define(["connectionManager","serverNotifications","events","globalize","emby-button"],(function(_connectionManager,_serverNotifications,_events,_globalize,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function onClick(e){var button=this,id=button.getAttribute("data-id"),serverId=button.getAttribute("data-serverid"),apiClient=_connectionManager.default.getApiClient(serverId),likes=this.getAttribute("data-likes");likes="true"===likes||"false"!==likes&&null,function showPicker(button,apiClient,itemId,likes,isFavorite){return apiClient.updateFavoriteStatus(apiClient.getCurrentUserId(),itemId,!isFavorite)}(0,apiClient,id,0,"true"===this.getAttribute("data-isfavorite")).then((function(userData){setState(button,userData.Likes,userData.IsFavorite)}))}function onUserDataChanged(e,apiClient,userData){userData.ItemId===this.getAttribute("data-id")&&setState(this,userData.Likes,userData.IsFavorite)}function setState(button,likes,isFavorite,updateAttribute){var icon=button.querySelector(".material-icons");isFavorite?(icon&&(icon.classList.add("favorite"),icon.classList.add("ratingbutton-icon-withrating")),button.classList.add("ratingbutton-withrating")):(icon&&(icon.classList.add("favorite"),icon.classList.remove("ratingbutton-icon-withrating")),button.classList.remove("ratingbutton-withrating")),!1!==updateAttribute&&(button.setAttribute("data-isfavorite",isFavorite),button.setAttribute("data-likes",null===likes?"":likes))}function clearEvents(button){button.removeEventListener("click",onClick),function removeNotificationEvent(instance,name){var handler=instance[name];handler&&(_events.default.off(_serverNotifications.default,name,handler),instance[name]=null)}(button,"UserDataChanged")}function bindEvents(button){clearEvents(button),button.addEventListener("click",onClick),function addNotificationEvent(instance,name,handler){var localHandler=handler.bind(instance);_events.default.on(_serverNotifications.default,name,localHandler),instance[name]=localHandler}(button,"UserDataChanged",onUserDataChanged)}_connectionManager=_interopRequireDefault(_connectionManager),_serverNotifications=_interopRequireDefault(_serverNotifications),_events=_interopRequireDefault(_events),_globalize=_interopRequireDefault(_globalize),_embyButton=_interopRequireDefault(_embyButton);var EmbyRatingButtonPrototype=Object.create(_embyButton.default);EmbyRatingButtonPrototype.createdCallback=function(){_embyButton.default.createdCallback&&_embyButton.default.createdCallback.call(this)},EmbyRatingButtonPrototype.attachedCallback=function(){_embyButton.default.attachedCallback&&_embyButton.default.attachedCallback.call(this);var itemId=this.getAttribute("data-id"),serverId=this.getAttribute("data-serverid");if(itemId&&serverId){var likes=this.getAttribute("data-likes");setState(this,likes="true"===likes||"false"!==likes&&null,"true"===this.getAttribute("data-isfavorite"),!1),bindEvents(this)}!function setTitle(button){button.title=_globalize.default.translate("Favorite");var text=button.querySelector(".button-text");text&&(text.innerHTML=button.title)}(this)},EmbyRatingButtonPrototype.detachedCallback=function(){_embyButton.default.detachedCallback&&_embyButton.default.detachedCallback.call(this),clearEvents(this)},EmbyRatingButtonPrototype.setItem=function(item){if(item){this.setAttribute("data-id",item.Id),this.setAttribute("data-serverid",item.ServerId);var userData=item.UserData||{};setState(this,userData.Likes,userData.IsFavorite),bindEvents(this)}else this.removeAttribute("data-id"),this.removeAttribute("data-serverid"),this.removeAttribute("data-likes"),this.removeAttribute("data-isfavorite"),clearEvents(this)},document.registerElement("emby-ratingbutton",{prototype:EmbyRatingButtonPrototype,extends:"button"})}));
//# sourceMappingURL=emby-ratingbutton.js.map
