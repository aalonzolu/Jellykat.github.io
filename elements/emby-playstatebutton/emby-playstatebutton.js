define(["connectionManager","serverNotifications","events","globalize","emby-button"],(function(_connectionManager,_serverNotifications,_events,_globalize,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function onClick(e){var id=this.getAttribute("data-id"),serverId=this.getAttribute("data-serverid"),apiClient=_connectionManager.default.getApiClient(serverId);this.classList.contains("playstatebutton-played")?(apiClient.markUnplayed(apiClient.getCurrentUserId(),id,new Date),setState(this,!1)):(apiClient.markPlayed(apiClient.getCurrentUserId(),id,new Date),setState(this,!0))}function onUserDataChanged(e,apiClient,userData){userData.ItemId===this.getAttribute("data-id")&&setState(this,userData.Played)}function setState(button,played,updateAttribute){var icon=button.iconElement;icon||(button.iconElement=button.querySelector(".material-icons"),icon=button.iconElement),played?(button.classList.add("playstatebutton-played"),icon&&(icon.classList.add("playstatebutton-icon-played"),icon.classList.remove("playstatebutton-icon-unplayed"))):(button.classList.remove("playstatebutton-played"),icon&&(icon.classList.remove("playstatebutton-icon-played"),icon.classList.add("playstatebutton-icon-unplayed"))),!1!==updateAttribute&&button.setAttribute("data-played",played)}function setTitle(button,itemType){button.title="AudioBook"!==itemType&&"AudioPodcast"!==itemType?_globalize.default.translate("Watched"):_globalize.default.translate("Played");var text=button.querySelector(".button-text");text&&(text.innerHTML=button.title)}function clearEvents(button){button.removeEventListener("click",onClick),function removeNotificationEvent(instance,name){var handler=instance[name];handler&&(_events.default.off(_serverNotifications.default,name,handler),instance[name]=null)}(button,"UserDataChanged")}function bindEvents(button){clearEvents(button),button.addEventListener("click",onClick),function addNotificationEvent(instance,name,handler){var localHandler=handler.bind(instance);_events.default.on(_serverNotifications.default,name,localHandler),instance[name]=localHandler}(button,"UserDataChanged",onUserDataChanged)}_connectionManager=_interopRequireDefault(_connectionManager),_serverNotifications=_interopRequireDefault(_serverNotifications),_events=_interopRequireDefault(_events),_globalize=_interopRequireDefault(_globalize),_embyButton=_interopRequireDefault(_embyButton);var EmbyPlaystateButtonPrototype=Object.create(_embyButton.default);EmbyPlaystateButtonPrototype.createdCallback=function(){_embyButton.default.createdCallback&&_embyButton.default.createdCallback.call(this)},EmbyPlaystateButtonPrototype.attachedCallback=function(){_embyButton.default.attachedCallback&&_embyButton.default.attachedCallback.call(this);var itemId=this.getAttribute("data-id"),serverId=this.getAttribute("data-serverid");itemId&&serverId&&(setState(this,"true"===this.getAttribute("data-played"),!1),bindEvents(this),setTitle(this,this.getAttribute("data-type")))},EmbyPlaystateButtonPrototype.detachedCallback=function(){_embyButton.default.detachedCallback&&_embyButton.default.detachedCallback.call(this),clearEvents(this),this.iconElement=null},EmbyPlaystateButtonPrototype.setItem=function(item){item?(this.setAttribute("data-id",item.Id),this.setAttribute("data-serverid",item.ServerId),setState(this,item.UserData&&item.UserData.Played),bindEvents(this),setTitle(this,item.Type)):(this.removeAttribute("data-id"),this.removeAttribute("data-serverid"),this.removeAttribute("data-played"),clearEvents(this))},document.registerElement("emby-playstatebutton",{prototype:EmbyPlaystateButtonPrototype,extends:"button"})}));
//# sourceMappingURL=emby-playstatebutton.js.map
