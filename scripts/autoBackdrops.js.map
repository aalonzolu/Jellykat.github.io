{"version":3,"sources":["scripts/autoBackdrops.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","define","_backdrop","userSettings","_libraryMenu","_getRequireWildcardCache","WeakMap","cache","_interopRequireDefault","__esModule","default","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","showBackdrop","type","parentId","apiClient","window","ApiClient","getBackdropItemIds","userId","types","concat","data","console","debug","JSON","parse","Promise","resolve","options","SortBy","Limit","Recursive","IncludeItemTypes","ImageTypes","ParentId","EnableTotalRecordCount","getItems","getCurrentUserId","then","result","images","Items","map","i","Id","tag","BackdropImageTags","ServerId","stringify","length","backdrop","setBackdrops","clearBackdrop","pageClassOn","this","classList","contains","enabled","enableBackdrops","remove","getAttribute","libraryMenu","getTopParentId"],"mappings":"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","file":"autoBackdrops.js","sourcesContent":["import backdrop from 'backdrop';\nimport * as userSettings from 'userSettings';\nimport libraryMenu from 'libraryMenu';\n\nconst cache = {};\n\nfunction enabled() {\n    return userSettings.enableBackdrops();\n}\n\nfunction getBackdropItemIds(apiClient, userId, types, parentId) {\n    const key = `backdrops2_${userId + (types || '') + (parentId || '')}`;\n    let data = cache[key];\n\n    if (data) {\n        console.debug(`Found backdrop id list in cache. Key: ${key}`);\n        data = JSON.parse(data);\n        return Promise.resolve(data);\n    }\n\n    const options = {\n        SortBy: 'IsFavoriteOrLiked,Random',\n        Limit: 20,\n        Recursive: true,\n        IncludeItemTypes: types,\n        ImageTypes: 'Backdrop',\n        ParentId: parentId,\n        EnableTotalRecordCount: false\n    };\n    return apiClient.getItems(apiClient.getCurrentUserId(), options).then(function (result) {\n        const images = result.Items.map(function (i) {\n            return {\n                Id: i.Id,\n                tag: i.BackdropImageTags[0],\n                ServerId: i.ServerId\n            };\n        });\n        cache[key] = JSON.stringify(images);\n        return images;\n    });\n}\n\nfunction showBackdrop(type, parentId) {\n    const apiClient = window.ApiClient;\n\n    if (apiClient) {\n        getBackdropItemIds(apiClient, apiClient.getCurrentUserId(), type, parentId).then(function (images) {\n            if (images.length) {\n                backdrop.setBackdrops(images.map(function (i) {\n                    i.BackdropImageTags = [i.tag];\n                    return i;\n                }));\n            } else {\n                backdrop.clearBackdrop();\n            }\n        });\n    }\n}\n\npageClassOn('pageshow', 'page', function () {\n    const page = this;\n\n    if (!page.classList.contains('selfBackdropPage')) {\n        if (page.classList.contains('backdropPage')) {\n            if (enabled()) {\n                const type = page.getAttribute('data-backdroptype');\n                const parentId = page.classList.contains('globalBackdropPage') ? '' : libraryMenu.getTopParentId();\n                showBackdrop(type, parentId);\n            } else {\n                page.classList.remove('backdropPage');\n                backdrop.clearBackdrop();\n            }\n        } else {\n            backdrop.clearBackdrop();\n        }\n    }\n});\n\n"]}