define(["exports","events","serverNotifications","connectionManager","globalize","emby-button"],(function(_exports,_events,_serverNotifications,_connectionManager,_globalize,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(options){function pollTasks(){_connectionManager.default.getApiClient(serverId).getScheduledTasks({IsEnabled:!0}).then(updateTasks)}function updateTasks(tasks){var task=tasks.filter((function(t){return t.Key==options.taskKey}))[0];if(options.panel&&(task?options.panel.classList.remove("hide"):options.panel.classList.add("hide")),task){"Idle"==task.State?button.removeAttribute("disabled"):button.setAttribute("disabled","disabled"),button.setAttribute("data-taskid",task.Id);var progress=(task.CurrentProgressPercentage||0).toFixed(1);if(options.progressElem&&(options.progressElem.value=progress,"Running"==task.State?options.progressElem.classList.remove("hide"):options.progressElem.classList.add("hide")),options.lastResultElem){var lastResult=task.LastExecutionResult?task.LastExecutionResult.Status:"";"Failed"==lastResult?options.lastResultElem.html('<span style="color:#FF0000;">('+_globalize.default.translate("LabelFailed")+")</span>"):"Cancelled"==lastResult?options.lastResultElem.html('<span style="color:#0026FF;">('+_globalize.default.translate("LabelCancelled")+")</span>"):"Aborted"==lastResult?options.lastResultElem.html('<span style="color:#FF0000;">'+_globalize.default.translate("LabelAbortedByServerShutdown")+"</span>"):options.lastResultElem.html(lastResult)}}}function onButtonClick(){!function onScheduledTaskMessageConfirmed(id){_connectionManager.default.getApiClient(serverId).startScheduledTask(id).then(pollTasks)}(this.getAttribute("data-taskid"))}function onScheduledTasksUpdate(e,apiClient,info){apiClient.serverId()===serverId&&updateTasks(info)}var pollInterval,button=options.button,serverId=ApiClient.serverId();function onPollIntervalFired(){_connectionManager.default.getApiClient(serverId).isMessageChannelOpen()||pollTasks()}options.panel&&options.panel.classList.add("hide");"off"==options.mode?(button.removeEventListener("click",onButtonClick),_events.default.off(_serverNotifications.default,"ScheduledTasksInfo",onScheduledTasksUpdate),function stopInterval(){_connectionManager.default.getApiClient(serverId).sendMessage("ScheduledTasksInfoStop"),pollInterval&&clearInterval(pollInterval)}()):(button.addEventListener("click",onButtonClick),pollTasks(),function startInterval(){var apiClient=_connectionManager.default.getApiClient(serverId);pollInterval&&clearInterval(pollInterval),apiClient.sendMessage("ScheduledTasksInfoStart","1000,1000"),pollInterval=setInterval(onPollIntervalFired,5e3)}(),_events.default.on(_serverNotifications.default,"ScheduledTasksInfo",onScheduledTasksUpdate))},_events=_interopRequireDefault(_events),_serverNotifications=_interopRequireDefault(_serverNotifications),_connectionManager=_interopRequireDefault(_connectionManager),_globalize=_interopRequireDefault(_globalize)}));
//# sourceMappingURL=taskbutton.js.map
