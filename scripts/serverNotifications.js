define(["require","exports","connectionManager","playbackManager","syncPlayManager","events","inputManager","focusManager","appRouter"],(function(_require,_exports,_connectionManager,_playbackManager,_syncPlayManager,_events,_inputManager,_focusManager,_appRouter){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_connectionManager=_interopRequireDefault(_connectionManager),_playbackManager=_interopRequireDefault(_playbackManager),_syncPlayManager=_interopRequireDefault(_syncPlayManager),_events=_interopRequireDefault(_events),_inputManager=_interopRequireDefault(_inputManager),_focusManager=_interopRequireDefault(_focusManager),_appRouter=_interopRequireDefault(_appRouter);var serverNotifications={};function notifyApp(){_inputManager.default.notify()}function processGeneralCommand(cmd,apiClient){switch(console.debug("Received command: "+cmd.Name),cmd.Name){case"Select":return void _inputManager.default.handleCommand("select");case"Back":return void _inputManager.default.handleCommand("back");case"MoveUp":return void _inputManager.default.handleCommand("up");case"MoveDown":return void _inputManager.default.handleCommand("down");case"MoveLeft":return void _inputManager.default.handleCommand("left");case"MoveRight":return void _inputManager.default.handleCommand("right");case"PageUp":return void _inputManager.default.handleCommand("pageup");case"PageDown":return void _inputManager.default.handleCommand("pagedown");case"PlayTrailers":!function playTrailers(apiClient,itemId){apiClient.getItem(apiClient.getCurrentUserId(),itemId).then((function(item){_playbackManager.default.playTrailers(item)}))}(apiClient,cmd.Arguments.ItemId);break;case"SetRepeatMode":_playbackManager.default.setRepeatMode(cmd.Arguments.RepeatMode);break;case"SetShuffleQueue":_playbackManager.default.setQueueShuffleMode(cmd.Arguments.ShuffleMode);break;case"VolumeUp":return void _inputManager.default.handleCommand("volumeup");case"VolumeDown":return void _inputManager.default.handleCommand("volumedown");case"ChannelUp":return void _inputManager.default.handleCommand("channelup");case"ChannelDown":return void _inputManager.default.handleCommand("channeldown");case"Mute":return void _inputManager.default.handleCommand("mute");case"Unmute":return void _inputManager.default.handleCommand("unmute");case"ToggleMute":return void _inputManager.default.handleCommand("togglemute");case"SetVolume":notifyApp(),_playbackManager.default.setVolume(cmd.Arguments.Volume);break;case"SetAudioStreamIndex":notifyApp(),_playbackManager.default.setAudioStreamIndex(parseInt(cmd.Arguments.Index));break;case"SetSubtitleStreamIndex":notifyApp(),_playbackManager.default.setSubtitleStreamIndex(parseInt(cmd.Arguments.Index));break;case"ToggleFullscreen":return void _inputManager.default.handleCommand("togglefullscreen");case"GoHome":return void _inputManager.default.handleCommand("home");case"GoToSettings":return void _inputManager.default.handleCommand("settings");case"DisplayContent":!function displayContent(cmd,apiClient){_playbackManager.default.isPlayingLocally(["Video","Book"])||_appRouter.default.showItem(cmd.Arguments.ItemId,apiClient.serverId())}(cmd,apiClient);break;case"GoToSearch":return void _inputManager.default.handleCommand("search");case"DisplayMessage":!function displayMessage(cmd){var args=cmd.Arguments;args.TimeoutMs?new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)({title:args.Header,text:args.Text})})):new Promise((function(_resolve,_reject){return _require(["alert"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){(0,_ref2.default)({title:args.Header,text:args.Text})}))}(cmd);break;case"ToggleOsd":case"ToggleContextMenu":case"TakeScreenShot":case"SendKey":break;case"SendString":_focusManager.default.sendText(cmd.Arguments.String);break;default:console.debug("processGeneralCommand does not recognize: "+cmd.Name)}notifyApp()}function onMessageReceived(e,msg){if("Play"===msg.MessageType){notifyApp();var serverId=this.serverInfo().Id;"PlayNext"===msg.Data.PlayCommand?_playbackManager.default.queueNext({ids:msg.Data.ItemIds,serverId:serverId}):"PlayLast"===msg.Data.PlayCommand?_playbackManager.default.queue({ids:msg.Data.ItemIds,serverId:serverId}):_playbackManager.default.play({ids:msg.Data.ItemIds,startPositionTicks:msg.Data.StartPositionTicks,mediaSourceId:msg.Data.MediaSourceId,audioStreamIndex:msg.Data.AudioStreamIndex,subtitleStreamIndex:msg.Data.SubtitleStreamIndex,startIndex:msg.Data.StartIndex,serverId:serverId})}else if("Playstate"===msg.MessageType)"Stop"===msg.Data.Command?_inputManager.default.handleCommand("stop"):"Pause"===msg.Data.Command?_inputManager.default.handleCommand("pause"):"Unpause"===msg.Data.Command?_inputManager.default.handleCommand("play"):"PlayPause"===msg.Data.Command?_inputManager.default.handleCommand("playpause"):"Seek"===msg.Data.Command?_playbackManager.default.seek(msg.Data.SeekPositionTicks):"NextTrack"===msg.Data.Command?_inputManager.default.handleCommand("next"):"PreviousTrack"===msg.Data.Command?_inputManager.default.handleCommand("previous"):notifyApp();else if("GeneralCommand"===msg.MessageType){processGeneralCommand(msg.Data,this)}else if("UserDataChanged"===msg.MessageType){if(msg.Data.UserId===this.getCurrentUserId())for(var i=0,length=msg.Data.UserDataList.length;i<length;i++)_events.default.trigger(serverNotifications,"UserDataChanged",[this,msg.Data.UserDataList[i]])}else"SyncPlayCommand"===msg.MessageType?_syncPlayManager.default.processCommand(msg.Data,this):"SyncPlayGroupUpdate"===msg.MessageType?_syncPlayManager.default.processGroupUpdate(msg.Data,this):_events.default.trigger(serverNotifications,msg.MessageType,[this,msg.Data])}function bindEvents(apiClient){_events.default.off(apiClient,"message",onMessageReceived),_events.default.on(apiClient,"message",onMessageReceived)}_connectionManager.default.getApiClients().forEach(bindEvents),_events.default.on(_connectionManager.default,"apiclientcreated",(function(e,newApiClient){bindEvents(newApiClient)}));var _default=serverNotifications;_exports.default=_default}));
//# sourceMappingURL=serverNotifications.js.map
