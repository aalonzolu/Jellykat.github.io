{"version":3,"sources":["scripts/clientUtils.js"],"names":["define","_require","_exports","_typeof","obj","Symbol","iterator","constructor","prototype","_slicedToArray","arr","i","_arrayWithHoles","Array","isArray","_iterableToArrayLimit","Object","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","value","length","err","_unsupportedIterableToArray","o","minLen","_arrayLikeToArray","n","toString","call","slice","name","from","test","_nonIterableRest","TypeError","len","arr2","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","__esModule","default","has","get","newObj","hasPropertyDescriptor","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","desc","set","getCurrentUser","window","ApiClient","serverAddress","AppInfo","isNativeApp","apiClient","urlLower","location","href","toLowerCase","index","lastIndexOf","substring","loc","address","protocol","hostname","port","getCurrentUserId","onServerChanged","userId","accessToken","logout","ConnectionManager","then","loginPage","navigate","getConfigurationPageUrl","encodeURIComponent","getConfigurationResourceUrl","getUrl","url","preserveQueryString","Error","queryString","getWindowLocationSearch","Promise","resolve","reject","_resolve","_reject","imported","_ref","show","processPluginConfigurationUpdateResult","all","_ref2","_ref3","loading","toast","hide","Globalize","translate","processServerConfigurationUpdateResult","result","_ref4","_ref5","processErrorResponse","response","_ref6","status","statusText","alert","title","message","headers","options","_ref8","text","callback","_ref7","capabilities","appHost","PlayableMediaTypes","SupportedCommands","SupportsPersistentIdentifier","appMode","SupportsMediaControl","assign","getPushTokenInfo","selectServer","NativeShell","hideLoadingMsg","_ref9","showLoadingMsg","_ref10","confirm","_ref11","catch","Dashboard","_default"],"mappings":"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","file":"clientUtils.js","sourcesContent":["\nexport function getCurrentUser() {\n    return window.ApiClient.getCurrentUser(false);\n}\n\n//TODO: investigate url prefix support for serverAddress function\nexport function serverAddress() {\n    if (AppInfo.isNativeApp) {\n        const apiClient = window.ApiClient;\n\n        if (apiClient) {\n            return apiClient.serverAddress();\n        }\n\n        return null;\n    }\n\n    const urlLower = window.location.href.toLowerCase();\n    const index = urlLower.lastIndexOf('/web');\n\n    if (index != -1) {\n        return urlLower.substring(0, index);\n    }\n\n    const loc = window.location;\n    let address = loc.protocol + '//' + loc.hostname;\n\n    if (loc.port) {\n        address += ':' + loc.port;\n    }\n\n    return address;\n}\n\nexport function getCurrentUserId() {\n    const apiClient = window.ApiClient;\n\n    if (apiClient) {\n        return apiClient.getCurrentUserId();\n    }\n\n    return null;\n}\n\nexport function onServerChanged(userId, accessToken, apiClient) {\n    apiClient = apiClient || window.ApiClient;\n    window.ApiClient = apiClient;\n}\n\nexport function logout() {\n    ConnectionManager.logout().then(function () {\n        let loginPage;\n\n        if (AppInfo.isNativeApp) {\n            loginPage = 'selectserver.html';\n            window.ApiClient = null;\n        } else {\n            loginPage = 'login.html';\n        }\n\n        navigate(loginPage);\n    });\n}\n\nexport function getConfigurationPageUrl(name) {\n    return 'configurationpage?name=' + encodeURIComponent(name);\n}\n\nexport function getConfigurationResourceUrl(name) {\n    if (AppInfo.isNativeApp) {\n        return ApiClient.getUrl('web/ConfigurationPage', {\n            name: name\n        });\n    }\n\n    return getConfigurationPageUrl(name);\n}\n\nexport function navigate(url, preserveQueryString) {\n    if (!url) {\n        throw new Error('url cannot be null or empty');\n    }\n\n    const queryString = getWindowLocationSearch();\n\n    if (preserveQueryString && queryString) {\n        url += queryString;\n    }\n\n    return new Promise(function (resolve, reject) {\n        import('appRouter').then(({default: appRouter}) => {\n            return appRouter.show(url).then(resolve, reject);\n        });\n    });\n}\n\nexport function processPluginConfigurationUpdateResult() {\n    Promise.all([\n        import('loading'),\n        import('toast')\n    ])\n        .then(([{default: loading}, {default: toast}]) => {\n            loading.hide();\n            toast(Globalize.translate('SettingsSaved'));\n        });\n}\n\nexport function processServerConfigurationUpdateResult(result) {\n    Promise.all([\n        import('loading'),\n        import('toast')\n    ])\n        .then(([{default: loading}, {default: toast}]) => {\n            loading.hide();\n            toast(Globalize.translate('SettingsSaved'));\n        });\n}\n\nexport function processErrorResponse(response) {\n    import('loading').then(({default: loading}) => {\n        loading.hide();\n    });\n\n    let status = '' + response.status;\n\n    if (response.statusText) {\n        status = response.statusText;\n    }\n\n    alert({\n        title: status,\n        message: response.headers ? response.headers.get('X-Application-Error-Code') : null\n    });\n}\n\nexport function alert(options) {\n    if (typeof options == 'string') {\n        return void import('toast').then(({default: toast}) => {\n            toast({\n                text: options\n            });\n        });\n    }\n\n    import('alert').then(({default: alert}) => {\n        alert({\n            title: options.title || Globalize.translate('HeaderAlert'),\n            text: options.message\n        }).then(options.callback || function () {});\n    });\n}\n\nexport function capabilities(appHost) {\n    let capabilities = {\n        PlayableMediaTypes: ['Audio', 'Video'],\n        SupportedCommands: ['MoveUp', 'MoveDown', 'MoveLeft', 'MoveRight', 'PageUp', 'PageDown', 'PreviousLetter', 'NextLetter', 'ToggleOsd', 'ToggleContextMenu', 'Select', 'Back', 'SendKey', 'SendString', 'GoHome', 'GoToSettings', 'VolumeUp', 'VolumeDown', 'Mute', 'Unmute', 'ToggleMute', 'SetVolume', 'SetAudioStreamIndex', 'SetSubtitleStreamIndex', 'DisplayContent', 'GoToSearch', 'DisplayMessage', 'SetRepeatMode', 'SetShuffleQueue', 'ChannelUp', 'ChannelDown', 'PlayMediaSource', 'PlayTrailers'],\n        SupportsPersistentIdentifier: window.appMode === 'cordova' || window.appMode === 'android',\n        SupportsMediaControl: true\n    };\n    return Object.assign(capabilities, appHost.getPushTokenInfo());\n}\n\nexport function selectServer() {\n    if (window.NativeShell && typeof window.NativeShell.selectServer === 'function') {\n        window.NativeShell.selectServer();\n    } else {\n        navigate('selectserver.html');\n    }\n}\n\nexport function hideLoadingMsg() {\n    import('loading').then(({default: loading}) => {\n        loading.hide();\n    });\n}\n\nexport function showLoadingMsg() {\n    import('loading').then(({default: loading}) => {\n        loading.show();\n    });\n}\n\nexport function confirm(message, title, callback) {\n    import('confirm').then(({default: confirm}) => {\n        confirm(message, title).then(function() {\n            callback(!0);\n        }).catch(function() {\n            callback(!1);\n        });\n    });\n}\n\n// This is used in plugins and templates, so keep it defined for now.\n// TODO: Remove once plugins don't need it\nwindow.Dashboard = {\n    alert,\n    capabilities,\n    confirm,\n    getConfigurationPageUrl,\n    getConfigurationResourceUrl,\n    getCurrentUser,\n    getCurrentUserId,\n    hideLoadingMsg,\n    logout,\n    navigate,\n    onServerChanged,\n    processErrorResponse,\n    processPluginConfigurationUpdateResult,\n    processServerConfigurationUpdateResult,\n    selectServer,\n    serverAddress,\n    showLoadingMsg\n};\n\nexport default {\n    alert,\n    capabilities,\n    confirm,\n    getConfigurationPageUrl,\n    getConfigurationResourceUrl,\n    getCurrentUser,\n    getCurrentUserId,\n    hideLoadingMsg,\n    logout,\n    navigate,\n    onServerChanged,\n    processErrorResponse,\n    processPluginConfigurationUpdateResult,\n    processServerConfigurationUpdateResult,\n    selectServer,\n    serverAddress,\n    showLoadingMsg\n};\n"]}