define(["require","exports","loading","listView","cardBuilder","libraryMenu","libraryBrowser","imageLoader","userSettings","emby-itemscontainer"],(function(_require,_exports,_loading,_listView,_cardBuilder,_libraryMenu,_libraryBrowser,_imageLoader,_userSettings,_embyItemscontainer){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){function getPageData(context){var key=getSavedQueryKey(context),pageData=data[key];return pageData||(pageData=data[key]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Playlist",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,CumulativeRunTimeTicks,CanDelete",StartIndex:0},view:_libraryBrowser.default.getSavedView(key)||"Poster"},_userSettings.default.libraryPageSize()>0&&(pageData.query.Limit=_userSettings.default.libraryPageSize()),pageData.query.ParentId=_libraryMenu.default.getTopParentId(),_libraryBrowser.default.loadSavedQueryValues(key,pageData.query)),pageData}function getSavedQueryKey(context){return context.savedQueryKey||(context.savedQueryKey=_libraryBrowser.default.getSavedQueryKey()),context.savedQueryKey}function onViewStyleChange(){var viewStyle=getPageData(view).view,itemsContainer=view.querySelector(".itemsContainer");"List"==viewStyle?(itemsContainer.classList.add("vertical-list"),itemsContainer.classList.remove("vertical-wrap")):(itemsContainer.classList.remove("vertical-list"),itemsContainer.classList.add("vertical-wrap")),itemsContainer.innerHTML=""}function reloadItems(){!function showLoadingMessage(){_loading.default.show()}();var query=function getQuery(context){return getPageData(context).query}(view),promise1=ApiClient.getItems(Dashboard.getCurrentUserId(),query),promise2=Dashboard.getCurrentUser();Promise.all([promise1,promise2]).then((function(responses){var result=responses[0];window.scrollTo(0,0);var html="",viewStyle=getPageData(view).view;view.querySelector(".listTopPaging").innerHTML=_libraryBrowser.default.getQueryPagingHtml({startIndex:query.StartIndex,limit:query.Limit,totalRecordCount:result.TotalRecordCount,viewButton:!1,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!0,layouts:"List,Poster,PosterCard,Thumb,ThumbCard",currentLayout:viewStyle}),result.TotalRecordCount?(html="List"==viewStyle?_listView.default.getListViewHtml({items:result.Items,sortBy:query.SortBy}):"PosterCard"==viewStyle?_cardBuilder.default.getCardsHtml({items:result.Items,shape:"square",coverImage:!0,showTitle:!0,cardLayout:!0}):"Thumb"==viewStyle?_cardBuilder.default.getCardsHtml({items:result.Items,shape:"backdrop",showTitle:!0,centerText:!0,preferThumb:!0,overlayPlayButton:!0}):"ThumbCard"==viewStyle?_cardBuilder.default.getCardsHtml({items:result.Items,shape:"backdrop",showTitle:!0,preferThumb:!0,cardLayout:!0}):_cardBuilder.default.getCardsHtml({items:result.Items,shape:"square",showTitle:!0,coverImage:!0,centerText:!0,overlayPlayButton:!0}),view.querySelector(".noItemsMessage").classList.add("hide")):view.querySelector(".noItemsMessage").classList.remove("hide");var elem=view.querySelector(".itemsContainer");elem.innerHTML=html,_imageLoader.default.lazyChildren(elem);var btnNextPage=view.querySelector(".btnNextPage");btnNextPage&&btnNextPage.addEventListener("click",(function(){_userSettings.default.libraryPageSize()>0&&(query.StartIndex+=query.Limit),reloadItems()}));var btnPreviousPage=view.querySelector(".btnPreviousPage");btnPreviousPage&&btnPreviousPage.addEventListener("click",(function(){_userSettings.default.libraryPageSize()>0&&(query.StartIndex=Math.max(0,query.StartIndex-query.Limit)),reloadItems()}));var btnChangeLayout=view.querySelector(".btnChangeLayout");btnChangeLayout&&btnChangeLayout.addEventListener("layoutchange",(function(e){var layout=e.detail.viewStyle;getPageData(view).view=layout,_libraryBrowser.default.saveViewSetting(getSavedQueryKey(view),layout),onViewStyleChange(),reloadItems()})),_libraryBrowser.default.saveQueryValues(getSavedQueryKey(view),query),function hideLoadingMessage(){_loading.default.hide()}()}))}var data={};view.addEventListener("viewbeforeshow",(function(){reloadItems()})),view.querySelector(".btnNewPlaylist").addEventListener("click",(function(){new Promise((function(_resolve,_reject){return _require(["playlistEditor"],(function(imported){return _resolve(function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(imported))}),_reject)})).then((function(_ref){new(0,_ref.default)({items:[],serverId:ApiClient.serverInfo().Id})}))})),onViewStyleChange()},_loading=_interopRequireDefault(_loading),_listView=_interopRequireDefault(_listView),_cardBuilder=_interopRequireDefault(_cardBuilder),_libraryMenu=_interopRequireDefault(_libraryMenu),_libraryBrowser=_interopRequireDefault(_libraryBrowser),_imageLoader=_interopRequireDefault(_imageLoader),_userSettings=_interopRequireDefault(_userSettings)}));
//# sourceMappingURL=playlists.js.map
