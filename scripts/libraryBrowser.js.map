{"version":3,"sources":["scripts/libraryBrowser.js"],"names":["define","_require","_exports","userSettings","_globalize","_typeof","obj","Symbol","iterator","constructor","prototype","_slicedToArray","arr","i","_arrayWithHoles","Array","isArray","_iterableToArrayLimit","Object","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","value","length","err","_unsupportedIterableToArray","o","minLen","_arrayLikeToArray","n","toString","call","slice","name","from","test","_nonIterableRest","TypeError","len","arr2","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","__esModule","default","has","get","newObj","hasPropertyDescriptor","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","desc","set","getSavedQueryKey","modifier","window","location","href","split","loadSavedQueryValues","query","values","JSON","parse","assign","saveQueryValues","SortBy","SortOrder","stringify","saveViewSetting","getSavedView","showLayoutMenu","button","currentLayout","views","dispatchEvent","getAttribute","menuItems","map","v","globalize","translate","id","selected","Promise","_resolve","_reject","imported","then","_ref","show","items","positionTo","callback","CustomEvent","detail","viewStyle","bubbles","cancelable","$","trigger","getQueryPagingHtml","options","startIndex","limit","totalRecordCount","html","recordsEnd","Math","min","showControls","viewButton","filterButton","sortButton","addLayoutButton","layouts","showSortMenu","all","_ref2","dialogHelper","onSortByChange","newValue","this","checked","changed","replace","StartIndex","onSortOrderChange","dlg","createDialog","removeOnClose","modal","entryAnimationDuration","exitAnimationDuration","classList","add","isChecked","option","radioValue","innerHTML","open","sortBys","querySelectorAll","addEventListener","sortOrders","_interopRequireDefault","libraryBrowser","LibraryBrowser","_default"],"mappings":"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","file":"libraryBrowser.js","sourcesContent":["import * as userSettings from 'userSettings';\nimport globalize from 'globalize';\n\nexport function getSavedQueryKey(modifier) {\n    return window.location.href.split('#')[0] + (modifier || '');\n}\n\nexport function loadSavedQueryValues(key, query) {\n    var values = userSettings.get(key);\n\n    if (values) {\n        values = JSON.parse(values);\n        return Object.assign(query, values);\n    }\n\n    return query;\n}\n\nexport function saveQueryValues(key, query) {\n    var values = {};\n\n    if (query.SortBy) {\n        values.SortBy = query.SortBy;\n    }\n\n    if (query.SortOrder) {\n        values.SortOrder = query.SortOrder;\n    }\n\n    userSettings.set(key, JSON.stringify(values));\n}\n\nexport function saveViewSetting (key, value) {\n    userSettings.set(key + '-_view', value);\n}\n\nexport function getSavedView (key) {\n    return userSettings.get(key + '-_view');\n}\n\nexport function showLayoutMenu (button, currentLayout, views) {\n    var dispatchEvent = true;\n\n    if (!views) {\n        dispatchEvent = false;\n        views = button.getAttribute('data-layouts');\n        views = views ? views.split(',') : ['List', 'Poster', 'PosterCard', 'Thumb', 'ThumbCard'];\n    }\n\n    var menuItems = views.map(function (v) {\n        return {\n            name: globalize.translate('Option' + v),\n            id: v,\n            selected: currentLayout == v\n        };\n    });\n\n    import('actionsheet').then(({default: actionsheet}) => {\n        actionsheet.show({\n            items: menuItems,\n            positionTo: button,\n            callback: function (id) {\n                button.dispatchEvent(new CustomEvent('layoutchange', {\n                    detail: {\n                        viewStyle: id\n                    },\n                    bubbles: true,\n                    cancelable: false\n                }));\n\n                if (!dispatchEvent) {\n                    if (window.$) {\n                        $(button).trigger('layoutchange', [id]);\n                    }\n                }\n            }\n        });\n    });\n}\n\nexport function getQueryPagingHtml (options) {\n    var startIndex = options.startIndex;\n    var limit = options.limit;\n    var totalRecordCount = options.totalRecordCount;\n    var html = '';\n    var recordsEnd = Math.min(startIndex + limit, totalRecordCount);\n    var showControls = limit < totalRecordCount;\n\n    if (html += '<div class=\"listPaging\">', showControls) {\n        html += '<span style=\"vertical-align:middle;\">';\n        html += globalize.translate('ListPaging', (totalRecordCount ? startIndex + 1 : 0), recordsEnd, totalRecordCount);\n        html += '</span>';\n    }\n\n    if (showControls || options.viewButton || options.filterButton || options.sortButton || options.addLayoutButton) {\n        html += '<div style=\"display:inline-block;\">';\n\n        if (showControls) {\n            html += '<button is=\"paper-icon-button-light\" class=\"btnPreviousPage autoSize\" ' + (startIndex ? '' : 'disabled') + '><span class=\"material-icons arrow_back\"></span></button>';\n            html += '<button is=\"paper-icon-button-light\" class=\"btnNextPage autoSize\" ' + (startIndex + limit >= totalRecordCount ? 'disabled' : '') + '><span class=\"material-icons arrow_forward\"></span></button>';\n        }\n\n        if (options.addLayoutButton) {\n            html += '<button is=\"paper-icon-button-light\" title=\"' + globalize.translate('ButtonSelectView') + '\" class=\"btnChangeLayout autoSize\" data-layouts=\"' + (options.layouts || '') + '\" onclick=\"LibraryBrowser.showLayoutMenu(this, \\'' + (options.currentLayout || '') + '\\');\"><span class=\"material-icons view_comfy\"></span></button>';\n        }\n\n        if (options.sortButton) {\n            html += '<button is=\"paper-icon-button-light\" class=\"btnSort autoSize\" title=\"' + globalize.translate('Sort') + '\"><span class=\"material-icons sort_by_alpha\"></span></button>';\n        }\n\n        if (options.filterButton) {\n            html += '<button is=\"paper-icon-button-light\" class=\"btnFilter autoSize\" title=\"' + globalize.translate('Filter') + '\"><span class=\"material-icons filter_list\"></span></button>';\n        }\n\n        html += '</div>';\n    }\n\n    return html += '</div>';\n}\n\nexport function showSortMenu (options) {\n    Promise.all([\n        import('dialogHelper'),\n        import('emby-radio')\n    ]).then(([{default: dialogHelper}]) => {\n        function onSortByChange() {\n            var newValue = this.value;\n\n            if (this.checked) {\n                var changed = options.query.SortBy != newValue;\n                options.query.SortBy = newValue.replace('_', ',');\n                options.query.StartIndex = 0;\n\n                if (options.callback && changed) {\n                    options.callback();\n                }\n            }\n        }\n\n        function onSortOrderChange() {\n            var newValue = this.value;\n\n            if (this.checked) {\n                var changed = options.query.SortOrder != newValue;\n                options.query.SortOrder = newValue;\n                options.query.StartIndex = 0;\n\n                if (options.callback && changed) {\n                    options.callback();\n                }\n            }\n        }\n\n        var dlg = dialogHelper.createDialog({\n            removeOnClose: true,\n            modal: false,\n            entryAnimationDuration: 160,\n            exitAnimationDuration: 200\n        });\n        dlg.classList.add('ui-body-a');\n        dlg.classList.add('background-theme-a');\n        dlg.classList.add('formDialog');\n        var html = '';\n        html += '<div style=\"margin:0;padding:1.25em 1.5em 1.5em;\">';\n        html += '<h2 style=\"margin:0 0 .5em;\">';\n        html += globalize.translate('HeaderSortBy');\n        html += '</h2>';\n        var i;\n        var length;\n        var isChecked;\n        html += '<div>';\n        for (i = 0, length = options.items.length; i < length; i++) {\n            var option = options.items[i];\n            var radioValue = option.id.replace(',', '_');\n            isChecked = (options.query.SortBy || '').replace(',', '_') == radioValue ? ' checked' : '';\n            html += '<label class=\"radio-label-block\"><input type=\"radio\" is=\"emby-radio\" name=\"SortBy\" data-id=\"' + option.id + '\" value=\"' + radioValue + '\" class=\"menuSortBy\" ' + isChecked + ' /><span>' + option.name + '</span></label>';\n        }\n\n        html += '</div>';\n        html += '<h2 style=\"margin: 1em 0 .5em;\">';\n        html += globalize.translate('HeaderSortOrder');\n        html += '</h2>';\n        html += '<div>';\n        isChecked = options.query.SortOrder == 'Ascending' ? ' checked' : '';\n        html += '<label class=\"radio-label-block\"><input type=\"radio\" is=\"emby-radio\" name=\"SortOrder\" value=\"Ascending\" class=\"menuSortOrder\" ' + isChecked + ' /><span>' + globalize.translate('OptionAscending') + '</span></label>';\n        isChecked = options.query.SortOrder == 'Descending' ? ' checked' : '';\n        html += '<label class=\"radio-label-block\"><input type=\"radio\" is=\"emby-radio\" name=\"SortOrder\" value=\"Descending\" class=\"menuSortOrder\" ' + isChecked + ' /><span>' + globalize.translate('OptionDescending') + '</span></label>';\n        html += '</div>';\n        html += '</div>';\n        dlg.innerHTML = html;\n        dialogHelper.open(dlg);\n        var sortBys = dlg.querySelectorAll('.menuSortBy');\n\n        for (i = 0, length = sortBys.length; i < length; i++) {\n            sortBys[i].addEventListener('change', onSortByChange);\n        }\n\n        var sortOrders = dlg.querySelectorAll('.menuSortOrder');\n\n        for (i = 0, length = sortOrders.length; i < length; i++) {\n            sortOrders[i].addEventListener('change', onSortOrderChange);\n        }\n    });\n}\n\nconst libraryBrowser = {\n    getSavedQueryKey,\n    loadSavedQueryValues,\n    saveQueryValues,\n    saveViewSetting,\n    getSavedView,\n    showLayoutMenu,\n    getQueryPagingHtml,\n    showSortMenu\n};\n\nwindow.LibraryBrowser = libraryBrowser;\n\nexport default libraryBrowser;\n"]}