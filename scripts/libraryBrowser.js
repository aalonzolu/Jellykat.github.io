define(["require","exports","userSettings","globalize"],(function(_require,_exports,userSettings,_globalize){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function getSavedQueryKey(modifier){return window.location.href.split("#")[0]+(modifier||"")}function loadSavedQueryValues(key,query){var values=userSettings.get(key);return values?(values=JSON.parse(values),Object.assign(query,values)):query}function saveQueryValues(key,query){var values={};query.SortBy&&(values.SortBy=query.SortBy),query.SortOrder&&(values.SortOrder=query.SortOrder),userSettings.set(key,JSON.stringify(values))}function saveViewSetting(key,value){userSettings.set(key+"-_view",value)}function getSavedView(key){return userSettings.get(key+"-_view")}function showLayoutMenu(button,currentLayout,views){var dispatchEvent=!0;views||(dispatchEvent=!1,views=(views=button.getAttribute("data-layouts"))?views.split(","):["List","Poster","PosterCard","Thumb","ThumbCard"]);var menuItems=views.map((function(v){return{name:_globalize.default.translate("Option"+v),id:v,selected:currentLayout==v}}));new Promise((function(_resolve,_reject){return _require(["actionsheet"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){_ref.default.show({items:menuItems,positionTo:button,callback:function callback(id){button.dispatchEvent(new CustomEvent("layoutchange",{detail:{viewStyle:id},bubbles:!0,cancelable:!1})),dispatchEvent||window.$&&$(button).trigger("layoutchange",[id])}})}))}function getQueryPagingHtml(options){var startIndex=options.startIndex,limit=options.limit,totalRecordCount=options.totalRecordCount,html="",recordsEnd=Math.min(startIndex+limit,totalRecordCount),showControls=limit<totalRecordCount;return html+='<div class="listPaging">',showControls&&(html+='<span style="vertical-align:middle;">',html+=_globalize.default.translate("ListPaging",totalRecordCount?startIndex+1:0,recordsEnd,totalRecordCount),html+="</span>"),(showControls||options.viewButton||options.filterButton||options.sortButton||options.addLayoutButton)&&(html+='<div style="display:inline-block;">',showControls&&(html+='<button is="paper-icon-button-light" class="btnPreviousPage autoSize" '+(startIndex?"":"disabled")+'><span class="material-icons arrow_back"></span></button>',html+='<button is="paper-icon-button-light" class="btnNextPage autoSize" '+(startIndex+limit>=totalRecordCount?"disabled":"")+'><span class="material-icons arrow_forward"></span></button>'),options.addLayoutButton&&(html+='<button is="paper-icon-button-light" title="'+_globalize.default.translate("ButtonSelectView")+'" class="btnChangeLayout autoSize" data-layouts="'+(options.layouts||"")+'" onclick="LibraryBrowser.showLayoutMenu(this, \''+(options.currentLayout||"")+'\');"><span class="material-icons view_comfy"></span></button>'),options.sortButton&&(html+='<button is="paper-icon-button-light" class="btnSort autoSize" title="'+_globalize.default.translate("Sort")+'"><span class="material-icons sort_by_alpha"></span></button>'),options.filterButton&&(html+='<button is="paper-icon-button-light" class="btnFilter autoSize" title="'+_globalize.default.translate("Filter")+'"><span class="material-icons filter_list"></span></button>'),html+="</div>"),html+"</div>"}function showSortMenu(options){Promise.all([new Promise((function(_resolve,_reject){return _require(["dialogHelper"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})),new Promise((function(_resolve,_reject){return _require(["emby-radio"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)}))]).then((function(_ref2){var dialogHelper=_slicedToArray(_ref2,1)[0].default;function onSortByChange(){var newValue=this.value;if(this.checked){var changed=options.query.SortBy!=newValue;options.query.SortBy=newValue.replace("_",","),options.query.StartIndex=0,options.callback&&changed&&options.callback()}}function onSortOrderChange(){var newValue=this.value;if(this.checked){var changed=options.query.SortOrder!=newValue;options.query.SortOrder=newValue,options.query.StartIndex=0,options.callback&&changed&&options.callback()}}var dlg=dialogHelper.createDialog({removeOnClose:!0,modal:!1,entryAnimationDuration:160,exitAnimationDuration:200});dlg.classList.add("ui-body-a"),dlg.classList.add("background-theme-a"),dlg.classList.add("formDialog");var i,length,isChecked,html="";for(html+='<div style="margin:0;padding:1.25em 1.5em 1.5em;">',html+='<h2 style="margin:0 0 .5em;">',html+=_globalize.default.translate("HeaderSortBy"),html+="</h2>",html+="<div>",i=0,length=options.items.length;i<length;i++){var option=options.items[i],radioValue=option.id.replace(",","_");isChecked=(options.query.SortBy||"").replace(",","_")==radioValue?" checked":"",html+='<label class="radio-label-block"><input type="radio" is="emby-radio" name="SortBy" data-id="'+option.id+'" value="'+radioValue+'" class="menuSortBy" '+isChecked+" /><span>"+option.name+"</span></label>"}html+="</div>",html+='<h2 style="margin: 1em 0 .5em;">',html+=_globalize.default.translate("HeaderSortOrder"),html+="</h2>",html+="<div>",html+='<label class="radio-label-block"><input type="radio" is="emby-radio" name="SortOrder" value="Ascending" class="menuSortOrder" '+(isChecked="Ascending"==options.query.SortOrder?" checked":"")+" /><span>"+_globalize.default.translate("OptionAscending")+"</span></label>",html+='<label class="radio-label-block"><input type="radio" is="emby-radio" name="SortOrder" value="Descending" class="menuSortOrder" '+(isChecked="Descending"==options.query.SortOrder?" checked":"")+" /><span>"+_globalize.default.translate("OptionDescending")+"</span></label>",html+="</div>",html+="</div>",dlg.innerHTML=html,dialogHelper.open(dlg);var sortBys=dlg.querySelectorAll(".menuSortBy");for(i=0,length=sortBys.length;i<length;i++)sortBys[i].addEventListener("change",onSortByChange);var sortOrders=dlg.querySelectorAll(".menuSortOrder");for(i=0,length=sortOrders.length;i<length;i++)sortOrders[i].addEventListener("change",onSortOrderChange)}))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getSavedQueryKey=getSavedQueryKey,_exports.loadSavedQueryValues=loadSavedQueryValues,_exports.saveQueryValues=saveQueryValues,_exports.saveViewSetting=saveViewSetting,_exports.getSavedView=getSavedView,_exports.showLayoutMenu=showLayoutMenu,_exports.getQueryPagingHtml=getQueryPagingHtml,_exports.showSortMenu=showSortMenu,_exports.default=void 0,userSettings=_interopRequireWildcard(userSettings),_globalize=function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}(_globalize);var libraryBrowser={getSavedQueryKey:getSavedQueryKey,loadSavedQueryValues:loadSavedQueryValues,saveQueryValues:saveQueryValues,saveViewSetting:saveViewSetting,getSavedView:getSavedView,showLayoutMenu:showLayoutMenu,getQueryPagingHtml:getQueryPagingHtml,showSortMenu:showSortMenu};window.LibraryBrowser=libraryBrowser;var _default=libraryBrowser;_exports.default=_default}));
//# sourceMappingURL=libraryBrowser.js.map
