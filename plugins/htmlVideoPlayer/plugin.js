define(["require","exports","browser","events","apphost","loading","dom","playbackManager","appRouter","connectionManager","htmlMediaHelper","itemHelper","screenfull","globalize"],(function(_require,_exports,_browser,_events,_apphost,_loading,_dom,_playbackManager,_appRouter,_connectionManager,_htmlMediaHelper,_itemHelper,_screenfull,_globalize){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e3){didErr=!0,err=_e3},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classPrivateFieldSet(receiver,privateMap,value){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to set private field on non-instance");if(descriptor.set)descriptor.set.call(receiver,value);else{if(!descriptor.writable)throw new TypeError("attempted to set read only private field");descriptor.value=value}return value}function _classPrivateFieldGet(receiver,privateMap){var descriptor=privateMap.get(receiver);if(!descriptor)throw new TypeError("attempted to get private field on non-instance");return descriptor.get?descriptor.get.call(receiver):descriptor.value}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function hidePrePlaybackPage(){document.querySelector(".page:not(.hide)").classList.add("hide"),document.body.classList.remove("force-scroll")}function normalizeTrackEventText(text,useHtml){var result=text.replace(/\\N/gi,"\n").replace(/\r/gi,"");return useHtml?result.replace(/\n/gi,"<br>"):result}function getTextTrackUrl(track,item,format){if(_itemHelper.default.isLocalItem(item)&&track.Path)return track.Path;var url=_playbackManager.default.getSubtitleUrl(track,item.ServerId);return format&&(url=url.replace(".vtt",format)),url}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=_exports.HtmlVideoPlayer=void 0,_browser=_interopRequireDefault(_browser),_events=_interopRequireDefault(_events),_apphost=_interopRequireDefault(_apphost),_loading=_interopRequireDefault(_loading),_dom=_interopRequireDefault(_dom),_playbackManager=_interopRequireDefault(_playbackManager),_appRouter=_interopRequireDefault(_appRouter),_connectionManager=_interopRequireDefault(_connectionManager),_itemHelper=_interopRequireDefault(_itemHelper),_screenfull=_interopRequireDefault(_screenfull),_globalize=_interopRequireDefault(_globalize);var _videoDialog=new WeakMap,_subtitleTrackIndexToSetOnPlaying=new WeakMap,_audioTrackIndexToSetOnPlaying=new WeakMap,_currentClock=new WeakMap,_currentSubtitlesOctopus=new WeakMap,_currentAssRenderer=new WeakMap,_customTrackIndex=new WeakMap,_showTrackOffset=new WeakMap,_currentTrackOffset=new WeakMap,_videoSubtitlesElem=new WeakMap,_currentTrackEvents=new WeakMap,_supportedFeatures=new WeakMap,_mediaElement=new WeakMap,_fetchQueue=new WeakMap,_currentSrc=new WeakMap,_started=new WeakMap,_timeUpdated=new WeakMap,_currentTime=new WeakMap,_flvPlayer=new WeakMap,_lastProfile=new WeakMap,_resizeObserver=new WeakMap,HtmlVideoPlayer=function(){function HtmlVideoPlayer(){var _this=this;!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HtmlVideoPlayer),_defineProperty(this,"name",void 0),_defineProperty(this,"type","mediaplayer"),_defineProperty(this,"id","htmlvideoplayer"),_defineProperty(this,"priority",1),_defineProperty(this,"isFetching",!1),_videoDialog.set(this,{writable:!0,value:void 0}),_subtitleTrackIndexToSetOnPlaying.set(this,{writable:!0,value:void 0}),_audioTrackIndexToSetOnPlaying.set(this,{writable:!0,value:void 0}),_currentClock.set(this,{writable:!0,value:void 0}),_currentSubtitlesOctopus.set(this,{writable:!0,value:void 0}),_currentAssRenderer.set(this,{writable:!0,value:void 0}),_customTrackIndex.set(this,{writable:!0,value:void 0}),_showTrackOffset.set(this,{writable:!0,value:void 0}),_currentTrackOffset.set(this,{writable:!0,value:void 0}),_videoSubtitlesElem.set(this,{writable:!0,value:void 0}),_currentTrackEvents.set(this,{writable:!0,value:void 0}),_supportedFeatures.set(this,{writable:!0,value:void 0}),_mediaElement.set(this,{writable:!0,value:void 0}),_fetchQueue.set(this,{writable:!0,value:0}),_currentSrc.set(this,{writable:!0,value:void 0}),_started.set(this,{writable:!0,value:void 0}),_timeUpdated.set(this,{writable:!0,value:void 0}),_currentTime.set(this,{writable:!0,value:void 0}),_flvPlayer.set(this,{writable:!0,value:void 0}),_defineProperty(this,"_hlsPlayer",void 0),_defineProperty(this,"_castPlayer",void 0),_defineProperty(this,"_currentPlayOptions",void 0),_lastProfile.set(this,{writable:!0,value:void 0}),_resizeObserver.set(this,{writable:!0,value:void 0}),_defineProperty(this,"onEnded",(function(e){var elem=e.target;_this.destroyCustomTrack(elem),(0,_htmlMediaHelper.onEndedInternal)(_this,elem,_this.onError)})),_defineProperty(this,"onTimeUpdate",(function(e){var elem=e.target,time=elem.currentTime;time&&!_classPrivateFieldGet(_this,_timeUpdated)&&(_classPrivateFieldSet(_this,_timeUpdated,!0),_this.ensureValidVideo(elem)),_classPrivateFieldSet(_this,_currentTime,time);var currentPlayOptions=_this._currentPlayOptions;if(currentPlayOptions){var timeMs=1e3*time;timeMs+=(currentPlayOptions.transcodingOffsetTicks||0)/1e4,_this.updateSubtitleText(timeMs)}_events.default.trigger(_this,"timeupdate")})),_defineProperty(this,"onVolumeChange",(function(e){var elem=e.target;(0,_htmlMediaHelper.saveVolume)(elem.volume),_events.default.trigger(_this,"volumechange")})),_defineProperty(this,"onNavigatedToOsd",(function(){var dlg=_classPrivateFieldGet(_this,_videoDialog);dlg&&(dlg.classList.remove("videoPlayerContainer-onTop"),_this.onStartedAndNavigatedToOsd())})),_defineProperty(this,"onPlaying",(function(e){var elem=e.target;_classPrivateFieldGet(_this,_started)||(_classPrivateFieldSet(_this,_started,!0),elem.removeAttribute("controls"),_loading.default.hide(),(0,_htmlMediaHelper.seekOnPlaybackStart)(_this,e.target,_this._currentPlayOptions.playerStartPositionTicks,(function(){_classPrivateFieldGet(_this,_currentSubtitlesOctopus)&&(_classPrivateFieldGet(_this,_currentSubtitlesOctopus).timeOffset=(_this._currentPlayOptions.transcodingOffsetTicks||0)/1e7+_classPrivateFieldGet(_this,_currentTrackOffset),_classPrivateFieldGet(_this,_currentSubtitlesOctopus).resize(),_classPrivateFieldGet(_this,_currentSubtitlesOctopus).resetRenderAheadCache(!1))})),_this._currentPlayOptions.fullscreen?_appRouter.default.showVideoOsd().then(_this.onNavigatedToOsd):(_appRouter.default.setTransparency("backdrop"),_classPrivateFieldGet(_this,_videoDialog).classList.remove("videoPlayerContainer-onTop"),_this.onStartedAndNavigatedToOsd())),_events.default.trigger(_this,"playing")})),_defineProperty(this,"onPlay",(function(){_events.default.trigger(_this,"unpause")})),_defineProperty(this,"onClick",(function(){_events.default.trigger(_this,"click")})),_defineProperty(this,"onDblClick",(function(){_events.default.trigger(_this,"dblclick")})),_defineProperty(this,"onPause",(function(){_events.default.trigger(_this,"pause")})),_defineProperty(this,"onError",(function(e){var type,elem=e.target,errorCode=elem.error&&elem.error.code||0,errorMessage=elem.error&&elem.error.message||"";switch(console.error("media element error: ".concat(errorCode," ").concat(errorMessage)),errorCode){case 1:return;case 2:type="network";break;case 3:if(_this._hlsPlayer)return void(0,_htmlMediaHelper.handleHlsJsMediaError)(_this);type="mediadecodeerror";break;case 4:type="medianotsupported";break;default:return}(0,_htmlMediaHelper.onErrorInternal)(_this,type)})),_browser.default.edgeUwp?this.name="Windows Video Player":this.name="Html Video Player"}var _fetchSubtitles;return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(HtmlVideoPlayer,[{key:"currentSrc",value:function currentSrc(){return _classPrivateFieldGet(this,_currentSrc)}},{key:"incrementFetchQueue",value:function incrementFetchQueue(){_classPrivateFieldGet(this,_fetchQueue)<=0&&(this.isFetching=!0,_events.default.trigger(this,"beginFetch")),_classPrivateFieldSet(this,_fetchQueue,1+ +_classPrivateFieldGet(this,_fetchQueue))}},{key:"decrementFetchQueue",value:function decrementFetchQueue(){_classPrivateFieldSet(this,_fetchQueue,+_classPrivateFieldGet(this,_fetchQueue)-1),_classPrivateFieldGet(this,_fetchQueue)<=0&&(this.isFetching=!1,_events.default.trigger(this,"endFetch"))}},{key:"updateVideoUrl",value:function updateVideoUrl(streamInfo){var isHls=streamInfo.url.toLowerCase().includes(".m3u8"),mediaSource=streamInfo.mediaSource,item=streamInfo.item;if(mediaSource&&item&&!mediaSource.RunTimeTicks&&isHls&&"Transcode"===streamInfo.playMethod&&(_browser.default.iOS||_browser.default.osx)){var hlsPlaylistUrl=streamInfo.url.replace("master.m3u8","live.m3u8");return _loading.default.show(),console.debug("prefetching hls playlist: ".concat(hlsPlaylistUrl)),_connectionManager.default.getApiClient(item.ServerId).ajax({type:"GET",url:hlsPlaylistUrl}).then((function(){console.debug("completed prefetching hls playlist: ".concat(hlsPlaylistUrl)),_loading.default.hide(),streamInfo.url=hlsPlaylistUrl}),(function(){console.error("error prefetching hls playlist: ".concat(hlsPlaylistUrl)),_loading.default.hide()}))}return Promise.resolve()}},{key:"play",value:function play(options){var _this2=this;return _classPrivateFieldSet(this,_started,!1),_classPrivateFieldSet(this,_timeUpdated,!1),_classPrivateFieldSet(this,_currentTime,null),this.resetSubtitleOffset(),this.createMediaElement(options).then((function(elem){return _this2.updateVideoUrl(options).then((function(){return _this2.setCurrentSrc(elem,options)}))}))}},{key:"setSrcWithFlvJs",value:function setSrcWithFlvJs(elem,options,url){var _this3=this;return new Promise((function(_resolve,_reject){return _require(["flvjs"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){var flvPlayer=_ref3.default.createPlayer({type:"flv",url:url},{seekType:"range",lazyLoad:!1});return flvPlayer.attachMediaElement(elem),flvPlayer.load(),_classPrivateFieldSet(_this3,_flvPlayer,flvPlayer),_classPrivateFieldSet(_this3,_currentSrc,url),flvPlayer.play()}))}},{key:"setSrcWithHlsJs",value:function setSrcWithHlsJs(elem,options,url){var _this4=this;return new Promise((function(resolve,reject){!function requireHlsPlayer(callback){new Promise((function(_resolve,_reject){return _require(["hlsjs"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){var hls=_ref.default;window.Hls=hls,callback()}))}((function(){var hls=new Hls({manifestLoadingTimeOut:2e4,xhrSetup:function xhrSetup(xhr){xhr.withCredentials=!0}});hls.loadSource(url),hls.attachMedia(elem),(0,_htmlMediaHelper.bindEventsToHlsPlayer)(_this4,hls,elem,_this4.onError,resolve,reject),_this4._hlsPlayer=hls,_classPrivateFieldSet(_this4,_currentSrc,url)}))}))}},{key:"setCurrentSrc",value:function setCurrentSrc(elem,options){var _this5=this;elem.removeEventListener("error",this.onError);var val=options.url;console.debug("playing url: ".concat(val));var seconds=(options.playerStartPositionTicks||0)/1e7;if(seconds&&(val+="#t=".concat(seconds)),(0,_htmlMediaHelper.destroyHlsPlayer)(this),(0,_htmlMediaHelper.destroyFlvPlayer)(this),(0,_htmlMediaHelper.destroyCastPlayer)(this),_classPrivateFieldSet(this,_subtitleTrackIndexToSetOnPlaying,null==options.mediaSource.DefaultSubtitleStreamIndex?-1:options.mediaSource.DefaultSubtitleStreamIndex),null!=_classPrivateFieldGet(this,_subtitleTrackIndexToSetOnPlaying)&&_classPrivateFieldGet(this,_subtitleTrackIndexToSetOnPlaying)>=0){var initialSubtitleStream=options.mediaSource.MediaStreams[_classPrivateFieldGet(this,_subtitleTrackIndexToSetOnPlaying)];initialSubtitleStream&&"Encode"!==initialSubtitleStream.DeliveryMethod||_classPrivateFieldSet(this,_subtitleTrackIndexToSetOnPlaying,-1)}_classPrivateFieldSet(this,_audioTrackIndexToSetOnPlaying,"Transcode"===options.playMethod?null:options.mediaSource.DefaultAudioStreamIndex),this._currentPlayOptions=options;var crossOrigin=(0,_htmlMediaHelper.getCrossOriginValue)(options.mediaSource);return crossOrigin&&(elem.crossOrigin=crossOrigin),(0,_htmlMediaHelper.enableHlsJsPlayer)(options.mediaSource.RunTimeTicks,"Video")&&val.includes(".m3u8")?this.setSrcWithHlsJs(elem,options,val):"Transcode"!==options.playMethod&&"flv"===options.mediaSource.Container?this.setSrcWithFlvJs(elem,options,val):(elem.autoplay=!0,elem.crossOrigin="use-credentials",(0,_htmlMediaHelper.applySrc)(elem,val,options).then((function(){return _classPrivateFieldSet(_this5,_currentSrc,val),(0,_htmlMediaHelper.playWithPromise)(elem,_this5.onError)})))}},{key:"setSubtitleStreamIndex",value:function setSubtitleStreamIndex(index){this.setCurrentTrackElement(index)}},{key:"resetSubtitleOffset",value:function resetSubtitleOffset(){_classPrivateFieldSet(this,_currentTrackOffset,0),_classPrivateFieldSet(this,_showTrackOffset,!1)}},{key:"enableShowingSubtitleOffset",value:function enableShowingSubtitleOffset(){_classPrivateFieldSet(this,_showTrackOffset,!0)}},{key:"disableShowingSubtitleOffset",value:function disableShowingSubtitleOffset(){_classPrivateFieldSet(this,_showTrackOffset,!1)}},{key:"isShowingSubtitleOffsetEnabled",value:function isShowingSubtitleOffsetEnabled(){return _classPrivateFieldGet(this,_showTrackOffset)}},{key:"getTextTrack",value:function getTextTrack(){var videoElement=_classPrivateFieldGet(this,_mediaElement);return videoElement?Array.from(videoElement.textTracks).find((function(trackElement){return"showing"===trackElement.mode})):null}},{key:"setSubtitleOffset",value:function setSubtitleOffset(offset){var offsetValue=parseFloat(offset);if(_classPrivateFieldGet(this,_currentSubtitlesOctopus))this.updateCurrentTrackOffset(offsetValue),_classPrivateFieldGet(this,_currentSubtitlesOctopus).timeOffset=(this._currentPlayOptions.transcodingOffsetTicks||0)/1e7+offsetValue;else{var trackElement=this.getTextTrack();trackElement?this.setTextTrackSubtitleOffset(trackElement,offsetValue):_classPrivateFieldGet(this,_currentTrackEvents)?this.setTrackEventsSubtitleOffset(_classPrivateFieldGet(this,_currentTrackEvents),offsetValue):console.debug("No available track, cannot apply offset: ",offsetValue)}}},{key:"updateCurrentTrackOffset",value:function updateCurrentTrackOffset(offsetValue){var relativeOffset=offsetValue,newTrackOffset=offsetValue;return _classPrivateFieldGet(this,_currentTrackOffset)&&(relativeOffset-=_classPrivateFieldGet(this,_currentTrackOffset)),_classPrivateFieldSet(this,_currentTrackOffset,newTrackOffset),relativeOffset}},{key:"setTextTrackSubtitleOffset",value:function setTextTrackSubtitleOffset(currentTrack,offsetValue){currentTrack.cues&&(offsetValue=this.updateCurrentTrackOffset(offsetValue),Array.from(currentTrack.cues).forEach((function(cue){cue.startTime-=offsetValue,cue.endTime-=offsetValue})))}},{key:"setTrackEventsSubtitleOffset",value:function setTrackEventsSubtitleOffset(trackEvents,offsetValue){Array.isArray(trackEvents)&&(offsetValue=1e7*this.updateCurrentTrackOffset(offsetValue),trackEvents.forEach((function(trackEvent){trackEvent.StartPositionTicks-=offsetValue,trackEvent.EndPositionTicks-=offsetValue})))}},{key:"getSubtitleOffset",value:function getSubtitleOffset(){return _classPrivateFieldGet(this,_currentTrackOffset)}},{key:"isAudioStreamSupported",value:function isAudioStreamSupported(stream,deviceProfile){var codec=(stream.Codec||"").toLowerCase();return!codec||(!deviceProfile||(deviceProfile.DirectPlayProfiles||[]).filter((function(p){return"Video"===p.Type&&(!p.AudioCodec||p.AudioCodec.toLowerCase().includes(codec))})).length>0)}},{key:"getSupportedAudioStreams",value:function getSupportedAudioStreams(){var _this6=this,profile=_classPrivateFieldGet(this,_lastProfile);return function getMediaStreamAudioTracks(mediaSource){return mediaSource.MediaStreams.filter((function(s){return"Audio"===s.Type}))}(this._currentPlayOptions.mediaSource).filter((function(stream){return _this6.isAudioStreamSupported(stream,profile)}))}},{key:"setAudioStreamIndex",value:function setAudioStreamIndex(index){var streams=this.getSupportedAudioStreams();if(!(streams.length<2)){var _step,audioIndex=-1,_iterator=_createForOfIteratorHelper(streams);try{for(_iterator.s();!(_step=_iterator.n()).done;){var stream=_step.value;if(audioIndex++,stream.Index===index)break}}catch(err){_iterator.e(err)}finally{_iterator.f()}if(-1!==audioIndex){var elem=_classPrivateFieldGet(this,_mediaElement);if(elem){var elemAudioTracks=elem.audioTracks||[];console.debug("found ".concat(elemAudioTracks.length," audio tracks"));var _step2,_iterator2=_createForOfIteratorHelper(Array.from(elemAudioTracks).entries());try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _step2$value=_slicedToArray(_step2.value,2),i=_step2$value[0],audioTrack=_step2$value[1];audioIndex===i?(console.debug("setting audio track ".concat(i," to enabled")),audioTrack.enabled=!0):(console.debug("setting audio track ".concat(i," to disabled")),audioTrack.enabled=!1)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}}}},{key:"stop",value:function stop(destroyPlayer){var elem=_classPrivateFieldGet(this,_mediaElement),src=_classPrivateFieldGet(this,_currentSrc);return elem&&(src&&elem.pause(),(0,_htmlMediaHelper.onEndedInternal)(this,elem,this.onError),destroyPlayer&&this.destroy()),this.destroyCustomTrack(elem),Promise.resolve()}},{key:"destroy",value:function destroy(){(0,_htmlMediaHelper.destroyHlsPlayer)(this),(0,_htmlMediaHelper.destroyFlvPlayer)(this),_appRouter.default.setTransparency("none");var videoElement=_classPrivateFieldGet(this,_mediaElement);videoElement&&(_classPrivateFieldSet(this,_mediaElement,null),this.destroyCustomTrack(videoElement),videoElement.removeEventListener("timeupdate",this.onTimeUpdate),videoElement.removeEventListener("ended",this.onEnded),videoElement.removeEventListener("volumechange",this.onVolumeChange),videoElement.removeEventListener("pause",this.onPause),videoElement.removeEventListener("playing",this.onPlaying),videoElement.removeEventListener("play",this.onPlay),videoElement.removeEventListener("click",this.onClick),videoElement.removeEventListener("dblclick",this.onDblClick),videoElement.removeEventListener("waiting",this.onWaiting),videoElement.parentNode.removeChild(videoElement));var dlg=_classPrivateFieldGet(this,_videoDialog);dlg&&(_classPrivateFieldSet(this,_videoDialog,null),dlg.parentNode.removeChild(dlg)),_screenfull.default.isEnabled?_screenfull.default.exit():document.webkitIsFullScreen&&document.webkitCancelFullscreen&&document.webkitCancelFullscreen()}},{key:"onStartedAndNavigatedToOsd",value:function onStartedAndNavigatedToOsd(){this.setCurrentTrackElement(_classPrivateFieldGet(this,_subtitleTrackIndexToSetOnPlaying)),null!=_classPrivateFieldGet(this,_audioTrackIndexToSetOnPlaying)&&this.canSetAudioStreamIndex()&&this.setAudioStreamIndex(_classPrivateFieldGet(this,_audioTrackIndexToSetOnPlaying))}},{key:"ensureValidVideo",value:function ensureValidVideo(elem){if(elem===_classPrivateFieldGet(this,_mediaElement)&&0===elem.videoWidth&&0===elem.videoHeight){var mediaSource=(this._currentPlayOptions||{}).mediaSource;mediaSource&&!mediaSource.RunTimeTicks||(0,_htmlMediaHelper.onErrorInternal)(this,"mediadecodeerror")}}},{key:"onWaiting",value:function onWaiting(){_events.default.trigger(this,"waiting")}},{key:"destroyCustomTrack",value:function destroyCustomTrack(videoElement){if(_classPrivateFieldGet(this,_resizeObserver)&&(_classPrivateFieldGet(this,_resizeObserver).disconnect(),_classPrivateFieldSet(this,_resizeObserver,null)),_classPrivateFieldGet(this,_videoSubtitlesElem)){var subtitlesContainer=_classPrivateFieldGet(this,_videoSubtitlesElem).parentNode;subtitlesContainer&&function tryRemoveElement(elem){var parentNode=elem.parentNode;if(parentNode)try{parentNode.removeChild(elem)}catch(err){console.error("error removing dialog element: ".concat(err))}}(subtitlesContainer),_classPrivateFieldSet(this,_videoSubtitlesElem,null)}if(_classPrivateFieldSet(this,_currentTrackEvents,null),videoElement){var _step3,_iterator3=_createForOfIteratorHelper(videoElement.textTracks||[]);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var track=_step3.value;track.label.includes("manualTrack")&&(track.mode="disabled")}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}_classPrivateFieldSet(this,_customTrackIndex,-1),_classPrivateFieldSet(this,_currentClock,null),this._currentAspectRatio=null;var octopus=_classPrivateFieldGet(this,_currentSubtitlesOctopus);octopus&&octopus.dispose(),_classPrivateFieldSet(this,_currentSubtitlesOctopus,null);var renderer=_classPrivateFieldGet(this,_currentAssRenderer);renderer&&renderer.setEnabled(!1),_classPrivateFieldSet(this,_currentAssRenderer,null)}},{key:"fetchSubtitlesUwp",value:function fetchSubtitlesUwp(track){return Windows.Storage.StorageFile.getFileFromPathAsync(track.Path).then((function(storageFile){return Windows.Storage.FileIO.readTextAsync(storageFile)})).then((function(text){return JSON.parse(text)}))}},{key:"fetchSubtitles",value:(_fetchSubtitles=function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}(regeneratorRuntime.mark((function _callee(track,item){var response;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!window.Windows||!_itemHelper.default.isLocalItem(item)){_context.next=2;break}return _context.abrupt("return",this.fetchSubtitlesUwp(track,item));case 2:return this.incrementFetchQueue(),_context.prev=3,_context.next=6,fetch(getTextTrackUrl(track,item,".js"));case 6:if((response=_context.sent).ok){_context.next=9;break}throw new Error(response);case 9:return _context.abrupt("return",response.json());case 10:return _context.prev=10,this.decrementFetchQueue(),_context.finish(10);case 13:case"end":return _context.stop()}}),_callee,this,[[3,,10,13]])}))),function fetchSubtitles(_x,_x2){return _fetchSubtitles.apply(this,arguments)})},{key:"setTrackForDisplay",value:function setTrackForDisplay(videoElement,track){if(track){if(_classPrivateFieldGet(this,_customTrackIndex)!==track.Index){this.resetSubtitleOffset();var item=this._currentPlayOptions.item;this.destroyCustomTrack(videoElement),_classPrivateFieldSet(this,_customTrackIndex,track.Index),this.renderTracksEvents(videoElement,track,item)}}else this.destroyCustomTrack(videoElement)}},{key:"renderSsaAss",value:function renderSsaAss(videoElement,track,item){var _this7=this,attachments=this._currentPlayOptions.mediaSource.MediaAttachments||[],apiClient=_connectionManager.default.getApiClient(item),htmlVideoPlayer=this,options={video:videoElement,subUrl:getTextTrackUrl(track,item),fonts:attachments.map((function(i){return apiClient.getUrl(i.DeliveryUrl)})),workerUrl:"".concat(_appRouter.default.baseUrl(),"/libraries/subtitles-octopus-worker.js"),legacyWorkerUrl:"".concat(_appRouter.default.baseUrl(),"/libraries/subtitles-octopus-worker-legacy.js"),onError:function onError(){(0,_htmlMediaHelper.onErrorInternal)(htmlVideoPlayer,"mediadecodeerror")},timeOffset:(this._currentPlayOptions.transcodingOffsetTicks||0)/1e7,renderMode:"blend",dropAllAnimations:!1,libassMemoryLimit:40,libassGlyphLimit:40,targetFps:24,prescaleTradeoff:.8,softHeightLimit:1080,hardHeightLimit:2160,resizeVariation:.2,renderAhead:90};new Promise((function(_resolve,_reject){return _require(["JavascriptSubtitlesOctopus"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref4){var SubtitlesOctopus=_ref4.default;_classPrivateFieldSet(_this7,_currentSubtitlesOctopus,new SubtitlesOctopus(options))}))}},{key:"requiresCustomSubtitlesElement",value:function requiresCustomSubtitlesElement(){if(_browser.default.ps4)return!0;if(_browser.default.firefox||_browser.default.web0s)return!0;if(_browser.default.edge)return!0;if(_browser.default.iOS){var userAgent=navigator.userAgent.toLowerCase();if((userAgent.includes("os 9")||userAgent.includes("os 8"))&&!userAgent.includes("safari"))return!0}return!1}},{key:"renderSubtitlesWithCustomElement",value:function renderSubtitlesWithCustomElement(videoElement,track,item){var _this8=this;this.fetchSubtitles(track,item).then((function(data){if(!_classPrivateFieldGet(_this8,_videoSubtitlesElem)){var subtitlesContainer=document.createElement("div");subtitlesContainer.classList.add("videoSubtitles"),subtitlesContainer.innerHTML='<div class="videoSubtitlesInner"></div>',_classPrivateFieldSet(_this8,_videoSubtitlesElem,subtitlesContainer.querySelector(".videoSubtitlesInner")),_this8.setSubtitleAppearance(subtitlesContainer,_classPrivateFieldGet(_this8,_videoSubtitlesElem)),videoElement.parentNode.appendChild(subtitlesContainer),_classPrivateFieldSet(_this8,_currentTrackEvents,data.TrackEvents)}}))}},{key:"setSubtitleAppearance",value:function setSubtitleAppearance(elem,innerElem){Promise.all([new Promise((function(_resolve,_reject){return _require(["userSettings"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})),new Promise((function(_resolve,_reject){return _require(["subtitleAppearanceHelper"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)}))]).then((function(_ref5){var _ref6=_slicedToArray(_ref5,2),userSettings=_ref6[0];_ref6[1].applyStyles({text:innerElem,window:elem},userSettings.getSubtitleAppearanceSettings())}))}},{key:"getCueCss",value:function getCueCss(appearance,selector){return"".concat(selector,"::cue {\n                ").concat(appearance.text.map((function(s){return void 0!==s.value&&""!==s.value?"".concat(s.name,":").concat(s.value,"!important;"):""})).join(""),"\n            }")}},{key:"setCueAppearance",value:function setCueAppearance(){var _this9=this;Promise.all([new Promise((function(_resolve,_reject){return _require(["userSettings"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})),new Promise((function(_resolve,_reject){return _require(["subtitleAppearanceHelper"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)}))]).then((function(_ref7){var _ref8=_slicedToArray(_ref7,2),userSettings=_ref8[0],subtitleAppearanceHelper=_ref8[1],elementId="".concat(_this9.id,"-cuestyle"),styleElem=document.querySelector("#".concat(elementId));styleElem||((styleElem=document.createElement("style")).id=elementId,document.getElementsByTagName("head")[0].appendChild(styleElem)),styleElem.innerHTML=_this9.getCueCss(subtitleAppearanceHelper.getStyles(userSettings.getSubtitleAppearanceSettings()),".htmlvideoplayer")}))}},{key:"renderTracksEvents",value:function renderTracksEvents(videoElement,track,item){if(!_itemHelper.default.isLocalItem(item)||track.IsExternal){var format=(track.Codec||"").toLowerCase();if("ssa"===format||"ass"===format)return void this.renderSsaAss(videoElement,track,item);if(this.requiresCustomSubtitlesElement())return void this.renderSubtitlesWithCustomElement(videoElement,track,item)}var trackElement=null;if(videoElement.textTracks&&videoElement.textTracks.length>0){trackElement=videoElement.textTracks[0];try{for(trackElement.mode="showing";trackElement.cues.length;)trackElement.removeCue(trackElement.cues[0])}catch(e){console.error("error removing cue from textTrack")}trackElement.mode="disabled"}else trackElement=videoElement.addTextTrack("subtitles","manualTrack","und");this.fetchSubtitles(track,item).then((function(data){new Promise((function(_resolve,_reject){return _require(["userSettings"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(userSettings){console.debug("downloaded ".concat(data.TrackEvents.length," track events"));var _step4,subtitleAppearance=userSettings.getSubtitleAppearanceSettings(),cueLine=parseInt(subtitleAppearance.verticalPosition,10),_iterator4=_createForOfIteratorHelper(data.TrackEvents);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var trackEvent=_step4.value,cue=new(window.VTTCue||window.TextTrackCue)(trackEvent.StartPositionTicks/1e7,trackEvent.EndPositionTicks/1e7,normalizeTrackEventText(trackEvent.Text,!1));"auto"===cue.line&&(cue.line=cueLine),trackElement.addCue(cue)}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}trackElement.mode="showing"}))}))}},{key:"updateSubtitleText",value:function updateSubtitleText(timeMs){var clock=_classPrivateFieldGet(this,_currentClock);if(clock)try{clock.seek(timeMs/1e3)}catch(err){console.error("error in libjass: ".concat(err))}else{var trackEvents=_classPrivateFieldGet(this,_currentTrackEvents),subtitleTextElement=_classPrivateFieldGet(this,_videoSubtitlesElem);if(trackEvents&&subtitleTextElement){var selectedTrackEvent,_step5,ticks=1e4*timeMs,_iterator5=_createForOfIteratorHelper(trackEvents);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var trackEvent=_step5.value;if(trackEvent.StartPositionTicks<=ticks&&trackEvent.EndPositionTicks>=ticks){selectedTrackEvent=trackEvent;break}}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}selectedTrackEvent&&selectedTrackEvent.Text?(subtitleTextElement.innerHTML=normalizeTrackEventText(selectedTrackEvent.Text,!0),subtitleTextElement.classList.remove("hide")):subtitleTextElement.classList.add("hide")}}}},{key:"setCurrentTrackElement",value:function setCurrentTrackElement(streamIndex){console.debug("setting new text track index to: ".concat(streamIndex));var mediaStreamTextTracks=function getMediaStreamTextTracks(mediaSource){return mediaSource.MediaStreams.filter((function(s){return"Subtitle"===s.Type}))}(this._currentPlayOptions.mediaSource),track=-1===streamIndex?null:mediaStreamTextTracks.filter((function(t){return t.Index===streamIndex}))[0];this.setTrackForDisplay(_classPrivateFieldGet(this,_mediaElement),track),!function enableNativeTrackSupport(currentSrc,track){if(track&&"Embed"===track.DeliveryMethod)return!0;if(_browser.default.firefox&&(currentSrc||"").toLowerCase().includes(".m3u8"))return!1;if(_browser.default.ps4)return!1;if(_browser.default.web0s)return!1;if(_browser.default.edge)return!1;if(_browser.default.iOS&&(_browser.default.iosVersion||10)<10)return!1;if(track){var format=(track.Codec||"").toLowerCase();if("ssa"===format||"ass"===format)return!1}return!0}(_classPrivateFieldGet(this,_currentSrc),track)?(streamIndex=-1,track=null):-1!==streamIndex&&this.setCueAppearance()}},{key:"createMediaElement",value:function createMediaElement(options){var _this10=this,dlg=document.querySelector(".videoPlayerContainer");return dlg?Promise.resolve(dlg.querySelector("video")):new Promise((function(_resolve,_reject){return _require(["css!./style"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(){_loading.default.show();var dlg=document.createElement("div");dlg.classList.add("videoPlayerContainer"),options.fullscreen&&dlg.classList.add("videoPlayerContainer-onTop");var html="";_apphost.default.supports("htmlvideoautoplay")?html+='<video class="htmlvideoplayer" preload="metadata" autoplay="autoplay" webkit-playsinline playsinline>':html+='<video class="htmlvideoplayer" preload="metadata" autoplay="autoplay" controls="controls" webkit-playsinline playsinline>',html+="</video>",dlg.innerHTML=html;var videoElement=dlg.querySelector("video");return videoElement.volume=(0,_htmlMediaHelper.getSavedVolume)(),videoElement.addEventListener("timeupdate",_this10.onTimeUpdate),videoElement.addEventListener("ended",_this10.onEnded),videoElement.addEventListener("volumechange",_this10.onVolumeChange),videoElement.addEventListener("pause",_this10.onPause),videoElement.addEventListener("playing",_this10.onPlaying),videoElement.addEventListener("play",_this10.onPlay),videoElement.addEventListener("click",_this10.onClick),videoElement.addEventListener("dblclick",_this10.onDblClick),videoElement.addEventListener("waiting",_this10.onWaiting),options.backdropUrl&&(videoElement.poster=options.backdropUrl),document.body.insertBefore(dlg,document.body.firstChild),_classPrivateFieldSet(_this10,_videoDialog,dlg),_classPrivateFieldSet(_this10,_mediaElement,videoElement),options.fullscreen&&_browser.default.supportsCssAnimation()&&!_browser.default.slow?function zoomIn(elem){return new Promise((function(resolve){elem.style.animation="htmlvideoplayer-zoomin ".concat(240,"ms ease-in normal"),hidePrePlaybackPage(),_dom.default.addEventListener(elem,_dom.default.whichAnimationEvent(),resolve,{once:!0})}))}(dlg).then((function(){return videoElement})):(hidePrePlaybackPage(),videoElement)}))}},{key:"canPlayMediaType",value:function canPlayMediaType(mediaType){return"video"===(mediaType||"").toLowerCase()}},{key:"supportsPlayMethod",value:function supportsPlayMethod(playMethod,item){return!_apphost.default.supportsPlayMethod||_apphost.default.supportsPlayMethod(playMethod,item)}},{key:"getDeviceProfile",value:function getDeviceProfile(item,options){var _this11=this;return HtmlVideoPlayer.getDeviceProfileInternal(item,options).then((function(profile){return _classPrivateFieldSet(_this11,_lastProfile,profile),profile}))}},{key:"supports",value:function supports(feature){return _classPrivateFieldGet(this,_supportedFeatures)||_classPrivateFieldSet(this,_supportedFeatures,HtmlVideoPlayer.getSupportedFeatures()),_classPrivateFieldGet(this,_supportedFeatures).includes(feature)}},{key:"currentTime",value:function currentTime(val){var mediaElement=_classPrivateFieldGet(this,_mediaElement);if(mediaElement){if(null!=val)return void(mediaElement.currentTime=val/1e3);var currentTime=_classPrivateFieldGet(this,_currentTime);return currentTime?1e3*currentTime:1e3*(mediaElement.currentTime||0)}}},{key:"duration",value:function duration(){var mediaElement=_classPrivateFieldGet(this,_mediaElement);if(mediaElement){var duration=mediaElement.duration;if((0,_htmlMediaHelper.isValidDuration)(duration))return 1e3*duration}return null}},{key:"canSetAudioStreamIndex",value:function canSetAudioStreamIndex(){if(_browser.default.tizen||_browser.default.orsay)return!0;var video=_classPrivateFieldGet(this,_mediaElement);return!(!video||!video.audioTracks)}},{key:"setPictureInPictureEnabled",value:function setPictureInPictureEnabled(isEnabled){var video=_classPrivateFieldGet(this,_mediaElement);document.pictureInPictureEnabled?video&&(isEnabled?video.requestPictureInPicture().catch(HtmlVideoPlayer.onPictureInPictureError):document.exitPictureInPicture().catch(HtmlVideoPlayer.onPictureInPictureError)):window.Windows?(this.isPip=isEnabled,isEnabled?Windows.UI.ViewManagement.ApplicationView.getForCurrentView().tryEnterViewModeAsync(Windows.UI.ViewManagement.ApplicationViewMode.compactOverlay):Windows.UI.ViewManagement.ApplicationView.getForCurrentView().tryEnterViewModeAsync(Windows.UI.ViewManagement.ApplicationViewMode.default)):video&&video.webkitSupportsPresentationMode&&"function"==typeof video.webkitSetPresentationMode&&video.webkitSetPresentationMode(isEnabled?"picture-in-picture":"inline")}},{key:"isPictureInPictureEnabled",value:function isPictureInPictureEnabled(){if(document.pictureInPictureEnabled)return!!document.pictureInPictureElement;if(window.Windows)return this.isPip||!1;var video=_classPrivateFieldGet(this,_mediaElement);return!!video&&"picture-in-picture"===video.webkitPresentationMode}},{key:"setAirPlayEnabled",value:function setAirPlayEnabled(isEnabled){var video=_classPrivateFieldGet(this,_mediaElement);document.AirPlayEnabled?video&&(isEnabled?video.requestAirPlay().catch((function(err){console.error("Error requesting AirPlay",err)})):document.exitAirPLay().catch((function(err){console.error("Error exiting AirPlay",err)}))):video.webkitShowPlaybackTargetPicker()}},{key:"setBrightness",value:function setBrightness(val){var elem=_classPrivateFieldGet(this,_mediaElement);if(elem){val=Math.max(0,val);var rawValue=val=Math.min(100,val),cssValue=(rawValue=Math.max(20,rawValue))>=100?"none":rawValue/100;elem.style["-webkit-filter"]="brightness(".concat(cssValue,")"),elem.style.filter="brightness(".concat(cssValue,")"),elem.brightnessValue=val,_events.default.trigger(this,"brightnesschange")}}},{key:"getBrightness",value:function getBrightness(){var elem=_classPrivateFieldGet(this,_mediaElement);if(elem){var val=elem.brightnessValue;return null==val?100:val}}},{key:"seekable",value:function seekable(){var mediaElement=_classPrivateFieldGet(this,_mediaElement);if(mediaElement){var seekable=mediaElement.seekable;if(seekable&&seekable.length){var start=seekable.start(0),end=seekable.end(0);return(0,_htmlMediaHelper.isValidDuration)(start)||(start=0),(0,_htmlMediaHelper.isValidDuration)(end)||(end=0),end-start>0}return!1}}},{key:"pause",value:function pause(){var mediaElement=_classPrivateFieldGet(this,_mediaElement);mediaElement&&mediaElement.pause()}},{key:"resume",value:function resume(){var mediaElement=_classPrivateFieldGet(this,_mediaElement);mediaElement&&mediaElement.play()}},{key:"unpause",value:function unpause(){var mediaElement=_classPrivateFieldGet(this,_mediaElement);mediaElement&&mediaElement.play()}},{key:"paused",value:function paused(){var mediaElement=_classPrivateFieldGet(this,_mediaElement);return!!mediaElement&&mediaElement.paused}},{key:"setPlaybackRate",value:function setPlaybackRate(value){var mediaElement=_classPrivateFieldGet(this,_mediaElement);mediaElement&&(mediaElement.playbackRate=value)}},{key:"getPlaybackRate",value:function getPlaybackRate(){var mediaElement=_classPrivateFieldGet(this,_mediaElement);return mediaElement?mediaElement.playbackRate:null}},{key:"getSupportedPlaybackRates",value:function getSupportedPlaybackRates(){return[{name:"0.5x",id:.5},{name:"0.75x",id:.75},{name:"1x",id:1},{name:"1.25x",id:1.25},{name:"1.5x",id:1.5},{name:"1.75x",id:1.75},{name:"2x",id:2}]}},{key:"setVolume",value:function setVolume(val){var mediaElement=_classPrivateFieldGet(this,_mediaElement);mediaElement&&(mediaElement.volume=val/100)}},{key:"getVolume",value:function getVolume(){var mediaElement=_classPrivateFieldGet(this,_mediaElement);if(mediaElement)return Math.min(Math.round(100*mediaElement.volume),100)}},{key:"volumeUp",value:function volumeUp(){this.setVolume(Math.min(this.getVolume()+2,100))}},{key:"volumeDown",value:function volumeDown(){this.setVolume(Math.max(this.getVolume()-2,0))}},{key:"setMute",value:function setMute(mute){var mediaElement=_classPrivateFieldGet(this,_mediaElement);mediaElement&&(mediaElement.muted=mute)}},{key:"isMuted",value:function isMuted(){var mediaElement=_classPrivateFieldGet(this,_mediaElement);return!!mediaElement&&mediaElement.muted}},{key:"setAspectRatio",value:function setAspectRatio(val){var mediaElement=_classPrivateFieldGet(this,_mediaElement);mediaElement&&("auto"===val?mediaElement.style.removeProperty("object-fit"):mediaElement.style["object-fit"]=val),this._currentAspectRatio=val}},{key:"getAspectRatio",value:function getAspectRatio(){return this._currentAspectRatio||"auto"}},{key:"getSupportedAspectRatios",value:function getSupportedAspectRatios(){return[{name:"Auto",id:"auto"},{name:"Cover",id:"cover"},{name:"Fill",id:"fill"}]}},{key:"togglePictureInPicture",value:function togglePictureInPicture(){return this.setPictureInPictureEnabled(!this.isPictureInPictureEnabled())}},{key:"toggleAirPlay",value:function toggleAirPlay(){return this.setAirPlayEnabled(!this.isAirPlayEnabled())}},{key:"getBufferedRanges",value:function getBufferedRanges(){var mediaElement=_classPrivateFieldGet(this,_mediaElement);return mediaElement?(0,_htmlMediaHelper.getBufferedRanges)(this,mediaElement):[]}},{key:"getStats",value:function getStats(){var mediaElement=_classPrivateFieldGet(this,_mediaElement),playOptions=this._currentPlayOptions||[],categories=[];if(!mediaElement)return Promise.resolve({categories:categories});var mediaCategory={stats:[],type:"media"};if(categories.push(mediaCategory),playOptions.url){var link=document.createElement("a");link.setAttribute("href",playOptions.url);var protocol=(link.protocol||"").replace(":","");protocol&&mediaCategory.stats.push({label:_globalize.default.translate("LabelProtocol"),value:protocol}),link=null}this._hlsPlayer?mediaCategory.stats.push({label:_globalize.default.translate("LabelStreamType"),value:"HLS"}):mediaCategory.stats.push({label:_globalize.default.translate("LabelStreamType"),value:"Video"});var videoCategory={stats:[],type:"video"};categories.push(videoCategory);var rect=mediaElement.getBoundingClientRect?mediaElement.getBoundingClientRect():{},height=parseInt(rect.height),width=parseInt(rect.width);if(width&&height&&!_browser.default.tv&&videoCategory.stats.push({label:_globalize.default.translate("LabelPlayerDimensions"),value:"".concat(width,"x").concat(height)}),height=mediaElement.videoHeight,(width=mediaElement.videoWidth)&&height&&videoCategory.stats.push({label:_globalize.default.translate("LabelVideoResolution"),value:"".concat(width,"x").concat(height)}),mediaElement.getVideoPlaybackQuality){var playbackQuality=mediaElement.getVideoPlaybackQuality(),droppedVideoFrames=playbackQuality.droppedVideoFrames||0;videoCategory.stats.push({label:_globalize.default.translate("LabelDroppedFrames"),value:droppedVideoFrames});var corruptedVideoFrames=playbackQuality.corruptedVideoFrames||0;videoCategory.stats.push({label:_globalize.default.translate("LabelCorruptedFrames"),value:corruptedVideoFrames})}var audioCategory={stats:[],type:"audio"};categories.push(audioCategory);var sinkId=mediaElement.sinkId;return sinkId&&audioCategory.stats.push({label:"Sink Id:",value:sinkId}),Promise.resolve({categories:categories})}}],[{key:"getDeviceProfileInternal",value:function getDeviceProfileInternal(item,options){return _apphost.default.getDeviceProfile?_apphost.default.getDeviceProfile(item,options):function getDefaultProfile(){return new Promise((function(_resolve,_reject){return _require(["browserdeviceprofile"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){return(0,_ref2.default)({})}))}()}},{key:"getSupportedFeatures",value:function getSupportedFeatures(){var list=[],video=document.createElement("video");return(video.webkitSupportsPresentationMode&&"function"==typeof video.webkitSetPresentationMode||document.pictureInPictureEnabled||window.Windows&&Windows.UI.ViewManagement.ApplicationView.getForCurrentView().isViewModeSupported(Windows.UI.ViewManagement.ApplicationViewMode.compactOverlay))&&list.push("PictureInPicture"),(_browser.default.safari||_browser.default.iOS||_browser.default.iPad)&&list.push("AirPlay"),"number"==typeof video.playbackRate&&list.push("PlaybackRate"),list.push("SetBrightness"),list.push("SetAspectRatio"),list}},{key:"onPictureInPictureError",value:function onPictureInPictureError(err){console.error("Picture in picture error: ".concat(err))}},{key:"isAirPlayEnabled",value:function isAirPlayEnabled(){return!!document.AirPlayEnabled&&!!document.AirplayElement}}]),HtmlVideoPlayer}();_exports.HtmlVideoPlayer=HtmlVideoPlayer;var _default=HtmlVideoPlayer;_exports.default=_default}));
//# sourceMappingURL=plugin.js.map
