define(["require","exports","events","browser","appRouter","loading"],(function(_require,_exports,_events,_browser,_appRouter,_loading){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function onVideoResize(){var player=this.currentYoutubePlayer,dlg=this.videoDialog;player&&dlg&&player.setSize(dlg.offsetWidth,dlg.offsetHeight)}function clearTimeUpdateInterval(instance){instance.timeUpdateInterval&&clearInterval(instance.timeUpdateInterval),instance.timeUpdateInterval=null}function onEndedInternal(instance){clearTimeUpdateInterval(instance);var resizeListener=instance.resizeListener;resizeListener&&(window.removeEventListener("resize",resizeListener),window.removeEventListener("orientationChange",resizeListener),instance.resizeListener=null);var stopInfo={src:instance._currentSrc};_events.default.trigger(instance,"stopped",[stopInfo]),instance._currentSrc=null,instance.currentYoutubePlayer&&instance.currentYoutubePlayer.destroy(),instance.currentYoutubePlayer=null}function onPlayerReady(event){event.target.playVideo()}function onTimeUpdate(e){_events.default.trigger(this,"timeupdate")}function onPlaying(instance,playOptions,resolve){instance.started||(instance.started=!0,resolve(),clearTimeUpdateInterval(instance),instance.timeUpdateInterval=setInterval(onTimeUpdate.bind(instance),500),playOptions.fullscreen?_appRouter.default.showVideoOsd().then((function(){instance.videoDialog.classList.remove("onTop")})):(_appRouter.default.setTransparency("backdrop"),instance.videoDialog.classList.remove("onTop")),new Promise((function(_resolve,_reject){return _require(["loading"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){_ref.default.hide()})))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_events=_interopRequireDefault(_events),_browser=_interopRequireDefault(_browser),_appRouter=_interopRequireDefault(_appRouter),_loading=_interopRequireDefault(_loading);var _default=function(){function YoutubePlayer(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,YoutubePlayer),this.name="Youtube Player",this.type="mediaplayer",this.id="youtubeplayer",this.priority=1}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(YoutubePlayer,[{key:"play",value:function play(options){this.started=!1;var instance=this;return function createMediaElement(instance,options){return new Promise((function(resolve,reject){var dlg=document.querySelector(".youtubePlayerContainer");dlg?resolve(dlg.querySelector("#player")):new Promise((function(_resolve,_reject){return _require(["css!./style"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(){_loading.default.show();var dlg=document.createElement("div");dlg.classList.add("youtubePlayerContainer"),options.fullscreen&&dlg.classList.add("onTop"),dlg.innerHTML='<div id="player"></div>';var videoElement=dlg.querySelector("#player");document.body.insertBefore(dlg,document.body.firstChild),instance.videoDialog=dlg,options.fullscreen&&dlg.animate&&!_browser.default.slow?(function zoomIn(elem,iterations){var timing={duration:240,iterations:iterations};return elem.animate([{transform:"scale3d(.2, .2, .2)  ",opacity:".6",offset:0},{transform:"none",opacity:"1",offset:1}],timing)}(dlg,1)).onfinish=function(){resolve(videoElement)}:resolve(videoElement)}))}))}(this,options).then((function(elem){return function setCurrentSrc(instance,elem,options){return new Promise((function(resolve,reject){new Promise((function(_resolve,_reject){return _require(["queryString"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){var queryString=_ref2.default;instance._currentSrc=options.url;var params=queryString.parse(options.url.split("?")[1]);if(window.onYouTubeIframeAPIReady=function(){instance.currentYoutubePlayer=new YT.Player("player",{height:instance.videoDialog.offsetHeight,width:instance.videoDialog.offsetWidth,videoId:params.v,events:{onReady:onPlayerReady,onStateChange:function onStateChange(event){event.data===YT.PlayerState.PLAYING?onPlaying(instance,options,resolve):event.data===YT.PlayerState.ENDED?onEndedInternal(instance):event.data===YT.PlayerState.PAUSED&&_events.default.trigger(instance,"pause")}},playerVars:{controls:0,enablejsapi:1,modestbranding:1,rel:0,showinfo:0,fs:0,playsinline:1}});var resizeListener=instance.resizeListener;resizeListener?(window.removeEventListener("resize",resizeListener),window.addEventListener("resize",resizeListener)):(resizeListener=instance.resizeListener=onVideoResize.bind(instance),window.addEventListener("resize",resizeListener)),window.removeEventListener("orientationChange",resizeListener),window.addEventListener("orientationChange",resizeListener)},window.YT)window.onYouTubeIframeAPIReady();else{var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}}))}))}(instance,0,options)}))}},{key:"stop",value:function stop(destroyPlayer){return this._currentSrc&&(this.currentYoutubePlayer&&this.currentYoutubePlayer.stopVideo(),onEndedInternal(this),destroyPlayer&&this.destroy()),Promise.resolve()}},{key:"destroy",value:function destroy(){_appRouter.default.setTransparency("none");var dlg=this.videoDialog;dlg&&(this.videoDialog=null,dlg.parentNode.removeChild(dlg))}},{key:"canPlayMediaType",value:function canPlayMediaType(mediaType){return"audio"===(mediaType=(mediaType||"").toLowerCase())||"video"===mediaType}},{key:"canPlayItem",value:function canPlayItem(item){return!1}},{key:"canPlayUrl",value:function canPlayUrl(url){return-1!==url.toLowerCase().indexOf("youtube.com")}},{key:"getDeviceProfile",value:function getDeviceProfile(){return Promise.resolve({})}},{key:"currentSrc",value:function currentSrc(){return this._currentSrc}},{key:"setSubtitleStreamIndex",value:function setSubtitleStreamIndex(index){}},{key:"canSetAudioStreamIndex",value:function canSetAudioStreamIndex(){return!1}},{key:"setAudioStreamIndex",value:function setAudioStreamIndex(index){}},{key:"currentTime",value:function currentTime(val){var currentYoutubePlayer=this.currentYoutubePlayer;if(currentYoutubePlayer)return null!=val?void currentYoutubePlayer.seekTo(val/1e3,!0):1e3*currentYoutubePlayer.getCurrentTime()}},{key:"duration",value:function duration(val){var currentYoutubePlayer=this.currentYoutubePlayer;return currentYoutubePlayer?1e3*currentYoutubePlayer.getDuration():null}},{key:"pause",value:function pause(){var currentYoutubePlayer=this.currentYoutubePlayer;if(currentYoutubePlayer){currentYoutubePlayer.pauseVideo();var instance=this;setTimeout((function(){_events.default.trigger(instance,"pause")}),200)}}},{key:"unpause",value:function unpause(){var currentYoutubePlayer=this.currentYoutubePlayer;if(currentYoutubePlayer){currentYoutubePlayer.playVideo();var instance=this;setTimeout((function(){_events.default.trigger(instance,"unpause")}),200)}}},{key:"paused",value:function paused(){var currentYoutubePlayer=this.currentYoutubePlayer;return!!currentYoutubePlayer&&2===currentYoutubePlayer.getPlayerState()}},{key:"volume",value:function volume(val){return null!=val?this.setVolume(val):this.getVolume()}},{key:"setVolume",value:function setVolume(val){var currentYoutubePlayer=this.currentYoutubePlayer;currentYoutubePlayer&&null!=val&&currentYoutubePlayer.setVolume(val)}},{key:"getVolume",value:function getVolume(){var currentYoutubePlayer=this.currentYoutubePlayer;if(currentYoutubePlayer)return currentYoutubePlayer.getVolume()}},{key:"setMute",value:function setMute(mute){var currentYoutubePlayer=this.currentYoutubePlayer;mute?currentYoutubePlayer&&currentYoutubePlayer.mute():currentYoutubePlayer&&currentYoutubePlayer.unMute()}},{key:"isMuted",value:function isMuted(){var currentYoutubePlayer=this.currentYoutubePlayer;if(currentYoutubePlayer)return currentYoutubePlayer.isMuted()}}]),YoutubePlayer}();_exports.default=_default}));
//# sourceMappingURL=plugin.js.map
