define(["require","exports","apphost","globalize","connectionManager","itemHelper","appRouter","playbackManager","browser","actionsheet"],(function(_require,_exports,_apphost,_globalize,_connectionManager,_itemHelper,_appRouter,_playbackManager,_browser,_actionsheet){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function getCommands(options){var item=options.item,user=options.user,canPlay=_playbackManager.default.canPlay(item),restrictOptions=(_browser.default.operaTv||_browser.default.web0s)&&!user.Policy.IsAdministrator,commands=[];canPlay&&"Photo"!==item.MediaType&&(!1!==options.play&&commands.push({name:_globalize.default.translate("Play"),id:"resume",icon:"play_arrow"}),options.playAllFromHere&&"Program"!==item.Type&&"TvChannel"!==item.Type&&commands.push({name:_globalize.default.translate("PlayAllFromHere"),id:"playallfromhere",icon:"play_arrow"})),null!==_playbackManager.default.getCurrentPlayer()&&(options.stopPlayback&&commands.push({name:_globalize.default.translate("StopPlayback"),id:"stopPlayback",icon:"stop"}),options.clearQueue&&commands.push({name:_globalize.default.translate("ClearQueue"),id:"clearQueue",icon:"clear_all"})),_playbackManager.default.canQueue(item)&&(!1!==options.queue&&commands.push({name:_globalize.default.translate("AddToPlayQueue"),id:"queue",icon:"playlist_add"}),!1!==options.queue&&commands.push({name:_globalize.default.translate("PlayNext"),id:"queuenext",icon:"playlist_add"})),(item.IsFolder||"MusicArtist"===item.Type||"MusicGenre"===item.Type)&&"livetv"!==item.CollectionType&&!1!==options.shuffle&&commands.push({name:_globalize.default.translate("Shuffle"),id:"shuffle",icon:"shuffle"}),"Audio"!==item.MediaType&&"MusicAlbum"!==item.Type&&"MusicArtist"!==item.Type&&"MusicGenre"!==item.Type||!1===options.instantMix||_itemHelper.default.isLocalItem(item)||commands.push({name:_globalize.default.translate("InstantMix"),id:"instantmix",icon:"explore"}),commands.length&&commands.push({divider:!0}),restrictOptions||(_itemHelper.default.supportsAddingToCollection(item)&&commands.push({name:_globalize.default.translate("AddToCollection"),id:"addtocollection",icon:"playlist_add"}),_itemHelper.default.supportsAddingToPlaylist(item)&&!1!==options.playlist&&commands.push({name:_globalize.default.translate("AddToPlaylist"),id:"addtoplaylist",icon:"playlist_add"})),"Timer"===item.Type&&user.Policy.EnableLiveTvManagement&&!1!==options.cancelTimer&&commands.push({name:_globalize.default.translate("CancelRecording"),id:"canceltimer",icon:"cancel"}),"Recording"===item.Type&&"InProgress"===item.Status&&user.Policy.EnableLiveTvManagement&&!1!==options.cancelTimer&&commands.push({name:_globalize.default.translate("CancelRecording"),id:"canceltimer",icon:"cancel"}),"SeriesTimer"===item.Type&&user.Policy.EnableLiveTvManagement&&!1!==options.cancelTimer&&commands.push({name:_globalize.default.translate("CancelSeries"),id:"cancelseriestimer",icon:"cancel"}),item.CanDelete&&!1!==options.deleteItem&&("Playlist"===item.Type||"BoxSet"===item.Type?commands.push({name:_globalize.default.translate("Delete"),id:"delete",icon:"delete"}):commands.push({name:_globalize.default.translate("DeleteMedia"),id:"delete",icon:"delete"})),item.CanDownload&&_apphost.default.supports("filedownload")&&"Book"!==item.Type&&(commands.push({name:_globalize.default.translate("Download"),id:"download",icon:"file_download"}),commands.push({name:_globalize.default.translate("CopyStreamURL"),id:"copy-stream",icon:"content_copy"})),commands.length&&commands.push({divider:!0});var canEdit=_itemHelper.default.canEdit(user,item);if(canEdit&&!1!==options.edit&&"SeriesTimer"!==item.Type){var text="Timer"===item.Type||"SeriesTimer"===item.Type?_globalize.default.translate("Edit"):_globalize.default.translate("EditMetadata");commands.push({name:text,id:"edit",icon:"edit"})}return _itemHelper.default.canEditImages(user,item)&&!1!==options.editImages&&commands.push({name:_globalize.default.translate("EditImages"),id:"editimages",icon:"image"}),canEdit&&("Video"!==item.MediaType||"TvChannel"===item.Type||"Program"===item.Type||"Virtual"===item.LocationType||"Recording"===item.Type&&"Completed"!==item.Status||!1!==options.editSubtitles&&commands.push({name:_globalize.default.translate("EditSubtitles"),id:"editsubtitles",icon:"closed_caption"})),!1!==options.identify&&_itemHelper.default.canIdentify(user,item)&&commands.push({name:_globalize.default.translate("Identify"),id:"identify",icon:"edit"}),item.MediaSources&&!1!==options.moremediainfo&&commands.push({name:_globalize.default.translate("MoreMediaInfo"),id:"moremediainfo",icon:"info"}),"Program"===item.Type&&!1!==options.record&&item.TimerId&&commands.push({name:_globalize.default.translate("ManageRecording"),id:"record",icon:"fiber_manual_record"}),"Program"===item.Type&&!1!==options.record&&(item.TimerId||commands.push({name:_globalize.default.translate("Record"),id:"record",icon:"fiber_manual_record"})),_itemHelper.default.canRefreshMetadata(item,user)&&commands.push({name:_globalize.default.translate("RefreshMetadata"),id:"refresh",icon:"refresh"}),item.PlaylistItemId&&options.playlistId&&commands.push({name:_globalize.default.translate("RemoveFromPlaylist"),id:"removefromplaylist",icon:"remove"}),options.collectionId&&commands.push({name:_globalize.default.translate("RemoveFromCollection"),id:"removefromcollection",icon:"remove"}),restrictOptions||!0===options.share&&_itemHelper.default.canShare(item,user)&&commands.push({name:_globalize.default.translate("Share"),id:"share",icon:"share"}),!1!==options.sync&&_itemHelper.default.canSync(user,item)&&commands.push({name:_globalize.default.translate("Sync"),id:"sync",icon:"sync"}),!1!==options.openAlbum&&item.AlbumId&&"Photo"!==item.MediaType&&commands.push({name:_globalize.default.translate("ViewAlbum"),id:"album",icon:"album"}),!1!==options.openArtist&&item.AlbumArtists&&item.AlbumArtists.length&&commands.push({name:_globalize.default.translate("ViewAlbumArtist"),id:"artist",icon:"person"}),commands}function getResolveFunction(resolve,id,changed,deleted){return function(){resolve({command:id,updated:changed,deleted:deleted})}}function executeCommand(item,id,options){var itemId=item.Id,serverId=item.ServerId,apiClient=_connectionManager.default.getApiClient(serverId);return new Promise((function(resolve,reject){switch(id){case"addtocollection":new Promise((function(_resolve,_reject){return _require(["collectionEditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){new(0,_ref.default)({items:[itemId],serverId:serverId}).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id))}));break;case"addtoplaylist":new Promise((function(_resolve,_reject){return _require(["playlistEditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){new(0,_ref2.default)({items:[itemId],serverId:serverId}).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id))}));break;case"download":new Promise((function(_resolve,_reject){return _require(["fileDownloader"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(fileDownloader){var downloadHref=apiClient.getItemDownloadUrl(itemId);fileDownloader.download([{url:downloadHref,itemId:itemId,serverId:serverId,title:item.Name,filename:item.Path.replace(/^.*[\\\/]/,"")}]),getResolveFunction(getResolveFunction(resolve,id),id)()}));break;case"copy-stream":var downloadHref=apiClient.getItemDownloadUrl(itemId),textAreaCopy=function textAreaCopy(){var textArea=document.createElement("textarea");textArea.value=downloadHref,document.body.appendChild(textArea),textArea.focus(),textArea.select(),document.execCommand("copy")?new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){(0,_ref3.default)(_globalize.default.translate("CopyStreamURLSuccess"))})):prompt(_globalize.default.translate("CopyStreamURL"),downloadHref),document.body.removeChild(textArea)};void 0===navigator.clipboard?textAreaCopy():navigator.clipboard.writeText(downloadHref).then((function(){new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref4){(0,_ref4.default)(_globalize.default.translate("CopyStreamURLSuccess"))}))})).catch((function(){textAreaCopy()})),getResolveFunction(resolve,id)();break;case"editsubtitles":new Promise((function(_resolve,_reject){return _require(["subtitleEditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref5){_ref5.default.show(itemId,serverId).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id))}));break;case"edit":(function editItem(apiClient,item){return new Promise((function(resolve,reject){var serverId=apiClient.serverInfo().Id;"Timer"===item.Type?new Promise((function(_resolve,_reject){return _require(["recordingEditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref12){_ref12.default.show(item.Id,serverId).then(resolve,reject)})):"SeriesTimer"===item.Type?new Promise((function(_resolve,_reject){return _require(["seriesRecordingEditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref13){_ref13.default.show(item.Id,serverId).then(resolve,reject)})):new Promise((function(_resolve,_reject){return _require(["metadataEditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref14){_ref14.default.show(item.Id,serverId).then(resolve,reject)}))}))})(apiClient,item).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id));break;case"editimages":new Promise((function(_resolve,_reject){return _require(["imageEditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref6){_ref6.default.show({itemId:itemId,serverId:serverId}).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id))}));break;case"identify":new Promise((function(_resolve,_reject){return _require(["itemIdentifier"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref7){_ref7.default.show(itemId,serverId).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id))}));break;case"moremediainfo":new Promise((function(_resolve,_reject){return _require(["itemMediaInfo"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref8){_ref8.default.show(itemId,serverId).then(getResolveFunction(resolve,id),getResolveFunction(resolve,id))}));break;case"refresh":!function refresh(apiClient,item){new Promise((function(_resolve,_reject){return _require(["refreshDialog"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref16){new(0,_ref16.default)({itemIds:[item.Id],serverId:apiClient.serverInfo().Id,mode:"CollectionFolder"===item.Type?"scan":null}).show()}))}(apiClient,item),getResolveFunction(resolve,id)();break;case"open":_appRouter.default.showItem(item),getResolveFunction(resolve,id)();break;case"play":play(item,!1),getResolveFunction(resolve,id)();break;case"resume":play(item,!0),getResolveFunction(resolve,id)();break;case"queue":play(item,!1,!0),getResolveFunction(resolve,id)();break;case"queuenext":play(item,!1,!0,!0),getResolveFunction(resolve,id)();break;case"stopPlayback":_playbackManager.default.stop();break;case"clearQueue":_playbackManager.default.clearQueue();break;case"record":new Promise((function(_resolve,_reject){return _require(["recordingCreator"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref9){_ref9.default.show(itemId,serverId).then(getResolveFunction(resolve,id,!0),getResolveFunction(resolve,id))}));break;case"shuffle":_playbackManager.default.shuffle(item),getResolveFunction(resolve,id)();break;case"instantmix":_playbackManager.default.instantMix(item),getResolveFunction(resolve,id)();break;case"delete":(function deleteItem(apiClient,item){return new Promise((function(resolve,reject){new Promise((function(_resolve,_reject){return _require(["deleteHelper"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref15){_ref15.default.deleteItem({item:item,navigate:!1}).then((function(){resolve(!0)}),reject)}))}))})(0,item).then(getResolveFunction(resolve,id,!0,!0),getResolveFunction(resolve,id));break;case"share":navigator.share({title:item.Name,text:item.Overview,url:"".concat(apiClient.serverAddress(),"/web/index.html#!/").concat(_appRouter.default.getRouteUrl(item))});break;case"album":_appRouter.default.showItem(item.AlbumId,item.ServerId),getResolveFunction(resolve,id)();break;case"artist":_appRouter.default.showItem(item.AlbumArtists[0].Id,item.ServerId),getResolveFunction(resolve,id)();break;case"playallfromhere":case"queueallfromhere":getResolveFunction(resolve,id)();break;case"removefromplaylist":apiClient.ajax({url:apiClient.getUrl("Playlists/"+options.playlistId+"/Items",{EntryIds:[item.PlaylistItemId].join(",")}),type:"DELETE"}).then((function(){getResolveFunction(resolve,id,!0)()}));break;case"removefromcollection":apiClient.ajax({type:"DELETE",url:apiClient.getUrl("Collections/"+options.collectionId+"/Items",{Ids:[item.Id].join(",")})}).then((function(){getResolveFunction(resolve,id,!0)()}));break;case"canceltimer":!function deleteTimer(apiClient,item,resolve,command){new Promise((function(_resolve,_reject){return _require(["recordingHelper"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref10){var recordingHelper=_ref10.default,timerId=item.TimerId||item.Id;recordingHelper.cancelTimerWithConfirmation(timerId,item.ServerId).then((function(){getResolveFunction(resolve,command,!0)()}))}))}(0,item,resolve,id);break;case"cancelseriestimer":!function deleteSeriesTimer(apiClient,item,resolve,command){new Promise((function(_resolve,_reject){return _require(["recordingHelper"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref11){_ref11.default.cancelSeriesTimerWithConfirmation(item.Id,item.ServerId).then((function(){getResolveFunction(resolve,command,!0)()}))}))}(0,item,resolve,id);break;default:reject()}}))}function play(item,resume,queue,queueNext){var method=queue?queueNext?"queueNext":"queue":"play",startPosition=0;resume&&item.UserData&&item.UserData.PlaybackPositionTicks&&(startPosition=item.UserData.PlaybackPositionTicks),"Program"===item.Type?_playbackManager.default[method]({ids:[item.ChannelId],startPositionTicks:startPosition,serverId:item.ServerId}):_playbackManager.default[method]({items:[item],startPositionTicks:startPosition})}function show(options){var commands=getCommands(options);return commands.length?_actionsheet.default.show({items:commands,positionTo:options.positionTo,resolveOnClick:["share"]}).then((function(id){return executeCommand(options.item,id,options)})):Promise.reject()}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getCommands=getCommands,_exports.show=show,_exports.default=void 0,_apphost=_interopRequireDefault(_apphost),_globalize=_interopRequireDefault(_globalize),_connectionManager=_interopRequireDefault(_connectionManager),_itemHelper=_interopRequireDefault(_itemHelper),_appRouter=_interopRequireDefault(_appRouter),_playbackManager=_interopRequireDefault(_playbackManager),_browser=_interopRequireDefault(_browser),_actionsheet=_interopRequireDefault(_actionsheet);var _default={getCommands:getCommands,show:show};_exports.default=_default}));
//# sourceMappingURL=itemContextMenu.js.map
