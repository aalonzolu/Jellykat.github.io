define(["exports","datetime","globalize","appRouter","itemHelper","indicators","material-icons","css!./mediainfo.css","programStyles","emby-button"],(function(_exports,_datetime,_globalize,_appRouter,_itemHelper,_indicators,_materialIcons,_mediainfo,_programStyles,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getMediaInfoHtml(item,options){var text,date,minutes,count,html="",miscInfo=[];options=options||{};var showFolderRuntime="MusicAlbum"===item.Type||"MusicArtist"===item.MediaType||"Playlist"===item.MediaType||"MusicGenre"===item.MediaType;if(showFolderRuntime?((count=item.SongCount||item.ChildCount)&&miscInfo.push(_globalize.default.translate("TrackCount",count)),item.RunTimeTicks&&miscInfo.push(_datetime.default.getDisplayRunningTime(item.RunTimeTicks))):"PhotoAlbum"!==item.Type&&"BoxSet"!==item.Type||(count=item.ChildCount)&&miscInfo.push(_globalize.default.translate("ItemCount",count)),("Episode"===item.Type||"Photo"===item.MediaType)&&!1!==options.originalAirDate&&item.PremiereDate)try{date=_datetime.default.parseISO8601Date(item.PremiereDate),text=_datetime.default.toLocaleDateString(date),miscInfo.push(text)}catch(e){console.error("error parsing date:",item.PremiereDate)}if("SeriesTimer"===item.Type&&(item.RecordAnyTime?miscInfo.push(_globalize.default.translate("Anytime")):miscInfo.push(_datetime.default.getDisplayTime(item.StartDate)),item.RecordAnyChannel?miscInfo.push(_globalize.default.translate("AllChannels")):miscInfo.push(item.ChannelName||_globalize.default.translate("OneChannel"))),item.StartDate&&"Program"!==item.Type&&"SeriesTimer"!==item.Type)try{date=_datetime.default.parseISO8601Date(item.StartDate),text=_datetime.default.toLocaleDateString(date),miscInfo.push(text),"Recording"!==item.Type&&(text=_datetime.default.getDisplayTime(date),miscInfo.push(text))}catch(e){console.error("error parsing date:",item.StartDate)}if(!1!==options.year&&item.ProductionYear&&"Series"===item.Type)if("Continuing"===item.Status)miscInfo.push(_globalize.default.translate("SeriesYearToPresent",item.ProductionYear));else if(item.ProductionYear){if(text=item.ProductionYear,item.EndDate)try{_datetime.default.parseISO8601Date(item.EndDate).getFullYear()!==item.ProductionYear&&(text+="-".concat(_datetime.default.parseISO8601Date(item.EndDate).getFullYear()))}catch(e){console.error("error parsing date:",item.EndDate)}miscInfo.push(text)}if("Program"===item.Type)if(!1!==options.programIndicator&&(item.IsLive?miscInfo.push({html:'<div class="mediaInfoProgramAttribute mediaInfoItem liveTvProgram">'.concat(_globalize.default.translate("Live"),"</div>")}):item.IsPremiere?miscInfo.push({html:'<div class="mediaInfoProgramAttribute mediaInfoItem premiereTvProgram">'.concat(_globalize.default.translate("Premiere"),"</div>")}):item.IsSeries&&!item.IsRepeat?miscInfo.push({html:'<div class="mediaInfoProgramAttribute mediaInfoItem newTvProgram">'.concat(_globalize.default.translate("New"),"</div>")}):item.IsSeries&&item.IsRepeat&&miscInfo.push({html:'<div class="mediaInfoProgramAttribute mediaInfoItem repeatTvProgram">'.concat(_globalize.default.translate("Repeat"),"</div>")})),(item.IsSeries||item.EpisodeTitle)&&!1!==options.episodeTitle)(text=_itemHelper.default.getDisplayName(item,{includeIndexNumber:options.episodeTitleIndexNumber}))&&miscInfo.push(text);else if(item.IsMovie&&item.ProductionYear&&!1!==options.originalAirDate)miscInfo.push(item.ProductionYear);else if(item.PremiereDate&&!1!==options.originalAirDate)try{date=_datetime.default.parseISO8601Date(item.PremiereDate),text=_globalize.default.translate("OriginalAirDateValue",_datetime.default.toLocaleDateString(date)),miscInfo.push(text)}catch(e){console.error("error parsing date:",item.PremiereDate)}else item.ProductionYear&&miscInfo.push(item.ProductionYear);if(!1!==options.year&&"Series"!==item.Type&&"Episode"!==item.Type&&"Person"!==item.Type&&"Photo"!==item.MediaType&&"Program"!==item.Type&&"Season"!==item.Type)if(item.ProductionYear)miscInfo.push(item.ProductionYear);else if(item.PremiereDate)try{text=_datetime.default.parseISO8601Date(item.PremiereDate).getFullYear(),miscInfo.push(text)}catch(e){console.error("error parsing date:",item.PremiereDate)}if(item.RunTimeTicks&&"Series"!==item.Type&&"Program"!==item.Type&&"Book"!==item.Type&&!showFolderRuntime&&!1!==options.runtime&&("Audio"===item.Type?miscInfo.push(_datetime.default.getDisplayRunningTime(item.RunTimeTicks)):(minutes=(minutes=item.RunTimeTicks/6e8)||1,miscInfo.push("".concat(Math.round(minutes)," mins")))),item.OfficialRating&&"Season"!==item.Type&&"Episode"!==item.Type&&miscInfo.push({text:item.OfficialRating,cssClass:"mediaInfoOfficialRating"}),item.Video3DFormat&&miscInfo.push("3D"),"Photo"===item.MediaType&&item.Width&&item.Height&&miscInfo.push("".concat(item.Width,"x").concat(item.Height)),!1!==options.container&&"Audio"===item.Type&&item.Container&&miscInfo.push(item.Container),html+=miscInfo.map((function(m){return getMediaInfoItem(m)})).join(""),html+=function getStarIconsHtml(item){var html="";item.CommunityRating&&(html+='<div class="starRatingContainer mediaInfoItem">',html+='<span class="material-icons starIcon star"></span>',html+=item.CommunityRating.toFixed(1),html+="</div>");return html}(item),item.HasSubtitles&&!1!==options.subtitles&&(html+='<div class="mediaInfoItem mediaInfoText closedCaptionMediaInfoText">CC</div>'),item.CriticRating&&!1!==options.criticRating&&(item.CriticRating>=60?html+='<div class="mediaInfoItem mediaInfoCriticRating mediaInfoCriticRatingFresh">'.concat(item.CriticRating,"</div>"):html+='<div class="mediaInfoItem mediaInfoCriticRating mediaInfoCriticRatingRotten">'.concat(item.CriticRating,"</div>")),!1!==options.endsAt){var endsAt=getEndsAt(item);endsAt&&(html+=getMediaInfoItem(endsAt,"endsAt"))}return html+=_indicators.default.getMissingIndicator(item)}function getEndsAt(item){if("Video"===item.MediaType&&item.RunTimeTicks&&!item.StartDate){var endDate=(new Date).getTime()+item.RunTimeTicks/1e4;endDate=new Date(endDate);var displayTime=_datetime.default.getDisplayTime(endDate);return _globalize.default.translate("EndsAtValue",displayTime)}return null}function getEndsAtFromPosition(runtimeTicks,positionTicks,includeText){var endDate=(new Date).getTime()+(runtimeTicks-(positionTicks||0))/1e4;endDate=new Date(endDate);var displayTime=_datetime.default.getDisplayTime(endDate);return!1===includeText?displayTime:_globalize.default.translate("EndsAtValue",displayTime)}function getMediaInfoItem(m,cssClass){cssClass=cssClass?"".concat(cssClass," mediaInfoItem"):"mediaInfoItem";var mediaInfoText=m;if("string"!=typeof m&&"number"!=typeof m){if(m.html)return m.html;mediaInfoText=m.text,cssClass+=" ".concat(m.cssClass)}return'<div class="'.concat(cssClass,'">').concat(mediaInfoText,"</div>")}function fillPrimaryMediaInfo(elem,item,options){var html=getPrimaryMediaInfoHtml(item,options);elem.innerHTML=html,afterFill(elem,item,options)}function fillSecondaryMediaInfo(elem,item,options){var html=getSecondaryMediaInfoHtml(item,options);elem.innerHTML=html,afterFill(elem,item,options)}function afterFill(elem,item,options){if(!1!==options.endsAt){var endsAtElem=elem.querySelector(".endsAt");endsAtElem&&function dynamicEndTime(elem,item){var interval=setInterval((function(){document.body.contains(elem)?elem.innerHTML=getEndsAt(item):clearInterval(interval)}),6e4)}(endsAtElem,item)}var lnkChannel=elem.querySelector(".lnkChannel");lnkChannel&&lnkChannel.addEventListener("click",onChannelLinkClick)}function onChannelLinkClick(e){var channelId=this.getAttribute("data-id"),serverId=this.getAttribute("data-serverid");return _appRouter.default.showItem(channelId,serverId),e.preventDefault(),!1}function getPrimaryMediaInfoHtml(item,options){return null==(options=options||{}).interactive&&(options.interactive=!1),getMediaInfoHtml(item,options)}function getSecondaryMediaInfoHtml(item,options){return null==(options=options||{}).interactive&&(options.interactive=!1),"Program"===item.Type?function getProgramInfoHtml(item,options){var text,date,html="",miscInfo=[];if(item.StartDate&&!1!==options.programTime)try{text="",date=_datetime.default.parseISO8601Date(item.StartDate),!1!==options.startDate&&(text+=_datetime.default.toLocaleDateString(date,{weekday:"short",month:"short",day:"numeric"})),text+=" ".concat(_datetime.default.getDisplayTime(date)),item.EndDate&&(date=_datetime.default.parseISO8601Date(item.EndDate),text+=" - ".concat(_datetime.default.getDisplayTime(date))),miscInfo.push(text)}catch(e){console.error("error parsing date:",item.StartDate)}if(item.ChannelNumber&&miscInfo.push("CH ".concat(item.ChannelNumber)),item.ChannelName&&(options.interactive&&item.ChannelId?miscInfo.push({html:'<a is="emby-linkbutton" class="button-flat mediaInfoItem" href="'.concat(_appRouter.default.getRouteUrl({ServerId:item.ServerId,Type:"TvChannel",Name:item.ChannelName,Id:item.ChannelId}),'">').concat(item.ChannelName,"</a>")}):miscInfo.push(item.ChannelName)),!1!==options.timerIndicator){var timerHtml=function getTimerIndicator(item){var status;if("SeriesTimer"===item.Type)return'<span class="material-icons mediaInfoItem mediaInfoIconItem mediaInfoTimerIcon fiber_smart_record"></span>';if(item.TimerId||item.SeriesTimerId)status=item.Status||"Cancelled";else{if("Timer"!==item.Type)return"";status=item.Status}return item.SeriesTimerId?"Cancelled"!==status?'<span class="material-icons mediaInfoItem mediaInfoIconItem mediaInfoTimerIcon fiber_smart_record"></span>':'<span class="material-icons mediaInfoItem mediaInfoIconItem fiber_smart_record"></span>':'<span class="material-icons mediaInfoItem mediaInfoIconItem mediaInfoTimerIcon fiber_manual_record"></span>'}(item);timerHtml&&miscInfo.push({html:timerHtml})}return html+=miscInfo.map((function(m){return getMediaInfoItem(m)})).join("")}(item,options):""}function getResolutionText(i){var width=i.Width,height=i.Height;if(width&&height){if(width>=3800||height>=2e3)return"4K";if(width>=2500||height>=1400)return i.IsInterlaced?"1440i":"1440p";if(width>=1800||height>=1e3)return i.IsInterlaced?"1080i":"1080p";if(width>=1200||height>=700)return i.IsInterlaced?"720i":"720p";if(width>=700||height>=400)return i.IsInterlaced?"480i":"480p"}return null}function getMediaInfoStats(item,options){options=options||{};var list=[],videoStream=(((item.MediaSources||[])[0]||{}).MediaStreams||[]).filter((function(i){return"Video"===i.Type}))[0]||{},audioStream=function getAudioStreamForDisplay(item){if(!item.MediaSources)return null;var mediaSource=item.MediaSources[0];return mediaSource?(mediaSource.MediaStreams||[]).filter((function(i){return"Audio"===i.Type&&(i.Index===mediaSource.DefaultAudioStreamIndex||null==mediaSource.DefaultAudioStreamIndex)}))[0]:null}(item)||{};"Dvd"===item.VideoType&&list.push({type:"mediainfo",text:"Dvd"}),"BluRay"===item.VideoType&&list.push({type:"mediainfo",text:"BluRay"});var resolutionText=getResolutionText(videoStream);resolutionText&&list.push({type:"mediainfo",text:resolutionText}),videoStream.Codec&&list.push({type:"mediainfo",text:videoStream.Codec});var channelText,channels=audioStream.Channels;8===channels?channelText="7.1":7===channels?channelText="6.1":6===channels?channelText="5.1":2===channels&&(channelText="2.0"),channelText&&list.push({type:"mediainfo",text:channelText});var audioCodec=(audioStream.Codec||"").toLowerCase();if("dca"!==audioCodec&&"dts"!==audioCodec||!audioStream.Profile?audioStream.Codec&&list.push({type:"mediainfo",text:audioStream.Codec}):list.push({type:"mediainfo",text:audioStream.Profile}),item.DateCreated&&_itemHelper.default.enableDateAddedDisplay(item)){var dateCreated=_datetime.default.parseISO8601Date(item.DateCreated);list.push({type:"added",text:_globalize.default.translate("AddedOnValue","".concat(_datetime.default.toLocaleDateString(dateCreated)," ").concat(_datetime.default.getDisplayTime(dateCreated)))})}return list}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getMediaInfoHtml=getMediaInfoHtml,_exports.getEndsAt=getEndsAt,_exports.getEndsAtFromPosition=getEndsAtFromPosition,_exports.fillPrimaryMediaInfo=fillPrimaryMediaInfo,_exports.fillSecondaryMediaInfo=fillSecondaryMediaInfo,_exports.getPrimaryMediaInfoHtml=getPrimaryMediaInfoHtml,_exports.getSecondaryMediaInfoHtml=getSecondaryMediaInfoHtml,_exports.getResolutionText=getResolutionText,_exports.getMediaInfoStats=getMediaInfoStats,_exports.default=void 0,_datetime=_interopRequireDefault(_datetime),_globalize=_interopRequireDefault(_globalize),_appRouter=_interopRequireDefault(_appRouter),_itemHelper=_interopRequireDefault(_itemHelper),_indicators=_interopRequireDefault(_indicators);var _default={getMediaInfoHtml:getPrimaryMediaInfoHtml,getEndsAt:getEndsAt,getEndsAtFromPosition:getEndsAtFromPosition,getPrimaryMediaInfoHtml:getPrimaryMediaInfoHtml,getSecondaryMediaInfoHtml:getSecondaryMediaInfoHtml,fillPrimaryMediaInfo:fillPrimaryMediaInfo,fillSecondaryMediaInfo:fillSecondaryMediaInfo,getMediaInfoStats:getMediaInfoStats,getResolutionText:getResolutionText};_exports.default=_default}));
//# sourceMappingURL=mediainfo.js.map
