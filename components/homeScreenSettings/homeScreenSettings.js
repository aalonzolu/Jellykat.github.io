define(["require","exports","layoutManager","focusManager","globalize","loading","connectionManager","homeSections","dom","events","listViewStyle","emby-select","emby-checkbox"],(function(_require,_exports,_layoutManager,_focusManager,_globalize,_loading,_connectionManager,_homeSections,_dom,_events,_listViewStyle,_embySelect,_embyCheckbox){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_layoutManager=_interopRequireDefault(_layoutManager),_focusManager=_interopRequireDefault(_focusManager),_globalize=_interopRequireDefault(_globalize),_loading=_interopRequireDefault(_loading),_connectionManager=_interopRequireDefault(_connectionManager),_homeSections=_interopRequireDefault(_homeSections),_dom=_interopRequireDefault(_dom),_events=_interopRequireDefault(_events);function getLandingScreenOptionsHtml(type,userValue){return function getLandingScreenOptions(type){var list=[];return"movies"===type?(list.push({name:_globalize.default.translate("Movies"),value:"movies",isDefault:!0}),list.push({name:_globalize.default.translate("Suggestions"),value:"suggestions"}),list.push({name:_globalize.default.translate("Genres"),value:"genres"}),list.push({name:_globalize.default.translate("Favorites"),value:"favorites"}),list.push({name:_globalize.default.translate("Collections"),value:"collections"})):"tvshows"===type?(list.push({name:_globalize.default.translate("Shows"),value:"shows",isDefault:!0}),list.push({name:_globalize.default.translate("Suggestions"),value:"suggestions"}),list.push({name:_globalize.default.translate("Latest"),value:"latest"}),list.push({name:_globalize.default.translate("Genres"),value:"genres"}),list.push({name:_globalize.default.translate("Favorites"),value:"favorites"})):"music"===type?(list.push({name:_globalize.default.translate("Suggestions"),value:"suggestions",isDefault:!0}),list.push({name:_globalize.default.translate("Albums"),value:"albums"}),list.push({name:_globalize.default.translate("HeaderAlbumArtists"),value:"albumartists"}),list.push({name:_globalize.default.translate("Artists"),value:"artists"}),list.push({name:_globalize.default.translate("Playlists"),value:"playlists"}),list.push({name:_globalize.default.translate("Genres"),value:"genres"})):"livetv"===type&&(list.push({name:_globalize.default.translate("Suggestions"),value:"suggestions",isDefault:!0}),list.push({name:_globalize.default.translate("Guide"),value:"guide"})),list}(type).map((function(o){var selectedHtml=userValue===o.value||o.isDefault&&!userValue?" selected":"",optionValue=o.isDefault?"":o.value;return'<option value="'.concat(optionValue,'"').concat(selectedHtml,">").concat(o.name,"</option>")})).join("")}function getPerLibrarySettingsHtml(item,user,userSettings,apiClient){var isChecked,html="";"Channel"!==item.Type&&"boxsets"!==item.CollectionType&&"playlists"!==item.CollectionType||(isChecked=!(user.Configuration.MyMediaExcludes||[]).includes(item.Id),html+="<div>",html+="<label>",html+='<input type="checkbox" is="emby-checkbox" class="chkIncludeInMyMedia" data-folderid="'.concat(item.Id,'"').concat(isChecked?' checked="checked"':"","/>"),html+="<span>".concat(_globalize.default.translate("DisplayInMyMedia"),"</span>"),html+="</label>",html+="</div>");if(["playlists","livetv","boxsets","channels"].includes(item.CollectionType||"")||(isChecked=!user.Configuration.LatestItemsExcludes.includes(item.Id),html+='<label class="fldIncludeInLatest">',html+='<input type="checkbox" is="emby-checkbox" class="chkIncludeInLatest" data-folderid="'.concat(item.Id,'"').concat(isChecked?' checked="checked"':"","/>"),html+="<span>".concat(_globalize.default.translate("DisplayInOtherHomeScreenSections"),"</span>"),html+="</label>"),html&&(html='<div class="checkboxListContainer">'.concat(html,"</div>")),"movies"===item.CollectionType||"tvshows"===item.CollectionType||"music"===item.CollectionType||"livetv"===item.CollectionType){var idForLanding="livetv"===item.CollectionType?item.CollectionType:item.Id;html+='<div class="selectContainer">',html+='<select is="emby-select" class="selectLanding" data-folderid="'.concat(idForLanding,'" label="').concat(_globalize.default.translate("LabelDefaultScreen"),'">');var userValue=userSettings.get("landing-".concat(idForLanding));html+=getLandingScreenOptionsHtml(item.CollectionType,userValue),html+="</select>",html+="</div>"}if(html){var prefix="";prefix+='<div class="verticalSection">',prefix+='<h2 class="sectionTitle">',prefix+=item.Name,html=(prefix+="</h2>")+html,html+="</div>"}return html}function loadForm(context,user,userSettings,apiClient){context.querySelector(".chkHidePlayedFromLatest").checked=user.Configuration.HidePlayedInLatest||!1,function updateHomeSectionValues(context,userSettings){for(var i=1;i<=7;i++){var select=context.querySelector("#selectHomeSection".concat(i)),defaultValue=_homeSections.default.getDefaultSection(i-1),option=select.querySelector("option[value=".concat(defaultValue,"]"))||select.querySelector('option[value=""]'),userValue=userSettings.get("homesection".concat(i-1));option.value="",select.value=userValue!==defaultValue&&userValue?userValue:""}context.querySelector(".selectTVHomeScreen").value=userSettings.get("tvhome")||""}(context,userSettings);var promise1=apiClient.getUserViews({IncludeHidden:!0},user.Id),promise2=apiClient.getJSON(apiClient.getUrl("Users/".concat(user.Id,"/GroupingOptions")));Promise.all([promise1,promise2]).then((function(responses){!function renderViewOrder(context,user,result){var html="";html+=result.Items.map((function(view){var currentHtml="";return currentHtml+='<div class="listItem viewItem" data-viewid="'.concat(view.Id,'">'),currentHtml+='<span class="material-icons listItemIcon folder_open"></span>',currentHtml+='<div class="listItemBody">',currentHtml+="<div>",currentHtml+=view.Name,currentHtml+="</div>",currentHtml+="</div>",currentHtml+='<button type="button" is="paper-icon-button-light" class="btnViewItemUp btnViewItemMove autoSize" title="'.concat(_globalize.default.translate("Up"),'"><span class="material-icons keyboard_arrow_up"></span></button>'),currentHtml+='<button type="button" is="paper-icon-button-light" class="btnViewItemDown btnViewItemMove autoSize" title="'.concat(_globalize.default.translate("Down"),'"><span class="material-icons keyboard_arrow_down"></span></button>'),currentHtml+="</div>"})).join(""),context.querySelector(".viewOrderList").innerHTML=html}(context,0,responses[0]),function renderPerLibrarySettings(context,user,userViews,userSettings,apiClient){for(var elem=context.querySelector(".perLibrarySettings"),html="",i=0,length=userViews.length;i<length;i++)html+=getPerLibrarySettingsHtml(userViews[i],user,userSettings);elem.innerHTML=html}(context,user,responses[0].Items,userSettings),function renderViews(page,user,result){var folderHtml="";folderHtml+='<div class="checkboxList">',folderHtml+=result.map((function(i){var currentHtml="",id="chkGroupFolder".concat(i.Id),checkedHtml=user.Configuration.GroupedFolders.includes(i.Id)?' checked="checked"':"";return currentHtml+="<label>",currentHtml+='<input type="checkbox" is="emby-checkbox" class="chkGroupFolder" data-folderid="'.concat(i.Id,'" id="').concat(id,'"').concat(checkedHtml,"/>"),currentHtml+="<span>".concat(i.Name,"</span>"),currentHtml+="</label>"})).join(""),folderHtml+="</div>",page.querySelector(".folderGroupList").innerHTML=folderHtml}(context,user,responses[1]),_loading.default.hide()}))}function onSectionOrderListClick(e){var target=_dom.default.parentWithClass(e.target,"btnViewItemMove");if(target){var viewItem=_dom.default.parentWithClass(target,"viewItem");if(viewItem)if(target.classList.contains("btnViewItemDown")){var next=viewItem.nextSibling;next&&(viewItem.parentNode.removeChild(viewItem),next.parentNode.insertBefore(viewItem,next.nextSibling),_focusManager.default.focus(e.target))}else{var prev=viewItem.previousSibling;prev&&(viewItem.parentNode.removeChild(viewItem),prev.parentNode.insertBefore(viewItem,prev),_focusManager.default.focus(e.target))}}}function getCheckboxItems(selector,context,isChecked){for(var inputs=context.querySelectorAll(selector),list=[],i=0,length=inputs.length;i<length;i++)inputs[i].checked===isChecked&&list.push(inputs[i]);return list}function save(instance,context,userId,userSettings,apiClient,enableSaveConfirmation){_loading.default.show(),apiClient.getUser(userId).then((function(user){(function saveUser(context,user,userSettingsInstance,apiClient){user.Configuration.HidePlayedInLatest=context.querySelector(".chkHidePlayedFromLatest").checked,user.Configuration.LatestItemsExcludes=getCheckboxItems(".chkIncludeInLatest",context,!1).map((function(i){return i.getAttribute("data-folderid")})),user.Configuration.MyMediaExcludes=getCheckboxItems(".chkIncludeInMyMedia",context,!1).map((function(i){return i.getAttribute("data-folderid")})),user.Configuration.GroupedFolders=getCheckboxItems(".chkGroupFolder",context,!0).map((function(i){return i.getAttribute("data-folderid")}));var i,length,viewItems=context.querySelectorAll(".viewItem"),orderedViews=[];for(i=0,length=viewItems.length;i<length;i++)orderedViews.push(viewItems[i].getAttribute("data-viewid"));user.Configuration.OrderedViews=orderedViews,userSettingsInstance.set("tvhome",context.querySelector(".selectTVHomeScreen").value),userSettingsInstance.set("homesection0",context.querySelector("#selectHomeSection1").value),userSettingsInstance.set("homesection1",context.querySelector("#selectHomeSection2").value),userSettingsInstance.set("homesection2",context.querySelector("#selectHomeSection3").value),userSettingsInstance.set("homesection3",context.querySelector("#selectHomeSection4").value),userSettingsInstance.set("homesection4",context.querySelector("#selectHomeSection5").value),userSettingsInstance.set("homesection5",context.querySelector("#selectHomeSection6").value),userSettingsInstance.set("homesection6",context.querySelector("#selectHomeSection7").value);var selectLandings=context.querySelectorAll(".selectLanding");for(i=0,length=selectLandings.length;i<length;i++){var selectLanding=selectLandings[i];userSettingsInstance.set("landing-".concat(selectLanding.getAttribute("data-folderid")),selectLanding.value)}return apiClient.updateUserConfiguration(user.Id,user.Configuration)})(context,user,userSettings,apiClient).then((function(){_loading.default.hide(),enableSaveConfirmation&&new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(_globalize.default.translate("SettingsSaved"))})),_events.default.trigger(instance,"saved")}),(function(){_loading.default.hide()}))}))}function onSubmit(e){var self=this,apiClient=_connectionManager.default.getApiClient(self.options.serverId),userId=self.options.userId,userSettings=self.options.userSettings;return userSettings.setUserInfo(userId,apiClient).then((function(){var enableSaveConfirmation=self.options.enableSaveConfirmation;save(self,self.options.element,userId,userSettings,apiClient,enableSaveConfirmation)})),e&&e.preventDefault(),!1}function onChange(e){var chkIncludeInMyMedia=_dom.default.parentWithClass(e.target,"chkIncludeInMyMedia");if(chkIncludeInMyMedia){var fldIncludeInLatest=_dom.default.parentWithClass(chkIncludeInMyMedia,"verticalSection").querySelector(".fldIncludeInLatest");fldIncludeInLatest&&(chkIncludeInMyMedia.checked?fldIncludeInLatest.classList.remove("hide"):fldIncludeInLatest.classList.add("hide"))}}var _default=function(){function HomeScreenSettings(options){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,HomeScreenSettings),this.options=options,function embed(options,self){return new Promise((function(_resolve,_reject){return _require(["text!./homeScreenSettings.template.html"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){for(var template=_ref2.default,i=1;i<=7;i++)template=template.replace("{section".concat(i,"label}"),_globalize.default.translate("LabelHomeScreenSectionValue",i));options.element.innerHTML=_globalize.default.translateHtml(template,"core"),options.element.querySelector(".viewOrderList").addEventListener("click",onSectionOrderListClick),options.element.querySelector("form").addEventListener("submit",onSubmit.bind(self)),options.element.addEventListener("change",onChange),options.enableSaveButton&&options.element.querySelector(".btnSave").classList.remove("hide"),_layoutManager.default.tv?options.element.querySelector(".selectTVHomeScreenContainer").classList.remove("hide"):options.element.querySelector(".selectTVHomeScreenContainer").classList.add("hide"),self.loadData(options.autoFocus)}))}(options,this)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(HomeScreenSettings,[{key:"loadData",value:function loadData(autoFocus){var self=this,context=self.options.element;_loading.default.show();var userId=self.options.userId,apiClient=_connectionManager.default.getApiClient(self.options.serverId),userSettings=self.options.userSettings;apiClient.getUser(userId).then((function(user){userSettings.setUserInfo(userId,apiClient).then((function(){self.dataLoaded=!0,loadForm(context,user,userSettings,apiClient),autoFocus&&_focusManager.default.autoFocus(context)}))}))}},{key:"submit",value:function submit(){onSubmit.call(this)}},{key:"destroy",value:function destroy(){this.options=null}}]),HomeScreenSettings}();_exports.default=_default}));
//# sourceMappingURL=homeScreenSettings.js.map
