define(["require","exports","playbackManager","inputManager","connectionManager","appRouter","globalize","dom","recordingHelper"],(function(_require,_exports,_playbackManager,_inputManager,_connectionManager,_appRouter,_globalize,_dom,_recordingHelper){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function playAllFromHere(card,serverId,queue){for(var startIndex,parent=card.parentNode,className=card.classList.length?".".concat(card.classList[0]):"",cards=parent.querySelectorAll("".concat(className,"[data-id]")),ids=[],foundCard=!1,i=0,length=cards.length;i<length;i++)cards[i]===card&&(foundCard=!0,startIndex=i),!foundCard&&queue||ids.push(cards[i].getAttribute("data-id"));var itemsContainer=_dom.default.parentWithClass(card,"itemsContainer");if(itemsContainer&&itemsContainer.fetchData){var queryOptions=queue?{StartIndex:startIndex}:{};return itemsContainer.fetchData(queryOptions).then((function(result){return queue?_playbackManager.default.queue({items:result.Items}):_playbackManager.default.play({items:result.Items,startIndex:startIndex})}))}if(ids.length)return queue?_playbackManager.default.queue({ids:ids,serverId:serverId}):_playbackManager.default.play({ids:ids,serverId:serverId,startIndex:startIndex})}function getItem(button){var serverId=(button=_dom.default.parentWithAttribute(button,"data-id")).getAttribute("data-serverid"),id=button.getAttribute("data-id"),type=button.getAttribute("data-type"),apiClient=_connectionManager.default.getApiClient(serverId);return"Timer"===type?apiClient.getLiveTvTimer(id):"SeriesTimer"===type?apiClient.getLiveTvSeriesTimer(id):apiClient.getItem(apiClient.getCurrentUserId(),id)}function showContextMenu(card,options){getItem(card).then((function(item){var playlistId=card.getAttribute("data-playlistid"),collectionId=card.getAttribute("data-collectionid");if(playlistId){var elem=_dom.default.parentWithAttribute(card,"data-playlistitemid");item.PlaylistItemId=elem?elem.getAttribute("data-playlistitemid"):null}new Promise((function(_resolve,_reject){return _require(["itemContextMenu"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){var itemContextMenu=_ref2.default;_connectionManager.default.getApiClient(item.ServerId).getCurrentUser().then((function(user){itemContextMenu.show(Object.assign({item:item,play:!0,queue:!0,playAllFromHere:!item.IsFolder,queueAllFromHere:!item.IsFolder,playlistId:playlistId,collectionId:collectionId,user:user},options||{})).then((function(result){"playallfromhere"===result.command||"queueallfromhere"===result.command?executeAction(card,options.positionTo,result.command):(result.updated||result.deleted)&&function notifyRefreshNeeded(childElement,itemsContainer){(itemsContainer=itemsContainer||_dom.default.parentWithAttribute(childElement,"is","emby-itemscontainer"))&&itemsContainer.notifyRefreshNeeded(!0)}(card,options.itemsContainer)}))}))}))}))}function getItemInfoFromCard(card){return{Type:card.getAttribute("data-type"),Id:card.getAttribute("data-id"),TimerId:card.getAttribute("data-timerid"),CollectionType:card.getAttribute("data-collectiontype"),ChannelId:card.getAttribute("data-channelid"),SeriesId:card.getAttribute("data-seriesid"),ServerId:card.getAttribute("data-serverid"),MediaType:card.getAttribute("data-mediatype"),IsFolder:"true"===card.getAttribute("data-isfolder"),UserData:{PlaybackPositionTicks:parseInt(card.getAttribute("data-positionticks")||"0")}}}function executeAction(card,target,action){target=target||card;var id=card.getAttribute("data-id");id||(id=(card=_dom.default.parentWithAttribute(card,"data-id")).getAttribute("data-id"));var item=getItemInfoFromCard(card),serverId=item.ServerId,type=item.Type,playableItemId="Program"===type?item.ChannelId:item.Id;if("Photo"===item.MediaType&&"link"===action&&(action="play"),"link"===action)_appRouter.default.showItem(item,{context:card.getAttribute("data-context"),parentId:card.getAttribute("data-parentid")});else if("programdialog"===action)!function showProgramDialog(item){new Promise((function(_resolve,_reject){return _require(["recordingCreator"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){_ref.default.show(item.Id,item.ServerId)}))}(item);else if("instantmix"===action)_playbackManager.default.instantMix({Id:playableItemId,ServerId:serverId});else if("play"===action||"resume"===action){var startPositionTicks=parseInt(card.getAttribute("data-positionticks")||"0");_playbackManager.default.play({ids:[playableItemId],startPositionTicks:startPositionTicks,serverId:serverId})}else if("queue"===action)_playbackManager.default.isPlaying()?(_playbackManager.default.queue({ids:[playableItemId],serverId:serverId}),function sendToast(text){new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref4){(0,_ref4.default)(text)}))}(_globalize.default.translate("MediaQueued"))):_playbackManager.default.queue({ids:[playableItemId],serverId:serverId});else if("playallfromhere"===action)playAllFromHere(card,serverId);else if("queueallfromhere"===action)playAllFromHere(card,serverId,!0);else if("setplaylistindex"===action)_playbackManager.default.setCurrentPlaylistItem(card.getAttribute("data-playlistitemid"));else if("record"===action)!function onRecordCommand(serverId,id,type,timerId,seriesTimerId){if("Program"===type||timerId||seriesTimerId){var programId="Program"===type?id:null;_recordingHelper.default.toggleRecording(serverId,programId,timerId,seriesTimerId)}}(serverId,id,type,card.getAttribute("data-timerid"),card.getAttribute("data-seriestimerid"));else if("menu"===action){var options="false"===target.getAttribute("data-playoptions")?{shuffle:!1,instantMix:!1,play:!1,playAllFromHere:!1,queue:!1,queueAllFromHere:!1}:{};options.positionTo=target,showContextMenu(card,options)}else if("playmenu"===action)!function showPlayMenu(card,target){var item=getItemInfoFromCard(card);new Promise((function(_resolve,_reject){return _require(["playMenu"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){_ref3.default.show({item:item,positionTo:target})}))}(card,target);else if("edit"===action)getItem(target).then((function(item){!function editItem(item,serverId){var apiClient=_connectionManager.default.getApiClient(serverId);return new Promise((function(resolve,reject){var serverId=apiClient.serverInfo().Id;"Timer"===item.Type?item.ProgramId?new Promise((function(_resolve,_reject){return _require(["recordingCreator"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref6){_ref6.default.show(item.ProgramId,serverId).then(resolve,reject)})):new Promise((function(_resolve,_reject){return _require(["recordingEditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref7){_ref7.default.show(item.Id,serverId).then(resolve,reject)})):new Promise((function(_resolve,_reject){return _require(["metadataEditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref8){_ref8.default.show(item.Id,serverId).then(resolve,reject)}))}))}(item,serverId)}));else if("playtrailer"===action)getItem(target).then(playTrailer);else if("addtoplaylist"===action)getItem(target).then(addToPlaylist);else if("custom"===action){var customAction=target.getAttribute("data-customaction");card.dispatchEvent(new CustomEvent("action-".concat(customAction),{detail:{playlistItemId:card.getAttribute("data-playlistitemid")},cancelable:!1,bubbles:!0}))}}function addToPlaylist(item){new Promise((function(_resolve,_reject){return _require(["playlistEditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref5){(new(0,_ref5.default)).show({items:[item.Id],serverId:item.ServerId})}))}function playTrailer(item){var apiClient=_connectionManager.default.getApiClient(item.ServerId);apiClient.getLocalTrailers(apiClient.getCurrentUserId(),item.Id).then((function(trailers){_playbackManager.default.play({items:trailers})}))}function onClick(e){var card=_dom.default.parentWithClass(e.target,"itemAction");if(card){var actionElement=card,action=actionElement.getAttribute("data-action");if(action||(actionElement=_dom.default.parentWithAttribute(actionElement,"data-action"))&&(action=actionElement.getAttribute("data-action")),action)return executeAction(card,actionElement,action),e.preventDefault(),e.stopPropagation(),!1}}function onCommand(e){var cmd=e.detail.command;if("play"===cmd||"resume"===cmd||"record"===cmd||"menu"===cmd||"info"===cmd){var target=e.target,card=_dom.default.parentWithClass(target,"itemAction")||_dom.default.parentWithAttribute(target,"data-id");card&&(e.preventDefault(),e.stopPropagation(),executeAction(card,card,cmd))}}function on(context,options){!1!==(options=options||{}).click&&context.addEventListener("click",onClick),!1!==options.command&&_inputManager.default.on(context,onCommand)}function off(context,options){options=options||{},context.removeEventListener("click",onClick),!1!==options.command&&_inputManager.default.off(context,onCommand)}function getShortcutAttributesHtml(item,serverId){var html='data-id="'.concat(item.Id,'" data-serverid="').concat(serverId||item.ServerId,'" data-type="').concat(item.Type,'" data-mediatype="').concat(item.MediaType,'" data-channelid="').concat(item.ChannelId,'" data-isfolder="').concat(item.IsFolder,'"'),collectionType=item.CollectionType;return collectionType&&(html+=' data-collectiontype="'.concat(collectionType,'"')),html}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.onClick=onClick,_exports.on=on,_exports.off=off,_exports.getShortcutAttributesHtml=getShortcutAttributesHtml,_exports.default=void 0,_playbackManager=_interopRequireDefault(_playbackManager),_inputManager=_interopRequireDefault(_inputManager),_connectionManager=_interopRequireDefault(_connectionManager),_appRouter=_interopRequireDefault(_appRouter),_globalize=_interopRequireDefault(_globalize),_dom=_interopRequireDefault(_dom),_recordingHelper=_interopRequireDefault(_recordingHelper);var _default={on:on,off:off,onClick:onClick,getShortcutAttributesHtml:getShortcutAttributesHtml};_exports.default=_default}));
//# sourceMappingURL=shortcuts.js.map
