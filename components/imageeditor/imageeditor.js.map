{"version":3,"sources":["components/imageeditor/imageeditor.js"],"names":["define","_require","_exports","_dialogHelper","_connectionManager","_loading","_dom","_layoutManager","_focusManager","_globalize","_scrollHelper","_imageLoader","_browser","_apphost","_cardStyle","_formDialogStyle","_embyButton","_paperIconButtonLight","_imageeditor","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","value","show","currentItem","enableFocusTransform","browser","slow","edge","hasChanges","reload","page","item","focusContext","apiClient","loading","connectionManager","getApiClient","ServerId","reloadItem","getItem","getCurrentUserId","Id","then","addListeners","container","className","eventName","fn","addEventListener","e","elem","dom","parentWithClass","target","getRemoteImageProviders","getBaseRemoteOptions","options","itemId","providers","btnBrowseAllImages","querySelectorAll","i","length","classList","remove","add","getItemImageInfos","imageInfos","renderStandardImages","imageProviders","images","filter","ImageType","renderImages","querySelector","renderBackdrops","sort","a","b","ImageIndex","renderScreenshots","hide","layoutManager","tv","focusManager","autoFocus","getCardHtml","image","index","numImages","imageSize","tagName","enableFooterButtons","html","cssClass","serverId","getImageUrl","type","tag","BackdropImageTags","ScreenshotImageTags","PrimaryImageTag","ImageTags","getScaledImageUrl","ItemId","maxWidth","globalize","translate","Width","Height","deleteImage","context","enableConfirmation","afterConfirm","deleteItemImage","Promise","_resolve","_reject","imported","_ref","confirm","text","confirmText","primary","moveImage","newIndex","updateItemImageIndex","_ref2","alert","windowSize","getWindowSize","innerWidth","Math","round","innerHTML","imageLoader","lazyChildren","showImageDownloader","imageType","_ref3","Type","initEditor","uploadButtons","isFileInputSupported","appHost","supports","this","getAttribute","_ref5","theme","hasChanged","showActionSheet","imageCard","parseInt","providerCount","_ref4","actionSheet","commands","push","name","id","items","positionTo","resolve","reject","showEditor","_ref6","template","dialogOptions","removeOnClose","size","dlg","dialogHelper","createDialog","translateHtml","scrollHelper","centerFocus","on","off","open","close","_default"],"mappings":"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","file":"imageeditor.js","sourcesContent":["import dialogHelper from 'dialogHelper';\nimport connectionManager from 'connectionManager';\nimport loading from 'loading';\nimport dom from 'dom';\nimport layoutManager from 'layoutManager';\nimport focusManager from 'focusManager';\nimport globalize from 'globalize';\nimport scrollHelper from 'scrollHelper';\nimport imageLoader from 'imageLoader';\nimport browser from 'browser';\nimport appHost from 'apphost';\nimport 'cardStyle';\nimport 'formDialogStyle';\nimport 'emby-button';\nimport 'paper-icon-button-light';\nimport 'css!./imageeditor';\n\n/* eslint-disable indent */\n\n    const enableFocusTransform = !browser.slow && !browser.edge;\n\n    let currentItem;\n    let hasChanges = false;\n\n    function getBaseRemoteOptions() {\n        const options = {};\n\n        options.itemId = currentItem.Id;\n\n        return options;\n    }\n\n    function reload(page, item, focusContext) {\n        loading.show();\n\n        let apiClient;\n\n        if (item) {\n            apiClient = connectionManager.getApiClient(item.ServerId);\n            reloadItem(page, item, apiClient, focusContext);\n        } else {\n            apiClient = connectionManager.getApiClient(currentItem.ServerId);\n            apiClient.getItem(apiClient.getCurrentUserId(), currentItem.Id).then(function (item) {\n                reloadItem(page, item, apiClient, focusContext);\n            });\n        }\n    }\n\n    function addListeners(container, className, eventName, fn) {\n        container.addEventListener(eventName, function (e) {\n            const elem = dom.parentWithClass(e.target, className);\n            if (elem) {\n                fn.call(elem, e);\n            }\n        });\n    }\n\n    function reloadItem(page, item, apiClient, focusContext) {\n        currentItem = item;\n\n        apiClient.getRemoteImageProviders(getBaseRemoteOptions()).then(function (providers) {\n            var btnBrowseAllImages = page.querySelectorAll('.btnBrowseAllImages');\n            for (var i = 0, length = btnBrowseAllImages.length; i < length; i++) {\n                if (providers.length) {\n                    btnBrowseAllImages[i].classList.remove('hide');\n                } else {\n                    btnBrowseAllImages[i].classList.add('hide');\n                }\n            }\n\n            apiClient.getItemImageInfos(currentItem.Id).then(function (imageInfos) {\n                renderStandardImages(page, apiClient, item, imageInfos, providers);\n                renderBackdrops(page, apiClient, item, imageInfos, providers);\n                renderScreenshots(page, apiClient, item, imageInfos, providers);\n                loading.hide();\n\n                if (layoutManager.tv) {\n                    focusManager.autoFocus((focusContext || page));\n                }\n            });\n        });\n    }\n\n    function getImageUrl(item, apiClient, type, index, options) {\n        options = options || {};\n        options.type = type;\n        options.index = index;\n\n        if (type === 'Backdrop') {\n            options.tag = item.BackdropImageTags[index];\n        } else if (type === 'Screenshot') {\n            options.tag = item.ScreenshotImageTags[index];\n        } else if (type === 'Primary') {\n            options.tag = item.PrimaryImageTag || item.ImageTags[type];\n        } else {\n            options.tag = item.ImageTags[type];\n        }\n\n        // For search hints\n        return apiClient.getScaledImageUrl(item.Id || item.ItemId, options);\n    }\n\n    function getCardHtml(image, index, numImages, apiClient, imageProviders, imageSize, tagName, enableFooterButtons) {\n        // TODO move card creation code to Card component\n\n        let html = '';\n\n        let cssClass = 'card scalableCard imageEditorCard';\n        const cardBoxCssClass = 'cardBox visualCardBox';\n\n        cssClass += ' backdropCard backdropCard-scalable';\n\n        if (tagName === 'button') {\n            cssClass += ' btnImageCard';\n\n            if (layoutManager.tv) {\n                cssClass += ' show-focus';\n\n                if (enableFocusTransform) {\n                    cssClass += ' show-animation';\n                }\n            }\n\n            html += '<button type=\"button\" class=\"' + cssClass + '\"';\n        } else {\n            html += '<div class=\"' + cssClass + '\"';\n        }\n\n        html += ' data-id=\"' + currentItem.Id + '\" data-serverid=\"' + apiClient.serverId() + '\" data-index=\"' + index + '\" data-numimages=\"' + numImages + '\" data-imagetype=\"' + image.ImageType + '\" data-providers=\"' + imageProviders.length + '\"';\n\n        html += '>';\n\n        html += '<div class=\"' + cardBoxCssClass + '\">';\n        html += '<div class=\"cardScalable visualCardBox-cardScalable\" style=\"background-color:transparent;\">';\n        html += '<div class=\"cardPadder-backdrop\"></div>';\n\n        html += '<div class=\"cardContent\">';\n\n        const imageUrl = getImageUrl(currentItem, apiClient, image.ImageType, image.ImageIndex, { maxWidth: imageSize });\n\n        html += '<div class=\"cardImageContainer\" style=\"background-image:url(\\'' + imageUrl + '\\');background-position:center center;background-size:contain;\"></div>';\n\n        html += '</div>';\n        html += '</div>';\n\n        html += '<div class=\"cardFooter visualCardBox-cardFooter\">';\n\n        html += '<h3 class=\"cardText cardTextCentered\" style=\"margin:0;\">' + globalize.translate('' + image.ImageType) + '</h3>';\n\n        html += '<div class=\"cardText cardText-secondary cardTextCentered\">';\n        if (image.Width && image.Height) {\n            html += image.Width + ' X ' + image.Height;\n        } else {\n            html += '&nbsp;';\n        }\n        html += '</div>';\n\n        if (enableFooterButtons) {\n            html += '<div class=\"cardText cardTextCentered\">';\n\n            if (image.ImageType === 'Backdrop' || image.ImageType === 'Screenshot') {\n                if (index > 0) {\n                    html += '<button type=\"button\" is=\"paper-icon-button-light\" class=\"btnMoveImage autoSize\" data-imagetype=\"' + image.ImageType + '\" data-index=\"' + image.ImageIndex + '\" data-newindex=\"' + (image.ImageIndex - 1) + '\" title=\"' + globalize.translate('MoveLeft') + '\"><span class=\"material-icons chevron_left\"></span></button>';\n                } else {\n                    html += '<button type=\"button\" is=\"paper-icon-button-light\" class=\"autoSize\" disabled title=\"' + globalize.translate('MoveLeft') + '\"><span class=\"material-icons chevron_left\"></span></button>';\n                }\n\n                if (index < numImages - 1) {\n                    html += '<button type=\"button\" is=\"paper-icon-button-light\" class=\"btnMoveImage autoSize\" data-imagetype=\"' + image.ImageType + '\" data-index=\"' + image.ImageIndex + '\" data-newindex=\"' + (image.ImageIndex + 1) + '\" title=\"' + globalize.translate('MoveRight') + '\"><span class=\"material-icons chevron_right\"></span></button>';\n                } else {\n                    html += '<button type=\"button\" is=\"paper-icon-button-light\" class=\"autoSize\" disabled title=\"' + globalize.translate('MoveRight') + '\"><span class=\"material-icons chevron_right\"></span></button>';\n                }\n            } else {\n                if (imageProviders.length) {\n                    html += '<button type=\"button\" is=\"paper-icon-button-light\" data-imagetype=\"' + image.ImageType + '\" class=\"btnSearchImages autoSize\" title=\"' + globalize.translate('Search') + '\"><span class=\"material-icons search\"></span></button>';\n                }\n            }\n\n            html += '<button type=\"button\" is=\"paper-icon-button-light\" data-imagetype=\"' + image.ImageType + '\" data-index=\"' + (image.ImageIndex != null ? image.ImageIndex : 'null') + '\" class=\"btnDeleteImage autoSize\" title=\"' + globalize.translate('Delete') + '\"><span class=\"material-icons delete\"></span></button>';\n            html += '</div>';\n        }\n\n        html += '</div>';\n        html += '</div>';\n        html += '</' + tagName + '>';\n\n        return html;\n    }\n\n    function deleteImage(context, itemId, type, index, apiClient, enableConfirmation) {\n        const afterConfirm = function () {\n            apiClient.deleteItemImage(itemId, type, index).then(function () {\n                hasChanges = true;\n                reload(context);\n            });\n        };\n\n        if (!enableConfirmation) {\n            afterConfirm();\n            return;\n        }\n\n        import('confirm').then(({default: confirm}) => {\n            confirm({\n\n                text: globalize.translate('ConfirmDeleteImage'),\n                confirmText: globalize.translate('Delete'),\n                primary: 'delete'\n\n            }).then(afterConfirm);\n        });\n    }\n\n    function moveImage(context, apiClient, itemId, type, index, newIndex, focusContext) {\n        apiClient.updateItemImageIndex(itemId, type, index, newIndex).then(function () {\n            hasChanges = true;\n            reload(context, null, focusContext);\n        }, function () {\n            import('alert').then(({default: alert}) => {\n                alert(globalize.translate('ErrorDefault'));\n            });\n        });\n    }\n\n    function renderImages(page, item, apiClient, images, imageProviders, elem) {\n        let html = '';\n\n        let imageSize = 300;\n        const windowSize = dom.getWindowSize();\n        if (windowSize.innerWidth >= 1280) {\n            imageSize = Math.round(windowSize.innerWidth / 4);\n        }\n\n        const tagName = layoutManager.tv ? 'button' : 'div';\n        const enableFooterButtons = !layoutManager.tv;\n\n        for (let i = 0, length = images.length; i < length; i++) {\n            const image = images[i];\n            html += getCardHtml(image, i, length, apiClient, imageProviders, imageSize, tagName, enableFooterButtons);\n        }\n\n        elem.innerHTML = html;\n        imageLoader.lazyChildren(elem);\n    }\n\n    function renderStandardImages(page, apiClient, item, imageInfos, imageProviders) {\n        const images = imageInfos.filter(function (i) {\n            return i.ImageType !== 'Screenshot' && i.ImageType !== 'Backdrop' && i.ImageType !== 'Chapter';\n        });\n\n        renderImages(page, item, apiClient, images, imageProviders, page.querySelector('#images'));\n    }\n\n    function renderBackdrops(page, apiClient, item, imageInfos, imageProviders) {\n        const images = imageInfos.filter(function (i) {\n            return i.ImageType === 'Backdrop';\n        }).sort(function (a, b) {\n            return a.ImageIndex - b.ImageIndex;\n        });\n\n        if (images.length) {\n            page.querySelector('#backdropsContainer', page).classList.remove('hide');\n            renderImages(page, item, apiClient, images, imageProviders, page.querySelector('#backdrops'));\n        } else {\n            page.querySelector('#backdropsContainer', page).classList.add('hide');\n        }\n    }\n\n    function renderScreenshots(page, apiClient, item, imageInfos, imageProviders) {\n        const images = imageInfos.filter(function (i) {\n            return i.ImageType === 'Screenshot';\n        }).sort(function (a, b) {\n            return a.ImageIndex - b.ImageIndex;\n        });\n\n        if (images.length) {\n            page.querySelector('#screenshotsContainer', page).classList.remove('hide');\n            renderImages(page, item, apiClient, images, imageProviders, page.querySelector('#screenshots'));\n        } else {\n            page.querySelector('#screenshotsContainer', page).classList.add('hide');\n        }\n    }\n\n    function showImageDownloader(page, imageType) {\n        import('imageDownloader').then(({default: ImageDownloader}) => {\n            ImageDownloader.show(currentItem.Id, currentItem.ServerId, currentItem.Type, imageType).then(function () {\n                hasChanges = true;\n                reload(page);\n            });\n        });\n    }\n\n    function showActionSheet(context, imageCard) {\n        const itemId = imageCard.getAttribute('data-id');\n        const serverId = imageCard.getAttribute('data-serverid');\n        const apiClient = connectionManager.getApiClient(serverId);\n\n        const type = imageCard.getAttribute('data-imagetype');\n        const index = parseInt(imageCard.getAttribute('data-index'));\n        const providerCount = parseInt(imageCard.getAttribute('data-providers'));\n        const numImages = parseInt(imageCard.getAttribute('data-numimages'));\n\n        import('actionsheet').then(({default: actionSheet}) => {\n            const commands = [];\n\n            commands.push({\n                name: globalize.translate('Delete'),\n                id: 'delete'\n            });\n\n            if (type === 'Backdrop' || type === 'Screenshot') {\n                if (index > 0) {\n                    commands.push({\n                        name: globalize.translate('MoveLeft'),\n                        id: 'moveleft'\n                    });\n                }\n\n                if (index < numImages - 1) {\n                    commands.push({\n                        name: globalize.translate('MoveRight'),\n                        id: 'moveright'\n                    });\n                }\n            }\n\n            if (providerCount) {\n                commands.push({\n                    name: globalize.translate('Search'),\n                    id: 'search'\n                });\n            }\n\n            actionSheet.show({\n\n                items: commands,\n                positionTo: imageCard\n\n            }).then(function (id) {\n                switch (id) {\n                    case 'delete':\n                        deleteImage(context, itemId, type, index, apiClient, false);\n                        break;\n                    case 'search':\n                        showImageDownloader(context, type);\n                        break;\n                    case 'moveleft':\n                        moveImage(context, apiClient, itemId, type, index, index - 1, dom.parentWithClass(imageCard, 'itemsContainer'));\n                        break;\n                    case 'moveright':\n                        moveImage(context, apiClient, itemId, type, index, index + 1, dom.parentWithClass(imageCard, 'itemsContainer'));\n                        break;\n                    default:\n                        break;\n                }\n            });\n        });\n    }\n\n    function initEditor(context, options) {\n        const uploadButtons = context.querySelectorAll('.btnOpenUploadMenu');\n        const isFileInputSupported = appHost.supports('fileinput');\n        for (let i = 0, length = uploadButtons.length; i < length; i++) {\n            if (isFileInputSupported) {\n                uploadButtons[i].classList.remove('hide');\n            } else {\n                uploadButtons[i].classList.add('hide');\n            }\n        }\n\n        addListeners(context, 'btnOpenUploadMenu', 'click', function () {\n            const imageType = this.getAttribute('data-imagetype');\n\n            import('imageUploader').then(({default: imageUploader}) => {\n                imageUploader.show({\n\n                    theme: options.theme,\n                    imageType: imageType,\n                    itemId: currentItem.Id,\n                    serverId: currentItem.ServerId\n\n                }).then(function (hasChanged) {\n                    if (hasChanged) {\n                        hasChanges = true;\n                        reload(context);\n                    }\n                });\n            });\n        });\n\n        addListeners(context, 'btnSearchImages', 'click', function () {\n            showImageDownloader(context, this.getAttribute('data-imagetype'));\n        });\n\n        addListeners(context, 'btnBrowseAllImages', 'click', function () {\n            showImageDownloader(context, this.getAttribute('data-imagetype') || 'Primary');\n        });\n\n        addListeners(context, 'btnImageCard', 'click', function () {\n            showActionSheet(context, this);\n        });\n\n        addListeners(context, 'btnDeleteImage', 'click', function () {\n            const type = this.getAttribute('data-imagetype');\n            let index = this.getAttribute('data-index');\n            index = index === 'null' ? null : parseInt(index);\n            const apiClient = connectionManager.getApiClient(currentItem.ServerId);\n            deleteImage(context, currentItem.Id, type, index, apiClient, true);\n        });\n\n        addListeners(context, 'btnMoveImage', 'click', function () {\n            const type = this.getAttribute('data-imagetype');\n            const index = this.getAttribute('data-index');\n            const newIndex = this.getAttribute('data-newindex');\n            const apiClient = connectionManager.getApiClient(currentItem.ServerId);\n            moveImage(context, apiClient, currentItem.Id, type, index, newIndex, dom.parentWithClass(this, 'itemsContainer'));\n        });\n    }\n\n    function showEditor(options, resolve, reject) {\n        const itemId = options.itemId;\n        const serverId = options.serverId;\n\n        loading.show();\n\n        import('text!./imageeditor.template.html').then(({default: template}) => {\n            const apiClient = connectionManager.getApiClient(serverId);\n            apiClient.getItem(apiClient.getCurrentUserId(), itemId).then(function (item) {\n                const dialogOptions = {\n                    removeOnClose: true\n                };\n\n                if (layoutManager.tv) {\n                    dialogOptions.size = 'fullscreen';\n                } else {\n                    dialogOptions.size = 'small';\n                }\n\n                const dlg = dialogHelper.createDialog(dialogOptions);\n\n                dlg.classList.add('formDialog');\n\n                dlg.innerHTML = globalize.translateHtml(template, 'core');\n\n                if (layoutManager.tv) {\n                    scrollHelper.centerFocus.on(dlg, false);\n                }\n\n                initEditor(dlg, options);\n\n                // Has to be assigned a z-index after the call to .open()\n                dlg.addEventListener('close', function () {\n                    if (layoutManager.tv) {\n                        scrollHelper.centerFocus.off(dlg, false);\n                    }\n\n                    loading.hide();\n\n                    if (hasChanges) {\n                        resolve();\n                    } else {\n                        reject();\n                    }\n                });\n\n                dialogHelper.open(dlg);\n\n                reload(dlg, item);\n\n                dlg.querySelector('.btnCancel').addEventListener('click', function () {\n                    dialogHelper.close(dlg);\n                });\n            });\n        });\n    }\n\nexport function show (options) {\n    return new Promise(function (resolve, reject) {\n        hasChanges = false;\n        showEditor(options, resolve, reject);\n    });\n}\n\nexport default {\n    show\n};\n\n/* eslint-enable indent */\n"]}