define(["require","exports","dom","loading","apphost","dialogHelper","connectionManager","imageLoader","browser","layoutManager","scrollHelper","globalize","emby-checkbox","paper-icon-button-light","emby-button","formDialogStyle","cardStyle"],(function(_require,_exports,_dom,_loading,_apphost,_dialogHelper,_connectionManager,_imageLoader,_browser,_layoutManager,_scrollHelper,_globalize,_embyCheckbox,_paperIconButtonLight,_embyButton,_formDialogStyle,_cardStyle){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.show=show,_exports.default=void 0,_dom=_interopRequireDefault(_dom),_loading=_interopRequireDefault(_loading),_apphost=_interopRequireDefault(_apphost),_dialogHelper=_interopRequireDefault(_dialogHelper),_connectionManager=_interopRequireDefault(_connectionManager),_imageLoader=_interopRequireDefault(_imageLoader),_browser=_interopRequireDefault(_browser),_layoutManager=_interopRequireDefault(_layoutManager),_scrollHelper=_interopRequireDefault(_scrollHelper),_globalize=_interopRequireDefault(_globalize);var currentItemId,currentItemType,currentResolve,currentReject,selectedProvider,enableFocusTransform=!_browser.default.slow&&!_browser.default.edge,hasChanges=!1,browsableImagePageSize=_browser.default.slow?6:30,browsableImageStartIndex=0,browsableImageType="Primary";function getBaseRemoteOptions(){var options={};return options.itemId=currentItemId,options}function reloadBrowsableImages(page,apiClient){_loading.default.show();var options=getBaseRemoteOptions();options.type=browsableImageType,options.startIndex=browsableImageStartIndex,options.limit=browsableImagePageSize,options.IncludeAllLanguages=page.querySelector("#chkAllLanguages").checked;var provider=selectedProvider||"";provider&&(options.ProviderName=provider),apiClient.getAvailableRemoteImages(options).then((function(result){!function renderRemoteImages(page,apiClient,imagesResult,imageType,startIndex,limit){page.querySelector(".availableImagesPaging").innerHTML=function getPagingHtml(startIndex,limit,totalRecordCount){var html="",recordsEnd=Math.min(startIndex+limit,totalRecordCount),showControls=totalRecordCount>limit;html+='<div class="listPaging">',html+='<span style="margin-right: 10px;">';var startAtDisplay=totalRecordCount?startIndex+1:0;html+=_globalize.default.translate("ListPaging",startAtDisplay,recordsEnd,totalRecordCount),html+="</span>",showControls&&(html+='<div data-role="controlgroup" data-type="horizontal" style="display:inline-block;">',html+='<button is="paper-icon-button-light" title="'+_globalize.default.translate("Previous")+'" class="btnPreviousPage autoSize" '+(startIndex?"":"disabled")+'><span class="material-icons arrow_back"></span></button>',html+='<button is="paper-icon-button-light" title="'+_globalize.default.translate("Next")+'" class="btnNextPage autoSize" '+(startIndex+limit>=totalRecordCount?"disabled":"")+'><span class="material-icons arrow_forward"></span></button>',html+="</div>");return html+="</div>"}(startIndex,limit,imagesResult.TotalRecordCount);for(var html="",i=0,length=imagesResult.Images.length;i<length;i++)html+=getRemoteImageHtml(imagesResult.Images[i],imageType,apiClient);var availableImagesList=page.querySelector(".availableImagesList");availableImagesList.innerHTML=html,_imageLoader.default.lazyChildren(availableImagesList);var btnNextPage=page.querySelector(".btnNextPage"),btnPreviousPage=page.querySelector(".btnPreviousPage");btnNextPage&&btnNextPage.addEventListener("click",(function(){browsableImageStartIndex+=browsableImagePageSize,reloadBrowsableImages(page,apiClient)}));btnPreviousPage&&btnPreviousPage.addEventListener("click",(function(){browsableImageStartIndex-=browsableImagePageSize,reloadBrowsableImages(page,apiClient)}))}(page,apiClient,result,browsableImageType,options.startIndex,options.limit),page.querySelector("#selectBrowsableImageType").value=browsableImageType;var providersHtml=result.Providers.map((function(p){return'<option value="'+p+'">'+p+"</option>"})),selectImageProvider=page.querySelector("#selectImageProvider");selectImageProvider.innerHTML='<option value="">'+_globalize.default.translate("All")+"</option>"+providersHtml,selectImageProvider.value=provider,_loading.default.hide()}))}function downloadRemoteImage(page,apiClient,url,type,provider){var options=getBaseRemoteOptions();options.Type=type,options.ImageUrl=url,options.ProviderName=provider,_loading.default.show(),apiClient.downloadRemoteImage(options).then((function(){hasChanges=!0;var dlg=_dom.default.parentWithClass(page,"dialog");_dialogHelper.default.close(dlg)}))}function getDisplayUrl(url,apiClient){return apiClient.getUrl("Images/Remote",{imageUrl:url})}function getRemoteImageHtml(image,imageType,apiClient){var shape,tagName=_layoutManager.default.tv?"button":"div",enableFooterButtons=!_layoutManager.default.tv,html="",cssClass="card scalableCard imageEditorCard";return cssClass+=" "+(shape="Backdrop"===imageType||"Art"===imageType||"Thumb"===imageType||"Logo"===imageType?"backdrop":"Banner"===imageType?"banner":"Disc"===imageType?"square":"Episode"===currentItemType?"backdrop":"MusicAlbum"===currentItemType||"MusicArtist"===currentItemType?"square":"portrait")+"Card "+shape+"Card-scalable","button"===tagName?(cssClass+=" btnImageCard",_layoutManager.default.tv&&(cssClass+=" show-focus",enableFocusTransform&&(cssClass+=" show-animation")),html+='<button type="button" class="'+cssClass+'"'):html+='<div class="'+cssClass+'"',html+=' data-imageprovider="'+image.ProviderName+'" data-imageurl="'+image.Url+'" data-imagetype="'+image.Type+'"',html+=">",html+='<div class="cardBox visualCardBox">',html+='<div class="cardScalable visualCardBox-cardScalable" style="background-color:transparent;">',html+='<div class="cardPadder-'+shape+'"></div>',html+='<div class="cardContent">',_layoutManager.default.tv||!_apphost.default.supports("externallinks")?html+='<div class="cardImageContainer lazy" data-src="'+getDisplayUrl(image.Url,apiClient)+'" style="background-position:center center;background-size:contain;"></div>':html+='<a is="emby-linkbutton" target="_blank" href="'+getDisplayUrl(image.Url,apiClient)+'" class="button-link cardImageContainer lazy" data-src="'+getDisplayUrl(image.Url,apiClient)+'" style="background-position:center center;background-size:contain"></a>',html+="</div>",html+="</div>",html+='<div class="cardFooter visualCardBox-cardFooter">',html+='<div class="cardText cardTextCentered">'+image.ProviderName+"</div>",(image.Width||image.Height||image.Language)&&(html+='<div class="cardText cardText-secondary cardTextCentered">',image.Width&&image.Height?(html+=image.Width+" x "+image.Height,image.Language&&(html+=" • "+image.Language)):image.Language&&(html+=image.Language),html+="</div>"),null!=image.CommunityRating&&(html+='<div class="cardText cardText-secondary cardTextCentered">',"Likes"===image.RatingType?html+=image.CommunityRating+(1===image.CommunityRating?" like":" likes"):image.CommunityRating?(html+=image.CommunityRating.toFixed(1),image.VoteCount&&(html+=" • "+image.VoteCount+(1===image.VoteCount?" vote":" votes"))):html+="Unrated",html+="</div>"),enableFooterButtons&&(html+='<div class="cardText cardTextCentered">',html+='<button is="paper-icon-button-light" class="btnDownloadRemoteImage autoSize" raised" title="'+_globalize.default.translate("Download")+'"><span class="material-icons cloud_download"></span></button>',html+="</div>"),html+="</div>",html+="</div>",html+="</"+tagName+">"}function showEditor(itemId,serverId,itemType){_loading.default.show(),new Promise((function(_resolve,_reject){return _require(["text!./imageDownloader.template.html"],(function(imported){return _resolve(function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}(imported))}),_reject)})).then((function(_ref){var template=_ref.default,apiClient=_connectionManager.default.getApiClient(serverId);currentItemId=itemId,currentItemType=itemType;var dialogOptions={removeOnClose:!0};_layoutManager.default.tv?dialogOptions.size="fullscreen":dialogOptions.size="small";var dlg=_dialogHelper.default.createDialog(dialogOptions);dlg.innerHTML=_globalize.default.translateHtml(template,"core"),_layoutManager.default.tv&&_scrollHelper.default.centerFocus.on(dlg,!1),dlg.addEventListener("close",onDialogClosed),_dialogHelper.default.open(dlg);var editorContent=dlg.querySelector(".formDialogContent");!function initEditor(page,apiClient){page.querySelector("#selectBrowsableImageType").addEventListener("change",(function(){browsableImageType=this.value,browsableImageStartIndex=0,selectedProvider=null,reloadBrowsableImages(page,apiClient)})),page.querySelector("#selectImageProvider").addEventListener("change",(function(){browsableImageStartIndex=0,selectedProvider=this.value,reloadBrowsableImages(page,apiClient)})),page.querySelector("#chkAllLanguages").addEventListener("change",(function(){browsableImageStartIndex=0,reloadBrowsableImages(page,apiClient)})),page.addEventListener("click",(function(e){var btnDownloadRemoteImage=_dom.default.parentWithClass(e.target,"btnDownloadRemoteImage");if(btnDownloadRemoteImage){var card=_dom.default.parentWithClass(btnDownloadRemoteImage,"card");downloadRemoteImage(page,apiClient,card.getAttribute("data-imageurl"),card.getAttribute("data-imagetype"),card.getAttribute("data-imageprovider"))}else{var btnImageCard=_dom.default.parentWithClass(e.target,"btnImageCard");btnImageCard&&downloadRemoteImage(page,apiClient,btnImageCard.getAttribute("data-imageurl"),btnImageCard.getAttribute("data-imagetype"),btnImageCard.getAttribute("data-imageprovider"))}}))}(editorContent,apiClient),dlg.querySelector(".btnCancel").addEventListener("click",(function(){_dialogHelper.default.close(dlg)})),reloadBrowsableImages(editorContent,apiClient)}))}function onDialogClosed(){_layoutManager.default.tv&&_scrollHelper.default.centerFocus.off(this,!1),_loading.default.hide(),hasChanges?currentResolve():currentReject()}function show(itemId,serverId,itemType,imageType){return new Promise((function(resolve,reject){currentResolve=resolve,currentReject=reject,hasChanges=!1,browsableImageStartIndex=0,browsableImageType=imageType||"Primary",selectedProvider=null,showEditor(itemId,serverId,itemType)}))}var _default={show:show};_exports.default=_default}));
//# sourceMappingURL=imageDownloader.js.map
