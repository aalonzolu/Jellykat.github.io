define(["require","exports","browser","appSettings","apphost","focusManager","qualityoptions","globalize","loading","connectionManager","events","emby-select","emby-checkbox"],(function(_require,_exports,_browser,_appSettings,_apphost,_focusManager,_qualityoptions,_globalize,_loading,_connectionManager,_events,_embySelect,_embyCheckbox){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function fillSkipLengths(select){select.innerHTML=[5,10,15,20,25,30].map((function(option){return{name:_globalize.default.translate("ValueSeconds",option),value:1e3*option}})).map((function(o){return'<option value="'.concat(o.value,'">').concat(o.name,"</option>")})).join("")}function setMaxBitrateIntoField(select,isInNetwork,mediatype){var options="Audio"===mediatype?_qualityoptions.default.getAudioQualityOptions({currentMaxBitrate:_appSettings.default.maxStreamingBitrate(isInNetwork,mediatype),isAutomaticBitrateEnabled:_appSettings.default.enableAutomaticBitrateDetection(isInNetwork,mediatype),enableAuto:!0}):_qualityoptions.default.getVideoQualityOptions({currentMaxBitrate:_appSettings.default.maxStreamingBitrate(isInNetwork,mediatype),isAutomaticBitrateEnabled:_appSettings.default.enableAutomaticBitrateDetection(isInNetwork,mediatype),enableAuto:!0});select.innerHTML=options.map((function(i){return'<option value="'.concat(i.bitrate||"",'">').concat(i.name,"</option>")})).join(""),_appSettings.default.enableAutomaticBitrateDetection(isInNetwork,mediatype)?select.value="":select.value=_appSettings.default.maxStreamingBitrate(isInNetwork,mediatype)}function setMaxBitrateFromField(select,isInNetwork,mediatype){select.value?(_appSettings.default.maxStreamingBitrate(isInNetwork,mediatype,select.value),_appSettings.default.enableAutomaticBitrateDetection(isInNetwork,mediatype,!1)):_appSettings.default.enableAutomaticBitrateDetection(isInNetwork,mediatype,!0)}function loadForm(context,user,userSettings,apiClient){var loggedInUserId=apiClient.getCurrentUserId(),userId=user.Id;!function showHideQualityFields(context,user,apiClient){if(user.Policy.EnableVideoPlaybackTranscoding?context.querySelector(".videoQualitySection").classList.remove("hide"):context.querySelector(".videoQualitySection").classList.add("hide"),_apphost.default.supports("multiserver"))return context.querySelector(".fldVideoInNetworkQuality").classList.remove("hide"),context.querySelector(".fldVideoInternetQuality").classList.remove("hide"),void(user.Policy.EnableAudioPlaybackTranscoding?context.querySelector(".musicQualitySection").classList.remove("hide"):context.querySelector(".musicQualitySection").classList.add("hide"));apiClient.getEndpointInfo().then((function(endpointInfo){endpointInfo.IsInNetwork?(context.querySelector(".fldVideoInNetworkQuality").classList.remove("hide"),context.querySelector(".fldVideoInternetQuality").classList.add("hide"),context.querySelector(".musicQualitySection").classList.add("hide")):(context.querySelector(".fldVideoInNetworkQuality").classList.add("hide"),context.querySelector(".fldVideoInternetQuality").classList.remove("hide"),user.Policy.EnableAudioPlaybackTranscoding?context.querySelector(".musicQualitySection").classList.remove("hide"):context.querySelector(".musicQualitySection").classList.add("hide"))}))}(context,user,apiClient),apiClient.getCultures().then((function(allCultures){!function populateLanguages(select,languages){var html="";html+="<option value=''>".concat(_globalize.default.translate("AnyLanguage"),"</option>");for(var i=0,length=languages.length;i<length;i++){var culture=languages[i];html+="<option value='".concat(culture.ThreeLetterISOLanguageName,"'>").concat(culture.DisplayName,"</option>")}select.innerHTML=html}(context.querySelector("#selectAudioLanguage"),allCultures),context.querySelector("#selectAudioLanguage",context).value=user.Configuration.AudioLanguagePreference||"",context.querySelector(".chkEpisodeAutoPlay").checked=user.Configuration.EnableNextEpisodeAutoPlay||!1})),apiClient.getNamedConfiguration("cinemamode").then((function(cinemaConfig){cinemaConfig.EnableIntrosForMovies||cinemaConfig.EnableIntrosForEpisodes?context.querySelector(".cinemaModeOptions").classList.remove("hide"):context.querySelector(".cinemaModeOptions").classList.add("hide")})),_apphost.default.supports("externalplayerintent")&&userId===loggedInUserId?context.querySelector(".fldExternalPlayer").classList.remove("hide"):context.querySelector(".fldExternalPlayer").classList.add("hide"),userId===loggedInUserId&&(user.Policy.EnableVideoPlaybackTranscoding||user.Policy.EnableAudioPlaybackTranscoding)?(context.querySelector(".qualitySections").classList.remove("hide"),_apphost.default.supports("chromecast")&&user.Policy.EnableVideoPlaybackTranscoding?context.querySelector(".fldChromecastQuality").classList.remove("hide"):context.querySelector(".fldChromecastQuality").classList.add("hide")):(context.querySelector(".qualitySections").classList.add("hide"),context.querySelector(".fldChromecastQuality").classList.add("hide")),_browser.default.tizen||_browser.default.web0s?context.querySelector(".fldEnableNextVideoOverlay").classList.add("hide"):context.querySelector(".fldEnableNextVideoOverlay").classList.remove("hide"),context.querySelector(".chkPlayDefaultAudioTrack").checked=user.Configuration.PlayDefaultAudioTrack||!1,context.querySelector(".chkEnableCinemaMode").checked=userSettings.enableCinemaMode(),context.querySelector(".chkEnableNextVideoOverlay").checked=userSettings.enableNextVideoInfoOverlay(),context.querySelector(".chkExternalVideoPlayer").checked=_appSettings.default.enableSystemExternalPlayers(),setMaxBitrateIntoField(context.querySelector(".selectVideoInNetworkQuality"),!0,"Video"),setMaxBitrateIntoField(context.querySelector(".selectVideoInternetQuality"),!1,"Video"),setMaxBitrateIntoField(context.querySelector(".selectMusicInternetQuality"),!1,"Audio"),function fillChromecastQuality(select){var options=_qualityoptions.default.getVideoQualityOptions({currentMaxBitrate:_appSettings.default.maxChromecastBitrate(),isAutomaticBitrateEnabled:!_appSettings.default.maxChromecastBitrate(),enableAuto:!0});select.innerHTML=options.map((function(i){return'<option value="'.concat(i.bitrate||"",'">').concat(i.name,"</option>")})).join(""),select.value=_appSettings.default.maxChromecastBitrate()||""}(context.querySelector(".selectChromecastVideoQuality")),context.querySelector(".selectChromecastVersion").value=userSettings.chromecastVersion();var selectSkipForwardLength=context.querySelector(".selectSkipForwardLength");fillSkipLengths(selectSkipForwardLength),selectSkipForwardLength.value=userSettings.skipForwardLength();var selectSkipBackLength=context.querySelector(".selectSkipBackLength");fillSkipLengths(selectSkipBackLength),selectSkipBackLength.value=userSettings.skipBackLength(),function showOrHideEpisodesField(context){_browser.default.tizen||_browser.default.web0s?context.querySelector(".fldEpisodeAutoPlay").classList.add("hide"):context.querySelector(".fldEpisodeAutoPlay").classList.remove("hide")}(context),_loading.default.hide()}function save(instance,context,userId,userSettings,apiClient,enableSaveConfirmation){_loading.default.show(),apiClient.getUser(userId).then((function(user){(function saveUser(context,user,userSettingsInstance,apiClient){return _appSettings.default.enableSystemExternalPlayers(context.querySelector(".chkExternalVideoPlayer").checked),_appSettings.default.maxChromecastBitrate(context.querySelector(".selectChromecastVideoQuality").value),setMaxBitrateFromField(context.querySelector(".selectVideoInNetworkQuality"),!0,"Video"),setMaxBitrateFromField(context.querySelector(".selectVideoInternetQuality"),!1,"Video"),setMaxBitrateFromField(context.querySelector(".selectMusicInternetQuality"),!1,"Audio"),user.Configuration.AudioLanguagePreference=context.querySelector("#selectAudioLanguage").value,user.Configuration.PlayDefaultAudioTrack=context.querySelector(".chkPlayDefaultAudioTrack").checked,user.Configuration.EnableNextEpisodeAutoPlay=context.querySelector(".chkEpisodeAutoPlay").checked,userSettingsInstance.enableCinemaMode(context.querySelector(".chkEnableCinemaMode").checked),userSettingsInstance.enableNextVideoInfoOverlay(context.querySelector(".chkEnableNextVideoOverlay").checked),userSettingsInstance.chromecastVersion(context.querySelector(".selectChromecastVersion").value),userSettingsInstance.skipForwardLength(context.querySelector(".selectSkipForwardLength").value),userSettingsInstance.skipBackLength(context.querySelector(".selectSkipBackLength").value),apiClient.updateUserConfiguration(user.Id,user.Configuration)})(context,user,userSettings,apiClient).then((function(){_loading.default.hide(),enableSaveConfirmation&&new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(_globalize.default.translate("SettingsSaved"))})),_events.default.trigger(instance,"saved")}),(function(){_loading.default.hide()}))}))}function onSubmit(e){var self=this,apiClient=_connectionManager.default.getApiClient(self.options.serverId),userId=self.options.userId,userSettings=self.options.userSettings;return userSettings.setUserInfo(userId,apiClient).then((function(){var enableSaveConfirmation=self.options.enableSaveConfirmation;save(self,self.options.element,userId,userSettings,apiClient,enableSaveConfirmation)})),e&&e.preventDefault(),!1}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_browser=_interopRequireDefault(_browser),_appSettings=_interopRequireDefault(_appSettings),_apphost=_interopRequireDefault(_apphost),_focusManager=_interopRequireDefault(_focusManager),_qualityoptions=_interopRequireDefault(_qualityoptions),_globalize=_interopRequireDefault(_globalize),_loading=_interopRequireDefault(_loading),_connectionManager=_interopRequireDefault(_connectionManager),_events=_interopRequireDefault(_events);var _default=function(){function PlaybackSettings(options){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PlaybackSettings),this.options=options,function embed(options,self){return new Promise((function(_resolve,_reject){return _require(["text!./playbackSettings.template.html"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){var template=_ref2.default;options.element.innerHTML=_globalize.default.translateHtml(template,"core"),options.element.querySelector("form").addEventListener("submit",onSubmit.bind(self)),options.enableSaveButton&&options.element.querySelector(".btnSave").classList.remove("hide"),self.loadData(),options.autoFocus&&_focusManager.default.autoFocus(options.element)}))}(options,this)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(PlaybackSettings,[{key:"loadData",value:function loadData(){var self=this,context=self.options.element;_loading.default.show();var userId=self.options.userId,apiClient=_connectionManager.default.getApiClient(self.options.serverId),userSettings=self.options.userSettings;apiClient.getUser(userId).then((function(user){userSettings.setUserInfo(userId,apiClient).then((function(){self.dataLoaded=!0,loadForm(context,user,userSettings,apiClient)}))}))}},{key:"submit",value:function submit(){onSubmit.call(this)}},{key:"destroy",value:function destroy(){this.options=null}}]),PlaybackSettings}();_exports.default=_default}));
//# sourceMappingURL=playbackSettings.js.map
