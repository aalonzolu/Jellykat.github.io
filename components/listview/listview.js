define(["exports","itemHelper","mediaInfo","indicators","connectionManager","layoutManager","globalize","datetime","cardBuilder","css!./listview","emby-ratingbutton","emby-playstatebutton"],(function(_exports,_itemHelper,_mediaInfo,_indicators,_connectionManager,_layoutManager,_globalize,_datetime,_cardBuilder,_listview,_embyRatingbutton,_embyPlaystatebutton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function getIndex(item,options){if("disc"===options.index)return null==item.ParentIndexNumber?"":_globalize.default.translate("ValueDiscNumber",item.ParentIndexNumber);var code,name,sortBy=(options.sortBy||"").toLowerCase();return 0===sortBy.indexOf("sortname")?"Episode"===item.Type?"":(code=(name=(item.SortName||item.Name||"?")[0].toUpperCase()).charCodeAt(0))<65||code>90?"#":name.toUpperCase():0===sortBy.indexOf("officialrating")?item.OfficialRating||_globalize.default.translate("Unrated"):0===sortBy.indexOf("communityrating")?null==item.CommunityRating?_globalize.default.translate("Unrated"):Math.floor(item.CommunityRating):0===sortBy.indexOf("criticrating")?null==item.CriticRating?_globalize.default.translate("Unrated"):Math.floor(item.CriticRating):0===sortBy.indexOf("albumartist")&&item.AlbumArtist?(code=(name=item.AlbumArtist[0].toUpperCase()).charCodeAt(0))<65||code>90?"#":name.toUpperCase():""}function getImageUrl(item,width){var itemId,apiClient=_connectionManager.default.getApiClient(item.ServerId),options={maxWidth:width,type:"Primary"};return item.ImageTags&&item.ImageTags.Primary?(options.tag=item.ImageTags.Primary,itemId=item.Id):item.AlbumId&&item.AlbumPrimaryImageTag?(options.tag=item.AlbumPrimaryImageTag,itemId=item.AlbumId):item.SeriesId&&item.SeriesPrimaryImageTag?(options.tag=item.SeriesPrimaryImageTag,itemId=item.SeriesId):item.ParentPrimaryImageTag&&(options.tag=item.ParentPrimaryImageTag,itemId=item.ParentPrimaryImageItemId),itemId?apiClient.getScaledImageUrl(itemId,options):null}function getChannelImageUrl(item,width){var apiClient=_connectionManager.default.getApiClient(item.ServerId),options={maxWidth:width,type:"Primary"};if(item.ChannelId&&item.ChannelPrimaryImageTag&&(options.tag=item.ChannelPrimaryImageTag),item.ChannelId)return apiClient.getScaledImageUrl(item.ChannelId,options)}function getTextLinesHtml(textlines,isLargeStyle){var _step,html="",largeTitleTagName=_layoutManager.default.tv?"h2":"div",_iterator=function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e3){didErr=!0,err=_e3},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}(textlines.entries());try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=_slicedToArray(_step.value,2),i=_step$value[0];_step$value[1]&&(html+=0===i?isLargeStyle?"<".concat(largeTitleTagName,' class="listItemBodyText">'):'<div class="listItemBodyText">':'<div class="secondary listItemBodyText">',html+=textlines[i]||"&nbsp;",html+=0===i&&isLargeStyle?"</".concat(largeTitleTagName,">"):"</div>")}}catch(err){_iterator.e(err)}finally{_iterator.f()}return html}function getRightButtonsHtml(options){for(var html="",i=0,length=options.rightButtons.length;i<length;i++){var button=options.rightButtons[i];html+='<button is="paper-icon-button-light" class="listItemButton itemAction" data-action="custom" data-customaction="'.concat(button.id,'" title="').concat(button.title,'"><span class="material-icons ').concat(button.icon,'"></span></button>')}return html}function getId(item){return item.Id}function getListViewHtml(options){for(var items=options.items,groupTitle="",action=options.action||"link",isLargeStyle="large"===options.imageSize,enableOverview=options.enableOverview,clickEntireItem=!!_layoutManager.default.tv,outerTagName=clickEntireItem?"button":"div",enableSideMediaInfo=null==options.enableSideMediaInfo||options.enableSideMediaInfo,outerHtml="",enableContentWrapper=options.enableOverview&&!_layoutManager.default.tv,containerAlbumArtistIds=(options.containerAlbumArtists||[]).map(getId),i=0,length=items.length;i<length;i++){var item=items[i],html="";if(options.showIndex){var itemGroupTitle=getIndex(item,options);itemGroupTitle!==groupTitle&&(html&&(html+="</div>"),html+=0===i?'<h2 class="listGroupHeader listGroupHeader-first">':'<h2 class="listGroupHeader">',html+=itemGroupTitle,html+="</h2>",html+="<div>",groupTitle=itemGroupTitle)}var cssClass="listItem";(options.border||!1!==options.highlight&&!_layoutManager.default.tv)&&(cssClass+=" listItem-border"),clickEntireItem&&(cssClass+=" itemAction listItem-button"),_layoutManager.default.tv&&(cssClass+=" listItem-focusscale");var downloadWidth=80;isLargeStyle&&(cssClass+=" listItem-largeImage",downloadWidth=500);var playlistItemId=item.PlaylistItemId?' data-playlistitemid="'.concat(item.PlaylistItemId,'"'):"",positionTicksData=item.UserData&&item.UserData.PlaybackPositionTicks?' data-positionticks="'.concat(item.UserData.PlaybackPositionTicks,'"'):"",collectionIdData=options.collectionId?' data-collectionid="'.concat(options.collectionId,'"'):"",playlistIdData=options.playlistId?' data-playlistid="'.concat(options.playlistId,'"'):"",mediaTypeData=item.MediaType?' data-mediatype="'.concat(item.MediaType,'"'):"",collectionTypeData=item.CollectionType?' data-collectiontype="'.concat(item.CollectionType,'"'):"",channelIdData=item.ChannelId?' data-channelid="'.concat(item.ChannelId,'"'):"";if(enableContentWrapper&&(cssClass+=" listItem-withContentWrapper"),html+="<".concat(outerTagName,' class="').concat(cssClass,'"').concat(playlistItemId,' data-action="').concat(action,'" data-isfolder="').concat(item.IsFolder,'" data-id="').concat(item.Id,'" data-serverid="').concat(item.ServerId,'" data-type="').concat(item.Type,'"').concat(mediaTypeData).concat(collectionTypeData).concat(channelIdData).concat(positionTicksData).concat(collectionIdData).concat(playlistIdData,">"),enableContentWrapper&&(html+='<div class="listItem-content">'),!clickEntireItem&&options.dragHandle&&(html+='<span class="listViewDragHandle material-icons listItemIcon listItemIcon-transparent drag_handle"></span>'),!1!==options.image){var imgUrl="channel"===options.imageSource?getChannelImageUrl(item,downloadWidth):getImageUrl(item,downloadWidth),imageClass=isLargeStyle?"listItemImage listItemImage-large":"listItemImage";isLargeStyle&&_layoutManager.default.tv&&(imageClass+=" listItemImage-large-tv");var playOnImageClick=options.imagePlayButton&&!_layoutManager.default.tv;clickEntireItem||(imageClass+=" itemAction"),html+=imgUrl?'<div data-action="'+(playOnImageClick?"link":action)+'" class="'+imageClass+' lazy" data-src="'+imgUrl+'" item-icon>':'<div class="'+imageClass+" cardImageContainer "+_cardBuilder.default.getDefaultBackgroundClass(item.Name)+'">'+_cardBuilder.default.getDefaultText(item,options);var indicatorsHtml="";(indicatorsHtml+=_indicators.default.getPlayedIndicatorHtml(item))&&(html+='<div class="indicators listItemIndicators">'.concat(indicatorsHtml,"</div>")),playOnImageClick&&(html+='<button is="paper-icon-button-light" class="listItemImageButton itemAction" data-action="resume"><span class="material-icons listItemImageButton-icon play_arrow"></span></button>');var progressHtml=_indicators.default.getProgressBarHtml(item,{containerClass:"listItemProgressBar"});progressHtml&&(html+=progressHtml),html+="</div>"}options.showIndexNumberLeft&&(html+='<div class="listItem-indexnumberleft">',html+=item.IndexNumber||"&nbsp;",html+="</div>");var textlines=[];options.showProgramDateTime&&textlines.push(_datetime.default.toLocaleString(_datetime.default.parseISO8601Date(item.StartDate),{weekday:"long",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})),options.showProgramTime&&textlines.push(_datetime.default.getDisplayTime(_datetime.default.parseISO8601Date(item.StartDate))),options.showChannel&&item.ChannelName&&textlines.push(item.ChannelName);var parentTitle=null;options.showParentTitle&&("Episode"===item.Type?parentTitle=item.SeriesName:(item.IsSeries||item.EpisodeTitle&&item.Name)&&(parentTitle=item.Name));var displayName=_itemHelper.default.getDisplayName(item,{includeParentInfo:options.includeParentInfoInTitle});if(options.showIndexNumber&&null!=item.IndexNumber&&(displayName="".concat(item.IndexNumber,". ").concat(displayName)),options.showParentTitle&&options.parentTitleWithTitle?(displayName&&(parentTitle&&(parentTitle+=" - "),parentTitle=(parentTitle||"")+displayName),textlines.push(parentTitle||"")):options.showParentTitle&&textlines.push(parentTitle||""),displayName&&!options.parentTitleWithTitle&&textlines.push(displayName),item.IsFolder)!1!==options.artist&&item.AlbumArtist&&"MusicAlbum"===item.Type&&textlines.push(item.AlbumArtist);else{var showArtist=!0===options.artist,artistItems=item.ArtistItems;showArtist||!1===options.artist||(artistItems&&artistItems.length?(artistItems.length>1||!containerAlbumArtistIds.includes(artistItems[0].Id))&&(showArtist=!0):showArtist=!0),showArtist&&artistItems&&"MusicAlbum"!==item.Type&&textlines.push(artistItems.map((function(a){return a.Name})).join(", "))}if("TvChannel"===item.Type&&item.CurrentProgram&&textlines.push(_itemHelper.default.getDisplayName(item.CurrentProgram)),cssClass="listItemBody",clickEntireItem||(cssClass+=" itemAction"),!1===options.image&&(cssClass+=" listItemBody-noleftpadding"),html+='<div class="'.concat(cssClass,'">'),html+=getTextLinesHtml(textlines,isLargeStyle),!1!==options.mediaInfo&&!enableSideMediaInfo){html+='<div class="'.concat("secondary listItemMediaInfo listItemBodyText",'">'),html+=_mediaInfo.default.getPrimaryMediaInfoHtml(item,{episodeTitle:!1,originalAirDate:!1,subtitles:!1}),html+="</div>"}if(enableOverview&&item.Overview&&(html+='<div class="secondary listItem-overview listItemBodyText">',html+=item.Overview,html+="</div>"),html+="</div>",!1!==options.mediaInfo&&enableSideMediaInfo&&(html+='<div class="secondary listItemMediaInfo">',html+=_mediaInfo.default.getPrimaryMediaInfoHtml(item,{year:!1,container:!1,episodeTitle:!1,criticRating:!1,endsAt:!1}),html+="</div>"),options.recordButton||"Timer"!==item.Type&&"Program"!==item.Type||(html+=_indicators.default.getTimerIndicator(item).replace("indicatorIcon","indicatorIcon listItemAside")),html+='<div class="listViewUserDataButtons">',!clickEntireItem){if(options.addToListButton&&(html+='<button is="paper-icon-button-light" class="listItemButton itemAction" data-action="addtoplaylist"><span class="material-icons playlist_add"></span></button>'),options.infoButton&&(html+='<button is="paper-icon-button-light" class="listItemButton itemAction" data-action="link"><span class="material-icons info_outline"></span></button>'),options.rightButtons&&(html+=getRightButtonsHtml(options)),!1!==options.enableUserDataButtons){var userData=item.UserData||{},likes=null==userData.Likes?"":userData.Likes;_itemHelper.default.canMarkPlayed(item)&&!1!==options.enablePlayedButton&&(html+='<button is="emby-playstatebutton" type="button" class="listItemButton paper-icon-button-light" data-id="'+item.Id+'" data-serverid="'+item.ServerId+'" data-itemtype="'+item.Type+'" data-played="'+userData.Played+'"><span class="material-icons check"></span></button>'),_itemHelper.default.canRate(item)&&!1!==options.enableRatingButton&&(html+='<button is="emby-ratingbutton" type="button" class="listItemButton paper-icon-button-light" data-id="'+item.Id+'" data-serverid="'+item.ServerId+'" data-itemtype="'+item.Type+'" data-likes="'+likes+'" data-isfavorite="'+userData.IsFavorite+'"><span class="material-icons favorite"></span></button>')}!1!==options.moreButton&&(html+='<button is="paper-icon-button-light" class="listItemButton itemAction" data-action="menu"><span class="material-icons more_vert"></span></button>')}html+="</div>",enableContentWrapper&&(html+="</div>",enableOverview&&item.Overview&&(html+='<div class="listItem-bottomoverview secondary">',html+=item.Overview,html+="</div>")),outerHtml+=html+="</".concat(outerTagName,">")}return outerHtml}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getListViewHtml=getListViewHtml,_exports.default=void 0,_itemHelper=_interopRequireDefault(_itemHelper),_mediaInfo=_interopRequireDefault(_mediaInfo),_indicators=_interopRequireDefault(_indicators),_connectionManager=_interopRequireDefault(_connectionManager),_layoutManager=_interopRequireDefault(_layoutManager),_globalize=_interopRequireDefault(_globalize),_datetime=_interopRequireDefault(_datetime),_cardBuilder=_interopRequireDefault(_cardBuilder);var _default={getListViewHtml:getListViewHtml};_exports.default=_default}));
//# sourceMappingURL=listview.js.map
