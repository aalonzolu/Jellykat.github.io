{"version":3,"sources":["components/userdatabuttons/userdatabuttons.js"],"names":["define","_exports","_connectionManager","_globalize","_dom","_itemHelper","_paperIconButtonLight","_materialIcons","_embyButton","_userdatabuttons","_interopRequireDefault","obj","__esModule","default","Object","defineProperty","value","userDataMethods","markPlayed","link","id","getAttribute","serverId","classList","contains","played","remove","add","markDislike","clearLike","likes","parentNode","querySelector","markLike","markFavorite","markAsFavorite","favorite","getUserDataButtonHtml","method","itemId","buttonCssClass","iconCssClass","icon","tooltip","style","className","onContainerClick","e","btnUserData","dom","parentWithClass","target","getIconsHtml","options","item","includePlayed","cssClass","html","userData","UserData","Id","itemHelper","isLocalItem","btnCssClass","ServerId","tooltipPlayed","globalize","translate","canMarkPlayed","Played","tooltipFavorite","IsFavorite","isLiked","apiClient","connectionManager","getApiClient","updateUserItemRating","getCurrentUserId","isPlayed","Date","isFavorite","updateFavoriteStatus","clearUserItemRating","_default","fill","fillMode","element","insertAdjacentHTML","insertLocation","innerHTML","removeEventListener","passive","addEventListener","destroy"],"mappings":"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","file":"userdatabuttons.js","sourcesContent":["import connectionManager from 'connectionManager';\nimport globalize from 'globalize';\nimport dom from 'dom';\nimport itemHelper from 'itemHelper';\nimport 'paper-icon-button-light';\nimport 'material-icons';\nimport 'emby-button';\nimport 'css!./userdatabuttons';\n\nconst userDataMethods = {\n    markPlayed: markPlayed,\n    markDislike: markDislike,\n    markLike: markLike,\n    markFavorite: markFavorite\n};\n\nfunction getUserDataButtonHtml(method, itemId, serverId, buttonCssClass, iconCssClass, icon, tooltip, style) {\n    if (style === 'fab-mini') {\n        style = 'fab';\n        buttonCssClass = buttonCssClass ? (buttonCssClass + ' mini') : 'mini';\n    }\n\n    const is = style === 'fab' ? 'emby-button' : 'paper-icon-button-light';\n    let className = style === 'fab' ? 'autoSize fab' : 'autoSize';\n\n    if (buttonCssClass) {\n        className += ' ' + buttonCssClass;\n    }\n\n    if (iconCssClass) {\n        iconCssClass += ' ';\n    } else {\n        iconCssClass = '';\n    }\n\n    iconCssClass += 'material-icons';\n\n    return '<button title=\"' + tooltip + '\" data-itemid=\"' + itemId + '\" data-serverid=\"' + serverId + '\" is=\"' + is + '\" data-method=\"' + method + '\" class=\"' + className + '\"><span class=\"' + iconCssClass + ' ' + icon + '\"></span></button>';\n}\n\nfunction onContainerClick(e) {\n    const btnUserData = dom.parentWithClass(e.target, 'btnUserData');\n\n    if (!btnUserData) {\n        return;\n    }\n\n    const method = btnUserData.getAttribute('data-method');\n    userDataMethods[method](btnUserData);\n}\n\nfunction fill(options) {\n    const html = getIconsHtml(options);\n\n    if (options.fillMode === 'insertAdjacent') {\n        options.element.insertAdjacentHTML(options.insertLocation || 'beforeend', html);\n    } else {\n        options.element.innerHTML = html;\n    }\n\n    dom.removeEventListener(options.element, 'click', onContainerClick, {\n        passive: true\n    });\n\n    dom.addEventListener(options.element, 'click', onContainerClick, {\n        passive: true\n    });\n}\n\nfunction destroy(options) {\n    options.element.innerHTML = '';\n\n    dom.removeEventListener(options.element, 'click', onContainerClick, {\n        passive: true\n    });\n}\n\nfunction getIconsHtml(options) {\n    const item = options.item;\n    const includePlayed = options.includePlayed;\n    const cssClass = options.cssClass;\n    const style = options.style;\n\n    let html = '';\n\n    const userData = item.UserData || {};\n\n    const itemId = item.Id;\n\n    if (itemHelper.isLocalItem(item)) {\n        return html;\n    }\n\n    let btnCssClass = 'btnUserData';\n\n    if (cssClass) {\n        btnCssClass += ' ' + cssClass;\n    }\n\n    const iconCssClass = options.iconCssClass;\n\n    const serverId = item.ServerId;\n\n    if (includePlayed !== false) {\n        const tooltipPlayed = globalize.translate('MarkPlayed');\n\n        if (itemHelper.canMarkPlayed(item)) {\n            if (userData.Played) {\n                html += getUserDataButtonHtml('markPlayed', itemId, serverId, btnCssClass + ' btnUserDataOn', iconCssClass, 'check', tooltipPlayed, style);\n            } else {\n                html += getUserDataButtonHtml('markPlayed', itemId, serverId, btnCssClass, iconCssClass, 'check', tooltipPlayed, style);\n            }\n        }\n    }\n\n    const tooltipFavorite = globalize.translate('Favorite');\n    if (userData.IsFavorite) {\n        html += getUserDataButtonHtml('markFavorite', itemId, serverId, btnCssClass + ' btnUserData btnUserDataOn', iconCssClass, 'favorite', tooltipFavorite, style);\n    } else {\n        html += getUserDataButtonHtml('markFavorite', itemId, serverId, btnCssClass + ' btnUserData', iconCssClass, 'favorite', tooltipFavorite, style);\n    }\n\n    return html;\n}\n\nfunction markFavorite(link) {\n    const id = link.getAttribute('data-itemid');\n    const serverId = link.getAttribute('data-serverid');\n\n    const markAsFavorite = !link.classList.contains('btnUserDataOn');\n\n    favorite(id, serverId, markAsFavorite);\n\n    if (markAsFavorite) {\n        link.classList.add('btnUserDataOn');\n    } else {\n        link.classList.remove('btnUserDataOn');\n    }\n}\n\nfunction markLike(link) {\n    const id = link.getAttribute('data-itemid');\n    const serverId = link.getAttribute('data-serverid');\n\n    if (!link.classList.contains('btnUserDataOn')) {\n        likes(id, serverId, true);\n\n        link.classList.add('btnUserDataOn');\n    } else {\n        clearLike(id, serverId);\n\n        link.classList.remove('btnUserDataOn');\n    }\n\n    link.parentNode.querySelector('.btnDislike').classList.remove('btnUserDataOn');\n}\n\nfunction markDislike(link) {\n    const id = link.getAttribute('data-itemid');\n    const serverId = link.getAttribute('data-serverid');\n\n    if (!link.classList.contains('btnUserDataOn')) {\n        likes(id, serverId, false);\n\n        link.classList.add('btnUserDataOn');\n    } else {\n        clearLike(id, serverId);\n\n        link.classList.remove('btnUserDataOn');\n    }\n\n    link.parentNode.querySelector('.btnLike').classList.remove('btnUserDataOn');\n}\n\nfunction markPlayed(link) {\n    const id = link.getAttribute('data-itemid');\n    const serverId = link.getAttribute('data-serverid');\n\n    if (!link.classList.contains('btnUserDataOn')) {\n        played(id, serverId, true);\n\n        link.classList.add('btnUserDataOn');\n    } else {\n        played(id, serverId, false);\n\n        link.classList.remove('btnUserDataOn');\n    }\n}\n\nfunction likes(id, serverId, isLiked) {\n    const apiClient = connectionManager.getApiClient(serverId);\n    return apiClient.updateUserItemRating(apiClient.getCurrentUserId(), id, isLiked);\n}\n\nfunction played(id, serverId, isPlayed) {\n    const apiClient = connectionManager.getApiClient(serverId);\n\n    const method = isPlayed ? 'markPlayed' : 'markUnplayed';\n\n    return apiClient[method](apiClient.getCurrentUserId(), id, new Date());\n}\n\nfunction favorite(id, serverId, isFavorite) {\n    const apiClient = connectionManager.getApiClient(serverId);\n\n    return apiClient.updateFavoriteStatus(apiClient.getCurrentUserId(), id, isFavorite);\n}\n\nfunction clearLike(id, serverId) {\n    const apiClient = connectionManager.getApiClient(serverId);\n\n    return apiClient.clearUserItemRating(apiClient.getCurrentUserId(), id);\n}\n\nexport default {\n    fill: fill,\n    destroy: destroy,\n    getIconsHtml: getIconsHtml\n};\n"]}