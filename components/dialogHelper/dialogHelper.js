define(["require","exports","appRouter","focusManager","browser","layoutManager","inputManager","dom","css!./dialoghelper.css","scrollStyles"],(function(_require,_exports,_appRouter,_focusManager,_browser,_layoutManager,_inputManager,_dom,_dialoghelper,_scrollStyles){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}var globalOnOpenCallback;function enableAnimation(){return!_browser.default.tv&&_browser.default.supportsCssAnimation()}function tryRemoveElement(elem){var parentNode=elem.parentNode;if(parentNode)try{parentNode.removeChild(elem)}catch(err){console.error("error removing dialog element: "+err)}}function DialogHashHandler(dlg,hash,resolve){var self=this;self.originalUrl=window.location.href;var activeElement=document.activeElement,removeScrollLockOnClose=!1;function onHashChange(e){var isBack=self.originalUrl===window.location.href;!isBack&&isOpened(dlg)||window.removeEventListener("popstate",onHashChange),isBack&&(self.closedByBack=!0,closeDialog(dlg))}function onBackCommand(e){"back"===e.detail.command&&(self.closedByBack=!0,e.preventDefault(),e.stopPropagation(),closeDialog(dlg))}dlg.addEventListener("close",(function onDialogClosed(){if(isHistoryEnabled(dlg)||_inputManager.default.off(dlg,onBackCommand),window.removeEventListener("popstate",onHashChange),function removeBackdrop(dlg){var backdrop=dlg.backdrop;if(!backdrop)return;dlg.backdrop=null;var onAnimationFinish=function onAnimationFinish(){tryRemoveElement(backdrop)};if(enableAnimation())return backdrop.classList.remove("dialogBackdropOpened"),void setTimeout(onAnimationFinish,300);onAnimationFinish()}(dlg),dlg.classList.remove("opened"),removeScrollLockOnClose&&document.body.classList.remove("noScroll"),!self.closedByBack&&isHistoryEnabled(dlg)&&(window.history.state||{}).dialogId===hash&&window.history.back(),_layoutManager.default.tv&&_focusManager.default.focus(activeElement),"false"!==dlg.getAttribute("data-removeonclose")){!function removeCenterFocus(dlg){_layoutManager.default.tv&&(dlg.classList.contains("scrollX")?centerFocus(dlg,!0,!1):dlg.classList.contains("smoothScrollY")&&centerFocus(dlg,!1,!1))}(dlg);var dialogContainer=dlg.dialogContainer;dialogContainer?(tryRemoveElement(dialogContainer),dlg.dialogContainer=null):tryRemoveElement(dlg)}setTimeout((function(){resolve({element:dlg,closedByBack:self.closedByBack})}),1)})),!dlg.classList.contains("dialog-fixedSize")&&dlg.classList.add("centeredDialog"),dlg.classList.remove("hide"),function addBackdropOverlay(dlg){var backdrop=document.createElement("div");backdrop.classList.add("dialogBackdrop");var backdropParent=dlg.dialogContainer||dlg;backdropParent.parentNode.insertBefore(backdrop,backdropParent),dlg.backdrop=backdrop,backdrop.offsetWidth,backdrop.classList.add("dialogBackdropOpened"),_dom.default.addEventListener(dlg.dialogContainer||backdrop,"click",(function(e){e.target===dlg.dialogContainer&&close(dlg)}),{passive:!0}),_dom.default.addEventListener(dlg.dialogContainer||backdrop,"contextmenu",(function(e){e.target===dlg.dialogContainer&&(close(dlg),e.preventDefault())}))}(dlg),dlg.classList.add("opened"),dlg.dispatchEvent(new CustomEvent("open",{bubbles:!1,cancelable:!1})),"true"!==dlg.getAttribute("data-lockscroll")||document.body.classList.contains("noScroll")||(document.body.classList.add("noScroll"),removeScrollLockOnClose=!0),function animateDialogOpen(dlg){var onAnimationFinish=function onAnimationFinish(){_focusManager.default.pushScope(dlg),"true"===dlg.getAttribute("data-autofocus")&&_focusManager.default.autoFocus(dlg),document.activeElement&&!dlg.contains(document.activeElement)&&document.activeElement.blur()};if(enableAnimation()){return void _dom.default.addEventListener(dlg,_dom.default.whichAnimationEvent(),(function onFinish(){_dom.default.removeEventListener(dlg,_dom.default.whichAnimationEvent(),onFinish,{once:!0}),onAnimationFinish()}),{once:!0})}onAnimationFinish()}(dlg),isHistoryEnabled(dlg)?(_appRouter.default.pushState({dialogId:hash},"Dialog","#".concat(hash)),window.addEventListener("popstate",onHashChange)):_inputManager.default.on(dlg,onBackCommand)}function isHistoryEnabled(dlg){return"true"===dlg.getAttribute("data-history")}function open(dlg){globalOnOpenCallback&&globalOnOpenCallback(dlg);var parent=dlg.parentNode;parent&&parent.removeChild(dlg);var dialogContainer=document.createElement("div");return dialogContainer.classList.add("dialogContainer"),dialogContainer.appendChild(dlg),dlg.dialogContainer=dialogContainer,document.body.appendChild(dialogContainer),new Promise((function(resolve,reject){new DialogHashHandler(dlg,"dlg".concat((new Date).getTime()),resolve)}))}function isOpened(dlg){return!dlg.classList.contains("hide")}function close(dlg){isOpened(dlg)&&(isHistoryEnabled(dlg)?window.history.back():closeDialog(dlg))}function closeDialog(dlg){if(!dlg.classList.contains("hide")){dlg.dispatchEvent(new CustomEvent("closing",{bubbles:!1,cancelable:!1}));!function animateDialogClose(dlg,onAnimationFinish){if(enableAnimation()){var animated=!0;switch(dlg.animationConfig.exit.name){case"fadeout":dlg.style.animation="fadeout ".concat(dlg.animationConfig.exit.timing.duration,"ms ease-out normal both");break;case"scaledown":dlg.style.animation="scaledown ".concat(dlg.animationConfig.exit.timing.duration,"ms ease-out normal both");break;case"slidedown":dlg.style.animation="slidedown ".concat(dlg.animationConfig.exit.timing.duration,"ms ease-out normal both");break;default:animated=!1}if(_dom.default.addEventListener(dlg,_dom.default.whichAnimationEvent(),(function onFinish(){_dom.default.removeEventListener(dlg,_dom.default.whichAnimationEvent(),onFinish,{once:!0}),onAnimationFinish()}),{once:!0}),animated)return}onAnimationFinish()}(dlg,(function onAnimationFinish(){_focusManager.default.popScope(dlg),dlg.classList.add("hide"),dlg.dispatchEvent(new CustomEvent("close",{bubbles:!1,cancelable:!1}))}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.open=open,_exports.close=close,_exports.createDialog=createDialog,_exports.setOnOpen=setOnOpen,_exports.default=void 0,_appRouter=_interopRequireDefault(_appRouter),_focusManager=_interopRequireDefault(_focusManager),_browser=_interopRequireDefault(_browser),_layoutManager=_interopRequireDefault(_layoutManager),_inputManager=_interopRequireDefault(_inputManager),_dom=_interopRequireDefault(_dom);var supportsOverscrollBehavior="overscroll-behavior-y"in document.body.style;function centerFocus(elem,horiz,on){new Promise((function(_resolve,_reject){return _require(["scrollHelper"],(function(imported){return _resolve(function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}(imported))}),_reject)})).then((function(scrollHelper){var fn=on?"on":"off";scrollHelper.centerFocus[fn](elem,horiz)}))}function createDialog(options){options=options||{};var dlg=document.createElement("div");dlg.classList.add("focuscontainer"),dlg.classList.add("hide"),function shouldLockDocumentScroll(options){return!(supportsOverscrollBehavior&&(options.size||!_browser.default.touch))&&(null!=options.lockScroll?options.lockScroll:"fullscreen"===options.size||(!!options.size||_browser.default.touch))}(options)&&dlg.setAttribute("data-lockscroll","true"),!1!==options.enableHistory&&dlg.setAttribute("data-history","true"),!1!==options.modal&&dlg.setAttribute("modal","modal"),!1!==options.autoFocus&&dlg.setAttribute("data-autofocus","true");var entryAnimation=options.entryAnimation||"scaleup",exitAnimation=options.exitAnimation||"scaledown",entryAnimationDuration=options.entryAnimationDuration||("fullscreen"!==options.size?180:280),exitAnimationDuration=options.exitAnimationDuration||("fullscreen"!==options.size?120:220);if(dlg.animationConfig={entry:{name:entryAnimation,timing:{duration:entryAnimationDuration,easing:"ease-out"}},exit:{name:exitAnimation,timing:{duration:exitAnimationDuration,easing:"ease-out",fill:"both"}}},dlg.classList.add("dialog"),options.scrollX?(dlg.classList.add("scrollX"),dlg.classList.add("smoothScrollX"),_layoutManager.default.tv&&centerFocus(dlg,!0,!0)):!1!==options.scrollY&&(dlg.classList.add("smoothScrollY"),_layoutManager.default.tv&&centerFocus(dlg,!1,!0)),options.removeOnClose&&dlg.setAttribute("data-removeonclose","true"),options.size&&(dlg.classList.add("dialog-fixedSize"),dlg.classList.add("dialog-".concat(options.size))),enableAnimation())switch(dlg.animationConfig.entry.name){case"fadein":dlg.style.animation="fadein ".concat(entryAnimationDuration,"ms ease-out normal");break;case"scaleup":dlg.style.animation="scaleup ".concat(entryAnimationDuration,"ms ease-out normal both");break;case"slideup":dlg.style.animation="slideup ".concat(entryAnimationDuration,"ms ease-out normal");break;case"slidedown":dlg.style.animation="slidedown ".concat(entryAnimationDuration,"ms ease-out normal")}return dlg}function setOnOpen(val){globalOnOpenCallback=val}var _default={open:open,close:close,createDialog:createDialog,setOnOpen:setOnOpen};_exports.default=_default}));
//# sourceMappingURL=dialogHelper.js.map
