define(["require","exports","browser","layoutManager","pluginManager","apphost","focusManager","datetime","globalize","loading","connectionManager","skinManager","events","emby-select","emby-checkbox","emby-button"],(function(_require,_exports,_browser,_layoutManager,_pluginManager,_apphost,_focusManager,_datetime,_globalize,_loading,_connectionManager,_skinManager,_events,_embySelect,_embyCheckbox,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function loadForm(context,user,userSettings){_apphost.default.supports("displaylanguage")?context.querySelector(".languageSection").classList.remove("hide"):context.querySelector(".languageSection").classList.add("hide"),_apphost.default.supports("displaymode")?context.querySelector(".fldDisplayMode").classList.remove("hide"):context.querySelector(".fldDisplayMode").classList.add("hide"),_apphost.default.supports("externallinks")?context.querySelector(".learnHowToContributeContainer").classList.remove("hide"):context.querySelector(".learnHowToContributeContainer").classList.add("hide"),_apphost.default.supports("screensaver")?context.querySelector(".selectScreensaverContainer").classList.remove("hide"):context.querySelector(".selectScreensaverContainer").classList.add("hide"),_datetime.default.supportsLocalization()?context.querySelector(".fldDateTimeLocale").classList.remove("hide"):context.querySelector(".fldDateTimeLocale").classList.add("hide"),_browser.default.tizen||_browser.default.web0s?(context.querySelector(".fldBackdrops").classList.add("hide"),context.querySelector(".fldThemeSong").classList.add("hide"),context.querySelector(".fldThemeVideo").classList.add("hide")):(context.querySelector(".fldBackdrops").classList.remove("hide"),context.querySelector(".fldThemeSong").classList.remove("hide"),context.querySelector(".fldThemeVideo").classList.remove("hide")),function fillThemes(context,userSettings){var select=context.querySelector("#selectTheme");_skinManager.default.getThemes().then((function(themes){select.innerHTML=themes.map((function(t){return'<option value="'.concat(t.id,'">').concat(t.name,"</option>")})).join("");var defaultTheme=themes.find((function(theme){return theme.default}));select.value=userSettings.theme()||defaultTheme.id}))}(context,userSettings),function loadScreensavers(context,userSettings){var selectScreensaver=context.querySelector(".selectScreensaver"),options=_pluginManager.default.ofType("screensaver").map((function(plugin){return{name:plugin.name,value:plugin.id}}));options.unshift({name:_globalize.default.translate("None"),value:"none"}),selectScreensaver.innerHTML=options.map((function(o){return'<option value="'.concat(o.value,'">').concat(o.name,"</option>")})).join(""),selectScreensaver.value=userSettings.screensaver(),selectScreensaver.value||(selectScreensaver.value="none")}(context,userSettings),context.querySelector(".chkDisplayMissingEpisodes").checked=user.Configuration.DisplayMissingEpisodes||!1,context.querySelector("#chkThemeSong").checked=userSettings.enableThemeSongs(),context.querySelector("#chkThemeVideo").checked=userSettings.enableThemeVideos(),context.querySelector("#chkFadein").checked=userSettings.enableFastFadein(),context.querySelector("#chkBlurhash").checked=userSettings.enableBlurhash(),context.querySelector("#chkBackdrops").checked=userSettings.enableBackdrops(),context.querySelector("#chkDetailsBanner").checked=userSettings.detailsBanner(),context.querySelector("#selectLanguage").value=userSettings.language()||"",context.querySelector(".selectDateTimeLocale").value=userSettings.dateTimeLocale()||"",context.querySelector("#txtLibraryPageSize").value=userSettings.libraryPageSize(),context.querySelector(".selectLayout").value=_layoutManager.default.getSavedLayout()||"",function showOrHideMissingEpisodesField(context){_browser.default.tizen||_browser.default.web0s?context.querySelector(".fldDisplayMissingEpisodes").classList.add("hide"):context.querySelector(".fldDisplayMissingEpisodes").classList.remove("hide")}(context),_loading.default.hide()}function save(instance,context,userId,userSettings,apiClient,enableSaveConfirmation){_loading.default.show(),apiClient.getUser(userId).then((function(user){(function saveUser(context,user,userSettingsInstance,apiClient){return user.Configuration.DisplayMissingEpisodes=context.querySelector(".chkDisplayMissingEpisodes").checked,_apphost.default.supports("displaylanguage")&&userSettingsInstance.language(context.querySelector("#selectLanguage").value),userSettingsInstance.dateTimeLocale(context.querySelector(".selectDateTimeLocale").value),userSettingsInstance.enableThemeSongs(context.querySelector("#chkThemeSong").checked),userSettingsInstance.enableThemeVideos(context.querySelector("#chkThemeVideo").checked),userSettingsInstance.theme(context.querySelector("#selectTheme").value),userSettingsInstance.screensaver(context.querySelector(".selectScreensaver").value),userSettingsInstance.libraryPageSize(context.querySelector("#txtLibraryPageSize").value),userSettingsInstance.enableFastFadein(context.querySelector("#chkFadein").checked),userSettingsInstance.enableBlurhash(context.querySelector("#chkBlurhash").checked),userSettingsInstance.enableBackdrops(context.querySelector("#chkBackdrops").checked),userSettingsInstance.detailsBanner(context.querySelector("#chkDetailsBanner").checked),user.Id===apiClient.getCurrentUserId()&&_skinManager.default.setTheme(userSettingsInstance.theme()),_layoutManager.default.setLayout(context.querySelector(".selectLayout").value),apiClient.updateUserConfiguration(user.Id,user.Configuration)})(context,user,userSettings,apiClient).then((function(){_loading.default.hide(),enableSaveConfirmation&&new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(_globalize.default.translate("SettingsSaved"))})),_events.default.trigger(instance,"saved")}),(function(){_loading.default.hide()}))}))}function onSubmit(e){var self=this,apiClient=_connectionManager.default.getApiClient(self.options.serverId),userId=self.options.userId,userSettings=self.options.userSettings;return userSettings.setUserInfo(userId,apiClient).then((function(){var enableSaveConfirmation=self.options.enableSaveConfirmation;save(self,self.options.element,userId,userSettings,apiClient,enableSaveConfirmation)})),e&&e.preventDefault(),!1}function _embed(){return(_embed=_asyncToGenerator(regeneratorRuntime.mark((function _callee(options,self){var _yield$import,template;return regeneratorRuntime.wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,new Promise((function(_resolve,_reject){return _require(["text!./displaySettings.template.html"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)}));case 2:_yield$import=_context.sent,template=_yield$import.default,options.element.innerHTML=_globalize.default.translateHtml(template,"core"),options.element.querySelector("form").addEventListener("submit",onSubmit.bind(self)),options.enableSaveButton&&options.element.querySelector(".btnSave").classList.remove("hide"),self.loadData(options.autoFocus);case 8:case"end":return _context.stop()}}),_callee)})))).apply(this,arguments)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_browser=_interopRequireDefault(_browser),_layoutManager=_interopRequireDefault(_layoutManager),_pluginManager=_interopRequireDefault(_pluginManager),_apphost=_interopRequireDefault(_apphost),_focusManager=_interopRequireDefault(_focusManager),_datetime=_interopRequireDefault(_datetime),_globalize=_interopRequireDefault(_globalize),_loading=_interopRequireDefault(_loading),_connectionManager=_interopRequireDefault(_connectionManager),_skinManager=_interopRequireDefault(_skinManager),_events=_interopRequireDefault(_events);var _default=function(){function DisplaySettings(options){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DisplaySettings),this.options=options,function embed(_x,_x2){return _embed.apply(this,arguments)}(options,this)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(DisplaySettings,[{key:"loadData",value:function loadData(autoFocus){var self=this,context=self.options.element;_loading.default.show();var userId=self.options.userId,apiClient=_connectionManager.default.getApiClient(self.options.serverId),userSettings=self.options.userSettings;return apiClient.getUser(userId).then((function(user){return userSettings.setUserInfo(userId,apiClient).then((function(){self.dataLoaded=!0,loadForm(context,user,userSettings),autoFocus&&_focusManager.default.autoFocus(context)}))}))}},{key:"submit",value:function submit(){onSubmit.call(this)}},{key:"destroy",value:function destroy(){this.options=null}}]),DisplaySettings}();_exports.default=_default}));
//# sourceMappingURL=displaySettings.js.map
