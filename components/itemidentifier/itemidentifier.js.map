{"version":3,"sources":["components/itemidentifier/itemidentifier.js"],"names":["define","_require","_exports","_dialogHelper","_loading","_connectionManager","_globalize","_scrollHelper","_layoutManager","_focusManager","_browser","_embyInput","_embyCheckbox","_paperIconButtonLight","_formdialog","_materialIcons","_cardStyle","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","value","show","showFindNew","currentItem","currentItemType","currentServerId","currentResolve","currentReject","currentSearchResult","enableFocusTransform","browser","slow","edge","hasChanges","getApiClient","connectionManager","searchForIdentificationResults","page","i","length","lookupInfo","ProviderIds","identifyField","querySelectorAll","type","parseInt","getAttribute","hasId","txtLookupId","Name","SearchInfo","Id","ItemId","IncludeDisabledProviders","loading","apiClient","ajax","url","getUrl","concat","data","JSON","stringify","contentType","dataType","then","results","hide","showIdentificationSearchResults","identificationSearchResults","querySelector","classList","add","remove","html","result","getSearchResultHtml","elem","onSearchImageClick","index","this","currentResult","showIdentifyOptions","identifyResult","identifyOptionsForm","checked","lines","push","ProductionYear","resultHtml","join","ImageUrl","displayUrl","getSearchImageDisplayUrl","SearchProviderName","innerHTML","focusManager","focus","finishFindNewDialog","dlg","dialogHelper","close","searchImages","addEventListener","layoutManager","tv","autoFocus","Promise","_resolve","_reject","imported","_ref","toast","globalize","translate","padderClass","cssClass","cardBoxCssClass","numLines","AlbumArtist","provider","imageUrl","ProviderName","showEditor","itemId","_ref2","template","getItem","getCurrentUserId","item","Type","dialogOptions","size","removeOnClose","scrollY","createDialog","translateHtml","onDialogClosed","scrollHelper","centerFocus","on","Path","open","e","preventDefault","submitIdentficationResult","options","ReplaceAllImages","showIdentificationForm","getJSON","idList","idInfo","id","Key","fullName","idLabel","showEditorFindNew","itemName","itemYear","itemType","resolveFunc","_ref3","showIdentificationFormFindNew","serverId","resolve","reject","_default"],"mappings":"AAAAA,OAAO,CAAC,UAAW,UAAW,eAAgB,UAAW,oBAAqB,YAAa,eAAgB,gBAAiB,eAAgB,UAAW,aAAc,gBAAiB,0BAA2B,sBAAuB,iBAAkB,cAAc,SAAUC,SAAUC,SAAUC,cAAeC,SAAUC,mBAAoBC,WAAYC,cAAeC,eAAgBC,cAAeC,SAAUC,WAAYC,cAAeC,sBAAuBC,YAAaC,eAAgBC,YACpe,aAiBA,SAASC,uBAAuBC,KAAO,OAAOA,KAAOA,IAAIC,WAAaD,IAAM,CAAEE,QAASF,KAEvF,SAASG,QAAQH,KAAmV,OAAtOG,QAArD,mBAAXC,QAAoD,iBAApBA,OAAOC,SAAmC,SAASF,QAAQH,KAAO,cAAcA,KAA2B,SAASG,QAAQH,KAAO,OAAOA,KAAyB,mBAAXI,QAAyBJ,IAAIM,cAAgBF,QAAUJ,MAAQI,OAAOG,UAAY,gBAAkBP,MAAyBA,KAEnX,SAASQ,2BAA6B,GAAuB,mBAAZC,QAAwB,OAAO,KAAM,IAAIC,MAAQ,IAAID,QAA6F,OAAlFD,yBAA2B,SAASA,2BAA6B,OAAOE,OAAiBA,MAE1M,SAASC,wBAAwBX,KAAO,GAAIA,KAAOA,IAAIC,WAAc,OAAOD,IAAO,GAAY,OAARA,KAAiC,WAAjBG,QAAQH,MAAoC,mBAARA,IAAsB,MAAO,CAAEE,QAASF,KAAS,IAAIU,MAAQF,2BAA4B,GAAIE,OAASA,MAAME,IAAIZ,KAAQ,OAAOU,MAAMG,IAAIb,KAAQ,IAAIc,OAAS,GAAQC,sBAAwBC,OAAOC,gBAAkBD,OAAOE,yBAA0B,IAAK,IAAIC,OAAOnB,IAAO,GAAIgB,OAAOT,UAAUa,eAAeC,KAAKrB,IAAKmB,KAAM,CAAE,IAAIG,KAAOP,sBAAwBC,OAAOE,yBAAyBlB,IAAKmB,KAAO,KAAUG,OAASA,KAAKT,KAAOS,KAAKC,KAAQP,OAAOC,eAAeH,OAAQK,IAAKG,MAAgBR,OAAOK,KAAOnB,IAAImB,KAAyE,OAA7DL,OAAOZ,QAAUF,IAASU,OAASA,MAAMa,IAAIvB,IAAKc,QAAkBA,OArBhuBE,OAAOC,eAAejC,SAAU,aAAc,CAC5CwC,OAAO,IAETxC,SAASyC,KAAOA,KAChBzC,SAAS0C,YAAcA,YACvB1C,SAASkB,aAAU,EADrBjB,cAAAc,uBAAAd,eACAC,SAAAa,uBAAAb,UACAC,mBAAAY,uBAAAZ,oBACAC,WAAAW,uBAAAX,YACAC,cAAAU,uBAAAV,eACAC,eAAAS,uBAAAT,gBACAC,cAAAQ,uBAAAR,eASI,IAEIoC,YACAC,gBACAC,gBACAC,eACAC,cAEAC,oBAREC,uBARVzC,SAAAO,uBAAAP,WAQkC0C,QAAQC,OAASD,SAAAA,QAAQE,KAOnDC,YAAa,EAGjB,SAASC,eACL,OAAOC,mBAAAA,QAAkBD,aAAaT,iBAG1C,SAASW,+BAA+BC,MACpC,IAIIC,EACAC,OAEAnB,MAPAoB,WAAa,CACbC,YAAa,IAKXC,cAAgBL,KAAKM,iBAAiB,kBAE5C,IAAKL,EAAI,EAAGC,OAASG,cAAcH,OAAQD,EAAIC,OAAQD,KACnDlB,MAAQsB,cAAcJ,GAAGlB,SAGS,WAA1BsB,cAAcJ,GAAGM,OACjBxB,MAAQyB,SAASzB,QAGrBoB,WAAWE,cAAcJ,GAAGQ,aAAa,gBAAkB1B,OAInE,IAAI2B,OAAQ,EAENC,YAAcX,KAAKM,iBAAiB,gBAC1C,IAAKL,EAAI,EAAGC,OAASS,YAAYT,OAAQD,EAAIC,OAAQD,KACjDlB,MAAQ4B,YAAYV,GAAGlB,SAGnB2B,OAAQ,GAEZP,WAAWC,YAAYO,YAAYV,GAAGQ,aAAa,qBAAuB1B,MAG9E,GAAK2B,OAAUP,WAAWS,KAA1B,CAOAT,WAAa,CACTU,WAAYV,YAGZjB,aAAeA,YAAY4B,GAC3BX,WAAWY,OAAS7B,YAAY4B,GAEhCX,WAAWa,0BAA2B,EAG1CC,SAAAA,QAAQjC,OAER,IAAMkC,UAAYrB,eAElBqB,UAAUC,KAAK,CACXZ,KAAM,OACNa,IAAKF,UAAUG,OAAV,sBAAAC,OAAuCnC,kBAC5CoC,KAAMC,KAAKC,UAAUtB,YACrBuB,YAAa,mBACbC,SAAU,SAEXC,MAAK,SAAAC,SACJZ,SAAAA,QAAQa,OAKhB,SAASC,gCAAgC/B,KAAM6B,SAC3C,IAAMG,4BAA8BhC,KAAKiC,cAAc,gCAEvDjC,KAAKiC,cAAc,sBAAsBC,UAAUC,IAAI,QACvDH,4BAA4BE,UAAUE,OAAO,QAC7CpC,KAAKiC,cAAc,wBAAwBC,UAAUC,IAAI,QACzDnC,KAAKiC,cAAc,uBAAuBC,UAAUE,OAAO,2BAE3D,IACInC,EACAC,OAFAmC,KAAO,GAGX,IAAKpC,EAAI,EAAGC,OAAS2B,QAAQ3B,OAAQD,EAAIC,OAAQD,IAAK,CAClD,IAAMqC,OAAST,QAAQ5B,GACvBoC,MAAQE,oBAAoBD,OAAQrC,GAGxC,IAAMuC,KAAOxC,KAAKiC,cAAc,mCAGhC,SAASQ,qBACL,IAAMC,MAAQlC,SAASmC,KAAKlC,aAAa,eAEnCmC,cAAgBf,QAAQa,OAEX,MAAfxD,YAyBZ,SAAS2D,oBAAoB7C,KAAM8C,gBAC/B,IAAMC,oBAAsB/C,KAAKiC,cAAc,wBAE/CjC,KAAKiC,cAAc,sBAAsBC,UAAUC,IAAI,QACvDnC,KAAKiC,cAAc,gCAAgCC,UAAUC,IAAI,QACjEY,oBAAoBb,UAAUE,OAAO,QACrCpC,KAAKiC,cAAc,6BAA6Be,SAAU,EAC1DhD,KAAKiC,cAAc,uBAAuBC,UAAUC,IAAI,2BAExD5C,oBAAsBuD,eAEtB,IAAMG,MAAQ,GACdA,MAAMC,KAAKJ,eAAelC,MAEtBkC,eAAeK,gBACfF,MAAMC,KAAKJ,eAAeK,gBAG9B,IAAIC,WAAaH,MAAMI,KAAK,SAE5B,GAAIP,eAAeQ,SAAU,CACzB,IAAMC,WAAaC,yBAAyBV,eAAeQ,SAAUR,eAAeW,oBAEpFL,WAAU,2DAAA9B,OAA8DiC,WAA9D,gEAAAjC,OAAuI8B,WAAvI,UAGdpD,KAAKiC,cAAc,yBAAyByB,UAAYN,WAExDO,cAAAA,QAAaC,MAAMb,oBAAoBd,cAAc,eApD7CY,CAAoB7C,KAAM4C,eAgBtC,SAASiB,oBAAoBC,IAAKhB,gBAC9BvD,oBAAsBuD,eACtBlD,YAAa,EACbqB,SAAAA,QAAQa,OAERiC,cAAAA,QAAaC,MAAMF,KAnBXD,CAAoB7D,KAAM4C,eAVlCJ,KAAKkB,UAAYrB,KAcjB,IAAM4B,aAAezB,KAAKlC,iBAAiB,SAC3C,IAAKL,EAAI,EAAGC,OAAS+D,aAAa/D,OAAQD,EAAIC,OAAQD,IAClDgE,aAAahE,GAAGiE,iBAAiB,QAASzB,oBAG1C0B,eAAAA,QAAcC,IACdT,cAAAA,QAAaU,UAAUrC,6BAzCvBD,CAAgC/B,KAAM6B,iBA7BtC,IAAAyC,SAAA,SAAAC,SAAAC,SAAA,OAAAlI,SAAA,CAAO,UAAP,SAAAmI,UAAA,OAAAF,SAAArG,wBAAAuG,aAAAD,YAAgB5C,MAAK,SAAA8C,OACjBC,EADuCD,KAApBjH,SACbmH,WAAAA,QAAUC,UAAU,2BAgHtC,SAAStC,oBAAoBD,OAAQI,OAGjC,IAGIoC,YAHAzC,KAAO,GACP0C,SAAW,oBAgCf,GA5BwB,YAApB5F,iBACA4F,UAAY,sCACZD,YAAc,uBACa,eAApB3F,iBAAwD,gBAApBA,iBAC3C4F,UAAY,kCACZD,YAAc,sBAEdC,UAAY,sCACZD,YAAc,uBAGdX,eAAAA,QAAcC,KACdW,UAAY,cAERvF,uBACAuF,UAAY,oBAID,wBAEnB1C,MAAI,gCAAAf,OAAoCyD,SAApC,kBAAAzD,OAA6DoB,MAA7D,MACJL,MAAI,eAAAf,OAHJ0D,+BAGI,MACJ3C,MAAQ,6BACRA,MAAI,eAAAf,OAAmBwD,YAAnB,YAEJzC,MAAQ,wCAEJC,OAAOgB,SAAU,CACjB,IAAMC,WAAaC,yBAAyBlB,OAAOgB,SAAUhB,OAAOmB,oBAEpEpB,MAAI,8EAAAf,OAAiFiC,WAAjF,qBAEJlB,MAAI,oIAAAf,OAAwIgB,OAAO1B,KAA/I,gBAERyB,MAAQ,SACRA,MAAQ,SAER,IAAI4C,SAAW,EACS,eAApB9F,iBACA8F,WAGJ,IAAMhC,MAAQ,CAACX,OAAO1B,MAEtBqC,MAAMC,KAAKZ,OAAOmB,oBAEdnB,OAAO4C,aACPjC,MAAMC,KAAKZ,OAAO4C,YAAYtE,MAE9B0B,OAAOa,gBACPF,MAAMC,KAAKZ,OAAOa,gBAGtB,IAAK,IAAIlD,EAAI,EAAGA,EAAIgF,SAAUhF,IAEtBoC,MADM,IAANpC,EACQ,yDAEA,6DAEZoC,MAAQY,MAAMhD,IAAM,SACpBoC,MAAQ,SAKZ,OAFAA,MAAQ,SACRA,MAAQ,YAIZ,SAASmB,yBAAyBpC,IAAK+D,UAGnC,OAFkBtF,eAEDwB,OAAO,2BAA4B,CAAE+D,SAAUhE,IAAKiE,aAAcF,WAuEvF,SAASG,WAAWC,QAGhB,OAFAtE,SAAAA,QAAQjC,OAED,IAAAsF,SAAA,SAAAC,SAAAC,SAAA,OAAAlI,SAAA,CAAO,wCAAP,SAAAmI,UAAA,OAAAF,SAAArG,wBAAAuG,aAAAD,YAA8C5C,MAAK,SAAA4D,OAAyB,IAAdC,SAAcD,MAAvB/H,QAClDyD,UAAYrB,eAElBqB,UAAUwE,QAAQxE,UAAUyE,mBAAoBJ,QAAQ3D,MAAK,SAAAgE,MAEzDzG,iBADAD,YAAc0G,MACgBC,KAE9B,IAAMC,cAAgB,CAClBC,KAAM,QACNC,eAAe,EACfC,SAAS,GAGT9B,eAAAA,QAAcC,KACd0B,cAAcC,KAAO,cAGzB,IAAMjC,IAAMC,cAAAA,QAAamC,aAAaJ,eAEtChC,IAAI5B,UAAUC,IAAI,cAClB2B,IAAI5B,UAAUC,IAAI,mBAElB,IAAIE,KAAO,GACXA,MAAQuC,WAAAA,QAAUuB,cAAcV,SAAU,QAE1C3B,IAAIJ,UAAYrB,KAGhByB,IAAII,iBAAiB,QAASkC,gBAE1BjC,eAAAA,QAAcC,IACdiC,cAAAA,QAAaC,YAAYC,GAAGzC,IAAI7B,cAAc,uBAAuB,GAGrE2D,KAAKY,KACL1C,IAAI7B,cAAc,YAAYC,UAAUE,OAAO,QAE/C0B,IAAI7B,cAAc,YAAYC,UAAUC,IAAI,QAGhD2B,IAAI7B,cAAc,YAAYyB,UAAYkC,KAAKY,MAAQ,GAEvDzC,cAAAA,QAAa0C,KAAK3C,KAElBA,IAAI7B,cAAc,sBAAsBiC,iBAAiB,UAAU,SAAAwC,GAG/D,OAFAA,EAAEC,iBACF5G,+BAA+B+D,MACxB,KAGXA,IAAI7B,cAAc,wBAAwBiC,iBAAiB,UAAU,SAAAwC,GAGjE,OAFAA,EAAEC,iBA1HlB,SAASC,0BAA0B5G,MAC/BiB,SAAAA,QAAQjC,OAER,IAAM6H,QAAU,CACZC,iBAAkB9G,KAAKiC,cAAc,6BAA6Be,SAGhE9B,UAAYrB,eAElBqB,UAAUC,KAAK,CACXZ,KAAM,OACNa,IAAKF,UAAUG,OAAV,4BAAAC,OAA6CpC,YAAY4B,IAAM+F,SACpEtF,KAAMC,KAAKC,UAAUlC,qBACrBmC,YAAa,qBAEdE,MAAK,WACJhC,YAAa,EACbqB,SAAAA,QAAQa,OAERiC,cAAAA,QAAaC,MAAMhE,SACpB,WACCiB,SAAAA,QAAQa,OAERiC,cAAAA,QAAaC,MAAMhE,SAoGX4G,CAA0B9C,MACnB,KAGXA,IAAI7B,cAAc,cAAciC,iBAAiB,SAAS,WACtDH,cAAAA,QAAaC,MAAMF,QAGvBA,IAAI5B,UAAUC,IAAI,kBAxG9B,SAAS4E,uBAAuB/G,KAAM4F,MAClC,IAAM1E,UAAYrB,eAElBqB,UAAU8F,QAAQ9F,UAAUG,OAAV,SAAAC,OAA0BsE,KAAK9E,GAA/B,sBAAsDc,MAAK,SAAAqF,QAGzE,IAFA,IAAI5E,KAAO,GAEFpC,EAAI,EAAGC,OAAS+G,OAAO/G,OAAQD,EAAIC,OAAQD,IAAK,CACrD,IAAMiH,OAASD,OAAOhH,GAEhBkH,GAAE,YAAA7F,OAAe4F,OAAOE,KAE9B/E,MAAQ,+BAER,IAAIgF,SAAWH,OAAOtG,KAClBsG,OAAOrB,OACPwB,SAAQ,GAAA/F,OAAM4F,OAAOtG,KAAb,KAAAU,OAAqBsD,WAAAA,QAAUC,UAAUqC,OAAOrB,QAG5D,IAAMyB,QAAU1C,WAAAA,QAAUC,UAAU,yBAA0BwC,UAE9DhF,MAAI,gEAAAf,OAAoE4F,OAAOE,IAA3E,UAAA9F,OAAuF6F,GAAvF,aAAA7F,OAAqGgG,QAArG,OAEJjF,MAAQ,SAGZrC,KAAKiC,cAAc,kBAAkBlD,MAAQ,GAE3B,WAAd6G,KAAKC,MAAmC,WAAdD,KAAKC,MAC/B7F,KAAKiC,cAAc,kBAAkBC,UAAUC,IAAI,QACnDnC,KAAKiC,cAAc,kBAAkBlD,MAAQ,KAE7CiB,KAAKiC,cAAc,kBAAkBC,UAAUE,OAAO,QACtDpC,KAAKiC,cAAc,kBAAkBlD,MAAQ,IAGjDiB,KAAKiC,cAAc,wBAAwByB,UAAYrB,KAEvDrC,KAAKiC,cAAc,0BAA0ByB,UAAYkB,WAAAA,QAAUC,UAAU,eAqEzEkC,CAAuBjD,IAAK8B,MAC5B3E,SAAAA,QAAQa,aAKpB,SAASsE,iBACLnF,SAAAA,QAAQa,OACJlC,WACAP,iBAEAC,gBAKR,SAASiI,kBAAkBC,SAAUC,SAAUC,SAAUC,aAIrD,OAHAzI,YAAc,KACdC,gBAAkBuI,SAEX,IAAApD,SAAA,SAAAC,SAAAC,SAAA,OAAAlI,SAAA,CAAO,wCAAP,SAAAmI,UAAA,OAAAF,SAAArG,wBAAAuG,aAAAD,YAA8C5C,MAAK,SAAAgG,OAAyB,IAAdnC,SAAcmC,MAAvBnK,QAClDqI,cAAgB,CAClBC,KAAM,QACNC,eAAe,EACfC,SAAS,GAGT9B,eAAAA,QAAcC,KACd0B,cAAcC,KAAO,cAGzB,IAAMjC,IAAMC,cAAAA,QAAamC,aAAaJ,eAEtChC,IAAI5B,UAAUC,IAAI,cAClB2B,IAAI5B,UAAUC,IAAI,mBAElB,IAAIE,KAAO,GACXA,MAAQuC,WAAAA,QAAUuB,cAAcV,SAAU,QAE1C3B,IAAIJ,UAAYrB,KAEZ8B,eAAAA,QAAcC,IACdiC,cAAAA,QAAaC,YAAYC,GAAGzC,IAAI7B,cAAc,uBAAuB,GAGzE8B,cAAAA,QAAa0C,KAAK3C,KAElBA,IAAI7B,cAAc,cAAciC,iBAAiB,SAAS,WACtDH,cAAAA,QAAaC,MAAMF,QAGvBA,IAAI7B,cAAc,sBAAsBiC,iBAAiB,UAAU,SAAAwC,GAG/D,OAFAA,EAAEC,iBACF5G,+BAA+B+D,MACxB,KAGXA,IAAII,iBAAiB,SAAS,WAC1BjD,SAAAA,QAAQa,OAGR6F,YAFkB/H,WAAaL,oBAAsB,SAKzDuE,IAAI5B,UAAUC,IAAI,kBAM1B,SAAS0F,8BAA8B/D,IAAK0D,SAAUC,SAAUC,UAC5D5D,IAAI7B,cAAc,kBAAkBlD,MAAQyI,SAE3B,WAAbE,UAAsC,WAAbA,UACzB5D,IAAI7B,cAAc,kBAAkBC,UAAUC,IAAI,QAClD2B,IAAI7B,cAAc,kBAAkBlD,MAAQ,KAE5C+E,IAAI7B,cAAc,kBAAkBC,UAAUE,OAAO,QACrD0B,IAAI7B,cAAc,kBAAkBlD,MAAQ0I,UAGhD3D,IAAI7B,cAAc,0BAA0ByB,UAAYkB,WAAAA,QAAUC,UAAU,UAfxEgD,CAA8B/D,IAAK0D,SAAUC,SAAUC,aAkBxD,SAAS1I,KAAKuG,OAAQuC,UACzB,OAAO,IAAIxD,SAAQ,SAACyD,QAASC,QACzB3I,eAAiB0I,QACjBzI,cAAgB0I,OAChB5I,gBAAkB0I,SAClBlI,YAAa,EAEb0F,WAAWC,WAIZ,SAAStG,YAAYuI,SAAUC,SAAUC,SAAUI,UACtD,OAAO,IAAIxD,SAAQ,SAACyD,SAChB3I,gBAAkB0I,SAElBlI,YAAa,EACb2H,kBAAkBC,SAAUC,SAAUC,SAAUK,YAH1D,IAAIE,SAQS,CACXjJ,KAAMA,KACNC,YAAaA,aANf1C,SAASkB,QAAUwK","file":"itemidentifier.js","sourcesContent":["/* eslint-disable indent */\n\n/**\n * Module for itemidentifier media item.\n * @module components/itemidentifier/itemidentifier\n */\n\nimport dialogHelper from 'dialogHelper';\nimport loading from 'loading';\nimport connectionManager from 'connectionManager';\nimport globalize from 'globalize';\nimport scrollHelper from 'scrollHelper';\nimport layoutManager from 'layoutManager';\nimport focusManager from 'focusManager';\nimport browser from 'browser';\nimport 'emby-input';\nimport 'emby-checkbox';\nimport 'paper-icon-button-light';\nimport 'css!./../formdialog';\nimport 'material-icons';\nimport 'cardStyle';\n\n    const enableFocusTransform = !browser.slow && !browser.edge;\n\n    let currentItem;\n    let currentItemType;\n    let currentServerId;\n    let currentResolve;\n    let currentReject;\n    let hasChanges = false;\n    let currentSearchResult;\n\n    function getApiClient() {\n        return connectionManager.getApiClient(currentServerId);\n    }\n\n    function searchForIdentificationResults(page) {\n        let lookupInfo = {\n            ProviderIds: {}\n        };\n\n        let i;\n        let length;\n        const identifyField = page.querySelectorAll('.identifyField');\n        let value;\n        for (i = 0, length = identifyField.length; i < length; i++) {\n            value = identifyField[i].value;\n\n            if (value) {\n                if (identifyField[i].type === 'number') {\n                    value = parseInt(value);\n                }\n\n                lookupInfo[identifyField[i].getAttribute('data-lookup')] = value;\n            }\n        }\n\n        let hasId = false;\n\n        const txtLookupId = page.querySelectorAll('.txtLookupId');\n        for (i = 0, length = txtLookupId.length; i < length; i++) {\n            value = txtLookupId[i].value;\n\n            if (value) {\n                hasId = true;\n            }\n            lookupInfo.ProviderIds[txtLookupId[i].getAttribute('data-providerkey')] = value;\n        }\n\n        if (!hasId && !lookupInfo.Name) {\n            import('toast').then(({default: toast}) => {\n                toast(globalize.translate('PleaseEnterNameOrId'));\n            });\n            return;\n        }\n\n        lookupInfo = {\n            SearchInfo: lookupInfo\n        };\n\n        if (currentItem && currentItem.Id) {\n            lookupInfo.ItemId = currentItem.Id;\n        } else {\n            lookupInfo.IncludeDisabledProviders = true;\n        }\n\n        loading.show();\n\n        const apiClient = getApiClient();\n\n        apiClient.ajax({\n            type: 'POST',\n            url: apiClient.getUrl(`Items/RemoteSearch/${currentItemType}`),\n            data: JSON.stringify(lookupInfo),\n            contentType: 'application/json',\n            dataType: 'json'\n\n        }).then(results => {\n            loading.hide();\n            showIdentificationSearchResults(page, results);\n        });\n    }\n\n    function showIdentificationSearchResults(page, results) {\n        const identificationSearchResults = page.querySelector('.identificationSearchResults');\n\n        page.querySelector('.popupIdentifyForm').classList.add('hide');\n        identificationSearchResults.classList.remove('hide');\n        page.querySelector('.identifyOptionsForm').classList.add('hide');\n        page.querySelector('.dialogContentInner').classList.remove('dialog-content-centered');\n\n        let html = '';\n        let i;\n        let length;\n        for (i = 0, length = results.length; i < length; i++) {\n            const result = results[i];\n            html += getSearchResultHtml(result, i);\n        }\n\n        const elem = page.querySelector('.identificationSearchResultList');\n        elem.innerHTML = html;\n\n        function onSearchImageClick() {\n            const index = parseInt(this.getAttribute('data-index'));\n\n            const currentResult = results[index];\n\n            if (currentItem != null) {\n                showIdentifyOptions(page, currentResult);\n            } else {\n                finishFindNewDialog(page, currentResult);\n            }\n        }\n\n        const searchImages = elem.querySelectorAll('.card');\n        for (i = 0, length = searchImages.length; i < length; i++) {\n            searchImages[i].addEventListener('click', onSearchImageClick);\n        }\n\n        if (layoutManager.tv) {\n            focusManager.autoFocus(identificationSearchResults);\n        }\n    }\n\n    function finishFindNewDialog(dlg, identifyResult) {\n        currentSearchResult = identifyResult;\n        hasChanges = true;\n        loading.hide();\n\n        dialogHelper.close(dlg);\n    }\n\n    function showIdentifyOptions(page, identifyResult) {\n        const identifyOptionsForm = page.querySelector('.identifyOptionsForm');\n\n        page.querySelector('.popupIdentifyForm').classList.add('hide');\n        page.querySelector('.identificationSearchResults').classList.add('hide');\n        identifyOptionsForm.classList.remove('hide');\n        page.querySelector('#chkIdentifyReplaceImages').checked = true;\n        page.querySelector('.dialogContentInner').classList.add('dialog-content-centered');\n\n        currentSearchResult = identifyResult;\n\n        const lines = [];\n        lines.push(identifyResult.Name);\n\n        if (identifyResult.ProductionYear) {\n            lines.push(identifyResult.ProductionYear);\n        }\n\n        let resultHtml = lines.join('<br/>');\n\n        if (identifyResult.ImageUrl) {\n            const displayUrl = getSearchImageDisplayUrl(identifyResult.ImageUrl, identifyResult.SearchProviderName);\n\n            resultHtml = `<div style=\"display:flex;align-items:center;\"><img src=\"${displayUrl}\" style=\"max-height:240px;\" /><div style=\"margin-left:1em;\">${resultHtml}</div>`;\n        }\n\n        page.querySelector('.selectedSearchResult').innerHTML = resultHtml;\n\n        focusManager.focus(identifyOptionsForm.querySelector('.btnSubmit'));\n    }\n\n    function getSearchResultHtml(result, index) {\n        // TODO move card creation code to Card component\n\n        let html = '';\n        let cssClass = 'card scalableCard';\n        let cardBoxCssClass = 'cardBox';\n        let padderClass;\n\n        if (currentItemType === 'Episode') {\n            cssClass += ' backdropCard backdropCard-scalable';\n            padderClass = 'cardPadder-backdrop';\n        } else if (currentItemType === 'MusicAlbum' || currentItemType === 'MusicArtist') {\n            cssClass += ' squareCard squareCard-scalable';\n            padderClass = 'cardPadder-square';\n        } else {\n            cssClass += ' portraitCard portraitCard-scalable';\n            padderClass = 'cardPadder-portrait';\n        }\n\n        if (layoutManager.tv) {\n            cssClass += ' show-focus';\n\n            if (enableFocusTransform) {\n                cssClass += ' show-animation';\n            }\n        }\n\n        cardBoxCssClass += ' cardBox-bottompadded';\n\n        html += `<button type=\"button\" class=\"${cssClass}\" data-index=\"${index}\">`;\n        html += `<div class=\"${cardBoxCssClass}\">`;\n        html += '<div class=\"cardScalable\">';\n        html += `<div class=\"${padderClass}\"></div>`;\n\n        html += '<div class=\"cardContent searchImage\">';\n\n        if (result.ImageUrl) {\n            const displayUrl = getSearchImageDisplayUrl(result.ImageUrl, result.SearchProviderName);\n\n            html += `<div class=\"cardImageContainer coveredImage\" style=\"background-image:url('${displayUrl}');\"></div>`;\n        } else {\n            html += `<div class=\"cardImageContainer coveredImage defaultCardBackground defaultCardBackground1\"><div class=\"cardText cardCenteredText\">${result.Name}</div></div>`;\n        }\n        html += '</div>';\n        html += '</div>';\n\n        let numLines = 3;\n        if (currentItemType === 'MusicAlbum') {\n            numLines++;\n        }\n\n        const lines = [result.Name];\n\n        lines.push(result.SearchProviderName);\n\n        if (result.AlbumArtist) {\n            lines.push(result.AlbumArtist.Name);\n        }\n        if (result.ProductionYear) {\n            lines.push(result.ProductionYear);\n        }\n\n        for (let i = 0; i < numLines; i++) {\n            if (i === 0) {\n                html += '<div class=\"cardText cardText-first cardTextCentered\">';\n            } else {\n                html += '<div class=\"cardText cardText-secondary cardTextCentered\">';\n            }\n            html += lines[i] || '&nbsp;';\n            html += '</div>';\n        }\n\n        html += '</div>';\n        html += '</button>';\n        return html;\n    }\n\n    function getSearchImageDisplayUrl(url, provider) {\n        const apiClient = getApiClient();\n\n        return apiClient.getUrl('Items/RemoteSearch/Image', { imageUrl: url, ProviderName: provider });\n    }\n\n    function submitIdentficationResult(page) {\n        loading.show();\n\n        const options = {\n            ReplaceAllImages: page.querySelector('#chkIdentifyReplaceImages').checked\n        };\n\n        const apiClient = getApiClient();\n\n        apiClient.ajax({\n            type: 'POST',\n            url: apiClient.getUrl(`Items/RemoteSearch/Apply/${currentItem.Id}`, options),\n            data: JSON.stringify(currentSearchResult),\n            contentType: 'application/json'\n\n        }).then(() => {\n            hasChanges = true;\n            loading.hide();\n\n            dialogHelper.close(page);\n        }, () => {\n            loading.hide();\n\n            dialogHelper.close(page);\n        });\n    }\n\n    function showIdentificationForm(page, item) {\n        const apiClient = getApiClient();\n\n        apiClient.getJSON(apiClient.getUrl(`Items/${item.Id}/ExternalIdInfos`)).then(idList => {\n            let html = '';\n\n            for (let i = 0, length = idList.length; i < length; i++) {\n                const idInfo = idList[i];\n\n                const id = `txtLookup${idInfo.Key}`;\n\n                html += '<div class=\"inputContainer\">';\n\n                let fullName = idInfo.Name;\n                if (idInfo.Type) {\n                    fullName = `${idInfo.Name} ${globalize.translate(idInfo.Type)}`;\n                }\n\n                const idLabel = globalize.translate('LabelDynamicExternalId', fullName);\n\n                html += `<input is=\"emby-input\" class=\"txtLookupId\" data-providerkey=\"${idInfo.Key}\" id=\"${id}\" label=\"${idLabel}\"/>`;\n\n                html += '</div>';\n            }\n\n            page.querySelector('#txtLookupName').value = '';\n\n            if (item.Type === 'Person' || item.Type === 'BoxSet') {\n                page.querySelector('.fldLookupYear').classList.add('hide');\n                page.querySelector('#txtLookupYear').value = '';\n            } else {\n                page.querySelector('.fldLookupYear').classList.remove('hide');\n                page.querySelector('#txtLookupYear').value = '';\n            }\n\n            page.querySelector('.identifyProviderIds').innerHTML = html;\n\n            page.querySelector('.formDialogHeaderTitle').innerHTML = globalize.translate('Identify');\n        });\n    }\n\n    function showEditor(itemId) {\n        loading.show();\n\n        return import('text!./itemidentifier.template.html').then(({default: template}) => {\n            const apiClient = getApiClient();\n\n            apiClient.getItem(apiClient.getCurrentUserId(), itemId).then(item => {\n                currentItem = item;\n                currentItemType = currentItem.Type;\n\n                const dialogOptions = {\n                    size: 'small',\n                    removeOnClose: true,\n                    scrollY: false\n                };\n\n                if (layoutManager.tv) {\n                    dialogOptions.size = 'fullscreen';\n                }\n\n                const dlg = dialogHelper.createDialog(dialogOptions);\n\n                dlg.classList.add('formDialog');\n                dlg.classList.add('recordingDialog');\n\n                let html = '';\n                html += globalize.translateHtml(template, 'core');\n\n                dlg.innerHTML = html;\n\n                // Has to be assigned a z-index after the call to .open()\n                dlg.addEventListener('close', onDialogClosed);\n\n                if (layoutManager.tv) {\n                    scrollHelper.centerFocus.on(dlg.querySelector('.formDialogContent'), false);\n                }\n\n                if (item.Path) {\n                    dlg.querySelector('.fldPath').classList.remove('hide');\n                } else {\n                    dlg.querySelector('.fldPath').classList.add('hide');\n                }\n\n                dlg.querySelector('.txtPath').innerHTML = item.Path || '';\n\n                dialogHelper.open(dlg);\n\n                dlg.querySelector('.popupIdentifyForm').addEventListener('submit', e => {\n                    e.preventDefault();\n                    searchForIdentificationResults(dlg);\n                    return false;\n                });\n\n                dlg.querySelector('.identifyOptionsForm').addEventListener('submit', e => {\n                    e.preventDefault();\n                    submitIdentficationResult(dlg);\n                    return false;\n                });\n\n                dlg.querySelector('.btnCancel').addEventListener('click', () => {\n                    dialogHelper.close(dlg);\n                });\n\n                dlg.classList.add('identifyDialog');\n\n                showIdentificationForm(dlg, item);\n                loading.hide();\n            });\n        });\n    }\n\n    function onDialogClosed() {\n        loading.hide();\n        if (hasChanges) {\n            currentResolve();\n        } else {\n            currentReject();\n        }\n    }\n\n    // TODO investigate where this was used\n    function showEditorFindNew(itemName, itemYear, itemType, resolveFunc) {\n        currentItem = null;\n        currentItemType = itemType;\n\n        return import('text!./itemidentifier.template.html').then(({default: template}) => {\n            const dialogOptions = {\n                size: 'small',\n                removeOnClose: true,\n                scrollY: false\n            };\n\n            if (layoutManager.tv) {\n                dialogOptions.size = 'fullscreen';\n            }\n\n            const dlg = dialogHelper.createDialog(dialogOptions);\n\n            dlg.classList.add('formDialog');\n            dlg.classList.add('recordingDialog');\n\n            let html = '';\n            html += globalize.translateHtml(template, 'core');\n\n            dlg.innerHTML = html;\n\n            if (layoutManager.tv) {\n                scrollHelper.centerFocus.on(dlg.querySelector('.formDialogContent'), false);\n            }\n\n            dialogHelper.open(dlg);\n\n            dlg.querySelector('.btnCancel').addEventListener('click', () => {\n                dialogHelper.close(dlg);\n            });\n\n            dlg.querySelector('.popupIdentifyForm').addEventListener('submit', e => {\n                e.preventDefault();\n                searchForIdentificationResults(dlg);\n                return false;\n            });\n\n            dlg.addEventListener('close', () => {\n                loading.hide();\n                const foundItem = hasChanges ? currentSearchResult : null;\n\n                resolveFunc(foundItem);\n            });\n\n            dlg.classList.add('identifyDialog');\n\n            showIdentificationFormFindNew(dlg, itemName, itemYear, itemType);\n        });\n    }\n\n    function showIdentificationFormFindNew(dlg, itemName, itemYear, itemType) {\n        dlg.querySelector('#txtLookupName').value = itemName;\n\n        if (itemType === 'Person' || itemType === 'BoxSet') {\n            dlg.querySelector('.fldLookupYear').classList.add('hide');\n            dlg.querySelector('#txtLookupYear').value = '';\n        } else {\n            dlg.querySelector('.fldLookupYear').classList.remove('hide');\n            dlg.querySelector('#txtLookupYear').value = itemYear;\n        }\n\n        dlg.querySelector('.formDialogHeaderTitle').innerHTML = globalize.translate('Search');\n    }\n\n    export function show(itemId, serverId) {\n        return new Promise((resolve, reject) => {\n            currentResolve = resolve;\n            currentReject = reject;\n            currentServerId = serverId;\n            hasChanges = false;\n\n            showEditor(itemId);\n        });\n    }\n\n    export function showFindNew(itemName, itemYear, itemType, serverId) {\n        return new Promise((resolve) => {\n            currentServerId = serverId;\n\n            hasChanges = false;\n            showEditorFindNew(itemName, itemYear, itemType, resolve);\n        });\n    }\n\n/* eslint-enable indent */\nexport default {\n    show: show,\n    showFindNew: showFindNew\n};\n"]}