define(["exports","dom","dialogHelper","loading","connectionManager","globalize","actionsheet","emby-input","paper-icon-button-light","emby-button","listViewStyle","material-icons","formDialogStyle"],(function(_exports,_dom,_dialogHelper,_loading,_connectionManager,_globalize,_actionsheet,_embyInput,_paperIconButtonLight,_embyButton,_listViewStyle,_materialIcons,_formDialogStyle){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_dom=_interopRequireDefault(_dom),_dialogHelper=_interopRequireDefault(_dialogHelper),_loading=_interopRequireDefault(_loading),_connectionManager=_interopRequireDefault(_connectionManager),_globalize=_interopRequireDefault(_globalize),_actionsheet=_interopRequireDefault(_actionsheet);_exports.default=function channelMapper(options){function onChannelsElementClick(e){var btnMap=_dom.default.parentWithClass(e.target,"btnMap");if(btnMap){var channelId=btnMap.getAttribute("data-id"),providerChannelId=btnMap.getAttribute("data-providerid"),menuItems=currentMappingOptions.ProviderChannels.map((function(m){return{name:m.Name,id:m.Id,selected:m.Id.toLowerCase()===providerChannelId.toLowerCase()}})).sort((function(a,b){return a.name.localeCompare(b.name)}));_actionsheet.default.show({positionTo:btnMap,items:menuItems}).then((function(newChannelId){!function mapChannel(button,channelId,providerChannelId){_loading.default.show();var providerId=options.providerId;_connectionManager.default.getApiClient(options.serverId).ajax({type:"POST",url:ApiClient.getUrl("LiveTv/ChannelMappings"),data:JSON.stringify({providerId:providerId,tunerChannelId:channelId,providerChannelId:providerChannelId}),dataType:"json"}).then((function(mapping){var listItem=_dom.default.parentWithClass(button,"listItem");button.setAttribute("data-providerid",mapping.ProviderChannelId),listItem.querySelector(".secondary").innerHTML=getMappingSecondaryName(mapping,currentMappingOptions.ProviderName),_loading.default.hide()}))}(btnMap,channelId,newChannelId)}))}}function getMappingSecondaryName(mapping,providerName){return"".concat(mapping.ProviderChannelName||""," - ").concat(providerName)}function initEditor(dlg,options){(function getChannelMappingOptions(serverId,providerId){var apiClient=_connectionManager.default.getApiClient(serverId);return apiClient.getJSON(apiClient.getUrl("LiveTv/ChannelMappingOptions",{providerId:providerId}))})(options.serverId,options.providerId).then((function(result){currentMappingOptions=result;var channelsElement=dlg.querySelector(".channels");channelsElement.innerHTML=result.TunerChannels.map((function(channel){return function getTunerChannelHtml(channel,providerName){var html="";return html+='<div class="listItem">',html+='<span class="material-icons listItemIcon dvr"></span>',html+='<div class="listItemBody two-line">',html+='<h3 class="listItemBodyText">',html+=channel.Name,html+="</h3>",html+='<div class="secondary listItemBodyText">',channel.ProviderChannelName&&(html+=getMappingSecondaryName(channel,providerName)),html+="</div>",html+="</div>",(html+='<button class="btnMap autoSize" is="paper-icon-button-light" type="button" data-id="'.concat(channel.Id,'" data-providerid="').concat(channel.ProviderChannelId,'"><span class="material-icons mode_edit"></span></button>'))+"</div>"}(channel,result.ProviderName)})).join(""),channelsElement.addEventListener("click",onChannelsElementClick)}))}var currentMappingOptions;!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,channelMapper),this.show=function(){var dialogOptions={removeOnClose:!0,size:"small"},dlg=_dialogHelper.default.createDialog(dialogOptions);dlg.classList.add("formDialog"),dlg.classList.add("ui-body-a"),dlg.classList.add("background-theme-a");var html="";return html+='<div class="formDialogHeader">',html+='<button is="paper-icon-button-light" class="btnCancel autoSize" tabindex="-1"><span class="material-icons arrow_back"></span></button>',html+='<h3 class="formDialogHeaderTitle">',html+=_globalize.default.translate("MapChannels"),html+="</h3>",html+="</div>",html+=function getEditorHtml(){var html="";return html+='<div class="formDialogContent smoothScrollY">',html+='<div class="dialogContentInner dialog-content-centered">',html+='<form style="margin:auto;">',html+="<h1>".concat(_globalize.default.translate("Channels"),"</h1>"),html+='<div class="channels paperList">',html+="</div>",html+="</form>",(html+="</div>")+"</div>"}(),dlg.innerHTML=html,initEditor(dlg,options),dlg.querySelector(".btnCancel").addEventListener("click",(function(){_dialogHelper.default.close(dlg)})),new Promise((function(resolve){dlg.addEventListener("close",resolve),_dialogHelper.default.open(dlg)}))}}}));
//# sourceMappingURL=channelMapper.js.map
