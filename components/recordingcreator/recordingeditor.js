define(["require","exports","dialogHelper","globalize","layoutManager","connectionManager","loading","scrollHelper","scrollStyles","emby-button","emby-collapse","emby-input","paper-icon-button-light","css!./../formdialog","css!./recordingcreator","material-icons","flexStyles"],(function(_require,_exports,_dialogHelper,_globalize,_layoutManager,_connectionManager,_loading,_scrollHelper,_scrollStyles,_embyButton,_embyCollapse,_embyInput,_paperIconButtonLight,_formdialog,_recordingcreator,_materialIcons,_flexStyles){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var currentDialog;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_dialogHelper=_interopRequireDefault(_dialogHelper),_globalize=_interopRequireDefault(_globalize),_layoutManager=_interopRequireDefault(_layoutManager),_connectionManager=_interopRequireDefault(_connectionManager),_loading=_interopRequireDefault(_loading),_scrollHelper=_interopRequireDefault(_scrollHelper);var currentItemId,currentServerId,currentResolve,recordingDeleted=!1;function closeDialog(isDeleted){recordingDeleted=isDeleted,_dialogHelper.default.close(currentDialog)}function onSubmit(e){var form=this,apiClient=_connectionManager.default.getApiClient(currentServerId);return apiClient.getLiveTvTimer(currentItemId).then((function(item){item.PrePaddingSeconds=60*form.querySelector("#txtPrePaddingMinutes").value,item.PostPaddingSeconds=60*form.querySelector("#txtPostPaddingMinutes").value,apiClient.updateLiveTvTimer(item).then(currentResolve)})),e.preventDefault(),!1}function init(context){context.querySelector(".btnCancel").addEventListener("click",(function(){closeDialog(!1)})),context.querySelector(".btnCancelRecording").addEventListener("click",(function(){(function deleteTimer(apiClient,timerId){return new Promise((function(_resolve,_reject){return _require(["recordingHelper"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){_ref.default.cancelTimerWithConfirmation(timerId,apiClient.serverId())}))})(_connectionManager.default.getApiClient(currentServerId),currentItemId).then((function(){closeDialog(!0)}))})),context.querySelector("form").addEventListener("submit",onSubmit)}function reload(context,id){_loading.default.show(),currentItemId=id;var apiClient=_connectionManager.default.getApiClient(currentServerId);apiClient.getLiveTvTimer(id).then((function(result){!function renderTimer(context,item,apiClient){context.querySelector("#txtPrePaddingMinutes").value=item.PrePaddingSeconds/60,context.querySelector("#txtPostPaddingMinutes").value=item.PostPaddingSeconds/60,_loading.default.hide()}(context,result),_loading.default.hide()}))}var _default={show:function showEditor(itemId,serverId,options){return new Promise((function(resolve,reject){recordingDeleted=!1,currentServerId=serverId,_loading.default.show(),options=options||{},currentResolve=resolve,new Promise((function(_resolve,_reject){return _require(["text!./recordingeditor.template.html"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){var template=_ref2.default,dialogOptions={removeOnClose:!0,scrollY:!1};_layoutManager.default.tv&&(dialogOptions.size="fullscreen");var dlg=_dialogHelper.default.createDialog(dialogOptions);dlg.classList.add("formDialog"),dlg.classList.add("recordingDialog"),_layoutManager.default.tv||(dlg.style["min-width"]="20%",dlg.classList.add("dialog-fullscreen-lowres"));var html="";html+=_globalize.default.translateHtml(template,"core"),dlg.innerHTML=html,!1===options.enableCancel&&dlg.querySelector(".formDialogFooter").classList.add("hide"),currentDialog=dlg,dlg.addEventListener("closing",(function(){recordingDeleted||dlg.querySelector(".btnSubmit").click()})),dlg.addEventListener("close",(function(){recordingDeleted&&resolve({updated:!0,deleted:!0})})),_layoutManager.default.tv&&_scrollHelper.default.centerFocus.on(dlg.querySelector(".formDialogContent"),!1),init(dlg),reload(dlg,itemId),_dialogHelper.default.open(dlg)}))}))}};_exports.default=_default}));
//# sourceMappingURL=recordingeditor.js.map
