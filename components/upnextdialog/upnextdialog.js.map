{"version":3,"sources":["components/upnextdialog/upnextdialog.js"],"names":["define","_exports","_dom","_playbackManager","_connectionManager","_events","_mediaInfo","_layoutManager","_focusManager","_globalize","_itemHelper","_upnextdialog","_embyButton","_flexStyles","_interopRequireDefault","obj","__esModule","default","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","value","transitionEndEventName","dom","whichTransitionEvent","seriesImageUrl","item","options","Type","type","SeriesPrimaryImageTag","tag","connectionManager","getApiClient","ServerId","getScaledImageUrl","SeriesId","SeriesThumbImageTag","ParentThumbImageTag","ParentThumbItemId","imageUrl","ImageTags","PrimaryImageItemId","Id","AlbumId","AlbumPrimaryImageTag","setNextVideoText","elem","this","parent","secondsRemaining","Math","max","round","getTimeRemainingMs","console","debug","timeText","globalize","translate","nextVideoText","itemType","querySelector","innerHTML","fillItem","setPoster","osdPoster","secondaryItem","imgUrl","Overview","mediaInfo","getPrimaryMediaInfoHtml","title","itemHelper","getDisplayName","SeriesName","show","clearCountdownTextTimeout","instance","_countdownTextTimeout","clearInterval","onStartNowClick","player","hide","playbackManager","nextTrack","init","getHtml","html","classList","add","call","nextItem","addEventListener","bind","clearHideAnimationEventListeners","fn","_onHideAnimationComplete","removeEventListener","once","onHideAnimationComplete","e","events","trigger","hideComingUpNext","contains","offsetWidth","runtimeTicks","duration","timeRemainingTicks","currentTime","_default","UpNextDialog","_classCallCheck","Constructor","TypeError","_createClass","protoProps","staticProps","prototype","remove","layoutManager","tv","setTimeout","focusManager","focus","startComingUpNextHideTimer","setInterval","destroy"],"mappings":"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","file":"upnextdialog.js","sourcesContent":["import dom from 'dom';\nimport playbackManager from 'playbackManager';\nimport connectionManager from 'connectionManager';\nimport events from 'events';\nimport mediaInfo from 'mediaInfo';\nimport layoutManager from 'layoutManager';\nimport focusManager from 'focusManager';\nimport globalize from 'globalize';\nimport itemHelper from 'itemHelper';\nimport 'css!./upnextdialog';\nimport 'emby-button';\nimport 'flexStyles';\n\n/* eslint-disable indent */\n\n    const transitionEndEventName = dom.whichTransitionEvent();\n\n    function seriesImageUrl(item, options) {\n        if (item.Type !== 'Episode') {\n            return null;\n        }\n\n        options = options || {};\n        options.type = options.type || 'Primary';\n\n        if (options.type === 'Primary') {\n            if (item.SeriesPrimaryImageTag) {\n                options.tag = item.SeriesPrimaryImageTag;\n\n                return connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.SeriesId, options);\n            }\n        }\n\n        if (options.type === 'Thumb') {\n            if (item.SeriesThumbImageTag) {\n                options.tag = item.SeriesThumbImageTag;\n\n                return connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.SeriesId, options);\n            }\n            if (item.ParentThumbImageTag) {\n                options.tag = item.ParentThumbImageTag;\n\n                return connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.ParentThumbItemId, options);\n            }\n        }\n\n        return null;\n    }\n\n    function imageUrl(item, options) {\n        options = options || {};\n        options.type = options.type || 'Primary';\n\n        if (item.ImageTags && item.ImageTags[options.type]) {\n            options.tag = item.ImageTags[options.type];\n            return connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.PrimaryImageItemId || item.Id, options);\n        }\n\n        if (options.type === 'Primary') {\n            if (item.AlbumId && item.AlbumPrimaryImageTag) {\n                options.tag = item.AlbumPrimaryImageTag;\n                return connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.AlbumId, options);\n            }\n        }\n\n        return null;\n    }\n\n    function setPoster(osdPoster, item, secondaryItem) {\n        if (item) {\n            let imgUrl = seriesImageUrl(item, { type: 'Primary' }) ||\n                seriesImageUrl(item, { type: 'Thumb' }) ||\n                imageUrl(item, { type: 'Primary' });\n\n            if (!imgUrl && secondaryItem) {\n                imgUrl = seriesImageUrl(secondaryItem, { type: 'Primary' }) ||\n                    seriesImageUrl(secondaryItem, { type: 'Thumb' }) ||\n                    imageUrl(secondaryItem, { type: 'Primary' });\n            }\n\n            if (imgUrl) {\n                osdPoster.innerHTML = '<img class=\"upNextDialog-poster-img\" src=\"' + imgUrl + '\" />';\n                return;\n            }\n        }\n\n        osdPoster.innerHTML = '';\n    }\n\n    function getHtml() {\n        let html = '';\n\n        html += '<div class=\"upNextDialog-poster\">';\n        html += '</div>';\n\n        html += '<div class=\"flex flex-direction-column flex-grow\">';\n\n        html += '<h2 class=\"upNextDialog-nextVideoText\" style=\"margin:.25em 0;\">&nbsp;</h2>';\n\n        html += '<h3 class=\"upNextDialog-title\" style=\"margin:.25em 0 .5em;\"></h3>';\n\n        html += '<div class=\"flex flex-direction-row upNextDialog-mediainfo\">';\n        html += '</div>';\n\n        html += '<div class=\"upNextDialog-overview\" style=\"margin-top:1em;\"></div>';\n\n        html += '<div class=\"flex flex-direction-row upNextDialog-buttons\" style=\"margin-top:1em;\">';\n\n        html += '<button type=\"button\" is=\"emby-button\" class=\"raised raised-mini btnStartNow upNextDialog-button\">';\n        html += globalize.translate('HeaderStartNow');\n        html += '</button>';\n\n        html += '<button type=\"button\" is=\"emby-button\" class=\"raised raised-mini btnHide upNextDialog-button\">';\n        html += globalize.translate('Hide');\n        html += '</button>';\n\n        // buttons\n        html += '</div>';\n\n        // main\n        html += '</div>';\n\n        return html;\n    }\n\n    function setNextVideoText() {\n        const instance = this;\n\n        const elem = instance.options.parent;\n\n        const secondsRemaining = Math.max(Math.round(getTimeRemainingMs(instance) / 1000), 0);\n\n        console.debug('up next seconds remaining: ' + secondsRemaining);\n\n        const timeText = '<span class=\"upNextDialog-countdownText\">' + globalize.translate('HeaderSecondsValue', secondsRemaining) + '</span>';\n\n        const nextVideoText = instance.itemType === 'Episode' ?\n            globalize.translate('HeaderNextEpisodePlayingInValue', timeText) :\n            globalize.translate('HeaderNextVideoPlayingInValue', timeText);\n\n        elem.querySelector('.upNextDialog-nextVideoText').innerHTML = nextVideoText;\n    }\n\n    function fillItem(item) {\n        const instance = this;\n\n        const elem = instance.options.parent;\n\n        setPoster(elem.querySelector('.upNextDialog-poster'), item);\n\n        elem.querySelector('.upNextDialog-overview').innerHTML = item.Overview || '';\n\n        elem.querySelector('.upNextDialog-mediainfo').innerHTML = mediaInfo.getPrimaryMediaInfoHtml(item, {\n        });\n\n        let title = itemHelper.getDisplayName(item);\n        if (item.SeriesName) {\n            title = item.SeriesName + ' - ' + title;\n        }\n\n        elem.querySelector('.upNextDialog-title').innerHTML = title || '';\n\n        instance.itemType = item.Type;\n\n        instance.show();\n    }\n\n    function clearCountdownTextTimeout(instance) {\n        if (instance._countdownTextTimeout) {\n            clearInterval(instance._countdownTextTimeout);\n            instance._countdownTextTimeout = null;\n        }\n    }\n\n    function onStartNowClick() {\n        const options = this.options;\n\n        if (options) {\n            const player = options.player;\n\n            this.hide();\n\n            playbackManager.nextTrack(player);\n        }\n    }\n\n    function init(instance, options) {\n        options.parent.innerHTML = getHtml();\n\n        options.parent.classList.add('hide');\n        options.parent.classList.add('upNextDialog');\n        options.parent.classList.add('upNextDialog-hidden');\n\n        fillItem.call(instance, options.nextItem);\n\n        options.parent.querySelector('.btnHide').addEventListener('click', instance.hide.bind(instance));\n        options.parent.querySelector('.btnStartNow').addEventListener('click', onStartNowClick.bind(instance));\n    }\n\n    function clearHideAnimationEventListeners(instance, elem) {\n        const fn = instance._onHideAnimationComplete;\n\n        if (fn) {\n            dom.removeEventListener(elem, transitionEndEventName, fn, {\n                once: true\n            });\n        }\n    }\n\n    function onHideAnimationComplete(e) {\n        const instance = this;\n        const elem = e.target;\n\n        elem.classList.add('hide');\n\n        clearHideAnimationEventListeners(instance, elem);\n        events.trigger(instance, 'hide');\n    }\n\n    function hideComingUpNext() {\n        const instance = this;\n        clearCountdownTextTimeout(this);\n\n        if (!instance.options) {\n            return;\n        }\n\n        const elem = instance.options.parent;\n\n        if (!elem) {\n            return;\n        }\n\n        clearHideAnimationEventListeners(this, elem);\n\n        if (elem.classList.contains('upNextDialog-hidden')) {\n            return;\n        }\n\n        // trigger a reflow to force it to animate again\n        void elem.offsetWidth;\n\n        elem.classList.add('upNextDialog-hidden');\n\n        const fn = onHideAnimationComplete.bind(instance);\n        instance._onHideAnimationComplete = fn;\n\n        dom.addEventListener(elem, transitionEndEventName, fn, {\n            once: true\n        });\n    }\n\n    function getTimeRemainingMs(instance) {\n        const options = instance.options;\n        if (options) {\n            const runtimeTicks = playbackManager.duration(options.player);\n\n            if (runtimeTicks) {\n                const timeRemainingTicks = runtimeTicks - playbackManager.currentTime(options.player);\n\n                return Math.round(timeRemainingTicks / 10000);\n            }\n        }\n\n        return 0;\n    }\n\n    function startComingUpNextHideTimer(instance) {\n        const timeRemainingMs = getTimeRemainingMs(instance);\n\n        if (timeRemainingMs <= 0) {\n            return;\n        }\n\n        setNextVideoText.call(instance);\n        clearCountdownTextTimeout(instance);\n\n        instance._countdownTextTimeout = setInterval(setNextVideoText.bind(instance), 400);\n    }\n\nclass UpNextDialog {\n    constructor(options) {\n        this.options = options;\n\n        init(this, options);\n    }\n    show() {\n        const elem = this.options.parent;\n\n        clearHideAnimationEventListeners(this, elem);\n\n        elem.classList.remove('hide');\n\n        // trigger a reflow to force it to animate again\n        void elem.offsetWidth;\n\n        elem.classList.remove('upNextDialog-hidden');\n\n        if (layoutManager.tv) {\n            setTimeout(function () {\n                focusManager.focus(elem.querySelector('.btnStartNow'));\n            }, 50);\n        }\n\n        startComingUpNextHideTimer(this);\n    }\n    hide() {\n        hideComingUpNext.call(this);\n    }\n    destroy() {\n        hideComingUpNext.call(this);\n\n        this.options = null;\n        this.itemType = null;\n    }\n}\n\nexport default UpNextDialog;\n\n/* eslint-enable indent */\n"]}