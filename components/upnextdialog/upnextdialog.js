define(["exports","dom","playbackManager","connectionManager","events","mediaInfo","layoutManager","focusManager","globalize","itemHelper","css!./upnextdialog","emby-button","flexStyles"],(function(_exports,_dom,_playbackManager,_connectionManager,_events,_mediaInfo,_layoutManager,_focusManager,_globalize,_itemHelper,_upnextdialog,_embyButton,_flexStyles){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_dom=_interopRequireDefault(_dom),_playbackManager=_interopRequireDefault(_playbackManager),_connectionManager=_interopRequireDefault(_connectionManager),_events=_interopRequireDefault(_events),_mediaInfo=_interopRequireDefault(_mediaInfo),_layoutManager=_interopRequireDefault(_layoutManager),_focusManager=_interopRequireDefault(_focusManager),_globalize=_interopRequireDefault(_globalize),_itemHelper=_interopRequireDefault(_itemHelper);var transitionEndEventName=_dom.default.whichTransitionEvent();function seriesImageUrl(item,options){if("Episode"!==item.Type)return null;if((options=options||{}).type=options.type||"Primary","Primary"===options.type&&item.SeriesPrimaryImageTag)return options.tag=item.SeriesPrimaryImageTag,_connectionManager.default.getApiClient(item.ServerId).getScaledImageUrl(item.SeriesId,options);if("Thumb"===options.type){if(item.SeriesThumbImageTag)return options.tag=item.SeriesThumbImageTag,_connectionManager.default.getApiClient(item.ServerId).getScaledImageUrl(item.SeriesId,options);if(item.ParentThumbImageTag)return options.tag=item.ParentThumbImageTag,_connectionManager.default.getApiClient(item.ServerId).getScaledImageUrl(item.ParentThumbItemId,options)}return null}function imageUrl(item,options){return(options=options||{}).type=options.type||"Primary",item.ImageTags&&item.ImageTags[options.type]?(options.tag=item.ImageTags[options.type],_connectionManager.default.getApiClient(item.ServerId).getScaledImageUrl(item.PrimaryImageItemId||item.Id,options)):"Primary"===options.type&&item.AlbumId&&item.AlbumPrimaryImageTag?(options.tag=item.AlbumPrimaryImageTag,_connectionManager.default.getApiClient(item.ServerId).getScaledImageUrl(item.AlbumId,options)):null}function setNextVideoText(){var elem=this.options.parent,secondsRemaining=Math.max(Math.round(getTimeRemainingMs(this)/1e3),0);console.debug("up next seconds remaining: "+secondsRemaining);var timeText='<span class="upNextDialog-countdownText">'+_globalize.default.translate("HeaderSecondsValue",secondsRemaining)+"</span>",nextVideoText="Episode"===this.itemType?_globalize.default.translate("HeaderNextEpisodePlayingInValue",timeText):_globalize.default.translate("HeaderNextVideoPlayingInValue",timeText);elem.querySelector(".upNextDialog-nextVideoText").innerHTML=nextVideoText}function fillItem(item){var elem=this.options.parent;!function setPoster(osdPoster,item,secondaryItem){if(item){var imgUrl=seriesImageUrl(item,{type:"Primary"})||seriesImageUrl(item,{type:"Thumb"})||imageUrl(item,{type:"Primary"});if(!imgUrl&&secondaryItem&&(imgUrl=seriesImageUrl(secondaryItem,{type:"Primary"})||seriesImageUrl(secondaryItem,{type:"Thumb"})||imageUrl(secondaryItem,{type:"Primary"})),imgUrl)return void(osdPoster.innerHTML='<img class="upNextDialog-poster-img" src="'+imgUrl+'" />')}osdPoster.innerHTML=""}(elem.querySelector(".upNextDialog-poster"),item),elem.querySelector(".upNextDialog-overview").innerHTML=item.Overview||"",elem.querySelector(".upNextDialog-mediainfo").innerHTML=_mediaInfo.default.getPrimaryMediaInfoHtml(item,{});var title=_itemHelper.default.getDisplayName(item);item.SeriesName&&(title=item.SeriesName+" - "+title),elem.querySelector(".upNextDialog-title").innerHTML=title||"",this.itemType=item.Type,this.show()}function clearCountdownTextTimeout(instance){instance._countdownTextTimeout&&(clearInterval(instance._countdownTextTimeout),instance._countdownTextTimeout=null)}function onStartNowClick(){var options=this.options;if(options){var player=options.player;this.hide(),_playbackManager.default.nextTrack(player)}}function init(instance,options){options.parent.innerHTML=function getHtml(){var html="";return html+='<div class="upNextDialog-poster">',html+="</div>",html+='<div class="flex flex-direction-column flex-grow">',html+='<h2 class="upNextDialog-nextVideoText" style="margin:.25em 0;">&nbsp;</h2>',html+='<h3 class="upNextDialog-title" style="margin:.25em 0 .5em;"></h3>',html+='<div class="flex flex-direction-row upNextDialog-mediainfo">',html+="</div>",html+='<div class="upNextDialog-overview" style="margin-top:1em;"></div>',html+='<div class="flex flex-direction-row upNextDialog-buttons" style="margin-top:1em;">',html+='<button type="button" is="emby-button" class="raised raised-mini btnStartNow upNextDialog-button">',html+=_globalize.default.translate("HeaderStartNow"),html+="</button>",html+='<button type="button" is="emby-button" class="raised raised-mini btnHide upNextDialog-button">',html+=_globalize.default.translate("Hide"),html+="</button>",html+="</div>",html+="</div>"}(),options.parent.classList.add("hide"),options.parent.classList.add("upNextDialog"),options.parent.classList.add("upNextDialog-hidden"),fillItem.call(instance,options.nextItem),options.parent.querySelector(".btnHide").addEventListener("click",instance.hide.bind(instance)),options.parent.querySelector(".btnStartNow").addEventListener("click",onStartNowClick.bind(instance))}function clearHideAnimationEventListeners(instance,elem){var fn=instance._onHideAnimationComplete;fn&&_dom.default.removeEventListener(elem,transitionEndEventName,fn,{once:!0})}function onHideAnimationComplete(e){var elem=e.target;elem.classList.add("hide"),clearHideAnimationEventListeners(this,elem),_events.default.trigger(this,"hide")}function hideComingUpNext(){if(clearCountdownTextTimeout(this),this.options){var elem=this.options.parent;if(elem&&(clearHideAnimationEventListeners(this,elem),!elem.classList.contains("upNextDialog-hidden"))){elem.offsetWidth,elem.classList.add("upNextDialog-hidden");var fn=onHideAnimationComplete.bind(this);this._onHideAnimationComplete=fn,_dom.default.addEventListener(elem,transitionEndEventName,fn,{once:!0})}}}function getTimeRemainingMs(instance){var options=instance.options;if(options){var runtimeTicks=_playbackManager.default.duration(options.player);if(runtimeTicks){var timeRemainingTicks=runtimeTicks-_playbackManager.default.currentTime(options.player);return Math.round(timeRemainingTicks/1e4)}}return 0}var _default=function(){function UpNextDialog(options){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,UpNextDialog),this.options=options,init(this,options)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(UpNextDialog,[{key:"show",value:function show(){var elem=this.options.parent;clearHideAnimationEventListeners(this,elem),elem.classList.remove("hide"),elem.offsetWidth,elem.classList.remove("upNextDialog-hidden"),_layoutManager.default.tv&&setTimeout((function(){_focusManager.default.focus(elem.querySelector(".btnStartNow"))}),50),function startComingUpNextHideTimer(instance){getTimeRemainingMs(instance)<=0||(setNextVideoText.call(instance),clearCountdownTextTimeout(instance),instance._countdownTextTimeout=setInterval(setNextVideoText.bind(instance),400))}(this)}},{key:"hide",value:function hide(){hideComingUpNext.call(this)}},{key:"destroy",value:function destroy(){hideComingUpNext.call(this),this.options=null,this.itemType=null}}]),UpNextDialog}();_exports.default=_default}));
//# sourceMappingURL=upnextdialog.js.map
