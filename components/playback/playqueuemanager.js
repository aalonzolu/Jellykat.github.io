define(["exports"],(function(_exports){"use strict";function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0;var currentId=0;function addUniquePlaylistItemId(item){item.PlaylistItemId||(item.PlaylistItemId="playlistItem"+currentId,currentId++)}function findPlaylistIndex(playlistItemId,list){for(var i=0,length=list.length;i<length;i++)if(list[i].PlaylistItemId===playlistItemId)return i;return-1}var _default=function(){function PlayQueueManager(){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,PlayQueueManager),this._sortedPlaylist=[],this._playlist=[],this._repeatMode="RepeatNone",this._shuffleMode="Sorted"}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(PlayQueueManager,[{key:"getPlaylist",value:function getPlaylist(){return this._playlist.slice(0)}},{key:"setPlaylist",value:function setPlaylist(items){for(var i=0,length=(items=items.slice(0)).length;i<length;i++)addUniquePlaylistItemId(items[i]);this._currentPlaylistItemId=null,this._playlist=items,this._repeatMode="RepeatNone"}},{key:"queue",value:function queue(items){for(var i=0,length=items.length;i<length;i++)addUniquePlaylistItemId(items[i]),this._playlist.push(items[i])}},{key:"shufflePlaylist",value:function shufflePlaylist(){this._sortedPlaylist=[];var _step,_iterator=_createForOfIteratorHelper(this._playlist);try{for(_iterator.s();!(_step=_iterator.n()).done;){var item=_step.value;this._sortedPlaylist.push(item)}}catch(err){_iterator.e(err)}finally{_iterator.f()}for(var currentPlaylistItem=this._playlist.splice(this.getCurrentPlaylistIndex(),1)[0],i=this._playlist.length-1;i>0;i--){var j=Math.floor(Math.random()*i),temp=this._playlist[i];this._playlist[i]=this._playlist[j],this._playlist[j]=temp}this._playlist.unshift(currentPlaylistItem),this._shuffleMode="Shuffle"}},{key:"sortShuffledPlaylist",value:function sortShuffledPlaylist(){this._playlist=[];var _step2,_iterator2=_createForOfIteratorHelper(this._sortedPlaylist);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var item=_step2.value;this._playlist.push(item)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}this._sortedPlaylist=[],this._shuffleMode="Sorted"}},{key:"clearPlaylist",value:function clearPlaylist(){var clearCurrentItem=arguments.length>0&&void 0!==arguments[0]&&arguments[0],currentPlaylistItem=this._playlist.splice(this.getCurrentPlaylistIndex(),1)[0];this._playlist=[],clearCurrentItem||this._playlist.push(currentPlaylistItem)}},{key:"queueNext",value:function queueNext(items){for(var i=0,length=items.length;i<length;i++)addUniquePlaylistItemId(items[i]);var currentIndex=this.getCurrentPlaylistIndex();-1===currentIndex?currentIndex=this._playlist.length:currentIndex++,function arrayInsertAt(destArray,pos,arrayToInsert){var args=[];args.push(pos),args.push(0),args=args.concat(arrayToInsert),destArray.splice.apply(destArray,args)}(this._playlist,currentIndex,items)}},{key:"getCurrentPlaylistIndex",value:function getCurrentPlaylistIndex(){return findPlaylistIndex(this.getCurrentPlaylistItemId(),this._playlist)}},{key:"getCurrentItem",value:function getCurrentItem(){var index=findPlaylistIndex(this.getCurrentPlaylistItemId(),this._playlist);return-1===index?null:this._playlist[index]}},{key:"getCurrentPlaylistItemId",value:function getCurrentPlaylistItemId(){return this._currentPlaylistItemId}},{key:"setPlaylistState",value:function setPlaylistState(playlistItemId,playlistIndex){this._currentPlaylistItemId=playlistItemId}},{key:"setPlaylistIndex",value:function setPlaylistIndex(playlistIndex){playlistIndex<0?this.setPlaylistState(null):this.setPlaylistState(this._playlist[playlistIndex].PlaylistItemId)}},{key:"removeFromPlaylist",value:function removeFromPlaylist(playlistItemIds){if(this._playlist.length<=playlistItemIds.length)return{result:"empty"};var currentPlaylistItemId=this.getCurrentPlaylistItemId(),isCurrentIndex=-1!==playlistItemIds.indexOf(currentPlaylistItemId);return this._sortedPlaylist=this._sortedPlaylist.filter((function(item){return!playlistItemIds.includes(item.PlaylistItemId)})),this._playlist=this._playlist.filter((function(item){return!playlistItemIds.includes(item.PlaylistItemId)})),{result:"removed",isCurrentIndex:isCurrentIndex}}},{key:"movePlaylistItem",value:function movePlaylistItem(playlistItemId,newIndex){for(var oldIndex,playlist=this.getPlaylist(),i=0,length=playlist.length;i<length;i++)if(playlist[i].PlaylistItemId===playlistItemId){oldIndex=i;break}if(-1===oldIndex||oldIndex===newIndex)return{result:"noop"};if(newIndex>=playlist.length)throw new Error("newIndex out of bounds");return function moveInArray(array,from,to){array.splice(to,0,array.splice(from,1)[0])}(playlist,oldIndex,newIndex),this._playlist=playlist,{result:"moved",playlistItemId:playlistItemId,newIndex:newIndex}}},{key:"reset",value:function reset(){this._sortedPlaylist=[],this._playlist=[],this._currentPlaylistItemId=null,this._repeatMode="RepeatNone",this._shuffleMode="Sorted"}},{key:"setRepeatMode",value:function setRepeatMode(value){if(!["RepeatOne","RepeatAll","RepeatNone"].includes(value))throw new TypeError("invalid value provided for setRepeatMode");this._repeatMode=value}},{key:"getRepeatMode",value:function getRepeatMode(){return this._repeatMode}},{key:"setShuffleMode",value:function setShuffleMode(value){switch(value){case"Shuffle":this.shufflePlaylist();break;case"Sorted":this.sortShuffledPlaylist();break;default:throw new TypeError("invalid value provided to setShuffleMode")}}},{key:"toggleShuffleMode",value:function toggleShuffleMode(){switch(this._shuffleMode){case"Shuffle":this.setShuffleMode("Sorted");break;case"Sorted":this.setShuffleMode("Shuffle");break;default:throw new TypeError("current value for shufflequeue is invalid")}}},{key:"getShuffleMode",value:function getShuffleMode(){return this._shuffleMode}},{key:"getNextItemInfo",value:function getNextItemInfo(){var newIndex,playlist=this.getPlaylist(),playlistLength=playlist.length;switch(this.getRepeatMode()){case"RepeatOne":newIndex=this.getCurrentPlaylistIndex();break;case"RepeatAll":(newIndex=this.getCurrentPlaylistIndex()+1)>=playlistLength&&(newIndex=0);break;default:newIndex=this.getCurrentPlaylistIndex()+1}if(newIndex<0||newIndex>=playlistLength)return null;var item=playlist[newIndex];return item?{item:item,index:newIndex}:null}}]),PlayQueueManager}();_exports.default=_default}));
//# sourceMappingURL=playqueuemanager.js.map
