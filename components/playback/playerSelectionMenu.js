define(["require","exports","appSettings","events","browser","loading","playbackManager","appRouter","globalize","apphost"],(function(_require,_exports,_appSettings,_events,_browser,_loading,_playbackManager,_appRouter,_globalize,_apphost){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function mirrorIfEnabled(info){if(info&&_playbackManager.default.enableDisplayMirroring()){var getPlayerInfo=_playbackManager.default.getPlayerInfo();getPlayerInfo&&(getPlayerInfo.isLocalPlayer||-1===getPlayerInfo.supportedCommands.indexOf("DisplayContent")||function mirrorItem(info,player){var item=info.item;_playbackManager.default.displayContent({ItemName:item.Name,ItemId:item.Id,ItemType:item.Type,Context:info.context},player)}(info,_playbackManager.default.getCurrentPlayer()))}}function emptyCallback(){}function getIcon(target){var deviceType=target.deviceType;switch(!deviceType&&target.isLocalPlayer&&(deviceType=_browser.default.tv?"tv":_browser.default.mobile?"smartphone":"desktop"),deviceType||(deviceType="tv"),deviceType){case"smartphone":return"smartphone";case"tablet":return"tablet";case"tv":return"tv";case"cast":return"cast";case"desktop":return"computer";default:return"tv"}}function show(button){var currentPlayerInfo=_playbackManager.default.getPlayerInfo();if(!currentPlayerInfo||currentPlayerInfo.isLocalPlayer){var currentPlayerId=currentPlayerInfo?currentPlayerInfo.id:null;_loading.default.show(),_playbackManager.default.getTargets().then((function(targets){var menuItems=targets.map((function(t){var target,name=t.name;return t.appName&&t.appName!==t.name&&(name+=" - "+t.appName),{name:name,id:t.id,selected:currentPlayerId===t.id,secondaryText:(target=t,target.user?target.user.Name:null),icon:getIcon(t)}}));new Promise((function(_resolve,_reject){return _require(["actionsheet"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){var actionsheet=_ref.default;_loading.default.hide();var menuOptions={title:_globalize.default.translate("HeaderPlayOn"),items:menuItems,positionTo:button,resolveOnClick:!0,border:!0};!_browser.default.chrome&&!_browser.default.edgeChromium||_apphost.default.supports("castmenuhashchange")||(menuOptions.enableHistory=!1),actionsheet.show(menuOptions).then((function(id){var target=targets.filter((function(t){return t.id===id}))[0];_playbackManager.default.trySetActivePlayer(target.playerName,target),mirrorIfEnabled()}),emptyCallback)}))}))}else(function showActivePlayerMenu(playerInfo){Promise.all([new Promise((function(_resolve,_reject){return _require(["dialogHelper"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})),new Promise((function(_resolve,_reject){return _require(["dialog"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})),new Promise((function(_resolve,_reject){return _require(["emby-checkbox"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})),new Promise((function(_resolve,_reject){return _require(["emby-button"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)}))]).then((function(_ref2){!function showActivePlayerMenuInternal(dialogHelper,playerInfo){var html="",dialogOptions={removeOnClose:!0,modal:!1,entryAnimationDuration:160,exitAnimationDuration:160,autoFocus:!1},dlg=dialogHelper.createDialog(dialogOptions);dlg.classList.add("promptDialog");var currentDeviceName=playerInfo.deviceName||playerInfo.name;if(html+='<div class="promptDialogContent" style="padding:1.5em;">',html+='<h2 style="margin-top:.5em;">',html+=currentDeviceName,html+="</h2>",html+="<div>",-1!==playerInfo.supportedCommands.indexOf("DisplayContent")){html+='<label class="checkboxContainer">';var checkedHtml=_playbackManager.default.enableDisplayMirroring()?" checked":"";html+='<input type="checkbox" is="emby-checkbox" class="chkMirror"'+checkedHtml+"/>",html+="<span>"+_globalize.default.translate("EnableDisplayMirroring")+"</span>",html+="</label>"}html+="</div>",html+='<div style="margin-top:1em;display:flex;justify-content: flex-end;">',html+='<button is="emby-button" type="button" class="button-flat btnRemoteControl promptDialogButton">'+_globalize.default.translate("HeaderRemoteControl")+"</button>",html+='<button is="emby-button" type="button" class="button-flat btnDisconnect promptDialogButton ">'+_globalize.default.translate("Disconnect")+"</button>",html+='<button is="emby-button" type="button" class="button-flat btnCancel promptDialogButton">'+_globalize.default.translate("ButtonCancel")+"</button>",html+="</div>",html+="</div>",dlg.innerHTML=html;var chkMirror=dlg.querySelector(".chkMirror");chkMirror&&chkMirror.addEventListener("change",onMirrorChange);var destination="",btnRemoteControl=dlg.querySelector(".btnRemoteControl");btnRemoteControl&&btnRemoteControl.addEventListener("click",(function(){destination="nowplaying",dialogHelper.close(dlg)}));dlg.querySelector(".btnDisconnect").addEventListener("click",(function(){destination="disconnectFromPlayer",dialogHelper.close(dlg)})),dlg.querySelector(".btnCancel").addEventListener("click",(function(){dialogHelper.close(dlg)})),dialogHelper.open(dlg).then((function(){"nowplaying"===destination?_appRouter.default.showNowPlaying():"disconnectFromPlayer"===destination&&function disconnectFromPlayer(currentDeviceName){-1!==_playbackManager.default.getSupportedCommands().indexOf("EndSession")?new Promise((function(_resolve,_reject){return _require(["dialog"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref4){var dialog=_ref4.default,menuItems=[];menuItems.push({name:_globalize.default.translate("Yes"),id:"yes"}),menuItems.push({name:_globalize.default.translate("No"),id:"no"}),dialog({buttons:menuItems,text:_globalize.default.translate("ConfirmEndPlayerSession",currentDeviceName)}).then((function(id){switch(id){case"yes":_playbackManager.default.getCurrentPlayer().endSession(),_playbackManager.default.setDefaultPlayerActive();break;case"no":_playbackManager.default.setDefaultPlayerActive()}}))})):_playbackManager.default.setDefaultPlayerActive()}(currentDeviceName)}),emptyCallback)}(_slicedToArray(_ref2,1)[0],playerInfo)}))})(currentPlayerInfo)}function onMirrorChange(){_playbackManager.default.enableDisplayMirroring(this.checked)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.show=show,_exports.default=void 0,_appSettings=_interopRequireDefault(_appSettings),_events=_interopRequireDefault(_events),_browser=_interopRequireDefault(_browser),_loading=_interopRequireDefault(_loading),_playbackManager=_interopRequireDefault(_playbackManager),_appRouter=_interopRequireDefault(_appRouter),_globalize=_interopRequireDefault(_globalize),_apphost=_interopRequireDefault(_apphost),document.addEventListener("viewshow",(function(e){var item=(e.detail.state||{}).item;item&&item.ServerId&&mirrorIfEnabled({item:item})})),_events.default.on(_appSettings.default,"change",(function(e,name){"displaymirror"===name&&mirrorIfEnabled()})),_events.default.on(_playbackManager.default,"pairing",(function(e){_loading.default.show()})),_events.default.on(_playbackManager.default,"paired",(function(e){_loading.default.hide()})),_events.default.on(_playbackManager.default,"pairerror",(function(e){_loading.default.hide()}));var _default={show:show};_exports.default=_default}));
//# sourceMappingURL=playerSelectionMenu.js.map
