define(["require","exports","datetime","backdrop","listView","imageLoader","playbackManager","nowPlayingHelper","events","connectionManager","apphost","globalize","layoutManager","userSettings","cardBuilder","itemContextMenu","cardStyle","emby-itemscontainer","css!./remotecontrol.css","emby-ratingbutton"],(function(_require,_exports,_datetime,_backdrop,_listView,_imageLoader,_playbackManager,_nowPlayingHelper,_events,_connectionManager,_apphost,_globalize,_layoutManager,userSettings,_cardBuilder,_itemContextMenu,_cardStyle,_embyItemscontainer,_remotecontrol,_embyRatingbutton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(){function updatePlayerState(player,context,state){lastPlayerState=state;var item=state.NowPlayingItem,supportedCommands=_playbackManager.default.getPlayerInfo().supportedCommands;currentPlayerSupportedCommands=supportedCommands;var playState=state.PlayState||{},isSupportedCommands=supportedCommands.includes("DisplayMessage")||supportedCommands.includes("SendString")||supportedCommands.includes("Select");if(buttonVisible(context.querySelector(".btnToggleFullscreen"),item&&"Video"==item.MediaType&&supportedCommands.includes("ToggleFullscreen")),function updateAudioTracksDisplay(player,context){var supportedCommands=currentPlayerSupportedCommands;buttonVisible(context.querySelector(".btnAudioTracks"),_playbackManager.default.audioTracks(player).length>1&&-1!=supportedCommands.indexOf("SetAudioStreamIndex"))}(player,context),function updateSubtitleTracksDisplay(player,context){var supportedCommands=currentPlayerSupportedCommands;buttonVisible(context.querySelector(".btnSubtitles"),_playbackManager.default.subtitleTracks(player).length&&-1!=supportedCommands.indexOf("SetSubtitleStreamIndex"))}(player,context),supportedCommands.includes("DisplayMessage")&&!currentPlayer.isLocalPlayer?context.querySelector(".sendMessageSection").classList.remove("hide"):context.querySelector(".sendMessageSection").classList.add("hide"),supportedCommands.includes("SendString")&&!currentPlayer.isLocalPlayer?context.querySelector(".sendTextSection").classList.remove("hide"):context.querySelector(".sendTextSection").classList.add("hide"),supportedCommands.includes("Select")&&!currentPlayer.isLocalPlayer?context.querySelector(".navigationSection").classList.remove("hide"):context.querySelector(".navigationSection").classList.add("hide"),isSupportedCommands&&!currentPlayer.isLocalPlayer?context.querySelector(".remoteControlSection").classList.remove("hide"):context.querySelector(".remoteControlSection").classList.add("hide"),buttonVisible(context.querySelector(".btnStop"),null!=item),buttonVisible(context.querySelector(".btnNextTrack"),null!=item),buttonVisible(context.querySelector(".btnPreviousTrack"),null!=item),_layoutManager.default.mobile){var playingVideo=_playbackManager.default.isPlayingVideo()&&null!==item,playingAudio=!_playbackManager.default.isPlayingVideo()&&null!==item;buttonVisible(context.querySelector(".btnRepeat"),playingAudio),buttonVisible(context.querySelector(".btnShuffleQueue"),playingAudio),buttonVisible(context.querySelector(".btnRewind"),playingVideo),buttonVisible(context.querySelector(".btnFastForward"),playingVideo),buttonVisible(context.querySelector(".nowPlayingSecondaryButtons .btnShuffleQueue"),playingVideo),buttonVisible(context.querySelector(".nowPlayingSecondaryButtons .btnRepeat"),playingVideo)}else buttonVisible(context.querySelector(".btnRewind"),null!=item),buttonVisible(context.querySelector(".btnFastForward"),null!=item);var positionSlider=context.querySelector(".nowPlayingPositionSlider");if(positionSlider&&item&&item.RunTimeTicks&&positionSlider.setKeyboardSteps(1e6*userSettings.skipBackLength()/item.RunTimeTicks,1e6*userSettings.skipForwardLength()/item.RunTimeTicks),positionSlider&&!positionSlider.dragging){positionSlider.disabled=!playState.CanSeek;var isProgressClear=state.MediaSource&&null==state.MediaSource.RunTimeTicks;positionSlider.setIsClear(isProgressClear)}updatePlayPauseState(playState.IsPaused,null!=item),updateTimeDisplay(playState.PositionTicks,item?item.RunTimeTicks:null),updatePlayerVolumeState(context,playState.IsMuted,playState.VolumeLevel),item&&"Video"==item.MediaType?context.classList.remove("hideVideoButtons"):context.classList.add("hideVideoButtons"),updateRepeatModeDisplay(_playbackManager.default.getRepeatMode()),onShuffleQueueModeChange(!1),function updateNowPlayingInfo(context,state,serverId){var item=state.NowPlayingItem,displayName=item?function getNowPlayingNameHtml(nowPlayingItem,includeNonNameInfo){return _nowPlayingHelper.default.getNowPlayingNames(nowPlayingItem,includeNonNameInfo).map((function(i){return i.text})).join("<br/>")}(item).replace("<br/>"," - "):"";if(item){var nowPlayingServerId=item.ServerId||serverId;if("Audio"==item.Type||"Audio"==item.MediaStreams[0].Type){var songName=item.Name,artistsSeries="",albumName="";if(null!=item.Artists)if(null!=item.ArtistItems){var _step,_iterator=_createForOfIteratorHelper(item.ArtistItems);try{for(_iterator.s();!(_step=_iterator.n()).done;){var artist=_step.value,artistName=artist.Name,artistId=artist.Id;artistsSeries+='<a class="button-link emby-button" is="emby-linkbutton" href="details?id='.concat(artistId,"&serverId=").concat(nowPlayingServerId,'">').concat(artistName,"</a>"),artist!==item.ArtistItems.slice(-1)[0]&&(artistsSeries+=", ")}}catch(err){_iterator.e(err)}finally{_iterator.f()}}else if(item.Artists){var _step2,_iterator2=_createForOfIteratorHelper(item.Artists);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _artist=_step2.value;artistsSeries+="<a>".concat(_artist,"</a>"),_artist!==item.Artists.slice(-1)[0]&&(artistsSeries+=", ")}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}null!=item.Album&&(albumName='<a class="button-link emby-button" is="emby-linkbutton" href="details?id='+item.AlbumId+"&serverId=".concat(nowPlayingServerId,'">')+item.Album+"</a>"),context.querySelector(".nowPlayingAlbum").innerHTML=albumName,context.querySelector(".nowPlayingArtist").innerHTML=artistsSeries,context.querySelector(".nowPlayingSongName").innerHTML=songName}else if("Episode"==item.Type){if(null!=item.SeasonName){var seasonName=item.SeasonName;context.querySelector(".nowPlayingSeason").innerHTML='<a class="button-link emby-button" is="emby-linkbutton" href="details?id='+item.SeasonId+"&serverId=".concat(nowPlayingServerId,'">').concat(seasonName,"</a>")}if(null!=item.SeriesName){var seriesName=item.SeriesName;null!=item.SeriesId?context.querySelector(".nowPlayingSerie").innerHTML='<a class="button-link emby-button" is="emby-linkbutton" href="details?id='+item.SeriesId+"&serverId=".concat(nowPlayingServerId,'">').concat(seriesName,"</a>"):context.querySelector(".nowPlayingSerie").innerHTML=seriesName}context.querySelector(".nowPlayingEpisode").innerHTML=item.Name}else context.querySelector(".nowPlayingPageTitle").innerHTML=displayName;displayName.length>0&&"Audio"!=item.Type&&"Episode"!=item.Type?context.querySelector(".nowPlayingPageTitle").classList.remove("hide"):context.querySelector(".nowPlayingPageTitle").classList.add("hide");var url=function seriesImageUrl(item,options){if("Episode"!==item.Type)return null;if((options=options||{}).type=options.type||"Primary","Primary"===options.type&&item.SeriesPrimaryImageTag)return options.tag=item.SeriesPrimaryImageTag,_connectionManager.default.getApiClient(item.ServerId).getScaledImageUrl(item.SeriesId,options);if("Thumb"===options.type){if(item.SeriesThumbImageTag)return options.tag=item.SeriesThumbImageTag,_connectionManager.default.getApiClient(item.ServerId).getScaledImageUrl(item.SeriesId,options);if(item.ParentThumbImageTag)return options.tag=item.ParentThumbImageTag,_connectionManager.default.getApiClient(item.ServerId).getScaledImageUrl(item.ParentThumbItemId,options)}return null}(item,{maxHeight:300})||function imageUrl(item,options){if((options=options||{}).type=options.type||"Primary",item.ImageTags&&item.ImageTags[options.type])return options.tag=item.ImageTags[options.type],_connectionManager.default.getApiClient(item.ServerId).getScaledImageUrl(item.PrimaryImageItemId||item.Id,options);if(item.AlbumId&&item.AlbumPrimaryImageTag)return options.tag=item.AlbumPrimaryImageTag,_connectionManager.default.getApiClient(item.ServerId).getScaledImageUrl(item.AlbumId,options);return null}(item,{maxHeight:300}),contextButton=context.querySelector(".btnToggleContextMenu"),autoFocusContextButton=document.activeElement===contextButton,contextButtonClone=contextButton.cloneNode(!0);contextButton.parentNode.replaceChild(contextButtonClone,contextButton),contextButton=context.querySelector(".btnToggleContextMenu"),autoFocusContextButton&&contextButton.focus();var options={play:!1,queue:!1,stopPlayback:!!_layoutManager.default.mobile,clearQueue:!0,openAlbum:!1,positionTo:contextButton},apiClient=_connectionManager.default.getApiClient(item.ServerId);apiClient.getItem(apiClient.getCurrentUserId(),item.Id).then((function(fullItem){apiClient.getCurrentUser().then((function(user){contextButton.addEventListener("click",(function(){_itemContextMenu.default.show(Object.assign({item:fullItem,user:user},options))}))}))})),function setImageUrl(context,state,url){var item=state.NowPlayingItem,imgContainer=context.querySelector(".nowPlayingPageImageContainer");url?(imgContainer.innerHTML='<img class="nowPlayingPageImage" src="'+url+'" />',"Audio"==item.Type?(context.querySelector(".nowPlayingPageImage").classList.add("nowPlayingPageImageAudio"),context.querySelector(".nowPlayingPageImageContainer").classList.remove("nowPlayingPageImageAudio")):(context.querySelector(".nowPlayingPageImageContainer").classList.add("nowPlayingPageImagePoster"),context.querySelector(".nowPlayingPageImage").classList.remove("nowPlayingPageImageAudio"))):imgContainer.innerHTML='<div class="nowPlayingPageImageContainerNoAlbum"><button data-action="link" class="cardImageContainer coveredImage '+_cardBuilder.default.getDefaultBackgroundClass(item.Name)+' cardContent cardContent-shadow itemAction"><span class="cardImageIcon material-icons album"></span></button></div>'}(context,state,url),_backdrop.default.setBackdrops([item]),apiClient.getItem(apiClient.getCurrentUserId(),item.Id).then((function(fullItem){var userData=fullItem.UserData||{},likes=null==userData.Likes?"":userData.Likes;context.querySelector(".nowPlayingPageUserDataButtonsTitle").innerHTML='<button is="emby-ratingbutton" type="button" class="listItemButton paper-icon-button-light" data-id="'+fullItem.Id+'" data-serverid="'+fullItem.ServerId+'" data-itemtype="'+fullItem.Type+'" data-likes="'+likes+'" data-isfavorite="'+userData.IsFavorite+'"><span class="material-icons favorite"></span></button>',context.querySelector(".nowPlayingPageUserDataButtons").innerHTML='<button is="emby-ratingbutton" type="button" class="listItemButton paper-icon-button-light" data-id="'+fullItem.Id+'" data-serverid="'+fullItem.ServerId+'" data-itemtype="'+fullItem.Type+'" data-likes="'+likes+'" data-isfavorite="'+userData.IsFavorite+'"><span class="material-icons favorite"></span></button>'}))}else _backdrop.default.clearBackdrop(),context.querySelector(".nowPlayingPageUserDataButtons").innerHTML=""}(context,state)}function updateRepeatModeDisplay(repeatMode){var toggleRepeatButtons=dlg.querySelectorAll(".repeatToggleButton"),innHtml='<span class="material-icons repeat"></span>',repeatOn=!0;switch(repeatMode){case"RepeatAll":break;case"RepeatOne":innHtml='<span class="material-icons repeat_one"></span>';break;case"RepeatNone":default:repeatOn=!1}var _step3,_iterator3=_createForOfIteratorHelper(toggleRepeatButtons);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var toggleRepeatButton=_step3.value;toggleRepeatButton.classList.toggle("buttonActive",repeatOn),toggleRepeatButton.innerHTML=innHtml}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}function updatePlayerVolumeState(context,isMuted,volumeLevel){var view=context,supportedCommands=currentPlayerSupportedCommands;-1===supportedCommands.indexOf("Mute")&&(showMuteButton=!1),-1===supportedCommands.indexOf("SetVolume")&&(showVolumeSlider=!1),currentPlayer.isLocalPlayer&&_apphost.default.supports("physicalvolumecontrol")&&(showMuteButton=!1,showVolumeSlider=!1);var buttonMute=view.querySelector(".buttonMute"),buttonMuteIcon=buttonMute.querySelector(".material-icons");if(buttonMuteIcon.classList.remove("volume_off","volume_up"),isMuted?(buttonMute.setAttribute("title",_globalize.default.translate("Unmute")),buttonMuteIcon.classList.add("volume_off")):(buttonMute.setAttribute("title",_globalize.default.translate("Mute")),buttonMuteIcon.classList.add("volume_up")),showMuteButton||showVolumeSlider){buttonMute.classList.toggle("hide",!showMuteButton);var nowPlayingVolumeSlider=context.querySelector(".nowPlayingVolumeSlider"),nowPlayingVolumeSliderContainer=context.querySelector(".nowPlayingVolumeSliderContainer");nowPlayingVolumeSlider&&(nowPlayingVolumeSliderContainer.classList.toggle("hide",!showVolumeSlider),nowPlayingVolumeSlider.dragging||(nowPlayingVolumeSlider.value=volumeLevel||0))}else context.querySelector(".volumecontrol").classList.add("hide")}function updatePlayPauseState(isPaused,isActive){var btnPlayPause=dlg.querySelector(".btnPlayPause"),btnPlayPauseIcon=btnPlayPause.querySelector(".material-icons");btnPlayPauseIcon.classList.remove("play_circle_filled","pause_circle_filled"),btnPlayPauseIcon.classList.add(isPaused?"play_circle_filled":"pause_circle_filled"),buttonVisible(btnPlayPause,isActive)}function updateTimeDisplay(positionTicks,runtimeTicks){var context=dlg,positionSlider=context.querySelector(".nowPlayingPositionSlider");if(positionSlider&&!positionSlider.dragging)if(runtimeTicks){var pct=positionTicks/runtimeTicks;pct*=100,positionSlider.value=pct}else positionSlider.value=0;context.querySelector(".positionTime").innerHTML=null==positionTicks?"--:--":_datetime.default.getDisplayRunningTime(positionTicks),context.querySelector(".runtime").innerHTML=null!=runtimeTicks?_datetime.default.getDisplayRunningTime(runtimeTicks):"--:--"}function getPlaylistItems(player){return _playbackManager.default.getPlaylist(player)}function onPlaybackStart(e,state){console.debug("remotecontrol event: "+e.type);onStateChanged.call(this,e,state)}function onRepeatModeChange(){updateRepeatModeDisplay(_playbackManager.default.getRepeatMode())}function onShuffleQueueModeChange(){var _step4,updateView=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],shuffleMode=_playbackManager.default.getQueueShuffleMode(this),context=dlg,cssClass="buttonActive",shuffleButtons=context.querySelectorAll(".btnShuffleQueue"),_iterator4=_createForOfIteratorHelper(shuffleButtons);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var shuffleButton=_step4.value;switch(shuffleMode){case"Shuffle":shuffleButton.classList.add(cssClass);break;case"Sorted":default:shuffleButton.classList.remove(cssClass)}}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}updateView&&onPlaylistUpdate()}function onPlaylistUpdate(e){!function loadPlaylist(context,player){getPlaylistItems(player).then((function(items){var html="",favoritesEnabled=!0;_layoutManager.default.mobile&&(items.length>0?context.querySelector(".btnTogglePlaylist").classList.remove("hide"):context.querySelector(".btnTogglePlaylist").classList.add("hide"),favoritesEnabled=!1),html+=_listView.default.getListViewHtml({items:items,smallIcon:!0,action:"setplaylistindex",enableUserDataButtons:favoritesEnabled,rightButtons:[{icon:"remove_circle_outline",title:_globalize.default.translate("ButtonRemove"),id:"remove"}],dragHandle:!0});var itemsContainer=context.querySelector(".playlist"),focusedItemPlaylistId=itemsContainer.querySelector("button:focus");if(itemsContainer.innerHTML=html,null!==focusedItemPlaylistId){focusedItemPlaylistId=focusedItemPlaylistId.getAttribute("data-playlistitemid");var newFocusedItem=itemsContainer.querySelector('button[data-playlistitemid="'.concat(focusedItemPlaylistId,'"]'));null!==newFocusedItem&&newFocusedItem.focus()}var playlistItemId=_playbackManager.default.getCurrentPlaylistItemId(player);if(playlistItemId){var img=itemsContainer.querySelector('.listItem[data-playlistItemId="'.concat(playlistItemId,'"] .listItemImage'));img&&(img.classList.remove("lazy"),img.classList.add("playlistIndexIndicatorImage"))}_imageLoader.default.lazyChildren(itemsContainer)}))}(dlg,this)}function onPlaylistItemRemoved(e,info){var context=dlg;if(void 0!==info)for(var playlistItemIds=info.playlistItemIds,i=0,length=playlistItemIds.length;i<length;i++){var listItem=context.querySelector('.listItem[data-playlistItemId="'+playlistItemIds[i]+'"]');listItem&&listItem.parentNode.removeChild(listItem)}else onPlaylistUpdate()}function onPlaybackStopped(e,state){console.debug("remotecontrol event: "+e.type);state.NextMediaType||(updatePlayerState(this,dlg,{}),Emby.Page.back())}function onPlayPauseStateChanged(e){updatePlayPauseState(this.paused(),!0)}function onStateChanged(event,state){updatePlayerState(this,dlg,state),onPlaylistUpdate()}function onTimeUpdate(e){var now=(new Date).getTime();if(!(now-lastUpdateTime<700)){lastUpdateTime=now;currentRuntimeTicks=_playbackManager.default.duration(this),updateTimeDisplay(_playbackManager.default.currentTime(this),currentRuntimeTicks)}}function onVolumeChanged(e){updatePlayerVolumeState(dlg,this.isMuted(),this.getVolume())}function releaseCurrentPlayer(){var player=currentPlayer;player&&(_events.default.off(player,"playbackstart",onPlaybackStart),_events.default.off(player,"statechange",onStateChanged),_events.default.off(player,"repeatmodechange",onRepeatModeChange),_events.default.off(player,"shufflequeuemodechange",onShuffleQueueModeChange),_events.default.off(player,"playlistitemremove",onPlaylistItemRemoved),_events.default.off(player,"playlistitemmove",onPlaylistUpdate),_events.default.off(player,"playlistitemadd",onPlaylistUpdate),_events.default.off(player,"playbackstop",onPlaybackStopped),_events.default.off(player,"volumechange",onVolumeChanged),_events.default.off(player,"pause",onPlayPauseStateChanged),_events.default.off(player,"unpause",onPlayPauseStateChanged),_events.default.off(player,"timeupdate",onTimeUpdate),currentPlayer=null)}function bindToPlayer(context,player){if(releaseCurrentPlayer(),currentPlayer=player,player){var state=_playbackManager.default.getPlayerState(player);onStateChanged.call(player,{type:"init"},state),_events.default.on(player,"playbackstart",onPlaybackStart),_events.default.on(player,"statechange",onStateChanged),_events.default.on(player,"repeatmodechange",onRepeatModeChange),_events.default.on(player,"shufflequeuemodechange",onShuffleQueueModeChange),_events.default.on(player,"playlistitemremove",onPlaylistItemRemoved),_events.default.on(player,"playlistitemmove",onPlaylistUpdate),_events.default.on(player,"playlistitemadd",onPlaylistUpdate),_events.default.on(player,"playbackstop",onPlaybackStopped),_events.default.on(player,"volumechange",onVolumeChanged),_events.default.on(player,"pause",onPlayPauseStateChanged),_events.default.on(player,"unpause",onPlayPauseStateChanged),_events.default.on(player,"timeupdate",onTimeUpdate);var supportedCommands=_playbackManager.default.getPlayerInfo().supportedCommands;currentPlayerSupportedCommands=supportedCommands,function updateSupportedCommands(context,commands){for(var all=context.querySelectorAll(".btnCommand"),i=0,length=all.length;i<length;i++){var enableButton=-1!==commands.indexOf(all[i].getAttribute("data-command"));all[i].disabled=!enableButton}}(context,supportedCommands)}}function onBtnCommandClick(){currentPlayer&&(this.classList.contains("repeatToggleButton")?function toggleRepeat(){switch(_playbackManager.default.getRepeatMode()){case"RepeatAll":_playbackManager.default.setRepeatMode("RepeatOne");break;case"RepeatOne":_playbackManager.default.setRepeatMode("RepeatNone");break;case"RepeatNone":_playbackManager.default.setRepeatMode("RepeatAll")}}():_playbackManager.default.sendCommand({Name:this.getAttribute("data-command")},currentPlayer))}function savePlaylist(){new Promise((function(_resolve,_reject){return _require(["playlistEditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){var playlistEditor=_ref3.default;(function getSaveablePlaylistItems(){return getPlaylistItems(currentPlayer).then((function(items){return items.filter((function(i){return i.Id&&i.ServerId}))}))})().then((function(items){var serverId=items.length?items[0].ServerId:ApiClient.serverId();new playlistEditor({items:items.map((function(i){return i.Id})),serverId:serverId,enableAddToPlayQueue:!1,defaultValue:"new"})}))}))}function bindEvents(context){for(var btnCommand=context.querySelectorAll(".btnCommand"),positionSlider=context.querySelector(".nowPlayingPositionSlider"),i=0,length=btnCommand.length;i<length;i++)btnCommand[i].addEventListener("click",onBtnCommandClick);context.querySelector(".btnToggleFullscreen").addEventListener("click",(function(e){currentPlayer&&_playbackManager.default.sendCommand({Name:e.target.getAttribute("data-command")},currentPlayer)})),context.querySelector(".btnAudioTracks").addEventListener("click",(function(e){currentPlayer&&lastPlayerState&&lastPlayerState.NowPlayingItem&&function showAudioMenu(context,player,button,item){var currentIndex=_playbackManager.default.getAudioStreamIndex(player),menuItems=_playbackManager.default.audioTracks(player).map((function(s){var menuItem={name:s.DisplayTitle,id:s.Index};return s.Index==currentIndex&&(menuItem.selected=!0),menuItem}));new Promise((function(_resolve,_reject){return _require(["actionsheet"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){_ref.default.show({items:menuItems,positionTo:button,callback:function callback(id){_playbackManager.default.setAudioStreamIndex(parseInt(id),player)}})}))}(0,currentPlayer,e.target,lastPlayerState.NowPlayingItem)})),context.querySelector(".btnSubtitles").addEventListener("click",(function(e){currentPlayer&&lastPlayerState&&lastPlayerState.NowPlayingItem&&function showSubtitleMenu(context,player,button,item){var currentIndex=_playbackManager.default.getSubtitleStreamIndex(player),menuItems=_playbackManager.default.subtitleTracks(player).map((function(s){var menuItem={name:s.DisplayTitle,id:s.Index};return s.Index==currentIndex&&(menuItem.selected=!0),menuItem}));menuItems.unshift({id:-1,name:_globalize.default.translate("Off"),selected:null==currentIndex}),new Promise((function(_resolve,_reject){return _require(["actionsheet"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){_ref2.default.show({items:menuItems,positionTo:button,callback:function callback(id){_playbackManager.default.setSubtitleStreamIndex(parseInt(id),player)}})}))}(0,currentPlayer,e.target,lastPlayerState.NowPlayingItem)})),context.querySelector(".btnStop").addEventListener("click",(function(){currentPlayer&&_playbackManager.default.stop(currentPlayer)})),context.querySelector(".btnPlayPause").addEventListener("click",(function(){currentPlayer&&_playbackManager.default.playPause(currentPlayer)})),context.querySelector(".btnNextTrack").addEventListener("click",(function(){currentPlayer&&_playbackManager.default.nextTrack(currentPlayer)})),context.querySelector(".btnRewind").addEventListener("click",(function(){currentPlayer&&_playbackManager.default.rewind(currentPlayer)})),context.querySelector(".btnFastForward").addEventListener("click",(function(){currentPlayer&&_playbackManager.default.fastForward(currentPlayer)}));var _step5,_iterator5=_createForOfIteratorHelper(context.querySelectorAll(".btnShuffleQueue"));try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){_step5.value.addEventListener("click",(function(){currentPlayer&&_playbackManager.default.toggleQueueShuffleMode(currentPlayer)}))}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}context.querySelector(".btnPreviousTrack").addEventListener("click",(function(e){if(currentPlayer)if("Audio"===lastPlayerState.NowPlayingItem.MediaType&&(currentPlayer._currentTime>=5||!_playbackManager.default.previousTrack(currentPlayer))){if(e.detail>1&&_playbackManager.default.previousTrack(currentPlayer))return;_playbackManager.default.seekPercent(0,currentPlayer),positionSlider.value=0}else _playbackManager.default.previousTrack(currentPlayer)})),context.querySelector(".btnPreviousTrack").addEventListener("dblclick",(function(){currentPlayer&&_playbackManager.default.previousTrack(currentPlayer)})),positionSlider.addEventListener("change",(function(){var value=this.value;if(currentPlayer){var newPercent=parseFloat(value);_playbackManager.default.seekPercent(newPercent,currentPlayer)}})),positionSlider.getBubbleText=function(value){if(!lastPlayerState||!lastPlayerState.NowPlayingItem||!currentRuntimeTicks)return"--:--";var ticks=currentRuntimeTicks;return ticks/=100,ticks*=value,_datetime.default.getDisplayRunningTime(ticks)},context.querySelector(".nowPlayingVolumeSlider").addEventListener("input",(function(e){_playbackManager.default.setVolume(e.target.value,currentPlayer)})),context.querySelector(".buttonMute").addEventListener("click",(function(){_playbackManager.default.toggleMute(currentPlayer)}));var playlistContainer=context.querySelector(".playlist");playlistContainer.addEventListener("action-remove",(function(e){_playbackManager.default.removeFromPlaylist([e.detail.playlistItemId],currentPlayer)})),playlistContainer.addEventListener("itemdrop",(function(e){var newIndex=e.detail.newIndex,playlistItemId=e.detail.playlistItemId;_playbackManager.default.movePlaylistItem(playlistItemId,newIndex,currentPlayer)})),context.querySelector(".btnSavePlaylist").addEventListener("click",savePlaylist),context.querySelector(".btnTogglePlaylist").addEventListener("click",(function(){context.querySelector(".playlist").classList.contains("hide")?(context.querySelector(".playlist").classList.remove("hide"),context.querySelector(".btnSavePlaylist").classList.remove("hide"),context.querySelector(".volumecontrol").classList.add("hide"),_layoutManager.default.mobile&&context.querySelector(".playlistSectionButton").classList.remove("playlistSectionButtonTransparent")):(context.querySelector(".playlist").classList.add("hide"),context.querySelector(".btnSavePlaylist").classList.add("hide"),(showMuteButton||showVolumeSlider)&&context.querySelector(".volumecontrol").classList.remove("hide"),_layoutManager.default.mobile&&context.querySelector(".playlistSectionButton").classList.add("playlistSectionButtonTransparent"))}))}function onPlayerChange(){bindToPlayer(dlg,_playbackManager.default.getCurrentPlayer())}function onMessageSubmit(e){var form=e.target;return _playbackManager.default.sendCommand({Name:"DisplayMessage",Arguments:{Header:form.querySelector("#txtMessageTitle").value,Text:form.querySelector("#txtMessageText",form).value}},currentPlayer),form.querySelector("input").value="",new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref4){(0,_ref4.default)("Message sent.")})),e.preventDefault(),e.stopPropagation(),!1}function onSendStringSubmit(e){var form=e.target;return _playbackManager.default.sendCommand({Name:"SendString",Arguments:{String:form.querySelector("#txtTypeText",form).value}},currentPlayer),form.querySelector("input").value="",new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref5){(0,_ref5.default)("Text sent.")})),e.preventDefault(),e.stopPropagation(),!1}var dlg,currentPlayer,lastPlayerState,currentPlayerSupportedCommands=[],lastUpdateTime=0,currentRuntimeTicks=0;this.init=function(ownerView,context){(function init(ownerView,context){var volumecontrolHtml='<div class="volumecontrol flex align-items-center flex-wrap-wrap justify-content-center">';volumecontrolHtml+='<button is="paper-icon-button-light" class="buttonMute autoSize" title='.concat(_globalize.default.translate("Mute"),'><span class="xlargePaperIconButton material-icons volume_up"></span></button>'),volumecontrolHtml+='<div class="sliderContainer nowPlayingVolumeSliderContainer"><input is="emby-slider" type="range" step="1" min="0" max="100" value="0" class="nowPlayingVolumeSlider"/></div>',volumecontrolHtml+="</div>";var optionsSection=context.querySelector(".playlistSectionButton");if(_layoutManager.default.mobile?(optionsSection.querySelector(".btnTogglePlaylist").insertAdjacentHTML("afterend",volumecontrolHtml),optionsSection.classList.add("playlistSectionButtonTransparent"),context.querySelector(".btnTogglePlaylist").classList.remove("hide"),context.querySelector(".playlistSectionButton").classList.remove("justify-content-center"),context.querySelector(".playlistSectionButton").classList.add("justify-content-space-between")):(context.querySelector(".nowPlayingSecondaryButtons").insertAdjacentHTML("beforeend",volumecontrolHtml),optionsSection.classList.remove("align-items-center","justify-content-center"),optionsSection.classList.add("align-items-right","justify-content-flex-end"),context.querySelector(".playlist").classList.remove("hide"),context.querySelector(".btnSavePlaylist").classList.remove("hide"),context.classList.add("padded-bottom")),bindEvents(context),context.querySelector(".sendMessageForm").addEventListener("submit",onMessageSubmit),context.querySelector(".typeTextForm").addEventListener("submit",onSendStringSubmit),_events.default.on(_playbackManager.default,"playerchange",onPlayerChange),_layoutManager.default.tv){var positionSlider=context.querySelector(".nowPlayingPositionSlider");positionSlider.classList.add("focusable"),positionSlider.enableKeyboardDragging()}})(0,dlg=context)},this.onShow=function(){!function onShow(context,tab){bindToPlayer(context,_playbackManager.default.getCurrentPlayer())}(dlg,window.location.hash)},this.destroy=function(){!function onDialogClosed(e){releaseCurrentPlayer(),_events.default.off(_playbackManager.default,"playerchange",onPlayerChange),lastPlayerState=null}()}},_datetime=_interopRequireDefault(_datetime),_backdrop=_interopRequireDefault(_backdrop),_listView=_interopRequireDefault(_listView),_imageLoader=_interopRequireDefault(_imageLoader),_playbackManager=_interopRequireDefault(_playbackManager),_nowPlayingHelper=_interopRequireDefault(_nowPlayingHelper),_events=_interopRequireDefault(_events),_connectionManager=_interopRequireDefault(_connectionManager),_apphost=_interopRequireDefault(_apphost),_globalize=_interopRequireDefault(_globalize),_layoutManager=_interopRequireDefault(_layoutManager),userSettings=_interopRequireWildcard(userSettings),_cardBuilder=_interopRequireDefault(_cardBuilder),_itemContextMenu=_interopRequireDefault(_itemContextMenu);var showMuteButton=!0,showVolumeSlider=!0;function buttonVisible(btn,enabled){enabled?btn.classList.remove("hide"):btn.classList.add("hide")}}));
//# sourceMappingURL=remotecontrol.js.map
