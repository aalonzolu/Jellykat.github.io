function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}define(["playbackManager","userSettings","connectionManager"],(function(_playbackManager,userSettings,_connectionManager){"use strict";function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var currentOwnerId;_playbackManager=_interopRequireDefault(_playbackManager),userSettings=function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(userSettings),_connectionManager=_interopRequireDefault(_connectionManager);var currentThemeIds=[];function playThemeMedia(items,ownerId){var currentThemeItems=items.filter((function(i){return function enabled(mediaType){if("Video"===mediaType)return userSettings.enableThemeVideos();return userSettings.enableThemeSongs()}(i.MediaType)}));if(currentThemeItems.length){if(!currentOwnerId&&_playbackManager.default.isPlaying())return;currentThemeIds=currentThemeItems.map((function(i){return i.Id})),_playbackManager.default.play({items:currentThemeItems,fullscreen:!1,enableRemotePlayers:!1}).then((function(){currentOwnerId=ownerId}))}else stopIfPlaying()}function stopIfPlaying(){currentOwnerId&&_playbackManager.default.stop(),currentOwnerId=null}var excludeTypes=["CollectionFolder","UserView","Program","SeriesTimer","Person","TvChannel","Channel"];document.addEventListener("viewshow",(function(e){var item=(e.detail.state||{}).item;item&&item.ServerId?function loadThemeMedia(item){if(item.CollectionType)stopIfPlaying();else if(-1===excludeTypes.indexOf(item.Type)){var apiClient=_connectionManager.default.getApiClient(item.ServerId);apiClient.getThemeMedia(apiClient.getCurrentUserId(),item.Id,!0).then((function(themeMediaResult){var ownerId=themeMediaResult.ThemeVideosResult.Items.length?themeMediaResult.ThemeVideosResult.OwnerId:themeMediaResult.ThemeSongsResult.OwnerId;ownerId!==currentOwnerId&&playThemeMedia(themeMediaResult.ThemeVideosResult.Items.length?themeMediaResult.ThemeVideosResult.Items:themeMediaResult.ThemeSongsResult.Items,ownerId)}))}else stopIfPlaying()}(item):(e.detail.options||{}).supportsThemeMedia||playThemeMedia([],null)}),!0),Events.on(_playbackManager.default,"playbackstart",(function(e,player){var item=_playbackManager.default.currentItem(player);-1==currentThemeIds.indexOf(item.Id)&&(currentOwnerId=null)}))}));
//# sourceMappingURL=themeMediaPlayer.js.map
