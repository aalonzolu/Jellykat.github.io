define(["exports","dialogHelper","dom","layoutManager","connectionManager","globalize","loading","browser","focusManager","scrollHelper","material-icons","formDialogStyle","emby-button","emby-itemscontainer","cardStyle"],(function(_exports,_dialogHelper,_dom,_layoutManager,_connectionManager,_globalize,_loading,_browser,_focusManager,_scrollHelper,_materialIcons,_formDialogStyle,_embyButton,_embyItemscontainer,_cardStyle){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_dialogHelper=_interopRequireDefault(_dialogHelper),_dom=_interopRequireDefault(_dom),_layoutManager=_interopRequireDefault(_layoutManager),_connectionManager=_interopRequireDefault(_connectionManager),_globalize=_interopRequireDefault(_globalize),_loading=_interopRequireDefault(_loading),_browser=_interopRequireDefault(_browser),_focusManager=_interopRequireDefault(_focusManager),_scrollHelper=_interopRequireDefault(_scrollHelper);var enableFocusTransform=!_browser.default.slow&&!_browser.default.edge;function getDeviceHtml(device){var html="",cssClass="card scalableCard backdropCard backdropCard-scalable";return _layoutManager.default.tv&&(cssClass+=" show-focus",enableFocusTransform&&(cssClass+=" show-animation")),html+='<button type="button" class="'+cssClass+'" data-id="'+device.DeviceId+'" style="min-width:33.3333%;">',html+='<div class="cardBox visualCardBox">',html+='<div class="cardScalable visualCardBox-cardScalable">',html+='<div class="cardPadder-backdrop"></div>',html+='<div class="cardContent searchImage">',html+='<div class="cardImageContainer coveredImage"><span class="cardImageIcon material-icons dvr"></span></div>',html+="</div>",html+="</div>",html+='<div class="cardFooter visualCardBox-cardFooter">',html+='<div class="cardText cardTextCentered">'+function getTunerName(providerId){switch(providerId=providerId.toLowerCase()){case"m3u":return"M3U";case"hdhomerun":return"HDHomerun";case"hauppauge":return"Hauppauge";case"satip":return"DVB";default:return"Unknown"}}(device.Type)+"</div>",html+='<div class="cardText cardTextCentered cardText-secondary">'+device.FriendlyName+"</div>",html+='<div class="cardText cardText-secondary cardTextCentered">',html+=device.Url||"&nbsp;",html+="</div>",html+="</div>",(html+="</div>")+"</button>"}function discoverDevices(view,apiClient){return _loading.default.show(),view.querySelector(".loadingContent").classList.remove("hide"),ApiClient.getJSON(ApiClient.getUrl("LiveTv/Tuners/Discvover",{NewDevicesOnly:!0})).then((function(devices){currentDevices=devices,function renderDevices(view,devices){for(var html="",i=0,length=devices.length;i<length;i++)html+=getDeviceHtml(devices[i]);devices.length?view.querySelector(".devicesHeader").classList.remove("hide"):(html="<p><br/>"+_globalize.default.translate("NoNewDevicesFound")+"</p>",view.querySelector(".devicesHeader").classList.add("hide"));var elem=view.querySelector(".results");elem.innerHTML=html,_layoutManager.default.tv&&_focusManager.default.autoFocus(elem)}(view,devices),view.querySelector(".loadingContent").classList.add("hide"),_loading.default.hide()}))}var currentDevices=[],_default=function tunerPicker(){this.show=function(options){var dialogOptions={removeOnClose:!0,scrollY:!1};_layoutManager.default.tv?dialogOptions.size="fullscreen":dialogOptions.size="small";var dlg=_dialogHelper.default.createDialog(dialogOptions);dlg.classList.add("formDialog");var deviceResult,html="";html+='<div class="formDialogHeader">',html+='<button is="paper-icon-button-light" class="btnCancel autoSize" tabindex="-1"><span class="material-icons arrow_back"></span></button>',html+='<h3 class="formDialogHeaderTitle">',html+=_globalize.default.translate("HeaderLiveTvTunerSetup"),html+="</h3>",html+="</div>",html+=function getEditorHtml(){var html="";return html+='<div class="formDialogContent scrollY">',html+='<div class="dialogContentInner dialog-content-centered">',html+='<div class="loadingContent hide">',html+="<h1>"+_globalize.default.translate("DetectingDevices")+"...</h1>",html+="<p>"+_globalize.default.translate("MessagePleaseWait")+"</p>",html+="</div>",html+='<h1 style="margin-bottom:.25em;" class="devicesHeader hide">'+_globalize.default.translate("HeaderNewDevices")+"</h1>",html+='<div is="emby-itemscontainer" class="results vertical-wrap">',html+="</div>",(html+="</div>")+"</div>"}(),dlg.innerHTML=html,dlg.querySelector(".btnCancel").addEventListener("click",(function(){_dialogHelper.default.close(dlg)})),dlg.querySelector(".results").addEventListener("click",(function(e){var tunerCard=_dom.default.parentWithClass(e.target,"card");if(tunerCard){var deviceId=tunerCard.getAttribute("data-id");deviceResult=currentDevices.filter((function(d){return d.DeviceId===deviceId}))[0],_dialogHelper.default.close(dlg)}})),_layoutManager.default.tv&&_scrollHelper.default.centerFocus.on(dlg.querySelector(".formDialogContent"),!1);_connectionManager.default.getApiClient(options.serverId);return discoverDevices(dlg),_layoutManager.default.tv&&_scrollHelper.default.centerFocus.off(dlg.querySelector(".formDialogContent"),!1),_dialogHelper.default.open(dlg).then((function(){return deviceResult?Promise.resolve(deviceResult):Promise.reject()}))}};_exports.default=_default}));
//# sourceMappingURL=tunerPicker.js.map
