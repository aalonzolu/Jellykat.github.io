{"version":3,"sources":["components/collectionEditor/collectionEditor.js"],"names":["define","_require","_exports","_dom","_dialogHelper","_loading","_layoutManager","_connectionManager","_appRouter","_globalize","_embyCheckbox","_embyInput","_paperIconButtonLight","_embySelect","_materialIcons","_formdialog","_embyButton","_flexStyles","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","currentServerId","onSubmit","e","loading","show","panel","dom","parentWithClass","this","collectionId","querySelector","value","apiClient","connectionManager","getApiClient","addToCollection","dlg","id","url","getUrl","concat","Ids","ajax","type","then","hide","submitted","dialogHelper","close","Promise","_resolve","_reject","imported","_ref","toast","globalize","translate","createCollection","Name","IsLocked","checked","dataType","result","Id","redirectToCollection","appRouter","showItem","serverId","preventDefault","triggerChange","select","dispatchEvent","CustomEvent","initEditor","content","items","addEventListener","classList","add","removeAttribute","remove","setAttribute","join","length","populateCollections","getItems","getCurrentUserId","Recursive","IncludeItemTypes","SortBy","EnableTotalRecordCount","html","Items","map","i","innerHTML","selectCollectionToAddTo","centerFocus","elem","horiz","on","scrollHelper","fn","showEditor","options","_classCallCheck","instance","Constructor","TypeError","dialogOptions","removeOnClose","scrollY","layoutManager","tv","size","createDialog","getEditorHtml","open","resolve","reject","_default"],"mappings":"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","file":"collectionEditor.js","sourcesContent":["import dom from 'dom';\nimport dialogHelper from 'dialogHelper';\nimport loading from 'loading';\nimport layoutManager from 'layoutManager';\nimport connectionManager from 'connectionManager';\nimport appRouter from 'appRouter';\nimport globalize from 'globalize';\nimport 'emby-checkbox';\nimport 'emby-input';\nimport 'paper-icon-button-light';\nimport 'emby-select';\nimport 'material-icons';\nimport 'css!./../formdialog';\nimport 'emby-button';\nimport 'flexStyles';\n\n/* eslint-disable indent */\n\n    let currentServerId;\n\n    function onSubmit(e) {\n        loading.show();\n\n        const panel = dom.parentWithClass(this, 'dialog');\n\n        const collectionId = panel.querySelector('#selectCollectionToAddTo').value;\n\n        const apiClient = connectionManager.getApiClient(currentServerId);\n\n        if (collectionId) {\n            addToCollection(apiClient, panel, collectionId);\n        } else {\n            createCollection(apiClient, panel);\n        }\n\n        e.preventDefault();\n        return false;\n    }\n\n    function createCollection(apiClient, dlg) {\n        const url = apiClient.getUrl('Collections', {\n\n            Name: dlg.querySelector('#txtNewCollectionName').value,\n            IsLocked: !dlg.querySelector('#chkEnableInternetMetadata').checked,\n            Ids: dlg.querySelector('.fldSelectedItemIds').value || ''\n        });\n\n        apiClient.ajax({\n            type: 'POST',\n            url: url,\n            dataType: 'json'\n\n        }).then(result => {\n            loading.hide();\n\n            const id = result.Id;\n\n            dlg.submitted = true;\n            dialogHelper.close(dlg);\n            redirectToCollection(apiClient, id);\n        });\n    }\n\n    function redirectToCollection(apiClient, id) {\n        appRouter.showItem(id, apiClient.serverId());\n    }\n\n    function addToCollection(apiClient, dlg, id) {\n        const url = apiClient.getUrl(`Collections/${id}/Items`, {\n\n            Ids: dlg.querySelector('.fldSelectedItemIds').value || ''\n        });\n\n        apiClient.ajax({\n            type: 'POST',\n            url: url\n\n        }).then(() => {\n            loading.hide();\n\n            dlg.submitted = true;\n            dialogHelper.close(dlg);\n\n            import('toast').then(({default: toast}) => {\n                toast(globalize.translate('MessageItemsAdded'));\n            });\n        });\n    }\n\n    function triggerChange(select) {\n        select.dispatchEvent(new CustomEvent('change', {}));\n    }\n\n    function populateCollections(panel) {\n        loading.show();\n\n        const select = panel.querySelector('#selectCollectionToAddTo');\n\n        panel.querySelector('.newCollectionInfo').classList.add('hide');\n\n        const options = {\n\n            Recursive: true,\n            IncludeItemTypes: 'BoxSet',\n            SortBy: 'SortName',\n            EnableTotalRecordCount: false\n        };\n\n        const apiClient = connectionManager.getApiClient(currentServerId);\n        apiClient.getItems(apiClient.getCurrentUserId(), options).then(result => {\n            let html = '';\n\n            html += `<option value=\"\">${globalize.translate('OptionNew')}</option>`;\n\n            html += result.Items.map(i => {\n                return `<option value=\"${i.Id}\">${i.Name}</option>`;\n            });\n\n            select.innerHTML = html;\n            select.value = '';\n            triggerChange(select);\n\n            loading.hide();\n        });\n    }\n\n    function getEditorHtml() {\n        let html = '';\n\n        html += '<div class=\"formDialogContent smoothScrollY\" style=\"padding-top:2em;\">';\n        html += '<div class=\"dialogContentInner dialog-content-centered\">';\n        html += '<form class=\"newCollectionForm\" style=\"margin:auto;\">';\n\n        html += '<div>';\n        html += globalize.translate('NewCollectionHelp');\n        html += '</div>';\n\n        html += '<div class=\"fldSelectCollection\">';\n        html += '<br/>';\n        html += '<br/>';\n        html += '<div class=\"selectContainer\">';\n        html += `<select is=\"emby-select\" label=\"${globalize.translate('LabelCollection')}\" id=\"selectCollectionToAddTo\" autofocus></select>`;\n        html += '</div>';\n        html += '</div>';\n\n        html += '<div class=\"newCollectionInfo\">';\n\n        html += '<div class=\"inputContainer\">';\n        html += `<input is=\"emby-input\" type=\"text\" id=\"txtNewCollectionName\" required=\"required\" label=\"${globalize.translate('LabelName')}\" />`;\n        html += `<div class=\"fieldDescription\">${globalize.translate('NewCollectionNameExample')}</div>`;\n        html += '</div>';\n\n        html += '<label class=\"checkboxContainer\">';\n        html += '<input is=\"emby-checkbox\" type=\"checkbox\" id=\"chkEnableInternetMetadata\" />';\n        html += `<span>${globalize.translate('SearchForCollectionInternetMetadata')}</span>`;\n        html += '</label>';\n\n        // newCollectionInfo\n        html += '</div>';\n\n        html += '<div class=\"formDialogFooter\">';\n        html += `<button is=\"emby-button\" type=\"submit\" class=\"raised btnSubmit block formDialogFooterItem button-submit\">${globalize.translate('ButtonOk')}</button>`;\n        html += '</div>';\n\n        html += '<input type=\"hidden\" class=\"fldSelectedItemIds\" />';\n\n        html += '</form>';\n        html += '</div>';\n        html += '</div>';\n\n        return html;\n    }\n\n    function initEditor(content, items) {\n        content.querySelector('#selectCollectionToAddTo').addEventListener('change', function () {\n            if (this.value) {\n                content.querySelector('.newCollectionInfo').classList.add('hide');\n                content.querySelector('#txtNewCollectionName').removeAttribute('required');\n            } else {\n                content.querySelector('.newCollectionInfo').classList.remove('hide');\n                content.querySelector('#txtNewCollectionName').setAttribute('required', 'required');\n            }\n        });\n\n        content.querySelector('form').addEventListener('submit', onSubmit);\n\n        content.querySelector('.fldSelectedItemIds', content).value = items.join(',');\n\n        if (items.length) {\n            content.querySelector('.fldSelectCollection').classList.remove('hide');\n            populateCollections(content);\n        } else {\n            content.querySelector('.fldSelectCollection').classList.add('hide');\n\n            const selectCollectionToAddTo = content.querySelector('#selectCollectionToAddTo');\n            selectCollectionToAddTo.innerHTML = '';\n            selectCollectionToAddTo.value = '';\n            triggerChange(selectCollectionToAddTo);\n        }\n    }\n\n    function centerFocus(elem, horiz, on) {\n        import('scrollHelper').then((scrollHelper) => {\n            const fn = on ? 'on' : 'off';\n            scrollHelper.centerFocus[fn](elem, horiz);\n        });\n    }\n\n    export class showEditor {\n        constructor(options) {\n            const items = options.items || {};\n            currentServerId = options.serverId;\n\n            const dialogOptions = {\n                removeOnClose: true,\n                scrollY: false\n            };\n\n            if (layoutManager.tv) {\n                dialogOptions.size = 'fullscreen';\n            } else {\n                dialogOptions.size = 'small';\n            }\n\n            const dlg = dialogHelper.createDialog(dialogOptions);\n\n            dlg.classList.add('formDialog');\n\n            let html = '';\n            const title = items.length ? globalize.translate('HeaderAddToCollection') : globalize.translate('NewCollection');\n\n            html += '<div class=\"formDialogHeader\">';\n            html += '<button is=\"paper-icon-button-light\" class=\"btnCancel autoSize\" tabindex=\"-1\"><span class=\"material-icons arrow_back\"></span></button>';\n            html += '<h3 class=\"formDialogHeaderTitle\">';\n            html += title;\n            html += '</h3>';\n\n            html += '</div>';\n\n            html += getEditorHtml();\n\n            dlg.innerHTML = html;\n\n            initEditor(dlg, items);\n\n            dlg.querySelector('.btnCancel').addEventListener('click', () => {\n                dialogHelper.close(dlg);\n            });\n\n            if (layoutManager.tv) {\n                centerFocus(dlg.querySelector('.formDialogContent'), false, true);\n            }\n\n            return dialogHelper.open(dlg).then(() => {\n                if (layoutManager.tv) {\n                    centerFocus(dlg.querySelector('.formDialogContent'), false, false);\n                }\n\n                if (dlg.submitted) {\n                    return Promise.resolve();\n                }\n\n                return Promise.reject();\n            });\n        }\n    }\n\n/* eslint-enable indent */\nexport default showEditor;\n"]}