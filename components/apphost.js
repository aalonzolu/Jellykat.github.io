define(["require","exports","appSettings","browser","events","htmlMediaHelper","webSettings","globalize"],(function(_require,_exports,_appSettings,_browser,_events,htmlMediaHelper,webSettings,_globalize){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function getBaseProfileOptions(item){var disableHlsVideoAudioCodecs=[];return item&&htmlMediaHelper.enableHlsJsPlayer(item.RunTimeTicks,item.MediaType)&&(_browser.default.edge&&disableHlsVideoAudioCodecs.push("mp3"),disableHlsVideoAudioCodecs.push("ac3"),disableHlsVideoAudioCodecs.push("eac3"),disableHlsVideoAudioCodecs.push("opus")),{enableMkvProgressive:!1,disableHlsVideoAudioCodecs:disableHlsVideoAudioCodecs}}function generateDeviceId(){var keys=[];if(keys.push(navigator.userAgent),keys.push((new Date).getTime()),window.btoa){var result=function replaceAll(originalString,strReplace,strWith){var strReplace2=function escapeRegExp(str){return str.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}(strReplace),reg=new RegExp(strReplace2,"ig");return originalString.replace(reg,strWith)}(btoa(keys.join("|")),"=","1");return Promise.resolve(result)}return Promise.resolve((new Date).getTime())}function onAppVisible(){isHidden&&(isHidden=!1,console.debug("triggering app resume event"),_events.default.trigger(appHost,"resume"))}function onAppHidden(){isHidden||(isHidden=!0,console.debug("app is hidden"))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_appSettings=_interopRequireDefault(_appSettings),_browser=_interopRequireDefault(_browser),_events=_interopRequireDefault(_events),htmlMediaHelper=_interopRequireWildcard(htmlMediaHelper),webSettings=_interopRequireWildcard(webSettings),_globalize=_interopRequireDefault(_globalize);var features,exitPromise,_deviceId,_deviceName,supportedFeatures=(features=[],navigator.share&&features.push("sharing"),_browser.default.edgeUwp||_browser.default.tv||_browser.default.xboxOne||_browser.default.ps4||features.push("filedownload"),_browser.default.operaTv||_browser.default.tizen||_browser.default.orsay||_browser.default.web0s?features.push("exit"):(features.push("exitmenu"),features.push("plugins")),_browser.default.operaTv||_browser.default.tizen||_browser.default.orsay||_browser.default.web0s||_browser.default.ps4||(features.push("externallinks"),features.push("externalpremium")),_browser.default.operaTv||features.push("externallinkdisplay"),function supportsVoiceInput(){return!_browser.default.tv&&(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.oSpeechRecognition||window.msSpeechRecognition)}()&&features.push("voiceinput"),function supportsHtmlMediaAutoplay(){return!!(_browser.default.edgeUwp||_browser.default.tizen||_browser.default.web0s||_browser.default.orsay||_browser.default.operaTv||_browser.default.ps4||_browser.default.xboxOne)||!_browser.default.mobile}()&&(features.push("htmlaudioautoplay"),features.push("htmlvideoautoplay")),_browser.default.edgeUwp&&features.push("sync"),function supportsFullscreen(){if(_browser.default.tv)return!1;var element=document.documentElement;return element.requestFullscreen||element.mozRequestFullScreen||element.webkitRequestFullscreen||element.msRequestFullscreen||document.createElement("video").webkitEnterFullscreen}()&&features.push("fullscreenchange"),(_browser.default.tv||_browser.default.xboxOne||_browser.default.ps4||_browser.default.mobile)&&features.push("physicalvolumecontrol"),_browser.default.tv||_browser.default.xboxOne||_browser.default.ps4||features.push("remotecontrol"),_browser.default.operaTv||_browser.default.tizen||_browser.default.orsay||_browser.default.web0s||_browser.default.edgeUwp||features.push("remotevideo"),features.push("displaylanguage"),features.push("otherapppromotions"),features.push("displaymode"),features.push("targetblank"),features.push("screensaver"),webSettings.getMultiServer().then((function(enabled){enabled&&features.push("multiserver")})),!_browser.default.orsay&&(_browser.default.firefox||_browser.default.ps4||_browser.default.edge||function supportsCue(){try{var video=document.createElement("video"),style=document.createElement("style");style.textContent="video::cue {background: inherit}",document.body.appendChild(style),document.body.appendChild(video);var cue=window.getComputedStyle(video,"::cue").background;return document.body.removeChild(style),document.body.removeChild(video),!!cue.length}catch(err){return console.error("error detecting cue support: "+err),!1}}())&&features.push("subtitleappearancesettings"),_browser.default.orsay||features.push("subtitleburnsettings"),_browser.default.tv||_browser.default.ps4||_browser.default.xboxOne||features.push("fileinput"),(_browser.default.chrome||_browser.default.edgeChromium)&&features.push("chromecast"),features);function doExit(){try{window.NativeShell?window.NativeShell.AppHost.exit():_browser.default.tizen?tizen.application.getCurrentApplication().exit():_browser.default.web0s?webOS.platformBack():window.close()}catch(err){console.error("error closing application: "+err)}}var hidden,visibilityChange,appHost={getWindowState:function getWindowState(){return document.windowState||"Normal"},setWindowState:function setWindowState(){alert("setWindowState is not supported and should not be called")},exit:function exit(){window.appMode&&_browser.default.tizen?function askForExit(){exitPromise||new Promise((function(_resolve,_reject){return _require(["actionsheet"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){var actionsheet=_ref2.default;exitPromise=actionsheet.show({title:_globalize.default.translate("MessageConfirmAppExit"),items:[{id:"yes",name:_globalize.default.translate("Yes")},{id:"no",name:_globalize.default.translate("No")}]}).then((function(value){"yes"===value&&doExit()})).finally((function(){exitPromise=null}))}))}():doExit()},supports:function supports(command){return window.NativeShell?window.NativeShell.AppHost.supports(command):-1!==supportedFeatures.indexOf(command.toLowerCase())},preferVisualCards:_browser.default.android||_browser.default.chrome,getDefaultLayout:function getDefaultLayout(){return window.NativeShell?window.NativeShell.AppHost.getDefaultLayout():"desktop"},getDeviceProfile:function getDeviceProfile(item){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(resolve){new Promise((function(_resolve,_reject){return _require(["browserdeviceprofile"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){var profile,profileBuilder=_ref.default;if(window.NativeShell)profile=window.NativeShell.AppHost.getDeviceProfile(profileBuilder);else{var builderOpts=getBaseProfileOptions(item);builderOpts.enableSsaRender=item&&!options.isRetry&&"allcomplexformats"!==_appSettings.default.get("subtitleburnin"),profile=profileBuilder(builderOpts)}resolve(profile)}))}))},init:function init(){if(window.NativeShell)return window.NativeShell.AppHost.init();_deviceName=function getDeviceName(){var deviceName;return deviceName=_browser.default.tizen?"Samsung Smart TV":_browser.default.web0s?"LG Smart TV":_browser.default.operaTv?"Opera TV":_browser.default.xboxOne?"Xbox One":_browser.default.ps4?"Sony PS4":_browser.default.chrome?"Chrome":_browser.default.edgeChromium?"Edge Chromium":_browser.default.edge?"Edge":_browser.default.firefox?"Firefox":_browser.default.opera?"Opera":_browser.default.safari?"Safari":"Web Browser",_browser.default.ipad?deviceName+=" iPad":_browser.default.iphone?deviceName+=" iPhone":_browser.default.android&&(deviceName+=" Android"),deviceName}(),function getDeviceId(){var key="_deviceId2",deviceId=_appSettings.default.get(key);return deviceId?Promise.resolve(deviceId):generateDeviceId().then((function(deviceId){return _appSettings.default.set(key,deviceId),deviceId}))}().then((function(id){_deviceId=id}))},deviceName:function deviceName(){return window.NativeShell?window.NativeShell.AppHost.deviceName():_deviceName},deviceId:function deviceId(){return window.NativeShell?window.NativeShell.AppHost.deviceId():_deviceId},appName:function appName(){return window.NativeShell?window.NativeShell.AppHost.appName():"Jellyfin Web"},appVersion:function appVersion(){return window.NativeShell?window.NativeShell.AppHost.appVersion():"10.7.0"},getPushTokenInfo:function getPushTokenInfo(){return{}},setUserScalable:function setUserScalable(scalable){if(!_browser.default.tv){var att=scalable?"width=device-width, initial-scale=1, minimum-scale=1, user-scalable=yes":"width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no";document.querySelector("meta[name=viewport]").setAttribute("content",att)}}},isHidden=!1;void 0!==document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):void 0!==document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange"),document.addEventListener(visibilityChange,(function(){document[hidden]?onAppHidden():onAppVisible()}),!1),window.addEventListener&&(window.addEventListener("focus",onAppVisible),window.addEventListener("blur",onAppHidden));var _default=appHost;_exports.default=_default}));
//# sourceMappingURL=apphost.js.map
