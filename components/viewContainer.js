define(["require","exports","css!components/viewManager/viewContainer"],(function(_require,_exports,_viewContainer){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function setControllerClass(view,options){if(options.controllerFactory)return Promise.resolve();var controllerUrl=view.getAttribute("data-controller");return controllerUrl?(0===controllerUrl.indexOf("__plugin/")&&(controllerUrl=controllerUrl.substring("__plugin/".length)),controllerUrl=Dashboard.getConfigurationResourceUrl(controllerUrl),new Promise((function(_resolve,_reject){return _require(["".concat(controllerUrl)],(function(imported){return _resolve(function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}(imported))}),_reject)})).then((function(ControllerFactory){options.controllerFactory=ControllerFactory}))):Promise.resolve()}function loadView(options){if(!options.cancel){var selected=selectedPageIndex,previousAnimatable=-1===selected?null:allPages[selected],pageIndex=selected+1;pageIndex>=pageContainerCount&&(pageIndex=0);var isPluginpage=-1!==options.url.toLowerCase().indexOf("/configurationpage"),newViewInfo=function normalizeNewView(options,isPluginpage){var viewHtml=options.view;if(-1===viewHtml.indexOf('data-role="page"'))return viewHtml;var hasScript=-1!==viewHtml.indexOf("<script"),elem=function parseHtml(html,hasScript){hasScript&&(html=replaceAll(html,"\x3c!--<script","<script"),html=replaceAll(html,"<\/script>--\x3e","<\/script>"));var wrapper=document.createElement("div");return wrapper.innerHTML=html,wrapper.querySelector('div[data-role="page"]')}(viewHtml,hasScript);hasScript&&(hasScript=null!=elem.querySelector("script"));var hasjQuery=!1,hasjQuerySelect=!1,hasjQueryChecked=!1;isPluginpage&&(hasjQuery=-1!=viewHtml.indexOf("jQuery")||-1!=viewHtml.indexOf("$(")||-1!=viewHtml.indexOf("$."),hasjQueryChecked=-1!=viewHtml.indexOf(".checked("),hasjQuerySelect=-1!=viewHtml.indexOf(".selectmenu("));return{elem:elem,hasScript:hasScript,hasjQuerySelect:hasjQuerySelect,hasjQueryChecked:hasjQueryChecked,hasjQuery:hasjQuery}}(options,isPluginpage),newView=newViewInfo.elem;return new Promise((function(resolve){var currentPage=allPages[pageIndex];currentPage&&function triggerDestroy(view){view.dispatchEvent(new CustomEvent("viewdestroy",{}))}(currentPage);var view=newView;"string"==typeof view&&((view=document.createElement("div")).innerHTML=newView),view.classList.add("mainAnimatedPage"),currentPage?newViewInfo.hasScript&&window.$?(mainAnimatedPages.removeChild(currentPage),view=$(view).appendTo(mainAnimatedPages)[0]):mainAnimatedPages.replaceChild(view,currentPage):newViewInfo.hasScript&&window.$?view=$(view).appendTo(mainAnimatedPages)[0]:mainAnimatedPages.appendChild(view),options.type&&view.setAttribute("data-type",options.type);var properties=[];options.fullscreen&&properties.push("fullscreen"),properties.length&&view.setAttribute("data-properties",properties.join(",")),allPages[pageIndex]=view,setControllerClass(view,options).then((function(){onBeforeChange&&onBeforeChange(view,!1,options),beforeAnimate(allPages,pageIndex,selected),selectedPageIndex=pageIndex,currentUrls[pageIndex]=options.url,!options.cancel&&previousAnimatable&&afterAnimate(allPages,pageIndex),window.$&&($.mobile=$.mobile||{},$.mobile.activePage=view),resolve(view)}))}))}}function replaceAll(str,find,replace){return str.split(find).join(replace)}function beforeAnimate(allPages,newPageIndex,oldPageIndex){for(var index=0,length=allPages.length;index<length;index++)newPageIndex!==index&&oldPageIndex!==index&&allPages[index].classList.add("hide")}function afterAnimate(allPages,newPageIndex){for(var index=0,length=allPages.length;index<length;index++)newPageIndex!==index&&allPages[index].classList.add("hide")}function setOnBeforeChange(fn){onBeforeChange=fn}function tryRestoreView(options){var url=options.url,index=currentUrls.indexOf(url);if(-1!==index){var animatable=allPages[index],view=animatable;if(view){if(options.cancel)return;var selected=selectedPageIndex,previousAnimatable=-1===selected?null:allPages[selected];return setControllerClass(view,options).then((function(){return onBeforeChange&&onBeforeChange(view,!0,options),beforeAnimate(allPages,index,selected),animatable.classList.remove("hide"),selectedPageIndex=index,!options.cancel&&previousAnimatable&&afterAnimate(allPages,index),window.$&&($.mobile=$.mobile||{},$.mobile.activePage=view),view}))}}return Promise.reject()}function reset(){allPages=[],currentUrls=[],mainAnimatedPages.innerHTML="",selectedPageIndex=-1}var onBeforeChange;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.loadView=loadView,_exports.setOnBeforeChange=setOnBeforeChange,_exports.tryRestoreView=tryRestoreView,_exports.reset=reset,_exports.default=void 0;var mainAnimatedPages=document.querySelector(".mainAnimatedPages"),allPages=[],currentUrls=[],pageContainerCount=3,selectedPageIndex=-1;reset(),mainAnimatedPages.classList.remove("hide");var _default={loadView:loadView,tryRestoreView:tryRestoreView,reset:reset,setOnBeforeChange:setOnBeforeChange};_exports.default=_default}));
//# sourceMappingURL=viewContainer.js.map
