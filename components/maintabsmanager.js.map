{"version":3,"sources":["components/maintabsmanager.js"],"names":["define","_require","_exports","_dom","_browser","_events","_embyTabs","_embyButton","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","tabOwnerView","Object","defineProperty","value","setTabs","view","selectedIndex","getTabsFn","getTabContainersFn","onBeforeTabChange","onTabChange","setSelectedIndex","headerTabsContainer","queryScope","querySelector","ensureElements","document","body","classList","remove","innerHTML","add","tabsContainer","replaced","tabsContainerElem","index","tabsHtml","map","t","tabHtml","tabClass","enabled","cssClass","href","name","join","window","CustomElements","upgradeSubtree","tabsElem","configureSwipeTabs","browser","touch","onSwipeLeft","e","target","allowSwipe","contains","selectNext","onSwipeRight","selectPrevious","Promise","_resolve","_reject","imported","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","then","_ref","touchHelper","TouchHelper","parentNode","events","on","addEventListener","destroy","tabContainers","detail","previousIndex","previousPanel","newPanel","selectedTabIndex","readySelectedIndex","onViewTabsReady","tabs","triggerTabChange","getTabsElement","this","allowSwipeOn","elem","dom","parentWithTag","parent"],"mappings":"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","file":"maintabsmanager.js","sourcesContent":["import dom from 'dom';\nimport browser from 'browser';\nimport events from 'events';\nimport 'emby-tabs';\nimport 'emby-button';\n\n/* eslint-disable indent */\n\n    let tabOwnerView;\n    const queryScope = document.querySelector('.skinHeader');\n    let headerTabsContainer;\n    let tabsElem;\n\n    function ensureElements() {\n        if (!headerTabsContainer) {\n            headerTabsContainer = queryScope.querySelector('.headerTabs');\n        }\n    }\n\n    function onViewTabsReady() {\n        this.selectedIndex(this.readySelectedIndex);\n        this.readySelectedIndex = null;\n    }\n\n    function allowSwipe(target) {\n        function allowSwipeOn(elem) {\n            if (dom.parentWithTag(elem, 'input')) {\n                return false;\n            }\n\n            const classList = elem.classList;\n            if (classList) {\n                return !classList.contains('scrollX') && !classList.contains('animatedScrollX');\n            }\n\n            return true;\n        }\n\n        let parent = target;\n        while (parent != null) {\n            if (!allowSwipeOn(parent)) {\n                return false;\n            }\n            parent = parent.parentNode;\n        }\n\n        return true;\n    }\n\n    function configureSwipeTabs(view, tabsElem, getTabContainersFn) {\n        if (!browser.touch) {\n            return;\n        }\n\n        // implement without hammer\n        const onSwipeLeft = function (e, target) {\n            if (allowSwipe(target) && view.contains(target)) {\n                tabsElem.selectNext();\n            }\n        };\n\n        const onSwipeRight = function (e, target) {\n            if (allowSwipe(target) && view.contains(target)) {\n                tabsElem.selectPrevious();\n            }\n        };\n\n        import('touchHelper').then(({default: TouchHelper}) => {\n            const touchHelper = new TouchHelper(view.parentNode.parentNode);\n\n            events.on(touchHelper, 'swipeleft', onSwipeLeft);\n            events.on(touchHelper, 'swiperight', onSwipeRight);\n\n            view.addEventListener('viewdestroy', function () {\n                touchHelper.destroy();\n            });\n        });\n    }\n\n    export function setTabs(view, selectedIndex, getTabsFn, getTabContainersFn, onBeforeTabChange, onTabChange, setSelectedIndex) {\n        if (!view) {\n            if (tabOwnerView) {\n                if (!headerTabsContainer) {\n                    headerTabsContainer = queryScope.querySelector('.headerTabs');\n                }\n\n                ensureElements();\n\n                document.body.classList.remove('withSectionTabs');\n\n                headerTabsContainer.innerHTML = '';\n                headerTabsContainer.classList.add('hide');\n\n                tabOwnerView = null;\n            }\n            return {\n                tabsContainer: headerTabsContainer,\n                replaced: false\n            };\n        }\n\n        ensureElements();\n\n        const tabsContainerElem = headerTabsContainer;\n\n        if (!tabOwnerView) {\n            tabsContainerElem.classList.remove('hide');\n        }\n\n        if (tabOwnerView !== view) {\n            let index = 0;\n\n            const indexAttribute = selectedIndex == null ? '' : (' data-index=\"' + selectedIndex + '\"');\n            const tabsHtml = '<div is=\"emby-tabs\"' + indexAttribute + ' class=\"tabs-viewmenubar\"><div class=\"emby-tabs-slider\" style=\"white-space:nowrap;\">' + getTabsFn().map(function (t) {\n                let tabClass = 'emby-tab-button';\n\n                if (t.enabled === false) {\n                    tabClass += ' hide';\n                }\n\n                let tabHtml;\n\n                if (t.cssClass) {\n                    tabClass += ' ' + t.cssClass;\n                }\n\n                if (t.href) {\n                    tabHtml = '<a href=\"' + t.href + '\" is=\"emby-linkbutton\" class=\"' + tabClass + '\" data-index=\"' + index + '\"><div class=\"emby-button-foreground\">' + t.name + '</div></a>';\n                } else {\n                    tabHtml = '<button type=\"button\" is=\"emby-button\" class=\"' + tabClass + '\" data-index=\"' + index + '\"><div class=\"emby-button-foreground\">' + t.name + '</div></button>';\n                }\n\n                index++;\n                return tabHtml;\n            }).join('') + '</div></div>';\n\n            tabsContainerElem.innerHTML = tabsHtml;\n            window.CustomElements.upgradeSubtree(tabsContainerElem);\n\n            document.body.classList.add('withSectionTabs');\n            tabOwnerView = view;\n\n            tabsElem = tabsContainerElem.querySelector('[is=\"emby-tabs\"]');\n\n            configureSwipeTabs(view, tabsElem, getTabContainersFn);\n\n            tabsElem.addEventListener('beforetabchange', function (e) {\n                const tabContainers = getTabContainersFn();\n                if (e.detail.previousIndex != null) {\n                    const previousPanel = tabContainers[e.detail.previousIndex];\n                    if (previousPanel) {\n                        previousPanel.classList.remove('is-active');\n                    }\n                }\n\n                const newPanel = tabContainers[e.detail.selectedTabIndex];\n\n                if (newPanel) {\n                    newPanel.classList.add('is-active');\n                }\n            });\n\n            if (onBeforeTabChange) {\n                tabsElem.addEventListener('beforetabchange', onBeforeTabChange);\n            }\n            if (onTabChange) {\n                tabsElem.addEventListener('tabchange', onTabChange);\n            }\n\n            if (setSelectedIndex !== false) {\n                if (tabsElem.selectedIndex) {\n                    tabsElem.selectedIndex(selectedIndex);\n                } else {\n                    tabsElem.readySelectedIndex = selectedIndex;\n                    tabsElem.addEventListener('ready', onViewTabsReady);\n                }\n            }\n\n            return {\n                tabsContainer: tabsContainerElem,\n                tabs: tabsContainerElem.querySelector('[is=\"emby-tabs\"]'),\n                replaced: true\n            };\n        }\n\n        if (!tabsElem) {\n            tabsElem = tabsContainerElem.querySelector('[is=\"emby-tabs\"]');\n        }\n\n        tabsElem.selectedIndex(selectedIndex);\n\n        tabOwnerView = view;\n        return {\n            tabsContainer: tabsContainerElem,\n            tabs: tabsElem,\n            replaced: false\n        };\n    }\n\n    export function selectedTabIndex(index) {\n        const tabsContainerElem = headerTabsContainer;\n\n        if (!tabsElem) {\n            tabsElem = tabsContainerElem.querySelector('[is=\"emby-tabs\"]');\n        }\n\n        if (index != null) {\n            tabsElem.selectedIndex(index);\n        } else {\n            tabsElem.triggerTabChange();\n        }\n    }\n\n    export function getTabsElement() {\n        return document.querySelector('.tabs-viewmenubar');\n    }\n\n/* eslint-enable indent */\n"]}