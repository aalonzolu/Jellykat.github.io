define(["require","exports","dialogHelper","connectionManager","dom","loading","scrollHelper","layoutManager","globalize","emby-button","emby-select","formDialogStyle","css!./style"],(function(_require,_exports,_dialogHelper,_connectionManager,_dom,_loading,_scrollHelper,_layoutManager,_globalize,_embyButton,_embySelect,_formDialogStyle,_style){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}var currentItemId,currentServerId,currentFile;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.show=show,_exports.default=void 0,_dialogHelper=_interopRequireDefault(_dialogHelper),_connectionManager=_interopRequireDefault(_connectionManager),_dom=_interopRequireDefault(_dom),_loading=_interopRequireDefault(_loading),_scrollHelper=_interopRequireDefault(_scrollHelper),_layoutManager=_interopRequireDefault(_layoutManager),_globalize=_interopRequireDefault(_globalize);var hasChanges=!1;function onFileReaderError(evt){switch(_loading.default.hide(),evt.target.error.code){case evt.target.error.NOT_FOUND_ERR:new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(_globalize.default.translate("MessageFileReadError"))}));break;case evt.target.error.ABORT_ERR:break;default:new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){(0,_ref2.default)(_globalize.default.translate("MessageFileReadError"))}))}}function onSubmit(e){var file=currentFile;if(!file)return!1;if(!file.type.startsWith("image/"))return new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){(0,_ref3.default)(_globalize.default.translate("MessageImageFileTypeAllowed"))})),e.preventDefault(),!1;_loading.default.show();var dlg=_dom.default.parentWithClass(this,"dialog"),imageType=dlg.querySelector("#selectImageType").value;return"None"===imageType?(new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref4){(0,_ref4.default)(_globalize.default.translate("MessageImageTypeNotSelected"))})),e.preventDefault(),!1):(_connectionManager.default.getApiClient(currentServerId).uploadItemImage(currentItemId,imageType,file).then((function(){dlg.querySelector("#uploadImage").value="",_loading.default.hide(),hasChanges=!0,_dialogHelper.default.close(dlg)})),e.preventDefault(),!1)}function initEditor(page){page.querySelector("form").addEventListener("submit",onSubmit),page.querySelector("#uploadImage").addEventListener("change",(function(){!function setFiles(page,files){var file=files[0];if(!file||!file.type.match("image.*"))return page.querySelector("#imageOutput").innerHTML="",page.querySelector("#fldUpload").classList.add("hide"),void(currentFile=null);currentFile=file;var theFile,reader=new FileReader;reader.onerror=onFileReaderError,reader.onloadstart=function(){page.querySelector("#fldUpload").classList.add("hide")},reader.onabort=function(){_loading.default.hide(),console.debug("File read cancelled")},reader.onload=(theFile=file,function(e){var html=['<img style="max-width:100%;max-height:100%;" src="',e.target.result,'" title="',escape(theFile.name),'"/>'].join("");page.querySelector("#imageOutput").innerHTML=html,page.querySelector("#dropImageText").classList.add("hide"),page.querySelector("#fldUpload").classList.remove("hide")}),reader.readAsDataURL(file)}(page,this.files)})),page.querySelector(".btnBrowse").addEventListener("click",(function(){page.querySelector("#uploadImage").click()}))}function show(options){return new Promise((function(resolve){hasChanges=!1,function showEditor(options,resolve){return options=options||{},new Promise((function(_resolve,_reject){return _require(["text!./imageUploader.template.html"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref5){var template=_ref5.default;currentItemId=options.itemId,currentServerId=options.serverId;var dialogOptions={removeOnClose:!0};_layoutManager.default.tv?dialogOptions.size="fullscreen":dialogOptions.size="small";var dlg=_dialogHelper.default.createDialog(dialogOptions);dlg.classList.add("formDialog"),dlg.innerHTML=_globalize.default.translateHtml(template,"core"),_layoutManager.default.tv&&_scrollHelper.default.centerFocus.on(dlg,!1),dlg.addEventListener("close",(function(){_layoutManager.default.tv&&_scrollHelper.default.centerFocus.off(dlg,!1),_loading.default.hide(),resolve(hasChanges)})),_dialogHelper.default.open(dlg),initEditor(dlg),dlg.querySelector("#selectImageType").value=options.imageType||"Primary",dlg.querySelector(".btnCancel").addEventListener("click",(function(){_dialogHelper.default.close(dlg)}))}))}(options,resolve)}))}var _default={show:show};_exports.default=_default}));
//# sourceMappingURL=imageUploader.js.map
