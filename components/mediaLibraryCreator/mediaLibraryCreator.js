define(["require","exports","loading","dialogHelper","dom","jQuery","components/libraryoptionseditor/libraryoptionseditor","globalize","emby-toggle","emby-input","emby-select","paper-icon-button-light","listViewStyle","formDialogStyle","emby-button","flexStyles"],(function(_require,_exports,_loading,_dialogHelper,_dom,_jQuery,_libraryoptionseditor,_globalize,_embyToggle,_embyInput,_embySelect,_paperIconButtonLight,_listViewStyle,_formDialogStyle,_embyButton,_flexStyles){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function onAddLibrary(){if(isCreating)return!1;if(0==pathInfos.length)return new Promise((function(_resolve,_reject){return _require(["alert"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)({text:_globalize.default.translate("PleaseAddAtLeastOneFolder"),type:"error"})})),!1;isCreating=!0,_loading.default.show();var dlg=_dom.default.parentWithClass(this,"dlg-librarycreator"),name=(0,_jQuery.default)("#txtValue",dlg).val(),type=(0,_jQuery.default)("#selectCollectionType",dlg).val();"mixed"==type&&(type=null);var libraryOptions=_libraryoptionseditor.default.getLibraryOptions(dlg.querySelector(".libraryOptions"));return libraryOptions.PathInfos=pathInfos,ApiClient.addVirtualFolder(name,type,currentOptions.refresh,libraryOptions).then((function(){hasChanges=!0,isCreating=!1,_loading.default.hide(),_dialogHelper.default.close(dlg)}),(function(){new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){(0,_ref2.default)(_globalize.default.translate("ErrorAddingMediaPathToVirtualFolder"))})),isCreating=!1,_loading.default.hide()})),!1}function onToggleAdvancedChange(){var dlg=_dom.default.parentWithClass(this,"dlg-librarycreator");_libraryoptionseditor.default.setAdvancedVisible(dlg.querySelector(".libraryOptions"),this.checked)}function onAddButtonClick(){var page=_dom.default.parentWithClass(this,"dlg-librarycreator");new Promise((function(_resolve,_reject){return _require(["directorybrowser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){var picker=new(0,_ref3.default);picker.show({enableNetworkSharePath:!0,callback:function callback(path,networkSharePath){path&&function addMediaLocation(page,path,networkSharePath){var pathLower=path.toLowerCase();if(!pathInfos.filter((function(p){return p.Path.toLowerCase()==pathLower})).length){var pathInfo={Path:path};networkSharePath&&(pathInfo.NetworkPath=networkSharePath),pathInfos.push(pathInfo),renderPaths(page)}}(page,path,networkSharePath),picker.close()}})}))}function getFolderHtml(pathInfo,index){var html="";return html+='<div class="listItem listItem-border lnkPath" style="padding-left:.5em;">',html+='<div class="'.concat(pathInfo.NetworkPath?"listItemBody two-line":"listItemBody",'">'),html+='<div class="listItemBodyText">'.concat(pathInfo.Path,"</div>"),pathInfo.NetworkPath&&(html+='<div class="listItemBodyText secondary">'.concat(pathInfo.NetworkPath,"</div>")),html+="</div>",html+='<button type="button" is="paper-icon-button-light"" class="listItemButton btnRemovePath" data-index="'.concat(index,'"><span class="material-icons remove_circle"></span></button>'),html+="</div>"}function renderPaths(page){var foldersHtml=pathInfos.map(getFolderHtml).join(""),folderList=page.querySelector(".folderList");folderList.innerHTML=foldersHtml,foldersHtml?folderList.classList.remove("hide"):folderList.classList.add("hide")}function onRemoveClick(e){var button=_dom.default.parentWithClass(e.target,"btnRemovePath"),index=parseInt(button.getAttribute("data-index")),locationLower=pathInfos[index].Path.toLowerCase();pathInfos=pathInfos.filter((function(p){return p.Path.toLowerCase()!=locationLower})),renderPaths(_dom.default.parentWithClass(button,"dlg-librarycreator"))}function onDialogClosed(){currentResolve(hasChanges)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=_exports.showEditor=void 0,_loading=_interopRequireDefault(_loading),_dialogHelper=_interopRequireDefault(_dialogHelper),_dom=_interopRequireDefault(_dom),_jQuery=_interopRequireDefault(_jQuery),_libraryoptionseditor=_interopRequireDefault(_libraryoptionseditor),_globalize=_interopRequireDefault(_globalize);var showEditor=function showEditor(options){return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,showEditor),new Promise((function(resolve){currentOptions=options,currentResolve=resolve,hasChanges=!1,new Promise((function(_resolve,_reject){return _require(["text!./components/mediaLibraryCreator/mediaLibraryCreator.template.html"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref4){var template=_ref4.default,dlg=_dialogHelper.default.createDialog({size:"small",modal:!1,removeOnClose:!0,scrollY:!1});dlg.classList.add("ui-body-a"),dlg.classList.add("background-theme-a"),dlg.classList.add("dlg-librarycreator"),dlg.classList.add("formDialog"),dlg.innerHTML=_globalize.default.translateHtml(template),function initEditor(page,collectionTypeOptions){(0,_jQuery.default)("#selectCollectionType",page).html(function getCollectionTypeOptionsHtml(collectionTypeOptions){return collectionTypeOptions.map((function(i){return'<option value="'.concat(i.value,'">').concat(i.name,"</option>")})).join("")}(collectionTypeOptions)).val("").on("change",(function(){var value=this.value,dlg=(0,_jQuery.default)(this).parents(".dialog")[0];if(_libraryoptionseditor.default.setContentType(dlg.querySelector(".libraryOptions"),"mixed"==value?"":value),value?dlg.querySelector(".libraryOptions").classList.remove("hide"):dlg.querySelector(".libraryOptions").classList.add("hide"),"mixed"!=value){var index=this.selectedIndex;if(-1!=index){var name=this.options[index].innerHTML.replace("*","").replace("&amp;","&");(0,_jQuery.default)("#txtValue",dlg).val(name);var folderOption=collectionTypeOptions.filter((function(i){return i.value==value}))[0];(0,_jQuery.default)(".collectionTypeFieldDescription",dlg).html(folderOption.message||"")}}})),page.querySelector(".btnAddFolder").addEventListener("click",onAddButtonClick),page.querySelector(".btnSubmit").addEventListener("click",onAddLibrary),page.querySelector(".folderList").addEventListener("click",onRemoveClick),page.querySelector(".chkAdvanced").addEventListener("change",onToggleAdvancedChange)}(dlg,options.collectionTypeOptions),dlg.addEventListener("close",onDialogClosed),_dialogHelper.default.open(dlg),dlg.querySelector(".btnCancel").addEventListener("click",(function(){_dialogHelper.default.close(dlg)})),pathInfos=[],renderPaths(dlg),function initLibraryOptions(dlg){_libraryoptionseditor.default.embed(dlg.querySelector(".libraryOptions")).then((function(){(0,_jQuery.default)("#selectCollectionType",dlg).trigger("change"),onToggleAdvancedChange.call(dlg.querySelector(".chkAdvanced"))}))}(dlg)}))}))};_exports.showEditor=showEditor;var currentResolve,currentOptions,pathInfos=[],hasChanges=!1,isCreating=!1,_default=showEditor;_exports.default=_default}));
//# sourceMappingURL=mediaLibraryCreator.js.map
