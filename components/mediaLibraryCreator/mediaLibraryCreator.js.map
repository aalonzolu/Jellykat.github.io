{"version":3,"sources":["components/mediaLibraryCreator/mediaLibraryCreator.js"],"names":["define","_require","_exports","_loading","_dialogHelper","_dom","_jQuery","_libraryoptionseditor","_globalize","_embyToggle","_embyInput","_embySelect","_paperIconButtonLight","_listViewStyle","_formDialogStyle","_embyButton","_flexStyles","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","onAddLibrary","isCreating","pathInfos","length","Promise","_resolve","_reject","imported","then","_ref","alert","text","globalize","translate","type","loading","show","dlg","dom","parentWithClass","this","name","val","libraryOptions","libraryoptionseditor","getLibraryOptions","querySelector","PathInfos","ApiClient","addVirtualFolder","currentOptions","refresh","hasChanges","hide","dialogHelper","close","_ref2","toast","onToggleAdvancedChange","setAdvancedVisible","checked","onAddButtonClick","page","_ref3","picker","directoryBrowser","enableNetworkSharePath","callback","path","networkSharePath","addMediaLocation","pathLower","toLowerCase","filter","p","Path","pathInfo","NetworkPath","push","renderPaths","getFolderHtml","index","html","concat","foldersHtml","map","join","folderList","innerHTML","classList","remove","add","onRemoveClick","e","button","target","parseInt","getAttribute","locationLower","onDialogClosed","currentResolve","value","showEditor","options","_classCallCheck","instance","Constructor","TypeError","resolve","_ref4","template","createDialog","size","modal","removeOnClose","scrollY","translateHtml","initEditor","collectionTypeOptions","getCollectionTypeOptionsHtml","i","on","parents","setContentType","selectedIndex","replace","folderOption","message","addEventListener","open","initLibraryOptions","embed","trigger","_default"],"mappings":"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","file":"mediaLibraryCreator.js","sourcesContent":["/* eslint-disable indent */\n\n/**\n * Module for media library creator.\n * @module components/mediaLibraryCreator/mediaLibraryCreator\n */\n\nimport loading from 'loading';\nimport dialogHelper from 'dialogHelper';\nimport dom from 'dom';\nimport $ from 'jQuery';\nimport libraryoptionseditor from 'components/libraryoptionseditor/libraryoptionseditor';\nimport globalize from 'globalize';\nimport 'emby-toggle';\nimport 'emby-input';\nimport 'emby-select';\nimport 'paper-icon-button-light';\nimport 'listViewStyle';\nimport 'formDialogStyle';\nimport 'emby-button';\nimport 'flexStyles';\n\n    function onAddLibrary() {\n        if (isCreating) {\n            return false;\n        }\n\n        if (pathInfos.length == 0) {\n            import('alert').then(({default: alert}) => {\n                alert({\n                    text: globalize.translate('PleaseAddAtLeastOneFolder'),\n                    type: 'error'\n                });\n            });\n\n            return false;\n        }\n\n        isCreating = true;\n        loading.show();\n        const dlg = dom.parentWithClass(this, 'dlg-librarycreator');\n        const name = $('#txtValue', dlg).val();\n        let type = $('#selectCollectionType', dlg).val();\n\n        if (type == 'mixed') {\n            type = null;\n        }\n\n        const libraryOptions = libraryoptionseditor.getLibraryOptions(dlg.querySelector('.libraryOptions'));\n        libraryOptions.PathInfos = pathInfos;\n        ApiClient.addVirtualFolder(name, type, currentOptions.refresh, libraryOptions).then(() => {\n            hasChanges = true;\n            isCreating = false;\n            loading.hide();\n            dialogHelper.close(dlg);\n        }, () => {\n            import('toast').then(({default: toast}) => {\n                toast(globalize.translate('ErrorAddingMediaPathToVirtualFolder'));\n            });\n\n            isCreating = false;\n            loading.hide();\n        });\n        return false;\n    }\n\n    function getCollectionTypeOptionsHtml(collectionTypeOptions) {\n        return collectionTypeOptions.map(i => {\n            return `<option value=\"${i.value}\">${i.name}</option>`;\n        }).join('');\n    }\n\n    function initEditor(page, collectionTypeOptions) {\n        $('#selectCollectionType', page).html(getCollectionTypeOptionsHtml(collectionTypeOptions)).val('').on('change', function () {\n            const value = this.value;\n            const dlg = $(this).parents('.dialog')[0];\n            libraryoptionseditor.setContentType(dlg.querySelector('.libraryOptions'), value == 'mixed' ? '' : value);\n\n            if (value) {\n                dlg.querySelector('.libraryOptions').classList.remove('hide');\n            } else {\n                dlg.querySelector('.libraryOptions').classList.add('hide');\n            }\n\n            if (value != 'mixed') {\n                const index = this.selectedIndex;\n\n                if (index != -1) {\n                    const name = this.options[index].innerHTML.replace('*', '').replace('&amp;', '&');\n                    $('#txtValue', dlg).val(name);\n                    const folderOption = collectionTypeOptions.filter(i => {\n                        return i.value == value;\n                    })[0];\n                    $('.collectionTypeFieldDescription', dlg).html(folderOption.message || '');\n                }\n            }\n        });\n        page.querySelector('.btnAddFolder').addEventListener('click', onAddButtonClick);\n        page.querySelector('.btnSubmit').addEventListener('click', onAddLibrary);\n        page.querySelector('.folderList').addEventListener('click', onRemoveClick);\n        page.querySelector('.chkAdvanced').addEventListener('change', onToggleAdvancedChange);\n    }\n\n    function onToggleAdvancedChange() {\n        const dlg = dom.parentWithClass(this, 'dlg-librarycreator');\n        libraryoptionseditor.setAdvancedVisible(dlg.querySelector('.libraryOptions'), this.checked);\n    }\n\n    function onAddButtonClick() {\n        const page = dom.parentWithClass(this, 'dlg-librarycreator');\n\n        import('directorybrowser').then(({default: directoryBrowser}) => {\n            const picker = new directoryBrowser();\n            picker.show({\n                enableNetworkSharePath: true,\n                callback: function (path, networkSharePath) {\n                    if (path) {\n                        addMediaLocation(page, path, networkSharePath);\n                    }\n\n                    picker.close();\n                }\n            });\n        });\n    }\n\n    function getFolderHtml(pathInfo, index) {\n        let html = '';\n        html += '<div class=\"listItem listItem-border lnkPath\" style=\"padding-left:.5em;\">';\n        html += `<div class=\"${pathInfo.NetworkPath ? 'listItemBody two-line' : 'listItemBody'}\">`;\n        html += `<div class=\"listItemBodyText\">${pathInfo.Path}</div>`;\n\n        if (pathInfo.NetworkPath) {\n            html += `<div class=\"listItemBodyText secondary\">${pathInfo.NetworkPath}</div>`;\n        }\n\n        html += '</div>';\n        html += `<button type=\"button\" is=\"paper-icon-button-light\"\" class=\"listItemButton btnRemovePath\" data-index=\"${index}\"><span class=\"material-icons remove_circle\"></span></button>`;\n        html += '</div>';\n        return html;\n    }\n\n    function renderPaths(page) {\n        const foldersHtml = pathInfos.map(getFolderHtml).join('');\n        const folderList = page.querySelector('.folderList');\n        folderList.innerHTML = foldersHtml;\n\n        if (foldersHtml) {\n            folderList.classList.remove('hide');\n        } else {\n            folderList.classList.add('hide');\n        }\n    }\n\n    function addMediaLocation(page, path, networkSharePath) {\n        const pathLower = path.toLowerCase();\n        const pathFilter = pathInfos.filter(p => {\n            return p.Path.toLowerCase() == pathLower;\n        });\n\n        if (!pathFilter.length) {\n            const pathInfo = {\n                Path: path\n            };\n\n            if (networkSharePath) {\n                pathInfo.NetworkPath = networkSharePath;\n            }\n\n            pathInfos.push(pathInfo);\n            renderPaths(page);\n        }\n    }\n\n    function onRemoveClick(e) {\n        const button = dom.parentWithClass(e.target, 'btnRemovePath');\n        const index = parseInt(button.getAttribute('data-index'));\n        const location = pathInfos[index].Path;\n        const locationLower = location.toLowerCase();\n        pathInfos = pathInfos.filter(p => {\n            return p.Path.toLowerCase() != locationLower;\n        });\n        renderPaths(dom.parentWithClass(button, 'dlg-librarycreator'));\n    }\n\n    function onDialogClosed() {\n        currentResolve(hasChanges);\n    }\n\n    function initLibraryOptions(dlg) {\n        libraryoptionseditor.embed(dlg.querySelector('.libraryOptions')).then(() => {\n            $('#selectCollectionType', dlg).trigger('change');\n            onToggleAdvancedChange.call(dlg.querySelector('.chkAdvanced'));\n        });\n    }\n\nexport class showEditor {\n    constructor(options) {\n        return new Promise((resolve) => {\n            currentOptions = options;\n            currentResolve = resolve;\n            hasChanges = false;\n            import('text!./components/mediaLibraryCreator/mediaLibraryCreator.template.html').then(({default: template}) => {\n                const dlg = dialogHelper.createDialog({\n                    size: 'small',\n                    modal: false,\n                    removeOnClose: true,\n                    scrollY: false\n                });\n                dlg.classList.add('ui-body-a');\n                dlg.classList.add('background-theme-a');\n                dlg.classList.add('dlg-librarycreator');\n                dlg.classList.add('formDialog');\n                dlg.innerHTML = globalize.translateHtml(template);\n                initEditor(dlg, options.collectionTypeOptions);\n                dlg.addEventListener('close', onDialogClosed);\n                dialogHelper.open(dlg);\n                dlg.querySelector('.btnCancel').addEventListener('click', () => {\n                    dialogHelper.close(dlg);\n                });\n                pathInfos = [];\n                renderPaths(dlg);\n                initLibraryOptions(dlg);\n            });\n        });\n    }\n}\n\n    let pathInfos = [];\n    let currentResolve;\n    let currentOptions;\n    let hasChanges = false;\n    let isCreating = false;\n\n/* eslint-enable indent */\nexport default showEditor;\n"]}