define(["exports","playbackManager","layoutManager","text!./subtitlesync.template.html","css!./subtitlesync"],(function(_exports,_playbackManager,_layoutManager,_subtitlesyncTemplate,_subtitlesync){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var player,subtitleSyncSlider,subtitleSyncTextField,subtitleSyncCloseButton,subtitleSyncContainer;function init(instance){var parent=document.createElement("div");document.body.appendChild(parent),parent.innerHTML=_subtitlesyncTemplate.default,subtitleSyncSlider=parent.querySelector(".subtitleSyncSlider"),subtitleSyncTextField=parent.querySelector(".subtitleSyncTextField"),subtitleSyncCloseButton=parent.querySelector(".subtitleSync-closeButton"),subtitleSyncContainer=parent.querySelector(".subtitleSyncContainer"),_layoutManager.default.tv&&(subtitleSyncSlider.classList.add("focusable"),setTimeout((function(){subtitleSyncSlider.enableKeyboardDragging()}),0)),subtitleSyncContainer.classList.add("hide"),subtitleSyncTextField.updateOffset=function(offset){this.textContent=offset+"s"},subtitleSyncTextField.addEventListener("click",(function(){this.hasFocus=!0})),subtitleSyncTextField.addEventListener("keydown",(function(event){if("Enter"===event.key){var inputOffset=/[-+]?\d+\.?\d*/g.exec(this.textContent);inputOffset?(inputOffset=inputOffset[0],this.textContent=inputOffset+"s",inputOffset=parseFloat(inputOffset),_playbackManager.default.setSubtitleOffset(inputOffset,player),subtitleSyncSlider.updateOffset(function getPercentageFromOffset(value){var percentValue=value/30;return percentValue*=50,percentValue+=50,Math.min(100,Math.max(0,percentValue.toFixed()))}(inputOffset))):this.textContent=(_playbackManager.default.getPlayerSubtitleOffset(player)||0)+"s",this.hasFocus=!1,event.preventDefault()}else this.hasFocus=!0,null===event.key.match(/[+-\d.s]/)&&event.preventDefault();event.stopPropagation()})),subtitleSyncTextField.blur=function(){!this.hasFocus&&this.prototype&&this.prototype.blur()},subtitleSyncSlider.updateOffset=function(percent){this.value=void 0===percent?50:percent},subtitleSyncSlider.addEventListener("change",(function(){_playbackManager.default.setSubtitleOffset(getOffsetFromPercentage(this.value),player),subtitleSyncTextField.updateOffset(getOffsetFromPercentage(this.value))})),subtitleSyncSlider.getBubbleHtml=function(value){var newOffset=getOffsetFromPercentage(value);return'<h1 class="sliderBubbleText">'+(newOffset>0?"+":"")+parseFloat(newOffset)+"s</h1>"},subtitleSyncCloseButton.addEventListener("click",(function(){_playbackManager.default.disableShowingSubtitleOffset(player),SubtitleSync.prototype.toggle("forceToHide")})),instance.element=parent}function getOffsetFromPercentage(value){var offset=(value-50)/50;return(offset*=30).toFixed(1)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_playbackManager=_interopRequireDefault(_playbackManager),_layoutManager=_interopRequireDefault(_layoutManager),_subtitlesyncTemplate=_interopRequireDefault(_subtitlesyncTemplate);var SubtitleSync=function(){function SubtitleSync(currentPlayer){!function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SubtitleSync),player=currentPlayer,init(this)}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(SubtitleSync,[{key:"destroy",value:function destroy(){SubtitleSync.prototype.toggle("forceToHide"),player&&(_playbackManager.default.disableShowingSubtitleOffset(player),_playbackManager.default.setSubtitleOffset(0,player));var elem=this.element;elem&&(elem.parentNode.removeChild(elem),this.element=null)}},{key:"toggle",value:function toggle(action){if(player&&_playbackManager.default.supportSubtitleOffset(player))switch(action){case void 0:if(_playbackManager.default.isShowingSubtitleOffsetEnabled(player)&&_playbackManager.default.canHandleOffsetOnCurrentSubtitle(player)){_playbackManager.default.getPlayerSubtitleOffset(player)||subtitleSyncTextField.hasFocus||(subtitleSyncSlider.value="50",subtitleSyncTextField.textContent="0s",_playbackManager.default.setSubtitleOffset(0,player)),subtitleSyncContainer.classList.remove("hide");break}case"hide":if(subtitleSyncTextField.hasFocus)break;case"forceToHide":subtitleSyncContainer.classList.add("hide")}}}]),SubtitleSync}(),_default=SubtitleSync;_exports.default=_default}));
//# sourceMappingURL=subtitlesync.js.map
