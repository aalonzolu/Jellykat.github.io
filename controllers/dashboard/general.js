define(["require","exports","jQuery","loading","globalize","emby-checkbox","emby-textarea","emby-input","emby-select","emby-button"],(function(_require,_exports,_jQuery,_loading,_globalize,_embyCheckbox,_embyTextarea,_embyInput,_embySelect,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function onSubmit(){_loading.default.show();var form=this;return(0,_jQuery.default)(form).parents(".page"),ApiClient.getServerConfiguration().then((function(config){config.ServerName=(0,_jQuery.default)("#txtServerName",form).val(),config.UICulture=(0,_jQuery.default)("#selectLocalizationLanguage",form).val(),config.CachePath=form.querySelector("#txtCachePath").value,config.MetadataPath=(0,_jQuery.default)("#txtMetadataPath",form).val(),config.MetadataNetworkPath=(0,_jQuery.default)("#txtMetadataNetworkPath",form).val();var requiresReload=config.UICulture!==currentLanguage;ApiClient.updateServerConfiguration(config).then((function(){ApiClient.getNamedConfiguration(brandingConfigKey).then((function(brandingConfig){brandingConfig.LoginDisclaimer=form.querySelector("#txtLoginDisclaimer").value,brandingConfig.CustomCss=form.querySelector("#txtCustomCss").value,currentBrandingOptions&&brandingConfig.CustomCss!==currentBrandingOptions.CustomCss&&(requiresReload=!0),ApiClient.updateNamedConfiguration(brandingConfigKey,brandingConfig).then((function(){Dashboard.processServerConfigurationUpdateResult(),requiresReload&&!AppInfo.isNativeApp&&window.location.reload(!0)}))}))}),(function(){new Promise((function(_resolve,_reject){return _require(["alert"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(_globalize.default.translate("ErrorDefault"))})),Dashboard.processServerConfigurationUpdateResult()}))})),!1}var currentBrandingOptions,currentLanguage;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){(0,_jQuery.default)("#btnSelectCachePath",view).on("click.selectDirectory",(function(){new Promise((function(_resolve,_reject){return _require(["directorybrowser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){var picker=new(0,_ref2.default);picker.show({callback:function callback(path){path&&(view.querySelector("#txtCachePath").value=path),picker.close()},validateWriteable:!0,header:_globalize.default.translate("HeaderSelectServerCachePath"),instruction:_globalize.default.translate("HeaderSelectServerCachePathHelp")})}))})),(0,_jQuery.default)("#btnSelectMetadataPath",view).on("click.selectDirectory",(function(){new Promise((function(_resolve,_reject){return _require(["directorybrowser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){var picker=new(0,_ref3.default);picker.show({path:(0,_jQuery.default)("#txtMetadataPath",view).val(),networkSharePath:(0,_jQuery.default)("#txtMetadataNetworkPath",view).val(),callback:function callback(path,networkPath){path&&(0,_jQuery.default)("#txtMetadataPath",view).val(path),networkPath&&(0,_jQuery.default)("#txtMetadataNetworkPath",view).val(networkPath),picker.close()},validateWriteable:!0,header:_globalize.default.translate("HeaderSelectMetadataPath"),instruction:_globalize.default.translate("HeaderSelectMetadataPathHelp"),enableNetworkSharePath:!0})}))})),(0,_jQuery.default)(".dashboardGeneralForm",view).off("submit",onSubmit).on("submit",onSubmit),view.addEventListener("viewshow",(function(){var promiseConfig=ApiClient.getServerConfiguration(),promiseLanguageOptions=ApiClient.getJSON(ApiClient.getUrl("Localization/Options")),promiseSystemInfo=ApiClient.getSystemInfo();Promise.all([promiseConfig,promiseLanguageOptions,promiseSystemInfo]).then((function(responses){!function loadPage(page,config,languageOptions,systemInfo){page.querySelector("#txtServerName").value=systemInfo.ServerName,page.querySelector("#txtCachePath").value=systemInfo.CachePath||"",(0,_jQuery.default)("#txtMetadataPath",page).val(systemInfo.InternalMetadataPath||""),(0,_jQuery.default)("#txtMetadataNetworkPath",page).val(systemInfo.MetadataNetworkPath||""),(0,_jQuery.default)("#selectLocalizationLanguage",page).html(languageOptions.map((function(language){return'<option value="'+language.Value+'">'+language.Name+"</option>"}))).val(config.UICulture),currentLanguage=config.UICulture,_loading.default.hide()}(view,responses[0],responses[1],responses[2])})),ApiClient.getNamedConfiguration(brandingConfigKey).then((function(config){currentBrandingOptions=config,view.querySelector("#txtLoginDisclaimer").value=config.LoginDisclaimer||"",view.querySelector("#txtCustomCss").value=config.CustomCss||""}))}))},_jQuery=_interopRequireDefault(_jQuery),_loading=_interopRequireDefault(_loading),_globalize=_interopRequireDefault(_globalize);var brandingConfigKey="branding"}));
//# sourceMappingURL=general.js.map
