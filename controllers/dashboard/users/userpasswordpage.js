define(["require","exports","loading","libraryMenu","globalize","emby-button"],(function(_require,_exports,_loading,_libraryMenu,_globalize,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function loadUser(page,params){var userid=params.userId;ApiClient.getUser(userid).then((function(user){Dashboard.getCurrentUser().then((function(loggedInUser){_libraryMenu.default.setTitle(user.Name),page.querySelector(".username").innerHTML=user.Name;var showPasswordSection=!0,showLocalAccessSection=!1;"Guest"==user.ConnectLinkType?(page.querySelector(".localAccessSection").classList.add("hide"),showPasswordSection=!1):user.HasConfiguredPassword?(page.querySelector("#btnResetPassword").classList.remove("hide"),page.querySelector("#fldCurrentPassword").classList.remove("hide"),showLocalAccessSection=!0):(page.querySelector("#btnResetPassword").classList.add("hide"),page.querySelector("#fldCurrentPassword").classList.add("hide")),showPasswordSection&&(loggedInUser.Policy.IsAdministrator||user.Policy.EnableUserPreferenceAccess)?page.querySelector(".passwordSection").classList.remove("hide"):page.querySelector(".passwordSection").classList.add("hide"),showLocalAccessSection&&(loggedInUser.Policy.IsAdministrator||user.Policy.EnableUserPreferenceAccess)?page.querySelector(".localAccessSection").classList.remove("hide"):page.querySelector(".localAccessSection").classList.add("hide");var txtEasyPassword=page.querySelector("#txtEasyPassword");txtEasyPassword.value="",user.HasConfiguredEasyPassword?(txtEasyPassword.placeholder="******",page.querySelector("#btnResetEasyPassword").classList.remove("hide")):(txtEasyPassword.removeAttribute("placeholder"),txtEasyPassword.placeholder="",page.querySelector("#btnResetEasyPassword").classList.add("hide")),page.querySelector(".chkEnableLocalEasyPassword").checked=user.Configuration.EnableLocalPassword,new Promise((function(_resolve,_reject){return _require(["autoFocuser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){_ref.default.autoFocus(page)}))}))})),page.querySelector("#txtCurrentPassword").value="",page.querySelector("#txtNewPassword").value="",page.querySelector("#txtNewPasswordConfirm").value=""}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){function onEasyPasswordSaved(userId){ApiClient.getUser(userId).then((function(user){user.Configuration.EnableLocalPassword=view.querySelector(".chkEnableLocalEasyPassword").checked,ApiClient.updateUserConfiguration(user.Id,user.Configuration).then((function(){_loading.default.hide(),new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){(0,_ref2.default)(_globalize.default.translate("SettingsSaved"))})),loadUser(view,params)}))}))}view.querySelector(".updatePasswordForm").addEventListener("submit",(function onSubmit(e){return this.querySelector("#txtNewPassword").value!=this.querySelector("#txtNewPasswordConfirm").value?new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref4){(0,_ref4.default)(_globalize.default.translate("PasswordMatchError"))})):(_loading.default.show(),function savePassword(){var userId=params.userId,currentPassword=view.querySelector("#txtCurrentPassword").value,newPassword=view.querySelector("#txtNewPassword").value;view.querySelector("#fldCurrentPassword").classList.contains("hide")&&(currentPassword=""),ApiClient.updateUserPassword(userId,currentPassword,newPassword).then((function(){_loading.default.hide(),new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){(0,_ref3.default)(_globalize.default.translate("PasswordSaved"))})),loadUser(view,params)}),(function(){_loading.default.hide(),Dashboard.alert({title:_globalize.default.translate("HeaderLoginFailure"),message:_globalize.default.translate("MessageInvalidUser")})}))}()),e.preventDefault(),!1})),view.querySelector(".localAccessForm").addEventListener("submit",(function onLocalAccessSubmit(e){return _loading.default.show(),function saveEasyPassword(){var userId=params.userId,easyPassword=view.querySelector("#txtEasyPassword").value;easyPassword?ApiClient.updateEasyPassword(userId,easyPassword).then((function(){onEasyPasswordSaved(userId)})):onEasyPasswordSaved(userId)}(),e.preventDefault(),!1})),view.querySelector("#btnResetEasyPassword").addEventListener("click",(function resetEasyPassword(){var msg=_globalize.default.translate("PinCodeResetConfirmation");new Promise((function(_resolve,_reject){return _require(["confirm"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref6){(0,_ref6.default)(msg,_globalize.default.translate("HeaderPinCodeReset")).then((function(){var userId=params.userId;_loading.default.show(),ApiClient.resetEasyPassword(userId).then((function(){_loading.default.hide(),Dashboard.alert({message:_globalize.default.translate("PinCodeResetComplete"),title:_globalize.default.translate("HeaderPinCodeReset")}),loadUser(view,params)}))}))}))})),view.querySelector("#btnResetPassword").addEventListener("click",(function resetPassword(){var msg=_globalize.default.translate("PasswordResetConfirmation");new Promise((function(_resolve,_reject){return _require(["confirm"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref5){(0,_ref5.default)(msg,_globalize.default.translate("HeaderResetPassword")).then((function(){var userId=params.userId;_loading.default.show(),ApiClient.resetUserPassword(userId).then((function(){_loading.default.hide(),Dashboard.alert({message:_globalize.default.translate("PasswordResetComplete"),title:_globalize.default.translate("HeaderResetPassword")}),loadUser(view,params)}))}))}))})),view.addEventListener("viewshow",(function(){loadUser(view,params)}))},_loading=_interopRequireDefault(_loading),_libraryMenu=_interopRequireDefault(_libraryMenu),_globalize=_interopRequireDefault(_globalize)}));
//# sourceMappingURL=userpasswordpage.js.map
