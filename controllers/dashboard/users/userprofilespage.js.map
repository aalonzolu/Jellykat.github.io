{"version":3,"sources":["controllers/dashboard/users/userprofilespage.js"],"names":["define","_require","_loading","_dom","_globalize","datefns","_dfnshelper","_paperIconButtonLight","_cardStyle","_embyButton","_indicators","_flexStyles","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","showUserMenu","elem","card","dom","parentWithClass","page","userId","getAttribute","menuItems","push","name","globalize","translate","id","icon","Promise","_resolve","_reject","imported","then","_ref2","show","items","positionTo","callback","Dashboard","navigate","deleteUser","msg","_ref","confirm","title","text","confirmText","primary","loading","ApiClient","loadData","getUserHtml","user","addConnectIndicator","imgUrl","html","cssClass","Policy","IsDisabled","Id","PrimaryImageTag","getUserImageUrl","width","tag","type","imageClass","Name","lastSeen","getLastSeenText","lastActivityDate","formatDistanceToNow","Date","parse","dfnshelper","localeWithSuffix","LastActivityDate","renderUsers","users","querySelector","innerHTML","getUserSectionHtml","map","u__q","join","getUsers","hide","pageIdOn","this","addEventListener","e__e","btnUserMenu","target"],"mappings":"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","file":"userprofilespage.js","sourcesContent":["import loading from 'loading';\nimport dom from 'dom';\nimport globalize from 'globalize';\nimport * as datefns from 'date-fns';\nimport dfnshelper from 'dfnshelper';\nimport 'paper-icon-button-light';\nimport 'cardStyle';\nimport 'emby-button';\nimport 'indicators';\nimport 'flexStyles';\n\n/* eslint-disable indent */\n\n    function deleteUser(page, id) {\n        const msg = globalize.translate('DeleteUserConfirmation');\n\n        import('confirm').then(({default: confirm}) => {\n            confirm({\n                title: globalize.translate('DeleteUser'),\n                text: msg,\n                confirmText: globalize.translate('Delete'),\n                primary: 'delete'\n            }).then(function () {\n                loading.show();\n                ApiClient.deleteUser(id).then(function () {\n                    loadData(page);\n                });\n            });\n        });\n    }\n\n    function showUserMenu(elem) {\n        const card = dom.parentWithClass(elem, 'card');\n        const page = dom.parentWithClass(card, 'page');\n        const userId = card.getAttribute('data-userid');\n        const menuItems = [];\n        menuItems.push({\n            name: globalize.translate('ButtonOpen'),\n            id: 'open',\n            icon: 'mode_edit'\n        });\n        menuItems.push({\n            name: globalize.translate('ButtonLibraryAccess'),\n            id: 'access',\n            icon: 'lock'\n        });\n        menuItems.push({\n            name: globalize.translate('ButtonParentalControl'),\n            id: 'parentalcontrol',\n            icon: 'person'\n        });\n        menuItems.push({\n            name: globalize.translate('Delete'),\n            id: 'delete',\n            icon: 'delete'\n        });\n\n        import('actionsheet').then(({default: actionsheet}) => {\n            actionsheet.show({\n                items: menuItems,\n                positionTo: card,\n                callback: function (id) {\n                    switch (id) {\n                        case 'open':\n                            Dashboard.navigate('useredit.html?userId=' + userId);\n                            break;\n\n                        case 'access':\n                            Dashboard.navigate('userlibraryaccess.html?userId=' + userId);\n                            break;\n\n                        case 'parentalcontrol':\n                            Dashboard.navigate('userparentalcontrol.html?userId=' + userId);\n                            break;\n\n                        case 'delete':\n                            deleteUser(page, userId);\n                    }\n                }\n            });\n        });\n    }\n\n    function getUserHtml(user, addConnectIndicator) {\n        let html = '';\n        let cssClass = 'card squareCard scalableCard squareCard-scalable';\n\n        if (user.Policy.IsDisabled) {\n            cssClass += ' grayscale';\n        }\n\n        html += \"<div data-userid='\" + user.Id + \"' class='\" + cssClass + \"'>\";\n        html += '<div class=\"cardBox visualCardBox\">';\n        html += '<div class=\"cardScalable visualCardBox-cardScalable\">';\n        html += '<div class=\"cardPadder cardPadder-square\"></div>';\n        html += '<a is=\"emby-linkbutton\" class=\"cardContent\" href=\"useredit.html?userId=' + user.Id + '\">';\n        let imgUrl;\n\n        if (user.PrimaryImageTag) {\n            imgUrl = ApiClient.getUserImageUrl(user.Id, {\n                width: 300,\n                tag: user.PrimaryImageTag,\n                type: 'Primary'\n            });\n        }\n\n        let imageClass = 'cardImage';\n\n        if (user.Policy.IsDisabled) {\n            imageClass += ' disabledUser';\n        }\n\n        if (imgUrl) {\n            html += '<div class=\"' + imageClass + '\" style=\"background-image:url(\\'' + imgUrl + \"');\\\">\";\n        } else {\n            html += '<div class=\"' + imageClass + ' flex align-items-center justify-content-center\">';\n            html += '<span class=\"material-icons cardImageIcon person\"></span>';\n        }\n\n        html += '</div>';\n        html += '</a>';\n        html += '</div>';\n        html += '<div class=\"cardFooter visualCardBox-cardFooter\">';\n        html += '<div class=\"cardText flex align-items-center\">';\n        html += '<div class=\"flex-grow\" style=\"overflow:hidden;text-overflow:ellipsis;\">';\n        html += user.Name;\n        html += '</div>';\n        html += '<button type=\"button\" is=\"paper-icon-button-light\" class=\"btnUserMenu flex-shrink-zero\"><span class=\"material-icons more_vert\"></span></button>';\n        html += '</div>';\n        html += '<div class=\"cardText cardText-secondary\">';\n        const lastSeen = getLastSeenText(user.LastActivityDate);\n        html += lastSeen != '' ? lastSeen : '&nbsp;';\n        html += '</div>';\n        html += '</div>';\n        html += '</div>';\n        return html + '</div>';\n    }\n    // FIXME: It seems that, sometimes, server sends date in the future, so date-fns displays messages like 'in less than a minute'. We should fix\n    // how dates are returned by the server when the session is active and show something like 'Active now', instead of past/future sentences\n    function getLastSeenText(lastActivityDate) {\n        if (lastActivityDate) {\n            return globalize.translate('LastSeen', datefns.formatDistanceToNow(Date.parse(lastActivityDate), dfnshelper.localeWithSuffix));\n        }\n\n        return '';\n    }\n\n    function getUserSectionHtml(users, addConnectIndicator) {\n        return users.map(function (u__q) {\n            return getUserHtml(u__q, addConnectIndicator);\n        }).join('');\n    }\n\n    function renderUsers(page, users) {\n        page.querySelector('.localUsers').innerHTML = getUserSectionHtml(users, true);\n    }\n\n    function loadData(page) {\n        loading.show();\n        ApiClient.getUsers().then(function (users) {\n            renderUsers(page, users);\n            loading.hide();\n        });\n    }\n\n    pageIdOn('pageinit', 'userProfilesPage', function () {\n        const page = this;\n        page.querySelector('.btnAddUser').addEventListener('click', function() {\n            Dashboard.navigate('usernew.html');\n        });\n        page.querySelector('.localUsers').addEventListener('click', function (e__e) {\n            const btnUserMenu = dom.parentWithClass(e__e.target, 'btnUserMenu');\n\n            if (btnUserMenu) {\n                showUserMenu(btnUserMenu);\n            }\n        });\n    });\n\n    pageIdOn('pagebeforeshow', 'userProfilesPage', function () {\n        loadData(this);\n    });\n\n/* eslint-enable indent */\n"]}