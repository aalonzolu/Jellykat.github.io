{"version":3,"sources":["controllers/dashboard/users/usernew.js"],"names":["define","_require","_jQuery","_loading","_globalize","_embyCheckbox","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","loadUser","page","val","loading","show","promiseFolders","ApiClient","getJSON","getUrl","IsHidden","promiseChannels","Promise","all","then","responses","loadMediaFolders","mediaFolders","html","globalize","translate","i","length","folder","Id","Name","trigger","prop","Items","loadChannels","channels","hide","saveUser","user","Password","createUser","Policy","EnableAllFolders","is","EnabledFolders","get","filter","checked","map","getAttribute","EnableAllChannels","EnabledChannels","updateUserPolicy","Dashboard","navigate","response","_resolve","_reject","imported","_interopRequireWildcard","has","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","_ref","toast","onSubmit","this","parents","document","on","off","loadData"],"mappings":"AAAAA,OAAO,CAAC,UAAW,SAAU,UAAW,YAAa,kBAAkB,SAAUC,SAAUC,QAASC,SAAUC,WAAYC,eACxH,aAMA,SAASC,uBAAuBC,KAAO,OAAOA,KAAOA,IAAIC,WAAaD,IAAM,CAAEE,QAASF,KAEvF,SAASG,QAAQH,KAAmV,OAAtOG,QAArD,mBAAXC,QAAoD,iBAApBA,OAAOC,SAAmC,SAASF,QAAQH,KAAO,cAAcA,KAA2B,SAASG,QAAQH,KAAO,OAAOA,KAAyB,mBAAXI,QAAyBJ,IAAIM,cAAgBF,QAAUJ,MAAQI,OAAOG,UAAY,gBAAkBP,MAAyBA,KAEnX,SAASQ,2BAA6B,GAAuB,mBAAZC,QAAwB,OAAO,KAAM,IAAIC,MAAQ,IAAID,QAA6F,OAAlFD,yBAA2B,SAASA,2BAA6B,OAAOE,OAAiBA,MAiCxM,SAASC,SAASC,OACd,EAAAjB,QAAAO,SAAE,eAAgBU,MAAMC,IAAI,KAC5B,EAAAlB,QAAAO,SAAE,eAAgBU,MAAMC,IAAI,IAC5BC,SAAAA,QAAQC,OACR,IAAMC,eAAiBC,UAAUC,QAAQD,UAAUE,OAAO,uBAAwB,CAC9EC,UAAU,KAERC,gBAAkBJ,UAAUC,QAAQD,UAAUE,OAAO,aAC3DG,QAAQC,IAAI,CAACP,eAAgBK,kBAAkBG,MAAK,SAAUC,YA7ClE,SAASC,iBAAiBd,KAAMe,cAC5B,IAAIC,KAAO,GACXA,MAAQ,iCAAmCC,WAAAA,QAAUC,UAAU,mBAAqB,QACpFF,MAAQ,iEAER,IAAK,IAAIG,EAAI,EAAGA,EAAIJ,aAAaK,OAAQD,IAAK,CAC1C,IAAME,OAASN,aAAaI,GAC5BH,MAAQ,+EAAiFK,OAAOC,GAAK,YAAcD,OAAOE,KAAO,kBAGrIP,MAAQ,UACR,EAAAjC,QAAAO,SAAE,gBAAiBU,MAAMgB,KAAKA,MAAMQ,QAAQ,WAC5C,EAAAzC,QAAAO,SAAE,uBAAwBU,MAAMyB,KAAK,WAAW,GAkC5CX,CAAiBd,KAAMa,UAAU,GAAGa,OA/B5C,SAASC,aAAa3B,KAAM4B,UACxB,IAAIZ,KAAO,GACXA,MAAQ,iCAAmCC,WAAAA,QAAUC,UAAU,YAAc,QAC7EF,MAAQ,iEAER,IAAK,IAAIG,EAAI,EAAGA,EAAIS,SAASR,OAAQD,IAAK,CACtC,IAAME,OAASO,SAAST,GACxBH,MAAQ,gFAAkFK,OAAOC,GAAK,YAAcD,OAAOE,KAAO,kBAGtIP,MAAQ,UACR,EAAAjC,QAAAO,SAAE,iBAAkBU,MAAMG,OAAOa,KAAKA,MAAMQ,QAAQ,UAEhDI,SAASR,QACT,EAAArC,QAAAO,SAAE,0BAA2BU,MAAMG,QAEnC,EAAApB,QAAAO,SAAE,0BAA2BU,MAAM6B,QAGvC,EAAA9C,QAAAO,SAAE,wBAAyBU,MAAMyB,KAAK,WAAW,GAa7CE,CAAa3B,KAAMa,UAAU,GAAGa,OAChCxB,SAAAA,QAAQ2B,UAIhB,SAASC,SAAS9B,MACd,IAAM+B,KAAO,GACbA,KAAKR,MAAO,EAAAxC,QAAAO,SAAE,eAAgBU,MAAMC,MACpC8B,KAAKC,UAAW,EAAAjD,QAAAO,SAAE,eAAgBU,MAAMC,MACxCI,UAAU4B,WAAWF,MAAMnB,MAAK,SAAUmB,MACtCA,KAAKG,OAAOC,kBAAmB,EAAApD,QAAAO,SAAE,uBAAwBU,MAAMoC,GAAG,YAClEL,KAAKG,OAAOG,eAAiB,GAExBN,KAAKG,OAAOC,mBACbJ,KAAKG,OAAOG,gBAAiB,EAAAtD,QAAAO,SAAE,aAAcU,MAAMsC,MAAMC,QAAO,SAAUpB,GACtE,OAAOA,EAAEqB,WACVC,KAAI,SAAUtB,GACb,OAAOA,EAAEuB,aAAa,eAI9BX,KAAKG,OAAOS,mBAAoB,EAAA5D,QAAAO,SAAE,wBAAyBU,MAAMoC,GAAG,YACpEL,KAAKG,OAAOU,gBAAkB,GAEzBb,KAAKG,OAAOS,oBACbZ,KAAKG,OAAOU,iBAAkB,EAAA7D,QAAAO,SAAE,cAAeU,MAAMsC,MAAMC,QAAO,SAAUpB,GACxE,OAAOA,EAAEqB,WACVC,KAAI,SAAUtB,GACb,OAAOA,EAAEuB,aAAa,eAI9BrC,UAAUwC,iBAAiBd,KAAKT,GAAIS,KAAKG,QAAQtB,MAAK,WAClDkC,UAAUC,SAAS,wBAA0BhB,KAAKT,UAEvD,SAAU0B,UACT,IAAAtC,SAAA,SAAAuC,SAAAC,SAAA,OAAApE,SAAA,CAAO,UAAP,SAAAqE,UAAA,OAAAF,SA7EV,SAASG,wBAAwBhE,KAAO,GAAIA,KAAOA,IAAIC,WAAc,OAAOD,IAAO,GAAY,OAARA,KAAiC,WAAjBG,QAAQH,MAAoC,mBAARA,IAAsB,MAAO,CAAEE,QAASF,KAAS,IAAIU,MAAQF,2BAA4B,GAAIE,OAASA,MAAMuD,IAAIjE,KAAQ,OAAOU,MAAMwC,IAAIlD,KAAQ,IAAIkE,OAAS,GAAQC,sBAAwBC,OAAOC,gBAAkBD,OAAOE,yBAA0B,IAAK,IAAIC,OAAOvE,IAAO,GAAIoE,OAAO7D,UAAUiE,eAAeC,KAAKzE,IAAKuE,KAAM,CAAE,IAAIG,KAAOP,sBAAwBC,OAAOE,yBAAyBtE,IAAKuE,KAAO,KAAUG,OAASA,KAAKxB,KAAOwB,KAAKC,KAAQP,OAAOC,eAAeH,OAAQK,IAAKG,MAAgBR,OAAOK,KAAOvE,IAAIuE,KAAyE,OAA7DL,OAAOhE,QAAUF,IAASU,OAASA,MAAMiE,IAAI3E,IAAKkE,QAAkBA,OA6EttBF,CAAAD,aAAAD,YAAgBtC,MAAK,SAAAoD,OACjBC,EADuCD,KAApB1E,SACb2B,WAAAA,QAAUC,UAAU,oBAG9BhB,SAAAA,QAAQ2B,UAIhB,SAASqC,WACL,IAAMlE,MAAO,EAAAjB,QAAAO,SAAE6E,MAAMC,QAAQ,SAAS,GAGtC,OAFAlE,SAAAA,QAAQC,OACR2B,SAAS9B,OACF,EAtGfjB,QAAAI,uBAAAJ,SACAC,SAAAG,uBAAAH,UACAC,WAAAE,uBAAAF,aA2GI,EAAAF,QAAAO,SAAE+E,UAAUC,GAAG,WAAY,gBAAgB,WACvC,IAAMtE,KAAOmE,MACb,EAAApF,QAAAO,SAAE,wBAAyBU,MAAMsE,GAAG,UAAU,WACtCH,KAAK3B,SACL,EAAAzD,QAAAO,SAAE,8BAA+BU,MAAM6B,QAEvC,EAAA9C,QAAAO,SAAE,8BAA+BU,MAAMG,WAG/C,EAAApB,QAAAO,SAAE,uBAAwBU,MAAMsE,GAAG,UAAU,WACrCH,KAAK3B,SACL,EAAAzD,QAAAO,SAAE,6BAA8BU,MAAM6B,QAEtC,EAAA9C,QAAAO,SAAE,6BAA8BU,MAAMG,WAG9C,EAAApB,QAAAO,SAAE,uBAAuBiF,IAAI,SAAUL,UAAUI,GAAG,SAAUJ,aAC/DI,GAAG,WAAY,gBAAgB,YArBlC,SAASE,SAASxE,MACdD,SAASC,MAqBTwE,CAASL","file":"usernew.js","sourcesContent":["import $ from 'jQuery';\nimport loading from 'loading';\nimport globalize from 'globalize';\nimport 'emby-checkbox';\n\n/* eslint-disable indent */\n\n    function loadMediaFolders(page, mediaFolders) {\n        let html = '';\n        html += '<h3 class=\"checkboxListLabel\">' + globalize.translate('HeaderLibraries') + '</h3>';\n        html += '<div class=\"checkboxList paperList\" style=\"padding:.5em 1em;\">';\n\n        for (let i = 0; i < mediaFolders.length; i++) {\n            const folder = mediaFolders[i];\n            html += '<label><input type=\"checkbox\" is=\"emby-checkbox\" class=\"chkFolder\" data-id=\"' + folder.Id + '\"/><span>' + folder.Name + '</span></label>';\n        }\n\n        html += '</div>';\n        $('.folderAccess', page).html(html).trigger('create');\n        $('#chkEnableAllFolders', page).prop('checked', false);\n    }\n\n    function loadChannels(page, channels) {\n        let html = '';\n        html += '<h3 class=\"checkboxListLabel\">' + globalize.translate('Channels') + '</h3>';\n        html += '<div class=\"checkboxList paperList\" style=\"padding:.5em 1em;\">';\n\n        for (let i = 0; i < channels.length; i++) {\n            const folder = channels[i];\n            html += '<label><input type=\"checkbox\" is=\"emby-checkbox\" class=\"chkChannel\" data-id=\"' + folder.Id + '\"/><span>' + folder.Name + '</span></label>';\n        }\n\n        html += '</div>';\n        $('.channelAccess', page).show().html(html).trigger('create');\n\n        if (channels.length) {\n            $('.channelAccessContainer', page).show();\n        } else {\n            $('.channelAccessContainer', page).hide();\n        }\n\n        $('#chkEnableAllChannels', page).prop('checked', false);\n    }\n\n    function loadUser(page) {\n        $('#txtUsername', page).val('');\n        $('#txtPassword', page).val('');\n        loading.show();\n        const promiseFolders = ApiClient.getJSON(ApiClient.getUrl('Library/MediaFolders', {\n            IsHidden: false\n        }));\n        const promiseChannels = ApiClient.getJSON(ApiClient.getUrl('Channels'));\n        Promise.all([promiseFolders, promiseChannels]).then(function (responses) {\n            loadMediaFolders(page, responses[0].Items);\n            loadChannels(page, responses[1].Items);\n            loading.hide();\n        });\n    }\n\n    function saveUser(page) {\n        const user = {};\n        user.Name = $('#txtUsername', page).val();\n        user.Password = $('#txtPassword', page).val();\n        ApiClient.createUser(user).then(function (user) {\n            user.Policy.EnableAllFolders = $('#chkEnableAllFolders', page).is(':checked');\n            user.Policy.EnabledFolders = [];\n\n            if (!user.Policy.EnableAllFolders) {\n                user.Policy.EnabledFolders = $('.chkFolder', page).get().filter(function (i) {\n                    return i.checked;\n                }).map(function (i) {\n                    return i.getAttribute('data-id');\n                });\n            }\n\n            user.Policy.EnableAllChannels = $('#chkEnableAllChannels', page).is(':checked');\n            user.Policy.EnabledChannels = [];\n\n            if (!user.Policy.EnableAllChannels) {\n                user.Policy.EnabledChannels = $('.chkChannel', page).get().filter(function (i) {\n                    return i.checked;\n                }).map(function (i) {\n                    return i.getAttribute('data-id');\n                });\n            }\n\n            ApiClient.updateUserPolicy(user.Id, user.Policy).then(function () {\n                Dashboard.navigate('useredit.html?userId=' + user.Id);\n            });\n        }, function (response) {\n            import('toast').then(({default: toast}) => {\n                toast(globalize.translate('ErrorDefault'));\n            });\n\n            loading.hide();\n        });\n    }\n\n    function onSubmit() {\n        const page = $(this).parents('.page')[0];\n        loading.show();\n        saveUser(page);\n        return false;\n    }\n\n    function loadData(page) {\n        loadUser(page);\n    }\n\n    $(document).on('pageinit', '#newUserPage', function () {\n        const page = this;\n        $('#chkEnableAllChannels', page).on('change', function () {\n            if (this.checked) {\n                $('.channelAccessListContainer', page).hide();\n            } else {\n                $('.channelAccessListContainer', page).show();\n            }\n        });\n        $('#chkEnableAllFolders', page).on('change', function () {\n            if (this.checked) {\n                $('.folderAccessListContainer', page).hide();\n            } else {\n                $('.folderAccessListContainer', page).show();\n            }\n        });\n        $('.newUserProfileForm').off('submit', onSubmit).on('submit', onSubmit);\n    }).on('pageshow', '#newUserPage', function () {\n        loadData(this);\n    });\n\n/* eslint-enable indent */\n"]}