define(["require","jQuery","datetime","loading","libraryMenu","globalize","listViewStyle","paper-icon-button-light"],(function(_require,_jQuery,_datetime,_loading,_libraryMenu,_globalize,_listViewStyle,_paperIconButtonLight){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function loadUser(page,user,allParentalRatings){page.querySelector(".username").innerHTML=user.Name,_libraryMenu.default.setTitle(user.Name),function loadUnratedItems(page,user){var items=[{name:_globalize.default.translate("OptionBlockBooks"),value:"Book"},{name:_globalize.default.translate("OptionBlockChannelContent"),value:"ChannelContent"},{name:_globalize.default.translate("OptionBlockLiveTvChannels"),value:"LiveTvChannel"},{name:_globalize.default.translate("OptionBlockMovies"),value:"Movie"},{name:_globalize.default.translate("OptionBlockMusic"),value:"Music"},{name:_globalize.default.translate("OptionBlockTrailers"),value:"Trailer"},{name:_globalize.default.translate("OptionBlockTvShows"),value:"Series"}],html="";html+='<h3 class="checkboxListLabel">'+_globalize.default.translate("HeaderBlockItemsWithNoRating")+"</h3>",html+='<div class="checkboxList paperList checkboxList-paperList">';for(var i=0,length=items.length;i<length;i++){var item=items[i],checkedAttribute=-1!=user.Policy.BlockUnratedItems.indexOf(item.value)?' checked="checked"':"";html+='<label><input type="checkbox" is="emby-checkbox" class="chkUnratedItem" data-itemtype="'+item.value+'" type="checkbox"'+checkedAttribute+"><span>"+item.name+"</span></label>"}html+="</div>",(0,_jQuery.default)(".blockUnratedItems",page).html(html).trigger("create")}(page,user),loadBlockedTags(page,user.Policy.BlockedTags),function populateRatings(allParentalRatings,page){var rating,html="";html+="<option value=''></option>";for(var ratings=[],i=0,length=allParentalRatings.length;i<length;i++){if(rating=allParentalRatings[i],ratings.length){var lastRating=ratings[ratings.length-1];if(lastRating.Value===rating.Value){lastRating.Name+="/"+rating.Name;continue}}ratings.push({Name:rating.Name,Value:rating.Value})}for(var _i=0,_length=ratings.length;_i<_length;_i++)html+="<option value='"+(rating=ratings[_i]).Value+"'>"+rating.Name+"</option>";(0,_jQuery.default)("#selectMaxParentalRating",page).html(html)}(allParentalRatings,page);var ratingValue="";if(user.Policy.MaxParentalRating)for(var i=0,length=allParentalRatings.length;i<length;i++){var rating=allParentalRatings[i];user.Policy.MaxParentalRating>=rating.Value&&(ratingValue=rating.Value)}(0,_jQuery.default)("#selectMaxParentalRating",page).val(ratingValue),user.Policy.IsAdministrator?(0,_jQuery.default)(".accessScheduleSection",page).hide():(0,_jQuery.default)(".accessScheduleSection",page).show(),renderAccessSchedule(page,user.Policy.AccessSchedules||[]),_loading.default.hide()}function loadBlockedTags(page,tags){var html=tags.map((function(h){var li='<div class="listItem">';return li+='<div class="listItemBody">',li+='<h3 class="listItemBodyText">',li+=h,li+="</h3>",li+="</div>",(li+='<button type="button" is="paper-icon-button-light" class="blockedTag btnDeleteTag listItemButton" data-tag="'+h+'"><span class="material-icons delete"></span></button>')+"</div>"})).join("");html&&(html='<div class="paperList">'+html+"</div>");var elem=(0,_jQuery.default)(".blockedTags",page).html(html).trigger("create");(0,_jQuery.default)(".btnDeleteTag",elem).on("click",(function(){var tag=this.getAttribute("data-tag"),newTags=tags.filter((function(t){return t!=tag}));loadBlockedTags(page,newTags)}))}function renderAccessSchedule(page,schedules){var html="",index=0;html+=schedules.map((function(a){var itemHtml="";return itemHtml+='<div class="liSchedule listItem" data-day="'+a.DayOfWeek+'" data-start="'+a.StartHour+'" data-end="'+a.EndHour+'">',itemHtml+='<div class="listItemBody two-line">',itemHtml+='<h3 class="listItemBodyText">',itemHtml+=_globalize.default.translate("Option"+a.DayOfWeek),itemHtml+="</h3>",itemHtml+='<div class="listItemBodyText secondary">'+getDisplayTime(a.StartHour)+" - "+getDisplayTime(a.EndHour)+"</div>",itemHtml+="</div>",itemHtml+='<button type="button" is="paper-icon-button-light" class="btnDelete listItemButton" data-index="'+index+'"><span class="material-icons delete"></span></button>',index++,itemHtml+="</div>"})).join("");var accessScheduleList=page.querySelector(".accessScheduleList");accessScheduleList.innerHTML=html,(0,_jQuery.default)(".btnDelete",accessScheduleList).on("click",(function(){!function deleteAccessSchedule(page,schedules,index){schedules.splice(index,1),renderAccessSchedule(page,schedules)}(page,schedules,parseInt(this.getAttribute("data-index")))}))}function saveUser(user,page){user.Policy.MaxParentalRating=(0,_jQuery.default)("#selectMaxParentalRating",page).val()||null,user.Policy.BlockUnratedItems=(0,_jQuery.default)(".chkUnratedItem",page).get().filter((function(i){return i.checked})).map((function(i){return i.getAttribute("data-itemtype")})),user.Policy.AccessSchedules=getSchedulesFromPage(page),user.Policy.BlockedTags=getBlockedTagsFromPage(page),ApiClient.updateUserPolicy(user.Id,user.Policy).then((function(){!function onSaveComplete(page){_loading.default.hide(),new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(_globalize.default.translate("SettingsSaved"))}))}()}))}function getDisplayTime(hours){var minutes=0,pct=hours%1;return pct&&(minutes=parseInt(60*pct)),_datetime.default.getDisplayTime(new Date(2e3,1,1,hours,minutes,0,0))}function getSchedulesFromPage(page){return(0,_jQuery.default)(".liSchedule",page).map((function(){return{DayOfWeek:this.getAttribute("data-day"),StartHour:this.getAttribute("data-start"),EndHour:this.getAttribute("data-end")}})).get()}function getBlockedTagsFromPage(page){return(0,_jQuery.default)(".blockedTag",page).map((function(){return this.getAttribute("data-tag")})).get()}_jQuery=_interopRequireDefault(_jQuery),_datetime=_interopRequireDefault(_datetime),_loading=_interopRequireDefault(_loading),_libraryMenu=_interopRequireDefault(_libraryMenu),_globalize=_interopRequireDefault(_globalize),window.UserParentalControlPage={onSubmit:function onSubmit(){var page=(0,_jQuery.default)(this).parents(".page");_loading.default.show();var userId=getParameterByName("userId");return ApiClient.getUser(userId).then((function(result){saveUser(result,page)})),!1}},(0,_jQuery.default)(document).on("pageinit","#userParentalControlPage",(function(){var page=this;(0,_jQuery.default)(".btnAddSchedule",page).on("click",(function(){!function showSchedulePopup(page,schedule,index){schedule=schedule||{},new Promise((function(_resolve,_reject){return _require(["components/accessSchedule/accessSchedule"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){_ref2.default.show({schedule:schedule}).then((function(updatedSchedule){var schedules=getSchedulesFromPage(page);-1==index&&(index=schedules.length),schedules[index]=updatedSchedule,renderAccessSchedule(page,schedules)}))}))}(page,{},-1)})),(0,_jQuery.default)(".btnAddBlockedTag",page).on("click",(function(){!function showBlockedTagPopup(page){new Promise((function(_resolve,_reject){return _require(["prompt"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){(0,_ref3.default)({label:_globalize.default.translate("LabelTag")}).then((function(value){var tags=getBlockedTagsFromPage(page);-1==tags.indexOf(value)&&(tags.push(value),loadBlockedTags(page,tags))}))}))}(page)})),(0,_jQuery.default)(".userParentalControlForm").off("submit",UserParentalControlPage.onSubmit).on("submit",UserParentalControlPage.onSubmit)})).on("pageshow","#userParentalControlPage",(function(){var page=this;_loading.default.show();var userId=getParameterByName("userId"),promise1=ApiClient.getUser(userId),promise2=ApiClient.getParentalRatings();Promise.all([promise1,promise2]).then((function(responses){loadUser(page,responses[0],responses[1])}))}))}));
//# sourceMappingURL=userparentalcontrol.js.map
