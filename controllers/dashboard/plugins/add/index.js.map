{"version":3,"sources":["controllers/dashboard/plugins/add/index.js"],"names":["define","_require","_exports","_jQuery","_loading","_globalize","_embyButton","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","alertText","options","Promise","_resolve","_reject","imported","then","_ref","alert","value","_default","view","params","on","loading","show","page","this","parents","name","guid","ApiClient","getInstalledPlugins","plugins","installedPlugin","filter","plugin","Name","version","val","Version","hide","Dashboard","message","globalize","translate","title","performInstallation","developer","html","toLowerCase","alertCallback","querySelector","disabled","installPlugin","catch","msg","_ref2","confirm","console","debug","addEventListener","promise1","getPackageInfo","promise2","all","responses","renderPackage","pkg","installedPlugins","ip","populateVersions","packageInfo","i","versions","length","selectmenu","packageVersion","populateHistory","Math","min","changelog","removeClass","overview","description","owner","currentVersionText"],"mappings":"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","file":"index.js","sourcesContent":["import $ from 'jQuery';\nimport loading from 'loading';\nimport globalize from 'globalize';\nimport 'emby-button';\n\nfunction populateHistory(packageInfo, page) {\n    let html = '';\n    const length = Math.min(packageInfo.versions.length, 10);\n\n    for (let i = 0; i < length; i++) {\n        const version = packageInfo.versions[i];\n        html += '<h2 style=\"margin:.5em 0;\">' + version.version + '</h2>';\n        html += '<div style=\"margin-bottom:1.5em;\">' + version.changelog + '</div>';\n    }\n\n    $('#revisionHistory', page).html(html);\n}\n\nfunction populateVersions(packageInfo, page, installedPlugin) {\n    let html = '';\n\n    for (let i = 0; i < packageInfo.versions.length; i++) {\n        const version = packageInfo.versions[i];\n        html += '<option value=\"' + version.version + '\">' + version.version + '</option>';\n    }\n\n    const selectmenu = $('#selectVersion', page).html(html);\n\n    if (!installedPlugin) {\n        $('#pCurrentVersion', page).hide().html('');\n    }\n\n    const packageVersion = packageInfo.versions[0];\n    if (packageVersion) {\n        selectmenu.val(packageVersion.version);\n    }\n}\n\nfunction renderPackage(pkg, installedPlugins, page) {\n    const installedPlugin = installedPlugins.filter(function (ip) {\n        return ip.Name == pkg.name;\n    })[0];\n\n    populateVersions(pkg, page, installedPlugin);\n    populateHistory(pkg, page);\n\n    $('.pluginName', page).html(pkg.name);\n    $('#btnInstallDiv', page).removeClass('hide');\n    $('#pSelectVersion', page).removeClass('hide');\n\n    if (pkg.overview) {\n        $('#overview', page).show().html(pkg.overview);\n    } else {\n        $('#overview', page).hide();\n    }\n\n    $('#description', page).html(pkg.description);\n    $('#developer', page).html(pkg.owner);\n\n    if (installedPlugin) {\n        const currentVersionText = globalize.translate('MessageYouHaveVersionInstalled', '<strong>' + installedPlugin.Version + '</strong>');\n        $('#pCurrentVersion', page).show().html(currentVersionText);\n    } else {\n        $('#pCurrentVersion', page).hide().html('');\n    }\n\n    loading.hide();\n}\n\nfunction alertText(options) {\n    import('alert').then(({default: alert}) => {\n        alert(options);\n    });\n}\n\nfunction performInstallation(page, name, guid, version) {\n    const developer = $('#developer', page).html().toLowerCase();\n\n    const alertCallback = function () {\n        loading.show();\n        page.querySelector('#btnInstall').disabled = true;\n        ApiClient.installPlugin(name, guid, version).then(() => {\n            loading.hide();\n            alertText(globalize.translate('MessagePluginInstalled'));\n        }).catch(() => {\n            alertText(globalize.translate('MessagePluginInstallError'));\n        });\n    };\n\n    if (developer !== 'jellyfin') {\n        loading.hide();\n        let msg = globalize.translate('MessagePluginInstallDisclaimer');\n        msg += '<br/>';\n        msg += '<br/>';\n        msg += globalize.translate('PleaseConfirmPluginInstallation');\n\n        import('confirm').then(({default: confirm}) => {\n            confirm(msg, globalize.translate('HeaderConfirmPluginInstallation')).then(function () {\n                alertCallback();\n            }).catch(() => {\n                console.debug('plugin not installed');\n            });\n        });\n    } else {\n        alertCallback();\n    }\n}\n\nexport default function(view, params) {\n    $('.addPluginForm', view).on('submit', function () {\n        loading.show();\n        const page = $(this).parents('#addPluginPage')[0];\n        const name = params.name;\n        const guid = params.guid;\n        ApiClient.getInstalledPlugins().then(function (plugins) {\n            const installedPlugin = plugins.filter(function (plugin) {\n                return plugin.Name == name;\n            })[0];\n\n            const version = $('#selectVersion', page).val();\n            if (installedPlugin && installedPlugin.Version === version) {\n                loading.hide();\n                Dashboard.alert({\n                    message: globalize.translate('MessageAlreadyInstalled'),\n                    title: globalize.translate('HeaderPluginInstallation')\n                });\n            } else {\n                performInstallation(page, name, guid, version);\n            }\n        }).catch(() => {\n            alertText(globalize.translate('MessageGetInstalledPluginsError'));\n        });\n        return false;\n    });\n    view.addEventListener('viewshow', function () {\n        const page = this;\n        loading.show();\n        const name = params.name;\n        const guid = params.guid;\n        const promise1 = ApiClient.getPackageInfo(name, guid);\n        const promise2 = ApiClient.getInstalledPlugins();\n        Promise.all([promise1, promise2]).then(function (responses) {\n            renderPackage(responses[0], responses[1], page);\n        });\n    });\n}\n"]}