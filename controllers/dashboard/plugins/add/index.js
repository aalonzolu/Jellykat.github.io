define(["require","exports","jQuery","loading","globalize","emby-button"],(function(_require,_exports,_jQuery,_loading,_globalize,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function alertText(options){new Promise((function(_resolve,_reject){return _require(["alert"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(options)}))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){(0,_jQuery.default)(".addPluginForm",view).on("submit",(function(){_loading.default.show();var page=(0,_jQuery.default)(this).parents("#addPluginPage")[0],name=params.name,guid=params.guid;return ApiClient.getInstalledPlugins().then((function(plugins){var installedPlugin=plugins.filter((function(plugin){return plugin.Name==name}))[0],version=(0,_jQuery.default)("#selectVersion",page).val();installedPlugin&&installedPlugin.Version===version?(_loading.default.hide(),Dashboard.alert({message:_globalize.default.translate("MessageAlreadyInstalled"),title:_globalize.default.translate("HeaderPluginInstallation")})):function performInstallation(page,name,guid,version){var developer=(0,_jQuery.default)("#developer",page).html().toLowerCase(),alertCallback=function alertCallback(){_loading.default.show(),page.querySelector("#btnInstall").disabled=!0,ApiClient.installPlugin(name,guid,version).then((function(){_loading.default.hide(),alertText(_globalize.default.translate("MessagePluginInstalled"))})).catch((function(){alertText(_globalize.default.translate("MessagePluginInstallError"))}))};if("jellyfin"!==developer){_loading.default.hide();var msg=_globalize.default.translate("MessagePluginInstallDisclaimer");msg+="<br/>",msg+="<br/>",msg+=_globalize.default.translate("PleaseConfirmPluginInstallation"),new Promise((function(_resolve,_reject){return _require(["confirm"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){(0,_ref2.default)(msg,_globalize.default.translate("HeaderConfirmPluginInstallation")).then((function(){alertCallback()})).catch((function(){console.debug("plugin not installed")}))}))}else alertCallback()}(page,name,guid,version)})).catch((function(){alertText(_globalize.default.translate("MessageGetInstalledPluginsError"))})),!1})),view.addEventListener("viewshow",(function(){var page=this;_loading.default.show();var name=params.name,guid=params.guid,promise1=ApiClient.getPackageInfo(name,guid),promise2=ApiClient.getInstalledPlugins();Promise.all([promise1,promise2]).then((function(responses){!function renderPackage(pkg,installedPlugins,page){var installedPlugin=installedPlugins.filter((function(ip){return ip.Name==pkg.name}))[0];(function populateVersions(packageInfo,page,installedPlugin){for(var html="",i=0;i<packageInfo.versions.length;i++){var version=packageInfo.versions[i];html+='<option value="'+version.version+'">'+version.version+"</option>"}var selectmenu=(0,_jQuery.default)("#selectVersion",page).html(html);installedPlugin||(0,_jQuery.default)("#pCurrentVersion",page).hide().html("");var packageVersion=packageInfo.versions[0];packageVersion&&selectmenu.val(packageVersion.version)})(pkg,page,installedPlugin),function populateHistory(packageInfo,page){for(var html="",length=Math.min(packageInfo.versions.length,10),i=0;i<length;i++){var version=packageInfo.versions[i];html+='<h2 style="margin:.5em 0;">'+version.version+"</h2>",html+='<div style="margin-bottom:1.5em;">'+version.changelog+"</div>"}(0,_jQuery.default)("#revisionHistory",page).html(html)}(pkg,page),(0,_jQuery.default)(".pluginName",page).html(pkg.name),(0,_jQuery.default)("#btnInstallDiv",page).removeClass("hide"),(0,_jQuery.default)("#pSelectVersion",page).removeClass("hide"),pkg.overview?(0,_jQuery.default)("#overview",page).show().html(pkg.overview):(0,_jQuery.default)("#overview",page).hide();if((0,_jQuery.default)("#description",page).html(pkg.description),(0,_jQuery.default)("#developer",page).html(pkg.owner),installedPlugin){var currentVersionText=_globalize.default.translate("MessageYouHaveVersionInstalled","<strong>"+installedPlugin.Version+"</strong>");(0,_jQuery.default)("#pCurrentVersion",page).show().html(currentVersionText)}else(0,_jQuery.default)("#pCurrentVersion",page).hide().html("");_loading.default.hide()}(responses[0],responses[1],page)}))}))},_jQuery=_interopRequireDefault(_jQuery),_loading=_interopRequireDefault(_loading),_globalize=_interopRequireDefault(_globalize)}));
//# sourceMappingURL=index.js.map
