define(["require","jQuery","scripts/taskbutton","loading","libraryMenu","globalize","dom","scripts/imagehelper","cardStyle","emby-itemrefreshindicator"],(function(_require,_jQuery,_taskbutton,_loading,_libraryMenu,_globalize,_dom,_imagehelper,_cardStyle,_embyItemrefreshindicator){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function editVirtualFolder(page,virtualFolder){new Promise((function(_resolve,_reject){return _require(["medialibraryeditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){new(0,_ref2.default)({refresh:shouldRefreshLibraryAfterChanges(page),library:virtualFolder}).then((function(hasChanges){hasChanges&&reloadLibrary(page)}))}))}function showCardMenu(page,elem,virtualFolders){var card=_dom.default.parentWithClass(elem,"card"),virtualFolder=virtualFolders[parseInt(card.getAttribute("data-index"))],menuItems=[];menuItems.push({name:_globalize.default.translate("EditImages"),id:"editimages",icon:"photo"}),menuItems.push({name:_globalize.default.translate("ManageLibrary"),id:"edit",icon:"folder_open"}),menuItems.push({name:_globalize.default.translate("ButtonRemove"),id:"delete",icon:"delete"}),menuItems.push({name:_globalize.default.translate("ButtonRename"),id:"rename",icon:"mode_edit"}),menuItems.push({name:_globalize.default.translate("ScanLibrary"),id:"refresh",icon:"refresh"}),new Promise((function(_resolve,_reject){return _require(["actionsheet"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref6){_ref6.default.show({items:menuItems,positionTo:elem,callback:function callback(resultId){switch(resultId){case"edit":editVirtualFolder(page,virtualFolder);break;case"editimages":!function editImages(page,virtualFolder){new Promise((function(_resolve,_reject){return _require(["imageEditor"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref7){_ref7.default.show({itemId:virtualFolder.ItemId,serverId:ApiClient.serverId()}).then((function(){reloadLibrary(page)}))}))}(page,virtualFolder);break;case"rename":!function renameVirtualFolder(page,virtualFolder){new Promise((function(_resolve,_reject){return _require(["prompt"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref5){(0,_ref5.default)({label:_globalize.default.translate("LabelNewName"),confirmText:_globalize.default.translate("ButtonRename")}).then((function(newName){if(newName&&newName!=virtualFolder.Name){var refreshAfterChange=shouldRefreshLibraryAfterChanges(page);ApiClient.renameVirtualFolder(virtualFolder.Name,newName,refreshAfterChange).then((function(){reloadLibrary(page)}))}}))}))}(page,virtualFolder);break;case"delete":!function deleteVirtualFolder(page,virtualFolder){var msg=_globalize.default.translate("MessageAreYouSureYouWishToRemoveMediaFolder");virtualFolder.Locations.length&&(msg+="<br/><br/>"+_globalize.default.translate("MessageTheFollowingLocationWillBeRemovedFromLibrary")+"<br/><br/>",msg+=virtualFolder.Locations.join("<br/>")),new Promise((function(_resolve,_reject){return _require(["confirm"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){(0,_ref3.default)({text:msg,title:_globalize.default.translate("HeaderRemoveMediaFolder"),confirmText:_globalize.default.translate("Delete"),primary:"delete"}).then((function(){var refreshAfterChange=shouldRefreshLibraryAfterChanges(page);ApiClient.removeVirtualFolder(virtualFolder.Name,refreshAfterChange).then((function(){reloadLibrary(page)}))}))}))}(page,virtualFolder);break;case"refresh":!function refreshVirtualFolder(page,virtualFolder){new Promise((function(_resolve,_reject){return _require(["refreshDialog"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref4){new(0,_ref4.default)({itemIds:[virtualFolder.ItemId],serverId:ApiClient.serverId(),mode:"scan"}).show()}))}(0,virtualFolder)}}})}))}function reloadLibrary(page){_loading.default.show(),ApiClient.getVirtualFolders().then((function(result){!function reloadVirtualFolders(page,virtualFolders){var html="";virtualFolders.push({Name:_globalize.default.translate("ButtonAddMediaLibrary"),icon:"add_circle",Locations:[],showType:!1,showLocations:!1,showMenu:!1,showNameWithIcon:!1});for(var i=0;i<virtualFolders.length;i++){var virtualFolder=virtualFolders[i];html+=getVirtualFolderHtml(page,virtualFolder,i)}var divVirtualFolders=page.querySelector("#divVirtualFolders");divVirtualFolders.innerHTML=html,divVirtualFolders.classList.add("itemsContainer"),divVirtualFolders.classList.add("vertical-wrap"),(0,_jQuery.default)(".btnCardMenu",divVirtualFolders).on("click",(function(){showCardMenu(page,this,virtualFolders)})),divVirtualFolders.querySelector("#addLibrary").addEventListener("click",(function(){!function addVirtualFolder(page){new Promise((function(_resolve,_reject){return _require(["medialibrarycreator"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){new(0,_ref.default)({collectionTypeOptions:getCollectionTypeOptions().filter((function(f){return!f.hidden})),refresh:shouldRefreshLibraryAfterChanges(page)}).then((function(hasChanges){hasChanges&&reloadLibrary(page)}))}))}(page)})),(0,_jQuery.default)(".editLibrary",divVirtualFolders).on("click",(function(){var card=(0,_jQuery.default)(this).parents(".card")[0],index=parseInt(card.getAttribute("data-index")),virtualFolder=virtualFolders[index];virtualFolder.ItemId&&editVirtualFolder(page,virtualFolder)})),_loading.default.hide()}(page,result)}))}function shouldRefreshLibraryAfterChanges(page){return"mediaLibraryPage"===page.id}function getLink(text,url){return _globalize.default.translate(text,'<a is="emby-linkbutton" class="button-link" href="'+url+'" target="_blank" data-autohide="true">',"</a>")}function getCollectionTypeOptions(){return[{name:"",value:""},{name:_globalize.default.translate("FolderTypeMovies"),value:"movies",message:getLink("MovieLibraryHelp","https://docs.jellyfin.org/general/server/media/movies.html")},{name:_globalize.default.translate("FolderTypeMusic"),value:"music",message:getLink("MusicLibraryHelp","https://docs.jellyfin.org/general/server/media/music.html")},{name:_globalize.default.translate("FolderTypeTvShows"),value:"tvshows",message:getLink("TvLibraryHelp","https://docs.jellyfin.org/general/server/media/shows.html")},{name:_globalize.default.translate("FolderTypeBooks"),value:"books",message:getLink("BookLibraryHelp","https://docs.jellyfin.org/general/server/media/books.html")},{name:_globalize.default.translate("OptionHomeVideos"),value:"homevideos"},{name:_globalize.default.translate("FolderTypeMusicVideos"),value:"musicvideos"},{name:_globalize.default.translate("FolderTypeUnset"),value:"mixed",message:_globalize.default.translate("MessageUnsetContentHelp")}]}function getVirtualFolderHtml(page,virtualFolder,index){var html="",style="";page.classList.contains("wizardPage")&&(style+="min-width:33.3%;"),0==virtualFolder.Locations.length?html+='<div id="addLibrary" class="card backdropCard scalableCard backdropCard-scalable" style="'+style+'" data-index="'+index+'" data-id="'+virtualFolder.ItemId+'">':html+='<div class="card backdropCard scalableCard backdropCard-scalable" style="'+style+'" data-index="'+index+'" data-id="'+virtualFolder.ItemId+'">',html+='<div class="cardBox visualCardBox">',html+='<div class="cardScalable visualCardBox-cardScalable">',html+='<div class="cardPadder cardPadder-backdrop"></div>',html+='<div class="cardContent">';var hasCardImageContainer,imgUrl="";virtualFolder.PrimaryImageItemId&&(imgUrl=ApiClient.getScaledImageUrl(virtualFolder.PrimaryImageItemId,{maxWidth:Math.round(.4*_dom.default.getScreenWidth()),type:"Primary"})),imgUrl?(html+='<div class="cardImageContainer editLibrary" style="cursor:pointer;background-image:url(\''+imgUrl+"');\">",hasCardImageContainer=!0):virtualFolder.showNameWithIcon||(html+='<div class="cardImageContainer editLibrary" style="cursor:pointer;">',html+='<span class="cardImageIcon-small material-icons '+(virtualFolder.icon||_imagehelper.default.getLibraryIcon(virtualFolder.CollectionType))+'"></span>',hasCardImageContainer=!0),hasCardImageContainer&&(html+='<div class="cardIndicators backdropCardIndicators">',html+='<div is="emby-itemrefreshindicator"'+(virtualFolder.RefreshProgress||virtualFolder.RefreshStatus&&"Idle"!==virtualFolder.RefreshStatus?"":' class="hide"')+' data-progress="'+(virtualFolder.RefreshProgress||0)+'" data-status="'+virtualFolder.RefreshStatus+'"></div>',html+="</div>",html+="</div>"),!imgUrl&&virtualFolder.showNameWithIcon&&(html+='<h3 class="cardImageContainer addLibrary" style="position:absolute;top:0;left:0;right:0;bottom:0;cursor:pointer;flex-direction:column;">',html+='<span class="cardImageIcon-small material-icons '+(virtualFolder.icon||_imagehelper.default.getLibraryIcon(virtualFolder.CollectionType))+'"></span>',virtualFolder.showNameWithIcon&&(html+='<div style="margin:1em 0;position:width:100%;">',html+=virtualFolder.Name,html+="</div>"),html+="</h3>"),html+="</div>",html+="</div>",html+='<div class="cardFooter visualCardBox-cardFooter">',!1!==virtualFolder.showMenu&&(html+='<div style="text-align:right; float:right;padding-top:5px;">',html+='<button type="button" is="paper-icon-button-light" class="btnCardMenu autoSize"><span class="material-icons more_vert"></span></button>',html+="</div>"),html+="<div class='cardText'>",virtualFolder.showNameWithIcon?html+="&nbsp;":html+=virtualFolder.Name,html+="</div>";var typeName=getCollectionTypeOptions().filter((function(t){return t.value==virtualFolder.CollectionType}))[0];return typeName=typeName?typeName.name:_globalize.default.translate("FolderTypeUnset"),html+="<div class='cardText cardText-secondary'>",!1===virtualFolder.showType?html+="&nbsp;":html+=typeName,html+="</div>",!1===virtualFolder.showLocations?(html+="<div class='cardText cardText-secondary'>",html+="&nbsp;",html+="</div>"):virtualFolder.Locations.length&&1===virtualFolder.Locations.length?(html+="<div class='cardText cardText-secondary'>",html+=virtualFolder.Locations[0],html+="</div>"):(html+="<div class='cardText cardText-secondary'>",html+=_globalize.default.translate("NumLocationsValue",virtualFolder.Locations.length),html+="</div>"),html+="</div>",html+="</div>",html+="</div>"}function getTabs(){return[{href:"library.html",name:_globalize.default.translate("HeaderLibraries")},{href:"librarydisplay.html",name:_globalize.default.translate("Display")},{href:"metadataimages.html",name:_globalize.default.translate("Metadata")},{href:"metadatanfo.html",name:_globalize.default.translate("TabNfoSettings")}]}_jQuery=_interopRequireDefault(_jQuery),_taskbutton=_interopRequireDefault(_taskbutton),_loading=_interopRequireDefault(_loading),_libraryMenu=_interopRequireDefault(_libraryMenu),_globalize=_interopRequireDefault(_globalize),_dom=_interopRequireDefault(_dom),_imagehelper=_interopRequireDefault(_imagehelper),window.WizardLibraryPage={next:function next(){Dashboard.navigate("wizardsettings.html")}},pageClassOn("pageshow","mediaLibraryPage",(function(){reloadLibrary(this)})),pageIdOn("pageshow","mediaLibraryPage",(function(){_libraryMenu.default.setTabs("librarysetup",0,getTabs);(0,_taskbutton.default)({mode:"on",progressElem:this.querySelector(".refreshProgress"),taskKey:"RefreshLibrary",button:this.querySelector(".btnRefresh")})})),pageIdOn("pagebeforehide","mediaLibraryPage",(function(){(0,_taskbutton.default)({mode:"off",progressElem:this.querySelector(".refreshProgress"),taskKey:"RefreshLibrary",button:this.querySelector(".btnRefresh")})}))}));
//# sourceMappingURL=library.js.map
