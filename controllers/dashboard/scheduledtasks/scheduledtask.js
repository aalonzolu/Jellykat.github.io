define(["require","exports","jQuery","loading","datetime","dom","globalize","emby-input","emby-button","emby-select"],(function(_require,_exports,_jQuery,_loading,_datetime,_dom,_globalize,_embyInput,_embyButton,_embySelect){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){view.querySelector(".addTriggerForm").addEventListener("submit",(function onSubmit(e){_loading.default.show();var id=getParameterByName("id");ApiClient.getScheduledTask(id).then((function(task){task.Triggers.push(ScheduledTaskPage.getTriggerToAdd(view)),ApiClient.updateScheduledTaskTriggers(task.Id,task.Triggers).then((function(){(0,_jQuery.default)("#popupAddTrigger").addClass("hide"),ScheduledTaskPage.refreshScheduledTask(view)}))})),e.preventDefault()})),function fillTimeOfDay(select){for(var options=[],i=0;i<864e5;i+=9e5)options.push({name:ScheduledTaskPage.getDisplayTime(1e4*i),value:1e4*i});select.innerHTML=options.map((function(o){return'<option value="'+o.value+'">'+o.name+"</option>"})).join("")}(view.querySelector("#selectTimeOfDay")),(0,_jQuery.default)(view.querySelector("#popupAddTrigger").parentNode).trigger("create"),view.querySelector(".selectTriggerType").addEventListener("change",(function(){ScheduledTaskPage.refreshTriggerFields(view,this.value)})),view.querySelector(".btnAddTrigger").addEventListener("click",(function(){ScheduledTaskPage.showAddTriggerPopup(view)})),view.addEventListener("click",(function(e){var btnDeleteTrigger=_dom.default.parentWithClass(e.target,"btnDeleteTrigger");btnDeleteTrigger&&ScheduledTaskPage.confirmDeleteTrigger(view,parseInt(btnDeleteTrigger.getAttribute("data-index")))})),view.addEventListener("viewshow",(function(){ScheduledTaskPage.refreshScheduledTask(view)}))},_jQuery=_interopRequireDefault(_jQuery),_loading=_interopRequireDefault(_loading),_datetime=_interopRequireDefault(_datetime),_dom=_interopRequireDefault(_dom),_globalize=_interopRequireDefault(_globalize),Array.prototype.remove=function(from,to){var rest=this.slice((to||from)+1||this.length);return this.length=from<0?this.length+from:from,this.push.apply(this,rest)};var ScheduledTaskPage={refreshScheduledTask:function refreshScheduledTask(view){_loading.default.show();var id=getParameterByName("id");ApiClient.getScheduledTask(id).then((function(task){ScheduledTaskPage.loadScheduledTask(view,task)}))},loadScheduledTask:function loadScheduledTask(view,task){(0,_jQuery.default)(".taskName",view).html(task.Name),(0,_jQuery.default)("#pTaskDescription",view).html(task.Description),new Promise((function(_resolve,_reject){return _require(["listViewStyle"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(){ScheduledTaskPage.loadTaskTriggers(view,task)})),_loading.default.hide()},loadTaskTriggers:function loadTaskTriggers(context,task){var html="";html+='<div class="paperList">';for(var i=0,length=task.Triggers.length;i<length;i++){var trigger=task.Triggers[i];if(html+='<div class="listItem listItem-border">',html+='<span class="material-icons listItemIcon schedule"></span>',trigger.MaxRuntimeMs?html+='<div class="listItemBody two-line">':html+='<div class="listItemBody">',html+="<div class='listItemBodyText'>"+ScheduledTaskPage.getTriggerFriendlyName(trigger)+"</div>",trigger.MaxRuntimeMs){html+='<div class="listItemBodyText secondary">';var hours=trigger.MaxRuntimeTicks/36e9;html+=1==hours?_globalize.default.translate("ValueTimeLimitSingleHour"):_globalize.default.translate("ValueTimeLimitMultiHour",hours),html+="</div>"}html+="</div>",html+='<button class="btnDeleteTrigger" data-index="'+i+'" type="button" is="paper-icon-button-light" title="'+_globalize.default.translate("Delete")+'"><span class="material-icons delete"></span></button>',html+="</div>"}html+="</div>",context.querySelector(".taskTriggers").innerHTML=html},getTriggerFriendlyName:function getTriggerFriendlyName(trigger){if("DailyTrigger"==trigger.Type)return _globalize.default.translate("DailyAt",ScheduledTaskPage.getDisplayTime(trigger.TimeOfDayTicks));if("WeeklyTrigger"==trigger.Type)return _globalize.default.translate("WeeklyAt",trigger.DayOfWeek,ScheduledTaskPage.getDisplayTime(trigger.TimeOfDayTicks));if("SystemEventTrigger"==trigger.Type&&"WakeFromSleep"==trigger.SystemEvent)return _globalize.default.translate("OnWakeFromSleep");if("IntervalTrigger"==trigger.Type){var hours=trigger.IntervalTicks/36e9;return.25==hours?_globalize.default.translate("EveryXMinutes","15"):.5==hours?_globalize.default.translate("EveryXMinutes","30"):.75==hours?_globalize.default.translate("EveryXMinutes","45"):1==hours?_globalize.default.translate("EveryHour"):_globalize.default.translate("EveryXHours",hours)}return"StartupTrigger"==trigger.Type?_globalize.default.translate("OnApplicationStartup"):trigger.Type},getDisplayTime:function getDisplayTime(ticks){var ms=ticks/1e4,now=new Date;return now.setHours(0,0,0,0),now.setTime(now.getTime()+ms),_datetime.default.getDisplayTime(now)},showAddTriggerPopup:function showAddTriggerPopup(view){(0,_jQuery.default)("#selectTriggerType",view).val("DailyTrigger"),view.querySelector("#selectTriggerType").dispatchEvent(new CustomEvent("change",{})),(0,_jQuery.default)("#popupAddTrigger",view).removeClass("hide")},confirmDeleteTrigger:function confirmDeleteTrigger(view,index){new Promise((function(_resolve,_reject){return _require(["confirm"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(_globalize.default.translate("MessageDeleteTaskTrigger"),_globalize.default.translate("HeaderDeleteTaskTrigger")).then((function(){ScheduledTaskPage.deleteTrigger(view,index)}))}))},deleteTrigger:function deleteTrigger(view,index){_loading.default.show();var id=getParameterByName("id");ApiClient.getScheduledTask(id).then((function(task){task.Triggers.remove(index),ApiClient.updateScheduledTaskTriggers(task.Id,task.Triggers).then((function(){ScheduledTaskPage.refreshScheduledTask(view)}))}))},refreshTriggerFields:function refreshTriggerFields(page,triggerType){"DailyTrigger"==triggerType?((0,_jQuery.default)("#fldTimeOfDay",page).show(),(0,_jQuery.default)("#fldDayOfWeek",page).hide(),(0,_jQuery.default)("#fldSelectSystemEvent",page).hide(),(0,_jQuery.default)("#fldSelectInterval",page).hide(),(0,_jQuery.default)("#selectTimeOfDay",page).attr("required","required")):"WeeklyTrigger"==triggerType?((0,_jQuery.default)("#fldTimeOfDay",page).show(),(0,_jQuery.default)("#fldDayOfWeek",page).show(),(0,_jQuery.default)("#fldSelectSystemEvent",page).hide(),(0,_jQuery.default)("#fldSelectInterval",page).hide(),(0,_jQuery.default)("#selectTimeOfDay",page).attr("required","required")):"SystemEventTrigger"==triggerType?((0,_jQuery.default)("#fldTimeOfDay",page).hide(),(0,_jQuery.default)("#fldDayOfWeek",page).hide(),(0,_jQuery.default)("#fldSelectSystemEvent",page).show(),(0,_jQuery.default)("#fldSelectInterval",page).hide(),(0,_jQuery.default)("#selectTimeOfDay",page).removeAttr("required")):"IntervalTrigger"==triggerType?((0,_jQuery.default)("#fldTimeOfDay",page).hide(),(0,_jQuery.default)("#fldDayOfWeek",page).hide(),(0,_jQuery.default)("#fldSelectSystemEvent",page).hide(),(0,_jQuery.default)("#fldSelectInterval",page).show(),(0,_jQuery.default)("#selectTimeOfDay",page).removeAttr("required")):"StartupTrigger"==triggerType&&((0,_jQuery.default)("#fldTimeOfDay",page).hide(),(0,_jQuery.default)("#fldDayOfWeek",page).hide(),(0,_jQuery.default)("#fldSelectSystemEvent",page).hide(),(0,_jQuery.default)("#fldSelectInterval",page).hide(),(0,_jQuery.default)("#selectTimeOfDay",page).removeAttr("required"))},getTriggerToAdd:function getTriggerToAdd(page){var trigger={Type:(0,_jQuery.default)("#selectTriggerType",page).val()};"DailyTrigger"==trigger.Type?trigger.TimeOfDayTicks=(0,_jQuery.default)("#selectTimeOfDay",page).val():"WeeklyTrigger"==trigger.Type?(trigger.DayOfWeek=(0,_jQuery.default)("#selectDayOfWeek",page).val(),trigger.TimeOfDayTicks=(0,_jQuery.default)("#selectTimeOfDay",page).val()):"SystemEventTrigger"==trigger.Type?trigger.SystemEvent=(0,_jQuery.default)("#selectSystemEvent",page).val():"IntervalTrigger"==trigger.Type&&(trigger.IntervalTicks=(0,_jQuery.default)("#selectInterval",page).val());var timeLimit=(0,_jQuery.default)("#txtTimeLimit",page).val()||"0";return timeLimit=36e5*parseFloat(timeLimit),trigger.MaxRuntimeMs=timeLimit||null,trigger}}}));
//# sourceMappingURL=scheduledtask.js.map
