define(["require","jQuery","loading","globalize","dom","libraryMenu"],(function(_require,_jQuery,_loading,_globalize,_dom,_libraryMenu){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function onSaveEncodingPathFailure(response){_loading.default.hide();var msg;msg=_globalize.default.translate("FFmpegSavePathNotFound"),new Promise((function(_resolve,_reject){return _require(["alert"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(msg)}))}function onSubmit(){var form=this,onDecoderConfirmed=function onDecoderConfirmed(){_loading.default.show(),ApiClient.getNamedConfiguration("encoding").then((function(config){config.DownMixAudioBoost=(0,_jQuery.default)("#txtDownMixAudioBoost",form).val(),config.TranscodingTempPath=(0,_jQuery.default)("#txtTranscodingTempPath",form).val(),config.EncodingThreadCount=(0,_jQuery.default)("#selectThreadCount",form).val(),config.HardwareAccelerationType=(0,_jQuery.default)("#selectVideoDecoder",form).val(),config.VaapiDevice=(0,_jQuery.default)("#txtVaapiDevice",form).val(),config.EncoderPreset=form.querySelector("#selectEncoderPreset").value,config.H264Crf=parseInt(form.querySelector("#txtH264Crf").value||"0"),config.DeinterlaceMethod=form.querySelector("#selectDeinterlaceMethod").value,config.EnableSubtitleExtraction=form.querySelector("#chkEnableSubtitleExtraction").checked,config.EnableThrottling=form.querySelector("#chkEnableThrottling").checked,config.HardwareDecodingCodecs=Array.prototype.map.call(Array.prototype.filter.call(form.querySelectorAll(".chkDecodeCodec"),(function(c){return c.checked})),(function(c){return c.getAttribute("data-codec")})),config.EnableDecodingColorDepth10Hevc=form.querySelector("#chkDecodingColorDepth10Hevc").checked,config.EnableDecodingColorDepth10Vp9=form.querySelector("#chkDecodingColorDepth10Vp9").checked,config.EnableHardwareEncoding=form.querySelector("#chkHardwareEncoding").checked,ApiClient.updateNamedConfiguration("encoding",config).then((function(){!function updateEncoder(form){return ApiClient.getSystemInfo().then((function(systemInfo){return ApiClient.ajax({url:ApiClient.getUrl("System/MediaEncoder/Path"),type:"POST",data:JSON.stringify({Path:form.querySelector(".txtEncoderPath").value,PathType:"Custom"})}).then(Dashboard.processServerConfigurationUpdateResult,onSaveEncodingPathFailure)}))}(form)}),(function(){new Promise((function(_resolve,_reject){return _require(["alert"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){(0,_ref2.default)(_globalize.default.translate("ErrorDefault"))})),Dashboard.processServerConfigurationUpdateResult()}))}))};return(0,_jQuery.default)("#selectVideoDecoder",form).val()?new Promise((function(_resolve,_reject){return _require(["alert"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){(0,_ref3.default)({title:_globalize.default.translate("TitleHardwareAcceleration"),text:_globalize.default.translate("HardwareAccelerationWarning")}).then(onDecoderConfirmed)})):onDecoderConfirmed(),!1}function getTabs(){return[{href:"encodingsettings.html",name:_globalize.default.translate("Transcoding")},{href:"playbackconfiguration.html",name:_globalize.default.translate("ButtonResume")},{href:"streamingsettings.html",name:_globalize.default.translate("TabStreaming")}]}_jQuery=_interopRequireDefault(_jQuery),_loading=_interopRequireDefault(_loading),_globalize=_interopRequireDefault(_globalize),_dom=_interopRequireDefault(_dom),_libraryMenu=_interopRequireDefault(_libraryMenu),(0,_jQuery.default)(document).on("pageinit","#encodingSettingsPage",(function(){var page=this;page.querySelector("#selectVideoDecoder").addEventListener("change",(function(){"vaapi"==this.value?(page.querySelector(".fldVaapiDevice").classList.remove("hide"),page.querySelector("#txtVaapiDevice").setAttribute("required","required")):(page.querySelector(".fldVaapiDevice").classList.add("hide"),page.querySelector("#txtVaapiDevice").removeAttribute("required")),this.value?page.querySelector(".hardwareAccelerationOptions").classList.remove("hide"):page.querySelector(".hardwareAccelerationOptions").classList.add("hide"),function setDecodingCodecsVisible(context,value){var any;value=value||"",Array.prototype.forEach.call(context.querySelectorAll(".chkDecodeCodec"),(function(c){-1===c.getAttribute("data-types").split(",").indexOf(value)?_dom.default.parentWithTag(c,"LABEL").classList.add("hide"):(_dom.default.parentWithTag(c,"LABEL").classList.remove("hide"),any=!0)})),any?context.querySelector(".decodingCodecsList").classList.remove("hide"):context.querySelector(".decodingCodecsList").classList.add("hide")}(page,this.value)})),(0,_jQuery.default)("#btnSelectEncoderPath",page).on("click.selectDirectory",(function(){new Promise((function(_resolve,_reject){return _require(["directorybrowser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref4){var picker=new(0,_ref4.default);picker.show({includeFiles:!0,callback:function callback(path){path&&(0,_jQuery.default)(".txtEncoderPath",page).val(path),picker.close()}})}))})),(0,_jQuery.default)("#btnSelectTranscodingTempPath",page).on("click.selectDirectory",(function(){new Promise((function(_resolve,_reject){return _require(["directorybrowser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref5){var picker=new(0,_ref5.default);picker.show({callback:function callback(path){path&&(0,_jQuery.default)("#txtTranscodingTempPath",page).val(path),picker.close()},validateWriteable:!0,header:_globalize.default.translate("HeaderSelectTranscodingPath"),instruction:_globalize.default.translate("HeaderSelectTranscodingPathHelp")})}))})),(0,_jQuery.default)(".encodingSettingsForm").off("submit",onSubmit).on("submit",onSubmit)})).on("pageshow","#encodingSettingsPage",(function(){_loading.default.show(),_libraryMenu.default.setTabs("playback",0,getTabs);var page=this;ApiClient.getNamedConfiguration("encoding").then((function(config){ApiClient.getSystemInfo().then((function(systemInfo){!function loadPage(page,config,systemInfo){Array.prototype.forEach.call(page.querySelectorAll(".chkDecodeCodec"),(function(c){c.checked=-1!==(config.HardwareDecodingCodecs||[]).indexOf(c.getAttribute("data-codec"))})),page.querySelector("#chkDecodingColorDepth10Hevc").checked=config.EnableDecodingColorDepth10Hevc,page.querySelector("#chkDecodingColorDepth10Vp9").checked=config.EnableDecodingColorDepth10Vp9,page.querySelector("#chkHardwareEncoding").checked=config.EnableHardwareEncoding,(0,_jQuery.default)("#selectVideoDecoder",page).val(config.HardwareAccelerationType),(0,_jQuery.default)("#selectThreadCount",page).val(config.EncodingThreadCount),(0,_jQuery.default)("#txtDownMixAudioBoost",page).val(config.DownMixAudioBoost),page.querySelector(".txtEncoderPath").value=config.EncoderAppPathDisplay||"",(0,_jQuery.default)("#txtTranscodingTempPath",page).val(systemInfo.TranscodingTempPath||""),(0,_jQuery.default)("#txtVaapiDevice",page).val(config.VaapiDevice||""),page.querySelector("#selectEncoderPreset").value=config.EncoderPreset||"",page.querySelector("#txtH264Crf").value=config.H264Crf||"",page.querySelector("#selectDeinterlaceMethod").value=config.DeinterlaceMethod||"",page.querySelector("#chkEnableSubtitleExtraction").checked=config.EnableSubtitleExtraction||!1,page.querySelector("#chkEnableThrottling").checked=config.EnableThrottling||!1,page.querySelector("#selectVideoDecoder").dispatchEvent(new CustomEvent("change",{bubbles:!0})),_loading.default.hide()}(page,config,systemInfo)}))}))}))}));
//# sourceMappingURL=encodingsettings.js.map
