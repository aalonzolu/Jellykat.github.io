{"version":3,"sources":["controllers/dashboard/encodingsettings.js"],"names":["define","_require","_jQuery","_loading","_globalize","_dom","_libraryMenu","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","onSaveEncodingPathFailure","response","loading","hide","msg","globalize","translate","Promise","_resolve","_reject","imported","then","_ref","alert","onSubmit","form","this","onDecoderConfirmed","show","ApiClient","getNamedConfiguration","config","DownMixAudioBoost","val","TranscodingTempPath","EncodingThreadCount","HardwareAccelerationType","VaapiDevice","EncoderPreset","querySelector","value","H264Crf","parseInt","DeinterlaceMethod","EnableSubtitleExtraction","checked","EnableThrottling","HardwareDecodingCodecs","Array","map","filter","querySelectorAll","c","getAttribute","EnableDecodingColorDepth10Hevc","EnableDecodingColorDepth10Vp9","EnableHardwareEncoding","updateNamedConfiguration","updateEncoder","getSystemInfo","systemInfo","ajax","url","getUrl","type","data","JSON","stringify","Path","PathType","Dashboard","processServerConfigurationUpdateResult","_ref2","_ref3","title","text","getTabs","href","name","document","on","page","addEventListener","classList","remove","setAttribute","add","removeAttribute","setDecodingCodecsVisible","context","any","forEach","split","indexOf","dom","parentWithTag","_ref4","picker","directoryBrowser","includeFiles","callback","path","close","_ref5","validateWriteable","header","instruction","off","libraryMenu","setTabs","loadPage","EncoderAppPathDisplay","dispatchEvent","CustomEvent","bubbles"],"mappings":"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","file":"encodingsettings.js","sourcesContent":["import $ from 'jQuery';\nimport loading from 'loading';\nimport globalize from 'globalize';\nimport dom from 'dom';\nimport libraryMenu from 'libraryMenu';\n\n/* eslint-disable indent */\n\n    function loadPage(page, config, systemInfo) {\n        Array.prototype.forEach.call(page.querySelectorAll('.chkDecodeCodec'), function (c) {\n            c.checked = (config.HardwareDecodingCodecs || []).indexOf(c.getAttribute('data-codec')) !== -1;\n        });\n        page.querySelector('#chkDecodingColorDepth10Hevc').checked = config.EnableDecodingColorDepth10Hevc;\n        page.querySelector('#chkDecodingColorDepth10Vp9').checked = config.EnableDecodingColorDepth10Vp9;\n        page.querySelector('#chkHardwareEncoding').checked = config.EnableHardwareEncoding;\n        $('#selectVideoDecoder', page).val(config.HardwareAccelerationType);\n        $('#selectThreadCount', page).val(config.EncodingThreadCount);\n        $('#txtDownMixAudioBoost', page).val(config.DownMixAudioBoost);\n        page.querySelector('.txtEncoderPath').value = config.EncoderAppPathDisplay || '';\n        $('#txtTranscodingTempPath', page).val(systemInfo.TranscodingTempPath || '');\n        $('#txtVaapiDevice', page).val(config.VaapiDevice || '');\n        page.querySelector('#selectEncoderPreset').value = config.EncoderPreset || '';\n        page.querySelector('#txtH264Crf').value = config.H264Crf || '';\n        page.querySelector('#selectDeinterlaceMethod').value = config.DeinterlaceMethod || '';\n        page.querySelector('#chkEnableSubtitleExtraction').checked = config.EnableSubtitleExtraction || false;\n        page.querySelector('#chkEnableThrottling').checked = config.EnableThrottling || false;\n        page.querySelector('#selectVideoDecoder').dispatchEvent(new CustomEvent('change', {\n            bubbles: true\n        }));\n        loading.hide();\n    }\n\n    function onSaveEncodingPathFailure(response) {\n        loading.hide();\n        let msg = '';\n        msg = globalize.translate('FFmpegSavePathNotFound');\n\n        import('alert').then(({default: alert}) => {\n            alert(msg);\n        });\n    }\n\n    function updateEncoder(form) {\n        return ApiClient.getSystemInfo().then(function (systemInfo) {\n            return ApiClient.ajax({\n                url: ApiClient.getUrl('System/MediaEncoder/Path'),\n                type: 'POST',\n                data: JSON.stringify({\n                    Path: form.querySelector('.txtEncoderPath').value,\n                    PathType: 'Custom'\n                })\n            }).then(Dashboard.processServerConfigurationUpdateResult, onSaveEncodingPathFailure);\n        });\n    }\n\n    function onSubmit() {\n        const form = this;\n\n        const onDecoderConfirmed = function () {\n            loading.show();\n            ApiClient.getNamedConfiguration('encoding').then(function (config) {\n                config.DownMixAudioBoost = $('#txtDownMixAudioBoost', form).val();\n                config.TranscodingTempPath = $('#txtTranscodingTempPath', form).val();\n                config.EncodingThreadCount = $('#selectThreadCount', form).val();\n                config.HardwareAccelerationType = $('#selectVideoDecoder', form).val();\n                config.VaapiDevice = $('#txtVaapiDevice', form).val();\n                config.EncoderPreset = form.querySelector('#selectEncoderPreset').value;\n                config.H264Crf = parseInt(form.querySelector('#txtH264Crf').value || '0');\n                config.DeinterlaceMethod = form.querySelector('#selectDeinterlaceMethod').value;\n                config.EnableSubtitleExtraction = form.querySelector('#chkEnableSubtitleExtraction').checked;\n                config.EnableThrottling = form.querySelector('#chkEnableThrottling').checked;\n                config.HardwareDecodingCodecs = Array.prototype.map.call(Array.prototype.filter.call(form.querySelectorAll('.chkDecodeCodec'), function (c) {\n                    return c.checked;\n                }), function (c) {\n                    return c.getAttribute('data-codec');\n                });\n                config.EnableDecodingColorDepth10Hevc = form.querySelector('#chkDecodingColorDepth10Hevc').checked;\n                config.EnableDecodingColorDepth10Vp9 = form.querySelector('#chkDecodingColorDepth10Vp9').checked;\n                config.EnableHardwareEncoding = form.querySelector('#chkHardwareEncoding').checked;\n                ApiClient.updateNamedConfiguration('encoding', config).then(function () {\n                    updateEncoder(form);\n                }, function () {\n                    import('alert').then(({default: alert}) => {\n                        alert(globalize.translate('ErrorDefault'));\n                    });\n\n                    Dashboard.processServerConfigurationUpdateResult();\n                });\n            });\n        };\n\n        if ($('#selectVideoDecoder', form).val()) {\n            import('alert').then(({default: alert}) => {\n                alert({\n                    title: globalize.translate('TitleHardwareAcceleration'),\n                    text: globalize.translate('HardwareAccelerationWarning')\n                }).then(onDecoderConfirmed);\n            });\n        } else {\n            onDecoderConfirmed();\n        }\n\n        return false;\n    }\n\n    function setDecodingCodecsVisible(context, value) {\n        value = value || '';\n        let any;\n        Array.prototype.forEach.call(context.querySelectorAll('.chkDecodeCodec'), function (c) {\n            if (c.getAttribute('data-types').split(',').indexOf(value) === -1) {\n                dom.parentWithTag(c, 'LABEL').classList.add('hide');\n            } else {\n                dom.parentWithTag(c, 'LABEL').classList.remove('hide');\n                any = true;\n            }\n        });\n\n        if (any) {\n            context.querySelector('.decodingCodecsList').classList.remove('hide');\n        } else {\n            context.querySelector('.decodingCodecsList').classList.add('hide');\n        }\n    }\n\n    function getTabs() {\n        return [{\n            href: 'encodingsettings.html',\n            name: globalize.translate('Transcoding')\n        }, {\n            href: 'playbackconfiguration.html',\n            name: globalize.translate('ButtonResume')\n        }, {\n            href: 'streamingsettings.html',\n            name: globalize.translate('TabStreaming')\n        }];\n    }\n\n    $(document).on('pageinit', '#encodingSettingsPage', function () {\n        const page = this;\n        page.querySelector('#selectVideoDecoder').addEventListener('change', function () {\n            if (this.value == 'vaapi') {\n                page.querySelector('.fldVaapiDevice').classList.remove('hide');\n                page.querySelector('#txtVaapiDevice').setAttribute('required', 'required');\n            } else {\n                page.querySelector('.fldVaapiDevice').classList.add('hide');\n                page.querySelector('#txtVaapiDevice').removeAttribute('required');\n            }\n\n            if (this.value) {\n                page.querySelector('.hardwareAccelerationOptions').classList.remove('hide');\n            } else {\n                page.querySelector('.hardwareAccelerationOptions').classList.add('hide');\n            }\n\n            setDecodingCodecsVisible(page, this.value);\n        });\n        $('#btnSelectEncoderPath', page).on('click.selectDirectory', function () {\n            import('directorybrowser').then(({default: directoryBrowser}) => {\n                const picker = new directoryBrowser();\n                picker.show({\n                    includeFiles: true,\n                    callback: function (path) {\n                        if (path) {\n                            $('.txtEncoderPath', page).val(path);\n                        }\n\n                        picker.close();\n                    }\n                });\n            });\n        });\n        $('#btnSelectTranscodingTempPath', page).on('click.selectDirectory', function () {\n            import('directorybrowser').then(({default: directoryBrowser}) => {\n                const picker = new directoryBrowser();\n                picker.show({\n                    callback: function (path) {\n                        if (path) {\n                            $('#txtTranscodingTempPath', page).val(path);\n                        }\n\n                        picker.close();\n                    },\n                    validateWriteable: true,\n                    header: globalize.translate('HeaderSelectTranscodingPath'),\n                    instruction: globalize.translate('HeaderSelectTranscodingPathHelp')\n                });\n            });\n        });\n        $('.encodingSettingsForm').off('submit', onSubmit).on('submit', onSubmit);\n    }).on('pageshow', '#encodingSettingsPage', function () {\n        loading.show();\n        libraryMenu.setTabs('playback', 0, getTabs);\n        const page = this;\n        ApiClient.getNamedConfiguration('encoding').then(function (config) {\n            ApiClient.getSystemInfo().then(function (systemInfo) {\n                loadPage(page, config, systemInfo);\n            });\n        });\n    });\n\n/* eslint-enable indent */\n"]}