{"version":3,"sources":["controllers/dashboard/apikeys.js"],"names":["define","_require","_datetime","_loading","_dom","_globalize","_embyButton","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","loadData","page","loading","show","ApiClient","getJSON","getUrl","then","result","renderKeys","keys","rows","map","item","html","AccessToken","globalize","translate","AppName","date","datetime","parseISO8601Date","DateCreated","toLocaleDateString","getDisplayTime","join","querySelector","innerHTML","hide","Items","pageIdOn","this","addEventListener","showNewKeyPrompt","Promise","_resolve","_reject","imported","_ref2","prompt","title","label","description","value","ajax","type","url","App","e","btnRevoke","dom","parentWithClass","target","revoke","_ref","confirm","getAttribute"],"mappings":"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","file":"apikeys.js","sourcesContent":["import datetime from 'datetime';\nimport loading from 'loading';\nimport dom from 'dom';\nimport globalize from 'globalize';\nimport 'emby-button';\n\n/* eslint-disable indent */\n\n    function revoke(page, key) {\n        import('confirm').then(({default: confirm}) => {\n            confirm(globalize.translate('MessageConfirmRevokeApiKey'), globalize.translate('HeaderConfirmRevokeApiKey')).then(function () {\n                loading.show();\n                ApiClient.ajax({\n                    type: 'DELETE',\n                    url: ApiClient.getUrl('Auth/Keys/' + key)\n                }).then(function () {\n                    loadData(page);\n                });\n            });\n        });\n    }\n\n    function renderKeys(page, keys) {\n        const rows = keys.map(function (item) {\n            let html = '';\n            html += '<tr class=\"detailTableBodyRow detailTableBodyRow-shaded\">';\n            html += '<td class=\"detailTableBodyCell\">';\n            html += '<button type=\"button\" is=\"emby-button\" data-token=\"' + item.AccessToken + '\" class=\"raised raised-mini btnRevoke\" data-mini=\"true\" title=\"' + globalize.translate('ButtonRevoke') + '\" style=\"margin:0;\">' + globalize.translate('ButtonRevoke') + '</button>';\n            html += '</td>';\n            html += '<td class=\"detailTableBodyCell\" style=\"vertical-align:middle;\">';\n            html += item.AccessToken;\n            html += '</td>';\n            html += '<td class=\"detailTableBodyCell\" style=\"vertical-align:middle;\">';\n            html += item.AppName || '';\n            html += '</td>';\n            html += '<td class=\"detailTableBodyCell\" style=\"vertical-align:middle;\">';\n            const date = datetime.parseISO8601Date(item.DateCreated, true);\n            html += datetime.toLocaleDateString(date) + ' ' + datetime.getDisplayTime(date);\n            html += '</td>';\n            return html += '</tr>';\n        }).join('');\n        page.querySelector('.resultBody').innerHTML = rows;\n        loading.hide();\n    }\n\n    function loadData(page) {\n        loading.show();\n        ApiClient.getJSON(ApiClient.getUrl('Auth/Keys')).then(function (result) {\n            renderKeys(page, result.Items);\n        });\n    }\n\n    function showNewKeyPrompt(page) {\n        import('prompt').then(({default: prompt}) => {\n            prompt({\n                title: globalize.translate('HeaderNewApiKey'),\n                label: globalize.translate('LabelAppName'),\n                description: globalize.translate('LabelAppNameExample')\n            }).then(function (value) {\n                ApiClient.ajax({\n                    type: 'POST',\n                    url: ApiClient.getUrl('Auth/Keys', {\n                        App: value\n                    })\n                }).then(function () {\n                    loadData(page);\n                });\n            });\n        });\n    }\n\n    pageIdOn('pageinit', 'apiKeysPage', function () {\n        const page = this;\n        page.querySelector('.btnNewKey').addEventListener('click', function () {\n            showNewKeyPrompt(page);\n        });\n        page.querySelector('.tblApiKeys').addEventListener('click', function (e) {\n            const btnRevoke = dom.parentWithClass(e.target, 'btnRevoke');\n\n            if (btnRevoke) {\n                revoke(page, btnRevoke.getAttribute('data-token'));\n            }\n        });\n    });\n    pageIdOn('pagebeforeshow', 'apiKeysPage', function () {\n        loadData(this);\n    });\n\n/* eslint-enable indent */\n"]}