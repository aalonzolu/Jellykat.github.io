{"version":3,"sources":["controllers/dashboard/general.js"],"names":["define","_require","_exports","_jQuery","_loading","_globalize","_embyCheckbox","_embyTextarea","_embyInput","_embySelect","_embyButton","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","onSubmit","loading","show","form","this","parents","ApiClient","getServerConfiguration","then","config","ServerName","val","UICulture","CachePath","querySelector","value","MetadataPath","MetadataNetworkPath","requiresReload","currentLanguage","updateServerConfiguration","getNamedConfiguration","brandingConfigKey","brandingConfig","LoginDisclaimer","CustomCss","currentBrandingOptions","updateNamedConfiguration","Dashboard","processServerConfigurationUpdateResult","AppInfo","isNativeApp","window","location","reload","Promise","_resolve","_reject","imported","_ref","alert","globalize","translate","_default","view","params","on","_ref2","picker","directoryBrowser","callback","path","close","validateWriteable","header","instruction","_ref3","networkSharePath","networkPath","enableNetworkSharePath","off","addEventListener","promiseConfig","promiseLanguageOptions","getJSON","getUrl","promiseSystemInfo","getSystemInfo","all","responses","loadPage","page","languageOptions","systemInfo","InternalMetadataPath","html","map","language","Value","Name","hide"],"mappings":"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","file":"general.js","sourcesContent":["import $ from 'jQuery';\nimport loading from 'loading';\nimport globalize from 'globalize';\nimport 'emby-checkbox';\nimport 'emby-textarea';\nimport 'emby-input';\nimport 'emby-select';\nimport 'emby-button';\n\n/* eslint-disable indent */\n\n    function loadPage(page, config, languageOptions, systemInfo) {\n        page.querySelector('#txtServerName').value = systemInfo.ServerName;\n        page.querySelector('#txtCachePath').value = systemInfo.CachePath || '';\n        $('#txtMetadataPath', page).val(systemInfo.InternalMetadataPath || '');\n        $('#txtMetadataNetworkPath', page).val(systemInfo.MetadataNetworkPath || '');\n        $('#selectLocalizationLanguage', page).html(languageOptions.map(function (language) {\n            return '<option value=\"' + language.Value + '\">' + language.Name + '</option>';\n        })).val(config.UICulture);\n        currentLanguage = config.UICulture;\n\n        loading.hide();\n    }\n\n    function onSubmit() {\n        loading.show();\n        const form = this;\n        $(form).parents('.page');\n        ApiClient.getServerConfiguration().then(function (config) {\n            config.ServerName = $('#txtServerName', form).val();\n            config.UICulture = $('#selectLocalizationLanguage', form).val();\n            config.CachePath = form.querySelector('#txtCachePath').value;\n            config.MetadataPath = $('#txtMetadataPath', form).val();\n            config.MetadataNetworkPath = $('#txtMetadataNetworkPath', form).val();\n            let requiresReload = config.UICulture !== currentLanguage;\n            ApiClient.updateServerConfiguration(config).then(function() {\n                ApiClient.getNamedConfiguration(brandingConfigKey).then(function(brandingConfig) {\n                    brandingConfig.LoginDisclaimer = form.querySelector('#txtLoginDisclaimer').value;\n                    brandingConfig.CustomCss = form.querySelector('#txtCustomCss').value;\n\n                    if (currentBrandingOptions && brandingConfig.CustomCss !== currentBrandingOptions.CustomCss) {\n                        requiresReload = true;\n                    }\n\n                    ApiClient.updateNamedConfiguration(brandingConfigKey, brandingConfig).then(function () {\n                        Dashboard.processServerConfigurationUpdateResult();\n\n                        if (requiresReload && !AppInfo.isNativeApp) {\n                            window.location.reload(true);\n                        }\n                    });\n                });\n            }, function () {\n                import('alert').then(({default: alert}) => {\n                    alert(globalize.translate('ErrorDefault'));\n                });\n\n                Dashboard.processServerConfigurationUpdateResult();\n            });\n        });\n        return false;\n    }\n\n    let currentBrandingOptions;\n    let currentLanguage;\n    const brandingConfigKey = 'branding';\n    export default function (view, params) {\n        $('#btnSelectCachePath', view).on('click.selectDirectory', function () {\n            import('directorybrowser').then(({default: directoryBrowser}) => {\n                const picker = new directoryBrowser();\n                picker.show({\n                    callback: function (path) {\n                        if (path) {\n                            view.querySelector('#txtCachePath').value = path;\n                        }\n\n                        picker.close();\n                    },\n                    validateWriteable: true,\n                    header: globalize.translate('HeaderSelectServerCachePath'),\n                    instruction: globalize.translate('HeaderSelectServerCachePathHelp')\n                });\n            });\n        });\n        $('#btnSelectMetadataPath', view).on('click.selectDirectory', function () {\n            import('directorybrowser').then(({default: directoryBrowser}) => {\n                const picker = new directoryBrowser();\n                picker.show({\n                    path: $('#txtMetadataPath', view).val(),\n                    networkSharePath: $('#txtMetadataNetworkPath', view).val(),\n                    callback: function (path, networkPath) {\n                        if (path) {\n                            $('#txtMetadataPath', view).val(path);\n                        }\n\n                        if (networkPath) {\n                            $('#txtMetadataNetworkPath', view).val(networkPath);\n                        }\n\n                        picker.close();\n                    },\n                    validateWriteable: true,\n                    header: globalize.translate('HeaderSelectMetadataPath'),\n                    instruction: globalize.translate('HeaderSelectMetadataPathHelp'),\n                    enableNetworkSharePath: true\n                });\n            });\n        });\n        $('.dashboardGeneralForm', view).off('submit', onSubmit).on('submit', onSubmit);\n        view.addEventListener('viewshow', function () {\n            const promiseConfig = ApiClient.getServerConfiguration();\n            const promiseLanguageOptions = ApiClient.getJSON(ApiClient.getUrl('Localization/Options'));\n            const promiseSystemInfo = ApiClient.getSystemInfo();\n            Promise.all([promiseConfig, promiseLanguageOptions, promiseSystemInfo]).then(function (responses) {\n                loadPage(view, responses[0], responses[1], responses[2]);\n            });\n            ApiClient.getNamedConfiguration(brandingConfigKey).then(function (config) {\n                currentBrandingOptions = config;\n                view.querySelector('#txtLoginDisclaimer').value = config.LoginDisclaimer || '';\n                view.querySelector('#txtCustomCss').value = config.CustomCss || '';\n            });\n        });\n    }\n\n/* eslint-enable indent */\n"]}