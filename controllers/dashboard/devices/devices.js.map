{"version":3,"sources":["controllers/dashboard/devices/devices.js"],"names":["define","_require","_exports","_loading","_dom","_globalize","_imagehelper","datefns","_dfnshelper","_embyButton","_embyItemscontainer","_cardStyle","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","canDelete","deviceId","ApiClient","loadData","page","loading","show","getJSON","getUrl","then","result","load","devices","html","map","device","deviceHtml","Id","canEdit","iconUrl","imageHelper","getDeviceIcon","globalize","translate","Name","AppName","AppVersion","LastUserName","formatDistanceToNow","Date","parse","DateLastActivity","dfnshelper","localeWithSuffix","join","querySelector","innerHTML","Items","hide","value","_default","view","params","addEventListener","e","btnDeviceMenu","dom","parentWithClass","target","showDeviceMenu","btn","menuItems","push","name","id","icon","Promise","_resolve","_reject","imported","_ref2","items","positionTo","callback","Dashboard","navigate","deleteDevice","msg","_ref","confirm","text","title","confirmText","primary","ajax","type","url","getAttribute","this","isMinServerVersion"],"mappings":"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","file":"devices.js","sourcesContent":["import loading from 'loading';\nimport dom from 'dom';\nimport globalize from 'globalize';\nimport imageHelper from 'scripts/imagehelper';\nimport * as datefns from 'date-fns';\nimport dfnshelper from 'dfnshelper';\nimport 'emby-button';\nimport 'emby-itemscontainer';\nimport 'cardStyle';\n\n/* eslint-disable indent */\n\n    function canDelete(deviceId) {\n        return deviceId !== ApiClient.deviceId();\n    }\n\n    function deleteDevice(page, id) {\n        const msg = globalize.translate('DeleteDeviceConfirmation');\n\n        import('confirm').then(({default: confirm}) => {\n            confirm({\n                text: msg,\n                title: globalize.translate('HeaderDeleteDevice'),\n                confirmText: globalize.translate('Delete'),\n                primary: 'delete'\n            }).then(function () {\n                loading.show();\n                ApiClient.ajax({\n                    type: 'DELETE',\n                    url: ApiClient.getUrl('Devices', {\n                        Id: id\n                    })\n                }).then(function () {\n                    loadData(page);\n                });\n            });\n        });\n    }\n\n    function showDeviceMenu(view, btn, deviceId) {\n        const menuItems = [];\n\n        if (canEdit) {\n            menuItems.push({\n                name: globalize.translate('Edit'),\n                id: 'open',\n                icon: 'mode_edit'\n            });\n        }\n\n        if (canDelete(deviceId)) {\n            menuItems.push({\n                name: globalize.translate('Delete'),\n                id: 'delete',\n                icon: 'delete'\n            });\n        }\n\n        import('actionsheet').then(({default: actionsheet}) => {\n            actionsheet.show({\n                items: menuItems,\n                positionTo: btn,\n                callback: function (id) {\n                    switch (id) {\n                        case 'open':\n                            Dashboard.navigate('device.html?id=' + deviceId);\n                            break;\n\n                        case 'delete':\n                            deleteDevice(view, deviceId);\n                    }\n                }\n            });\n        });\n    }\n\n    function load(page, devices) {\n        let html = '';\n        html += devices.map(function (device) {\n            let deviceHtml = '';\n            deviceHtml += \"<div data-id='\" + device.Id + \"' class='card backdropCard'>\";\n            deviceHtml += '<div class=\"cardBox visualCardBox\">';\n            deviceHtml += '<div class=\"cardScalable\">';\n            deviceHtml += '<div class=\"cardPadder cardPadder-backdrop\"></div>';\n            deviceHtml += '<a is=\"emby-linkbutton\" href=\"' + (canEdit ? 'device.html?id=' + device.Id : '#') + '\" class=\"cardContent cardImageContainer\">';\n            const iconUrl = imageHelper.getDeviceIcon(device);\n\n            if (iconUrl) {\n                deviceHtml += '<div class=\"cardImage\" style=\"background-image:url(\\'' + iconUrl + \"');background-size: auto 64%;background-position:center center;\\\">\";\n                deviceHtml += '</div>';\n            } else {\n                deviceHtml += '<span class=\"cardImageIcon material-icons tablet_android\"></span>';\n            }\n\n            deviceHtml += '</a>';\n            deviceHtml += '</div>';\n            deviceHtml += '<div class=\"cardFooter\">';\n\n            if (canEdit || canDelete(device.Id)) {\n                deviceHtml += '<div style=\"text-align:right; float:right;padding-top:5px;\">';\n                deviceHtml += '<button type=\"button\" is=\"paper-icon-button-light\" data-id=\"' + device.Id + '\" title=\"' + globalize.translate('Menu') + '\" class=\"btnDeviceMenu\"><span class=\"material-icons more_vert\"></span></button>';\n                deviceHtml += '</div>';\n            }\n\n            deviceHtml += \"<div class='cardText'>\";\n            deviceHtml += device.Name;\n            deviceHtml += '</div>';\n            deviceHtml += \"<div class='cardText cardText-secondary'>\";\n            deviceHtml += device.AppName + ' ' + device.AppVersion;\n            deviceHtml += '</div>';\n            deviceHtml += \"<div class='cardText cardText-secondary'>\";\n\n            if (device.LastUserName) {\n                deviceHtml += device.LastUserName;\n                deviceHtml += ', ' + datefns.formatDistanceToNow(Date.parse(device.DateLastActivity), dfnshelper.localeWithSuffix);\n            }\n\n            deviceHtml += '&nbsp;';\n            deviceHtml += '</div>';\n            deviceHtml += '</div>';\n            deviceHtml += '</div>';\n            deviceHtml += '</div>';\n            return deviceHtml;\n        }).join('');\n        page.querySelector('.devicesList').innerHTML = html;\n    }\n\n    function loadData(page) {\n        loading.show();\n        ApiClient.getJSON(ApiClient.getUrl('Devices')).then(function (result) {\n            load(page, result.Items);\n            loading.hide();\n        });\n    }\n\n    const canEdit = ApiClient.isMinServerVersion('3.4.1.31');\n    export default function (view, params) {\n        view.querySelector('.devicesList').addEventListener('click', function (e) {\n            const btnDeviceMenu = dom.parentWithClass(e.target, 'btnDeviceMenu');\n\n            if (btnDeviceMenu) {\n                showDeviceMenu(view, btnDeviceMenu, btnDeviceMenu.getAttribute('data-id'));\n            }\n        });\n        view.addEventListener('viewshow', function () {\n            loadData(this);\n        });\n    }\n\n/* eslint-enable indent */\n"]}