define(["require","exports","loading","dom","globalize","scripts/imagehelper","date-fns","dfnshelper","emby-button","emby-itemscontainer","cardStyle"],(function(_require,_exports,_loading,_dom,_globalize,_imagehelper,datefns,_dfnshelper,_embyButton,_embyItemscontainer,_cardStyle){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function canDelete(deviceId){return deviceId!==ApiClient.deviceId()}function loadData(page){_loading.default.show(),ApiClient.getJSON(ApiClient.getUrl("Devices")).then((function(result){!function load(page,devices){var html="";html+=devices.map((function(device){var deviceHtml="";deviceHtml+="<div data-id='"+device.Id+"' class='card backdropCard'>",deviceHtml+='<div class="cardBox visualCardBox">',deviceHtml+='<div class="cardScalable">',deviceHtml+='<div class="cardPadder cardPadder-backdrop"></div>',deviceHtml+='<a is="emby-linkbutton" href="'+(canEdit?"device.html?id="+device.Id:"#")+'" class="cardContent cardImageContainer">';var iconUrl=_imagehelper.default.getDeviceIcon(device);return iconUrl?(deviceHtml+='<div class="cardImage" style="background-image:url(\''+iconUrl+"');background-size: auto 64%;background-position:center center;\">",deviceHtml+="</div>"):deviceHtml+='<span class="cardImageIcon material-icons tablet_android"></span>',deviceHtml+="</a>",deviceHtml+="</div>",deviceHtml+='<div class="cardFooter">',(canEdit||canDelete(device.Id))&&(deviceHtml+='<div style="text-align:right; float:right;padding-top:5px;">',deviceHtml+='<button type="button" is="paper-icon-button-light" data-id="'+device.Id+'" title="'+_globalize.default.translate("Menu")+'" class="btnDeviceMenu"><span class="material-icons more_vert"></span></button>',deviceHtml+="</div>"),deviceHtml+="<div class='cardText'>",deviceHtml+=device.Name,deviceHtml+="</div>",deviceHtml+="<div class='cardText cardText-secondary'>",deviceHtml+=device.AppName+" "+device.AppVersion,deviceHtml+="</div>",deviceHtml+="<div class='cardText cardText-secondary'>",device.LastUserName&&(deviceHtml+=device.LastUserName,deviceHtml+=", "+datefns.formatDistanceToNow(Date.parse(device.DateLastActivity),_dfnshelper.default.localeWithSuffix)),deviceHtml+="&nbsp;",deviceHtml+="</div>",deviceHtml+="</div>",deviceHtml+="</div>",deviceHtml+="</div>"})).join(""),page.querySelector(".devicesList").innerHTML=html}(page,result.Items),_loading.default.hide()}))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){view.querySelector(".devicesList").addEventListener("click",(function(e){var btnDeviceMenu=_dom.default.parentWithClass(e.target,"btnDeviceMenu");btnDeviceMenu&&function showDeviceMenu(view,btn,deviceId){var menuItems=[];canEdit&&menuItems.push({name:_globalize.default.translate("Edit"),id:"open",icon:"mode_edit"});canDelete(deviceId)&&menuItems.push({name:_globalize.default.translate("Delete"),id:"delete",icon:"delete"});new Promise((function(_resolve,_reject){return _require(["actionsheet"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){_ref2.default.show({items:menuItems,positionTo:btn,callback:function callback(id){switch(id){case"open":Dashboard.navigate("device.html?id="+deviceId);break;case"delete":!function deleteDevice(page,id){var msg=_globalize.default.translate("DeleteDeviceConfirmation");new Promise((function(_resolve,_reject){return _require(["confirm"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)({text:msg,title:_globalize.default.translate("HeaderDeleteDevice"),confirmText:_globalize.default.translate("Delete"),primary:"delete"}).then((function(){_loading.default.show(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Devices",{Id:id})}).then((function(){loadData(page)}))}))}))}(view,deviceId)}}})}))}(view,btnDeviceMenu,btnDeviceMenu.getAttribute("data-id"))})),view.addEventListener("viewshow",(function(){loadData(this)}))},_loading=_interopRequireDefault(_loading),_dom=_interopRequireDefault(_dom),_globalize=_interopRequireDefault(_globalize),_imagehelper=_interopRequireDefault(_imagehelper),datefns=_interopRequireWildcard(datefns),_dfnshelper=_interopRequireDefault(_dfnshelper);var canEdit=ApiClient.isMinServerVersion("3.4.1.31")}));
//# sourceMappingURL=devices.js.map
