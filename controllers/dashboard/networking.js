define(["require","exports","loading","globalize","emby-checkbox","emby-select"],(function(_require,_exports,_loading,_globalize,_embyCheckbox,_embySelect){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function onSubmit(e){var form=this,localAddress=form.querySelector("#txtLocalAddress").value,enableUpnp=form.querySelector("#chkEnableUpnp").checked;!function confirmSelections(localAddress,enableUpnp,callback){localAddress||!enableUpnp?showAlertText({title:_globalize.default.translate("TitleHostingSettings"),text:_globalize.default.translate("SettingsWarning")}).then(callback):callback()}(localAddress,enableUpnp,(function(){var validationResult=function getValidationAlert(form){if(form.querySelector("#txtPublicPort").value===form.querySelector("#txtPublicHttpsPort").value)return"The public http and https ports must be different.";if(form.querySelector("#txtPortNumber").value===form.querySelector("#txtHttpsPort").value)return"The http and https ports must be different.";return null}(form);validationResult?showAlertText(validationResult):function validateHttps(form){var certPath=form.querySelector("#txtCertificatePath").value||null;if(form.querySelector("#chkEnableHttps").checked&&!certPath)return showAlertText({title:_globalize.default.translate("TitleHostingSettings"),text:_globalize.default.translate("HttpsRequiresCert")}).then(Promise.reject);return Promise.resolve()}(form).then((function(){_loading.default.show(),ApiClient.getServerConfiguration().then((function(config){config.LocalNetworkSubnets=form.querySelector("#txtLanNetworks").value.split(",").map((function(s){return s.trim()})).filter((function(s){return s.length>0})),config.RemoteIPFilter=form.querySelector("#txtExternalAddressFilter").value.split(",").map((function(s){return s.trim()})).filter((function(s){return s.length>0})),config.IsRemoteIPFilterBlacklist="blacklist"===form.querySelector("#selectExternalAddressFilterMode").value,config.PublicPort=form.querySelector("#txtPublicPort").value,config.PublicHttpsPort=form.querySelector("#txtPublicHttpsPort").value,config.HttpServerPortNumber=form.querySelector("#txtPortNumber").value,config.HttpsPortNumber=form.querySelector("#txtHttpsPort").value,config.EnableHttps=form.querySelector("#chkEnableHttps").checked,config.RequireHttps=form.querySelector("#chkRequireHttps").checked,config.EnableUPnP=enableUpnp,config.BaseUrl=form.querySelector("#txtBaseUrl").value,config.EnableRemoteAccess=form.querySelector("#chkRemoteAccess").checked,config.CertificatePath=form.querySelector("#txtCertificatePath").value||null,config.CertificatePassword=form.querySelector("#txtCertPassword").value||null,config.LocalNetworkAddresses=localAddress?[localAddress]:[],ApiClient.updateServerConfiguration(config).then(Dashboard.processServerConfigurationUpdateResult,Dashboard.processErrorResponse)}))}))})),e.preventDefault()}function showAlertText(options){return new Promise((function(resolve,reject){new Promise((function(_resolve,_reject){return _require(["alert"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(options).then(resolve,reject)}))}))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){function loadPage(page,config){page.querySelector("#txtPortNumber").value=config.HttpServerPortNumber,page.querySelector("#txtPublicPort").value=config.PublicPort,page.querySelector("#txtPublicHttpsPort").value=config.PublicHttpsPort,page.querySelector("#txtLocalAddress").value=config.LocalNetworkAddresses[0]||"",page.querySelector("#txtLanNetworks").value=(config.LocalNetworkSubnets||[]).join(", "),page.querySelector("#txtExternalAddressFilter").value=(config.RemoteIPFilter||[]).join(", "),page.querySelector("#selectExternalAddressFilterMode").value=config.IsRemoteIPFilterBlacklist?"blacklist":"whitelist",page.querySelector("#chkRemoteAccess").checked=null==config.EnableRemoteAccess||config.EnableRemoteAccess,page.querySelector("#txtHttpsPort").value=config.HttpsPortNumber,page.querySelector("#chkEnableHttps").checked=config.EnableHttps,page.querySelector("#chkRequireHttps").checked=config.RequireHttps,page.querySelector("#txtBaseUrl").value=config.BaseUrl||"",page.querySelector("#txtCertificatePath").value=config.CertificatePath||"",page.querySelector("#txtCertPassword").value=config.CertificatePassword||"",page.querySelector("#chkEnableUpnp").checked=config.EnableUPnP,function triggerChange(select){var evt=document.createEvent("HTMLEvents");evt.initEvent("change",!1,!0),select.dispatchEvent(evt)}(page.querySelector("#chkRemoteAccess")),_loading.default.hide()}view.querySelector("#chkRemoteAccess").addEventListener("change",(function(){this.checked?(view.querySelector(".fldExternalAddressFilter").classList.remove("hide"),view.querySelector(".fldExternalAddressFilterMode").classList.remove("hide"),view.querySelector(".fldPublicPort").classList.remove("hide"),view.querySelector(".fldPublicHttpsPort").classList.remove("hide"),view.querySelector(".fldEnableUpnp").classList.remove("hide")):(view.querySelector(".fldExternalAddressFilter").classList.add("hide"),view.querySelector(".fldExternalAddressFilterMode").classList.add("hide"),view.querySelector(".fldPublicPort").classList.add("hide"),view.querySelector(".fldPublicHttpsPort").classList.add("hide"),view.querySelector(".fldEnableUpnp").classList.add("hide"))})),view.querySelector("#btnSelectCertPath").addEventListener("click",(function(){new Promise((function(_resolve,_reject){return _require(["directorybrowser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){var picker=new(0,_ref2.default);picker.show({includeFiles:!0,includeDirectories:!0,callback:function callback(path){path&&(view.querySelector("#txtCertificatePath").value=path),picker.close()},header:_globalize.default.translate("HeaderSelectCertificatePath")})}))})),view.querySelector(".dashboardHostingForm").addEventListener("submit",onSubmit),view.addEventListener("viewshow",(function(e){_loading.default.show(),ApiClient.getServerConfiguration().then((function(config){loadPage(view,config)}))}))},_loading=_interopRequireDefault(_loading),_globalize=_interopRequireDefault(_globalize)}));
//# sourceMappingURL=networking.js.map
