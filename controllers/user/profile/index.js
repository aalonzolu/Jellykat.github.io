define(["require","exports","controllers/dashboard/users/userpasswordpage","loading","libraryMenu","apphost","globalize","emby-button"],(function(_require,_exports,_userpasswordpage,_loading,_libraryMenu,_apphost,_globalize,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function reloadUser(page){var userId=getParameterByName("userId");_loading.default.show(),ApiClient.getUser(userId).then((function(user){page.querySelector(".username").innerHTML=user.Name,_libraryMenu.default.setTitle(user.Name);var imageUrl="assets/img/avatar.png";user.PrimaryImageTag&&(imageUrl=ApiClient.getUserImageUrl(user.Id,{tag:user.PrimaryImageTag,type:"Primary"})),page.querySelector("#image").style.backgroundImage="url("+imageUrl+")",Dashboard.getCurrentUser().then((function(loggedInUser){user.PrimaryImageTag?(page.querySelector("#btnAddImage").classList.add("hide"),page.querySelector("#btnDeleteImage").classList.remove("hide")):_apphost.default.supports("fileinput")&&(loggedInUser.Policy.IsAdministrator||user.Policy.EnableUserPreferenceAccess)&&(page.querySelector("#btnDeleteImage").classList.add("hide"),page.querySelector("#btnAddImage").classList.remove("hide"))})),_loading.default.hide()}))}function onFileReaderError(evt){switch(_loading.default.hide(),evt.target.error.code){case evt.target.error.NOT_FOUND_ERR:new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(_globalize.default.translate("FileNotFound"))}));break;case evt.target.error.ABORT_ERR:onFileReaderAbort();break;case evt.target.error.NOT_READABLE_ERR:default:new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){(0,_ref2.default)(_globalize.default.translate("FileReadError"))}))}}function onFileReaderAbort(evt){_loading.default.hide(),new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){(0,_ref3.default)(_globalize.default.translate("FileReadCancelled"))}))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){reloadUser(view),new _userpasswordpage.default(view,params),view.querySelector("#btnDeleteImage").addEventListener("click",(function(){new Promise((function(_resolve,_reject){return _require(["confirm"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref4){(0,_ref4.default)(_globalize.default.translate("DeleteImageConfirmation"),_globalize.default.translate("DeleteImage")).then((function(){_loading.default.show();var userId=getParameterByName("userId");ApiClient.deleteUserImage(userId,"primary").then((function(){_loading.default.hide(),reloadUser(view)}))}))}))})),view.querySelector("#btnAddImage").addEventListener("click",(function(evt){view.querySelector("#uploadImage").click()})),view.querySelector("#uploadImage").addEventListener("change",(function(evt){!function setFiles(page,files){var userImage=page.querySelector("#image"),file=files[0];if(!file||!file.type.match("image.*"))return!1;var reader=new FileReader;reader.onerror=onFileReaderError,reader.onabort=onFileReaderAbort,reader.onload=function(evt){userImage.style.backgroundImage="url("+evt.target.result+")";var userId=getParameterByName("userId");ApiClient.uploadUserImage(userId,"Primary",file).then((function(){_loading.default.hide(),reloadUser(page)}))},reader.readAsDataURL(file)}(view,evt.target.files)}))},_userpasswordpage=_interopRequireDefault(_userpasswordpage),_loading=_interopRequireDefault(_loading),_libraryMenu=_interopRequireDefault(_libraryMenu),_apphost=_interopRequireDefault(_apphost),_globalize=_interopRequireDefault(_globalize)}));
//# sourceMappingURL=index.js.map
