{"version":3,"sources":["controllers/user/profile/index.js"],"names":["define","_require","_exports","_userpasswordpage","_loading","_libraryMenu","_apphost","_globalize","_embyButton","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","reloadUser","page","userId","getParameterByName","loading","show","ApiClient","getUser","then","user","querySelector","innerHTML","Name","libraryMenu","setTitle","imageUrl","PrimaryImageTag","getUserImageUrl","Id","tag","type","style","backgroundImage","Dashboard","getCurrentUser","loggedInUser","classList","add","remove","appHost","supports","Policy","IsAdministrator","EnableUserPreferenceAccess","hide","onFileReaderError","evt","target","error","code","NOT_FOUND_ERR","Promise","_resolve","_reject","imported","_ref","toast","globalize","translate","ABORT_ERR","onFileReaderAbort","NOT_READABLE_ERR","_ref2","_ref3","value","_default","view","params","UserPasswordPage","addEventListener","_ref4","confirm","deleteUserImage","click","setFiles","files","userImage","file","match","reader","FileReader","onerror","onabort","onload","result","uploadUserImage","readAsDataURL"],"mappings":"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","file":"index.js","sourcesContent":["import UserPasswordPage from 'controllers/dashboard/users/userpasswordpage';\nimport loading from 'loading';\nimport libraryMenu from 'libraryMenu';\nimport appHost from 'apphost';\nimport globalize from 'globalize';\nimport 'emby-button';\n\nfunction reloadUser(page) {\n    const userId = getParameterByName('userId');\n    loading.show();\n    ApiClient.getUser(userId).then(function (user) {\n        page.querySelector('.username').innerHTML = user.Name;\n        libraryMenu.setTitle(user.Name);\n\n        let imageUrl = 'assets/img/avatar.png';\n        if (user.PrimaryImageTag) {\n            imageUrl = ApiClient.getUserImageUrl(user.Id, {\n                tag: user.PrimaryImageTag,\n                type: 'Primary'\n            });\n        }\n\n        const userImage = page.querySelector('#image');\n        userImage.style.backgroundImage = 'url(' + imageUrl + ')';\n\n        Dashboard.getCurrentUser().then(function (loggedInUser) {\n            if (user.PrimaryImageTag) {\n                page.querySelector('#btnAddImage').classList.add('hide');\n                page.querySelector('#btnDeleteImage').classList.remove('hide');\n            } else if (appHost.supports('fileinput') && (loggedInUser.Policy.IsAdministrator || user.Policy.EnableUserPreferenceAccess)) {\n                page.querySelector('#btnDeleteImage').classList.add('hide');\n                page.querySelector('#btnAddImage').classList.remove('hide');\n            }\n        });\n        loading.hide();\n    });\n}\n\nfunction onFileReaderError(evt) {\n    loading.hide();\n    switch (evt.target.error.code) {\n        case evt.target.error.NOT_FOUND_ERR:\n            import('toast').then(({default: toast}) => {\n                toast(globalize.translate('FileNotFound'));\n            });\n            break;\n        case evt.target.error.ABORT_ERR:\n            onFileReaderAbort();\n            break;\n        case evt.target.error.NOT_READABLE_ERR:\n        default:\n            import('toast').then(({default: toast}) => {\n                toast(globalize.translate('FileReadError'));\n            });\n    }\n}\n\nfunction onFileReaderAbort(evt) {\n    loading.hide();\n    import('toast').then(({default: toast}) => {\n        toast(globalize.translate('FileReadCancelled'));\n    });\n}\n\nfunction setFiles(page, files) {\n    const userImage = page.querySelector('#image');\n    const file = files[0];\n\n    if (!file || !file.type.match('image.*')) {\n        return false;\n    }\n\n    const reader = new FileReader();\n    reader.onerror = onFileReaderError;\n    reader.onabort = onFileReaderAbort;\n    reader.onload = function (evt) {\n        userImage.style.backgroundImage = 'url(' + evt.target.result + ')';\n        const userId = getParameterByName('userId');\n        ApiClient.uploadUserImage(userId, 'Primary', file).then(function () {\n            loading.hide();\n            reloadUser(page);\n        });\n    };\n\n    reader.readAsDataURL(file);\n}\n\nexport default function (view, params) {\n    reloadUser(view);\n    new UserPasswordPage(view, params);\n    view.querySelector('#btnDeleteImage').addEventListener('click', function () {\n        import('confirm').then(({default: confirm}) => {\n            confirm(globalize.translate('DeleteImageConfirmation'), globalize.translate('DeleteImage')).then(function () {\n                loading.show();\n                const userId = getParameterByName('userId');\n                ApiClient.deleteUserImage(userId, 'primary').then(function () {\n                    loading.hide();\n                    reloadUser(view);\n                });\n            });\n        });\n    });\n    view.querySelector('#btnAddImage').addEventListener('click', function (evt) {\n        view.querySelector('#uploadImage').click();\n    });\n    view.querySelector('#uploadImage').addEventListener('change', function (evt) {\n        setFiles(view, evt.target.files);\n    });\n}\n"]}