define(["require","exports","apphost","appSettings","dom","connectionManager","loading","layoutManager","libraryMenu","browser","globalize","cardStyle","emby-checkbox"],(function(_require,_exports,_apphost,_appSettings,_dom,_connectionManager,_loading,_layoutManager,_libraryMenu,_browser,_globalize,_cardStyle,_embyCheckbox){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){function getApiClient(){var serverId=params.serverid;return serverId?_connectionManager.default.getOrCreateApiClient(serverId):ApiClient}function showVisualForm(){view.querySelector(".visualLoginForm").classList.remove("hide"),view.querySelector(".manualLoginForm").classList.add("hide"),view.querySelector(".btnManual").classList.remove("hide"),new Promise((function(_resolve,_reject){return _require(["autoFocuser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){_ref2.default.autoFocus(view)}))}view.querySelector("#divUsers").addEventListener("click",(function(e){var card=_dom.default.parentWithClass(e.target,"card"),cardContent=card?card.querySelector(".cardContent"):null;if(cardContent){var context=view,id=cardContent.getAttribute("data-userid"),name=cardContent.getAttribute("data-username"),haspw=cardContent.getAttribute("data-haspw");"manual"===id?(context.querySelector("#txtManualName").value="",showManualForm(context,!0)):"false"==haspw?authenticateUserByName(context,getApiClient(),name,""):(context.querySelector("#txtManualName").value=name,context.querySelector("#txtManualPassword").value="",showManualForm(context,!0,!0))}})),view.querySelector(".manualLoginForm").addEventListener("submit",(function(e){_appSettings.default.enableAutoLogin(view.querySelector(".chkRememberLogin").checked);var apiClient=getApiClient();return authenticateUserByName(view,apiClient,view.querySelector("#txtManualName").value,view.querySelector("#txtManualPassword").value),e.preventDefault(),!1})),view.querySelector(".btnForgotPassword").addEventListener("click",(function(){Dashboard.navigate("forgotpassword.html")})),view.querySelector(".btnCancel").addEventListener("click",showVisualForm),view.querySelector(".btnManual").addEventListener("click",(function(){view.querySelector("#txtManualName").value="",showManualForm(view,!0)})),view.querySelector(".btnSelectServer").addEventListener("click",(function(){Dashboard.selectServer()})),view.addEventListener("viewshow",(function(e){_loading.default.show(),_libraryMenu.default.setTransparentMenu(!0),_apphost.default.supports("multiserver")||view.querySelector(".btnSelectServer").classList.add("hide");var apiClient=getApiClient();apiClient.getPublicUsers().then((function(users){users.length?(showVisualForm(),function loadUserList(context,apiClient,users){for(var html="",i=0;i<users.length;i++){var user=users[i],cssClass="card squareCard scalableCard squareCard-scalable";_layoutManager.default.tv&&(cssClass+=" show-focus",enableFocusTransform&&(cssClass+=" show-animation"));html+='<button type="button" class="'+cssClass+'">',html+='<div class="cardBox cardBox-bottompadded">',html+='<div class="cardScalable">',html+='<div class="cardPadder cardPadder-square"></div>',html+='<div class="cardContent" data-haspw="'+user.HasPassword+'" data-username="'+user.Name+'" data-userid="'+user.Id+'">';var imgUrl=void 0;if(user.PrimaryImageTag)imgUrl=apiClient.getUserImageUrl(user.Id,{width:300,tag:user.PrimaryImageTag,type:"Primary"}),html+='<div class="cardImageContainer coveredImage" style="background-image:url(\''+imgUrl+"');\"></div>";else{var background=getMetroColor(user.Id);html+='<div class="cardImageContainer coveredImage" style="background-image:url(\''+(imgUrl="assets/img/avatar.png")+"');background-color:"+background+';"></div>'}html+="</div>",html+="</div>",html+='<div class="cardFooter visualCardBox-cardFooter">',html+='<div class="cardText singleCardText cardTextCentered">'+user.Name+"</div>",html+="</div>",html+="</div>",html+="</button>"}context.querySelector("#divUsers").innerHTML=html}(view,apiClient,users)):(view.querySelector("#txtManualName").value="",showManualForm(view,!1,!1))})).catch().then((function(){_loading.default.hide()})),apiClient.getJSON(apiClient.getUrl("Branding/Configuration")).then((function(options){view.querySelector(".disclaimer").textContent=options.LoginDisclaimer||""}))})),view.addEventListener("viewhide",(function(e){_libraryMenu.default.setTransparentMenu(!1)}))},_apphost=_interopRequireDefault(_apphost),_appSettings=_interopRequireDefault(_appSettings),_dom=_interopRequireDefault(_dom),_connectionManager=_interopRequireDefault(_connectionManager),_loading=_interopRequireDefault(_loading),_layoutManager=_interopRequireDefault(_layoutManager),_libraryMenu=_interopRequireDefault(_libraryMenu),_browser=_interopRequireDefault(_browser),_globalize=_interopRequireDefault(_globalize);var enableFocusTransform=!_browser.default.slow&&!_browser.default.edge;function authenticateUserByName(page,apiClient,username,password){_loading.default.show(),apiClient.authenticateUserByName(username,password).then((function(result){var user=result.User;_loading.default.hide(),Dashboard.onServerChanged(user.Id,result.AccessToken,apiClient),Dashboard.navigate("home.html")}),(function(response){page.querySelector("#txtManualName").value="",page.querySelector("#txtManualPassword").value="",_loading.default.hide();[401,403].includes(response.status)?new Promise((function(_resolve,_reject){return _require(["toast"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){var toast=_ref.default,messageKey=401===response.status?"MessageInvalidUser":"MessageUnauthorizedUser";toast(_globalize.default.translate(messageKey))})):Dashboard.alert({message:_globalize.default.translate("MessageUnableToConnectToServer"),title:_globalize.default.translate("HeaderConnectionFailure")})}))}function showManualForm(context,showCancel,focusPassword){context.querySelector(".chkRememberLogin").checked=_appSettings.default.enableAutoLogin(),context.querySelector(".manualLoginForm").classList.remove("hide"),context.querySelector(".visualLoginForm").classList.add("hide"),context.querySelector(".btnManual").classList.add("hide"),focusPassword?context.querySelector("#txtManualPassword").focus():context.querySelector("#txtManualName").focus(),showCancel?context.querySelector(".btnCancel").classList.remove("hide"):context.querySelector(".btnCancel").classList.add("hide")}var metroColors=["#6FBD45","#4BB3DD","#4164A5","#E12026","#800080","#E1B222","#008040","#0094FF","#FF00C7","#FF870F","#7F0037"];function getMetroColor(str){if(str){for(var character=String(str.substr(0,1).charCodeAt()),sum=0,i=0;i<character.length;i++)sum+=parseInt(character.charAt(i));var index=String(sum).substr(-1);return metroColors[index]}return function getRandomMetroColor(){var index=Math.floor(Math.random()*(metroColors.length-1));return metroColors[index]}()}}));
//# sourceMappingURL=index.js.map
