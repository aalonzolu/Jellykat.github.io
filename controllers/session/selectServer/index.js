define(["require","exports","loading","appRouter","layoutManager","libraryMenu","appSettings","focusManager","connectionManager","globalize","actionsheet","dom","browser","material-icons","flexStyles","emby-scroller","emby-itemscontainer","cardStyle","emby-button"],(function(_require,_exports,_loading,_appRouter,_layoutManager,_libraryMenu,_appSettings,_focusManager,_connectionManager,_globalize,_actionsheet,_dom,_browser,_materialIcons,_flexStyles,_embyScroller,_embyItemscontainer,_cardStyle,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){function connectToServer(server){_loading.default.show(),_connectionManager.default.connectToServer(server,{enableAutoLogin:_appSettings.default.enableAutoLogin()}).then((function(result){_loading.default.hide();var apiClient=result.ApiClient;switch(result.State){case"SignedIn":Dashboard.onServerChanged(apiClient.getCurrentUserId(),apiClient.accessToken(),apiClient),Dashboard.navigate("home.html");break;case"ServerSignIn":Dashboard.onServerChanged(null,null,apiClient),Dashboard.navigate("login.html?serverid="+result.Servers[0].Id);break;case"ServerUpdateNeeded":alertTextWithOptions({text:_globalize.default.translate("core#ServerUpdateNeeded","https://github.com/jellyfin/jellyfin"),html:_globalize.default.translate("core#ServerUpdateNeeded",'<a href="https://github.com/jellyfin/jellyfin">https://github.com/jellyfin/jellyfin</a>')});break;default:!function showServerConnectionFailure(){!function alertText(text){alertTextWithOptions({text:text})}(_globalize.default.translate("MessageUnableToConnectToServer"))}()}}))}function onServerClick(server){var menuItems=[];menuItems.push({name:_globalize.default.translate("Connect"),id:"connect"}),menuItems.push({name:_globalize.default.translate("Delete"),id:"delete"}),_actionsheet.default.show({items:menuItems,title:server.Name}).then((function(id){switch(id){case"connect":connectToServer(server);break;case"delete":!function deleteServer(server){_loading.default.show(),_connectionManager.default.deleteServer(server.Id).then((function(){_loading.default.hide(),loadServers()}))}(server)}}))}function onServersRetrieved(result){servers=result,function renderSelectServerItems(view,servers){var items=servers.map((function(server){return{name:server.Name,showIcon:!0,icon:"cast",cardType:"",id:server.Id,server:server}})),html=items.map((function(item){var cardImageContainer;cardImageContainer=item.showIcon?'<span class="cardImageIcon material-icons '+item.icon+'"></span>':'<div class="cardImage" style="'+item.cardImageStyle+'"></div>';var cssClass="card overflowSquareCard loginSquareCard scalableCard overflowSquareCard-scalable";_layoutManager.default.tv&&(cssClass+=" show-focus",enableFocusTransform&&(cssClass+=" show-animation"));var cardContainer="";return cardContainer+='<button raised class="'+cssClass+'" style="display:inline-block;" data-id="'+item.id+'" data-url="'+(item.url||"")+'" data-cardtype="'+item.cardType+'">',cardContainer+='<div class="cardBox">',cardContainer+='<div class="cardScalable">',cardContainer+='<div class="cardPadder cardPadder-square">',cardContainer+="</div>",cardContainer+='<div class="cardContent">',cardContainer+='<div class="cardImageContainer coveredImage" style="background:#0288D1;border-radius:.15em;">',cardContainer+=cardImageContainer,cardContainer+="</div>",cardContainer+="</div>",cardContainer+="</div>",cardContainer+='<div class="cardFooter">',cardContainer+='<div class="cardText cardTextCentered">'+item.name+"</div>",cardContainer+="</div></div></button>"})).join(""),itemsContainer=view.querySelector(".servers");items.length||(html="<p>"+_globalize.default.translate("MessageNoServersAvailable")+"</p>");itemsContainer.innerHTML=html,_loading.default.hide()}(view,result),_layoutManager.default.tv&&_focusManager.default.autoFocus(view)}function loadServers(){_loading.default.show(),_connectionManager.default.getAvailableServers().then(onServersRetrieved)}var servers;(function updatePageStyle(view,params){"1"==params.showuser?(view.classList.add("libraryPage"),view.classList.remove("standalonePage"),view.classList.add("noSecondaryNavPage")):(view.classList.add("standalonePage"),view.classList.remove("libraryPage"),view.classList.remove("noSecondaryNavPage"))})(view,params),view.addEventListener("viewshow",(function(e){var isRestored=e.detail.isRestored;_appRouter.default.setTitle(null),_libraryMenu.default.setTransparentMenu(!0),isRestored||loadServers()})),view.querySelector(".servers").addEventListener("click",(function(e){var card=_dom.default.parentWithClass(e.target,"card");if(card){var url=card.getAttribute("data-url");if(url)_appRouter.default.show(url);else{var id=card.getAttribute("data-id");onServerClick(servers.filter((function(s){return s.Id===id}))[0])}}}))},_loading=_interopRequireDefault(_loading),_appRouter=_interopRequireDefault(_appRouter),_layoutManager=_interopRequireDefault(_layoutManager),_libraryMenu=_interopRequireDefault(_libraryMenu),_appSettings=_interopRequireDefault(_appSettings),_focusManager=_interopRequireDefault(_focusManager),_connectionManager=_interopRequireDefault(_connectionManager),_globalize=_interopRequireDefault(_globalize),_actionsheet=_interopRequireDefault(_actionsheet),_dom=_interopRequireDefault(_dom);var enableFocusTransform=!(_browser=_interopRequireDefault(_browser)).default.slow&&!_browser.default.edge;function alertTextWithOptions(options){new Promise((function(_resolve,_reject){return _require(["alert"],(function(imported){return _resolve(function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(options)}))}}));
//# sourceMappingURL=index.js.map
