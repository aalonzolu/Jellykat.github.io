define(["require","exports","jQuery","globalize","scripts/taskbutton","dom","layoutManager","loading","browser","listViewStyle","flexStyles","emby-itemscontainer","cardStyle","material-icons","emby-button"],(function(_require,_exports,_jQuery,_globalize,_taskbutton,_dom,_layoutManager,_loading,_browser,_listViewStyle,_flexStyles,_embyItemscontainer,_cardStyle,_materialIcons,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(){(0,_jQuery.default)(document).on("pageinit","#liveTvStatusPage",(function(){var page=this;(0,_jQuery.default)(".btnAddDevice",page).on("click",(function(){!function addDevice(button){Dashboard.navigate("livetvtuner.html")}()})),(0,_jQuery.default)(".formAddDevice",page).on("submit",(function(){return function submitAddDeviceForm(page){page.querySelector(".dlgAddDevice").close(),_loading.default.show(),ApiClient.ajax({type:"POST",url:ApiClient.getUrl("LiveTv/TunerHosts"),data:JSON.stringify({Type:(0,_jQuery.default)("#selectTunerDeviceType",page).val(),Url:(0,_jQuery.default)("#txtDevicePath",page).val()}),contentType:"application/json"}).then((function(){reload(page)}),(function(){Dashboard.alert({message:_globalize.default.translate("ErrorAddingTunerDevice")})}))}(page),!1})),(0,_jQuery.default)(".btnAddProvider",page).on("click",(function(){!function addProvider(button){var menuItems=[];menuItems.push({name:"Schedules Direct",id:"SchedulesDirect"}),menuItems.push({name:"XMLTV",id:"xmltv"}),new Promise((function(_resolve,_reject){return _require(["actionsheet"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref5){_ref5.default.show({items:menuItems,positionTo:button,callback:function callback(id){Dashboard.navigate(getProviderConfigurationUrl(id))}})}))}(this)})),page.querySelector(".devicesList").addEventListener("click",onDevicesListClick)})).on("pageshow","#liveTvStatusPage",(function(){reload(this),(0,_taskbutton.default)({mode:"on",progressElem:this.querySelector(".refreshGuideProgress"),taskKey:"RefreshGuide",button:this.querySelector(".btnRefresh")})})).on("pagehide","#liveTvStatusPage",(function(){(0,_taskbutton.default)({mode:"off",progressElem:this.querySelector(".refreshGuideProgress"),taskKey:"RefreshGuide",button:this.querySelector(".btnRefresh")})}))},_jQuery=_interopRequireDefault(_jQuery),_globalize=_interopRequireDefault(_globalize),_taskbutton=_interopRequireDefault(_taskbutton),_dom=_interopRequireDefault(_dom),_layoutManager=_interopRequireDefault(_layoutManager),_loading=_interopRequireDefault(_loading);var enableFocusTransform=!(_browser=_interopRequireDefault(_browser)).default.slow&&!_browser.default.edge;function getDeviceHtml(device){var cssClass="card scalableCard backdropCard backdropCard-scalable",html="";return _layoutManager.default.tv&&(cssClass+=" show-focus",enableFocusTransform&&(cssClass+=" show-animation")),html+='<div type="button" class="'+cssClass+'" data-id="'+device.Id+'">',html+='<div class="cardBox visualCardBox">',html+='<div class="cardScalable visualCardBox-cardScalable">',html+='<div class="cardPadder-backdrop"></div>',html+='<div class="cardContent searchImage">',html+='<div class="cardImageContainer coveredImage"><span class="cardImageIcon material-icons dvr"></span></div>',html+="</div>",html+="</div>",html+='<div class="cardFooter visualCardBox-cardFooter">',html+='<button is="paper-icon-button-light" class="itemAction btnCardOptions autoSize" data-action="menu"><span class="material-icons more_vert"></span></button>',html+='<div class="cardText">'+(device.FriendlyName||function getTunerName(providerId){switch(providerId=providerId.toLowerCase()){case"m3u":return"M3U";case"hdhomerun":return"HDHomeRun";case"hauppauge":return"Hauppauge";case"satip":return"DVB";default:return"Unknown"}}(device.Type))+"</div>",html+='<div class="cardText cardText-secondary">',html+=device.Url||"&nbsp;",html+="</div>",html+="</div>",(html+="</div>")+"</div>"}function reload(page){_loading.default.show(),ApiClient.getNamedConfiguration("livetv").then((function(config){!function renderDevices(page,devices){page.querySelector(".devicesList").innerHTML=devices.map(getDeviceHtml).join("")}(page,config.TunerHosts),function renderProviders(page,providers){var html="";if(providers.length){html+='<div class="paperList">';for(var i=0,length=providers.length;i<length;i++){var provider=providers[i];html+='<div class="listItem">',html+='<span class="listItemIcon material-icons dvr"></span>',html+='<div class="listItemBody two-line">',html+='<a is="emby-linkbutton" style="display:block;padding:0;margin:0;text-align:left;" class="clearLink" href="'+getProviderConfigurationUrl(provider.Type)+"&id="+provider.Id+'">',html+='<h3 class="listItemBodyText">',html+=getProviderName(provider.Type),html+="</h3>",html+='<div class="listItemBodyText secondary">',html+=provider.Path||provider.ListingsId||"",html+="</div>",html+="</a>",html+="</div>",html+='<button type="button" is="paper-icon-button-light" class="btnOptions" data-id="'+provider.Id+'"><span class="material-icons listItemAside more_vert"></span></button>',html+="</div>"}html+="</div>"}var elem=(0,_jQuery.default)(".providerList",page).html(html);(0,_jQuery.default)(".btnOptions",elem).on("click",(function(){var id=this.getAttribute("data-id");!function showProviderOptions(page,providerId,button){var items=[];items.push({name:_globalize.default.translate("Delete"),id:"delete"}),items.push({name:_globalize.default.translate("MapChannels"),id:"map"}),new Promise((function(_resolve,_reject){return _require(["actionsheet"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){_ref2.default.show({items:items,positionTo:button}).then((function(id){switch(id){case"delete":!function deleteProvider(page,id){var message=_globalize.default.translate("MessageConfirmDeleteGuideProvider");new Promise((function(_resolve,_reject){return _require(["confirm"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref4){(0,_ref4.default)(message,_globalize.default.translate("HeaderDeleteProvider")).then((function(){_loading.default.show(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("LiveTv/ListingProviders",{Id:id})}).then((function(){reload(page)}),(function(){reload(page)}))}))}))}(page,providerId);break;case"map":!function mapChannels(page,providerId){new Promise((function(_resolve,_reject){return _require(["components/channelMapper/channelMapper"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){new(0,_ref3.default)({serverId:ApiClient.serverInfo().Id,providerId:providerId}).show()}))}(0,providerId)}}))}))}(page,id,this)}))}(page,config.ListingProviders)})),_loading.default.hide()}function getProviderName(providerId){switch(providerId=providerId.toLowerCase()){case"schedulesdirect":return"Schedules Direct";case"xmltv":return"XMLTV";default:return"Unknown"}}function getProviderConfigurationUrl(providerId){switch(providerId=providerId.toLowerCase()){case"xmltv":return"livetvguideprovider.html?type=xmltv";case"schedulesdirect":return"livetvguideprovider.html?type=schedulesdirect"}}function showDeviceMenu(button,tunerDeviceId){var items=[];items.push({name:_globalize.default.translate("Delete"),id:"delete"}),items.push({name:_globalize.default.translate("Edit"),id:"edit"}),new Promise((function(_resolve,_reject){return _require(["actionsheet"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref6){_ref6.default.show({items:items,positionTo:button}).then((function(id){switch(id){case"delete":!function deleteDevice(page,id){var message=_globalize.default.translate("MessageConfirmDeleteTunerDevice");new Promise((function(_resolve,_reject){return _require(["confirm"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){(0,_ref.default)(message,_globalize.default.translate("HeaderDeleteDevice")).then((function(){_loading.default.show(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("LiveTv/TunerHosts",{Id:id})}).then((function(){reload(page)}))}))}))}(_dom.default.parentWithClass(button,"page"),tunerDeviceId);break;case"edit":Dashboard.navigate("livetvtuner.html?id="+tunerDeviceId)}}))}))}function onDevicesListClick(e){var card=_dom.default.parentWithClass(e.target,"card");if(card){var id=card.getAttribute("data-id"),btnCardOptions=_dom.default.parentWithClass(e.target,"btnCardOptions");btnCardOptions?showDeviceMenu(btnCardOptions,id):Dashboard.navigate("livetvtuner.html?id="+id)}}}));
//# sourceMappingURL=livetvstatus.js.map
