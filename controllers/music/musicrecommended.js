define(["require","exports","browser","layoutManager","userSettings","inputManager","loading","cardBuilder","dom","imageLoader","libraryMenu","mainTabsManager","globalize","scrollStyles","emby-itemscontainer","emby-tabs","emby-button","flexStyles"],(function(_require,_exports,_browser,_layoutManager,userSettings,_inputManager,_loading,_cardBuilder,_dom,_imageLoader,_libraryMenu,mainTabsManager,_globalize,_scrollStyles,_embyItemscontainer,_embyTabs,_embyButton,_flexStyles){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function itemsPerRow(){var screenWidth=_dom.default.getWindowSize().innerWidth;return screenWidth>=1920?9:screenWidth>=1200?12:screenWidth>=1e3?10:8}function enableScrollX(){return!_layoutManager.default.desktop}function getSquareShape(){return enableScrollX()?"overflowSquare":"square"}function loadLatest(page,parentId){_loading.default.show();var userId=ApiClient.getCurrentUserId(),options={IncludeItemTypes:"Audio",Limit:enableScrollX()?3*itemsPerRow():2*itemsPerRow(),Fields:"PrimaryImageAspectRatio,BasicSyncInfo",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getJSON(ApiClient.getUrl("Users/"+userId+"/Items/Latest",options)).then((function(items){var elem=page.querySelector("#recentlyAddedSongs");elem.innerHTML=_cardBuilder.default.getCardsHtml({items:items,showUnplayedIndicator:!1,showLatestItemsPopup:!1,shape:getSquareShape(),showTitle:!0,showParentTitle:!0,lazy:!0,centerText:!0,overlayPlayButton:!0,allowBottomPadding:!enableScrollX(),cardLayout:!1,coverImage:!0}),_imageLoader.default.lazyChildren(elem),_loading.default.hide(),new Promise((function(_resolve,_reject){return _require(["autoFocuser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){_ref.default.autoFocus(page)}))}))}function loadRecentlyPlayed(page,parentId){var options={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Audio",Limit:itemsPerRow(),Recursive:!0,Fields:"PrimaryImageAspectRatio,AudioInfo",Filters:"IsPlayed",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(ApiClient.getCurrentUserId(),options).then((function(result){var elem=page.querySelector("#recentlyPlayed");result.Items.length?elem.classList.remove("hide"):elem.classList.add("hide");var itemsContainer=elem.querySelector(".itemsContainer");itemsContainer.innerHTML=_cardBuilder.default.getCardsHtml({items:result.Items,showUnplayedIndicator:!1,shape:getSquareShape(),showTitle:!0,showParentTitle:!0,action:"instantmix",lazy:!0,centerText:!0,overlayMoreButton:!0,allowBottomPadding:!enableScrollX(),cardLayout:!1,coverImage:!0}),_imageLoader.default.lazyChildren(itemsContainer)}))}function loadFrequentlyPlayed(page,parentId){var options={SortBy:"PlayCount",SortOrder:"Descending",IncludeItemTypes:"Audio",Limit:itemsPerRow(),Recursive:!0,Fields:"PrimaryImageAspectRatio,AudioInfo",Filters:"IsPlayed",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(ApiClient.getCurrentUserId(),options).then((function(result){var elem=page.querySelector("#topPlayed");result.Items.length?elem.classList.remove("hide"):elem.classList.add("hide");var itemsContainer=elem.querySelector(".itemsContainer");itemsContainer.innerHTML=_cardBuilder.default.getCardsHtml({items:result.Items,showUnplayedIndicator:!1,shape:getSquareShape(),showTitle:!0,showParentTitle:!0,action:"instantmix",lazy:!0,centerText:!0,overlayMoreButton:!0,allowBottomPadding:!enableScrollX(),cardLayout:!1,coverImage:!0}),_imageLoader.default.lazyChildren(itemsContainer)}))}function getTabs(){return[{name:_globalize.default.translate("Suggestions")},{name:_globalize.default.translate("Albums")},{name:_globalize.default.translate("HeaderAlbumArtists")},{name:_globalize.default.translate("Artists")},{name:_globalize.default.translate("Playlists")},{name:_globalize.default.translate("Songs")},{name:_globalize.default.translate("Genres")}]}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){var _this=this;function reload(){_loading.default.show(),function loadSuggestionsTab(page,tabContent,parentId){console.debug("loadSuggestionsTab"),loadLatest(tabContent,parentId),loadRecentlyPlayed(tabContent,parentId),loadFrequentlyPlayed(tabContent,parentId),new Promise((function(_resolve,_reject){return _require(["components/favoriteitems"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){_ref2.default.render(tabContent,ApiClient.getCurrentUserId(),parentId,["favoriteArtists","favoriteAlbums","favoriteSongs"])}))}(0,view.querySelector(".pageTabContent[data-index='0']"),params.topParentId)}function onBeforeTabChange(e){!function preLoadTab(page,index){getTabController(page,index,(function(controller){-1==renderedTabs.indexOf(index)&&controller.preRender&&controller.preRender()}))}(view,parseInt(e.detail.selectedTabIndex))}function onTabChange(e){!function loadTab(page,index){currentTabIndex=index,getTabController(page,index,(function(controller){-1==renderedTabs.indexOf(index)&&(renderedTabs.push(index),controller.renderTab())}))}(view,parseInt(e.detail.selectedTabIndex))}function getTabContainers(){return view.querySelectorAll(".pageTabContent")}var getTabController=function getTabController(page,index,callback){var depends;switch(index){case 0:depends="controllers/music/musicrecommended";break;case 1:depends="controllers/music/musicalbums";break;case 2:case 3:depends="controllers/music/musicartists";break;case 4:depends="controllers/music/musicplaylists";break;case 5:depends="controllers/music/songs";break;case 6:depends="controllers/music/musicgenres"}new Promise((function(_resolve,_reject){return _require(["".concat(depends)],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref3){var tabContent,controllerFactory=_ref3.default;0==index&&(tabContent=view.querySelector(".pageTabContent[data-index='"+index+"']"),_this.tabContent=tabContent);var controller=tabControllers[index];controller||(tabContent=view.querySelector(".pageTabContent[data-index='"+index+"']"),controller=0===index?_this:7===index?new controllerFactory(view,tabContent,{collectionType:"music",parentId:params.topParentId}):new controllerFactory(view,params,tabContent),2==index?controller.mode="albumartists":3==index&&(controller.mode="artists"),tabControllers[index]=controller,controller.initTab&&controller.initTab()),callback(controller)}))};function onInputCommand(e){switch(e.detail.command){case"search":e.preventDefault(),Dashboard.navigate("search.html?collectionType=music&parentId="+params.topParentId)}}var currentTabIndex=parseInt(params.tab||function getDefaultTabIndex(folderId){switch(userSettings.get("landing-"+folderId)){case"albums":return 1;case"albumartists":return 2;case"artists":return 3;case"playlists":return 4;case"songs":return 5;case"genres":return 6;default:return 0}}(params.topParentId));this.initTab=function(){for(var elem,containers=view.querySelector(".pageTabContent[data-index='0']").querySelectorAll(".itemsContainer"),i=0,length=containers.length;i<length;i++)elem=containers[i],_browser.default.mobile?(elem.classList.add("hiddenScrollX"),_layoutManager.default.tv&&elem.classList.add("smoothScrollX"),elem.classList.add("scrollX"),elem.classList.remove("vertical-wrap")):(elem.classList.remove("hiddenScrollX"),elem.classList.remove("smoothScrollX"),elem.classList.remove("scrollX"),elem.classList.add("vertical-wrap"))},this.renderTab=function(){reload()};var tabControllers=[],renderedTabs=[];view.addEventListener("viewshow",(function(e){if(function initTabs(){mainTabsManager.setTabs(view,currentTabIndex,getTabs,getTabContainers,onBeforeTabChange,onTabChange)}(),!view.getAttribute("data-title")){var parentId=params.topParentId;parentId?ApiClient.getItem(ApiClient.getCurrentUserId(),parentId).then((function(item){view.setAttribute("data-title",item.Name),_libraryMenu.default.setTitle(item.Name)})):(view.setAttribute("data-title",_globalize.default.translate("TabMusic")),_libraryMenu.default.setTitle(_globalize.default.translate("TabMusic")))}_inputManager.default.on(window,onInputCommand)})),view.addEventListener("viewbeforehide",(function(e){_inputManager.default.off(window,onInputCommand)})),view.addEventListener("viewdestroy",(function(e){tabControllers.forEach((function(t){t.destroy&&t.destroy()}))}))},_browser=_interopRequireDefault(_browser),_layoutManager=_interopRequireDefault(_layoutManager),userSettings=_interopRequireWildcard(userSettings),_inputManager=_interopRequireDefault(_inputManager),_loading=_interopRequireDefault(_loading),_cardBuilder=_interopRequireDefault(_cardBuilder),_dom=_interopRequireDefault(_dom),_imageLoader=_interopRequireDefault(_imageLoader),_libraryMenu=_interopRequireDefault(_libraryMenu),mainTabsManager=_interopRequireWildcard(mainTabsManager),_globalize=_interopRequireDefault(_globalize)}));
//# sourceMappingURL=musicrecommended.js.map
