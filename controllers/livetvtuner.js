define(["require","exports","globalize","loading","dom","emby-input","emby-button","emby-checkbox","emby-select"],(function(_require,_exports,_globalize,_loading,_dom,_embyInput,_embyButton,_embyCheckbox,_embySelect){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function isM3uVariant(type){return-1!==["nextpvr"].indexOf(type||"")}function fillTunerHostInfo(view,info){var selectType=view.querySelector(".selectType"),type=info.Type||"";info.Source&&isM3uVariant(info.Source)&&(type=info.Source),selectType.value=type,onTypeChange.call(selectType),view.querySelector(".txtDevicePath").value=info.Url||"",view.querySelector(".txtFriendlyName").value=info.FriendlyName||"",view.querySelector(".txtUserAgent").value=info.UserAgent||"",view.querySelector(".fldDeviceId").value=info.DeviceId||"",view.querySelector(".chkFavorite").checked=info.ImportFavoritesOnly,view.querySelector(".chkTranscode").checked=info.AllowHWTranscoding,view.querySelector(".chkStreamLoop").checked=info.EnableStreamLooping,view.querySelector(".txtTunerCount").value=info.TunerCount||"0"}function onTypeChange(){var value=this.value,view=_dom.default.parentWithClass(this,"page"),mayIncludeUnsupportedDrmChannels="hdhomerun"===value,supportsTranscoding="hdhomerun"===value,supportsFavorites="hdhomerun"===value,supportsTunerIpAddress="hdhomerun"===value,supportsTunerFileOrUrl="m3u"===value,supportsStreamLooping="m3u"===value,supportsTunerCount="m3u"===value,supportsUserAgent="m3u"===value,suppportsSubmit="other"!==value,supportsSelectablePath=supportsTunerFileOrUrl,txtDevicePath=view.querySelector(".txtDevicePath");supportsTunerIpAddress?(txtDevicePath.label(_globalize.default.translate("LabelTunerIpAddress")),view.querySelector(".fldPath").classList.remove("hide")):supportsTunerFileOrUrl?(txtDevicePath.label(_globalize.default.translate("LabelFileOrUrl")),view.querySelector(".fldPath").classList.remove("hide")):view.querySelector(".fldPath").classList.add("hide"),supportsSelectablePath?(view.querySelector(".btnSelectPath").classList.remove("hide"),view.querySelector(".txtDevicePath").setAttribute("required","required")):(view.querySelector(".btnSelectPath").classList.add("hide"),view.querySelector(".txtDevicePath").removeAttribute("required")),supportsUserAgent?view.querySelector(".fldUserAgent").classList.remove("hide"):view.querySelector(".fldUserAgent").classList.add("hide"),supportsFavorites?view.querySelector(".fldFavorites").classList.remove("hide"):view.querySelector(".fldFavorites").classList.add("hide"),supportsTranscoding?view.querySelector(".fldTranscode").classList.remove("hide"):view.querySelector(".fldTranscode").classList.add("hide"),supportsStreamLooping?view.querySelector(".fldStreamLoop").classList.remove("hide"):view.querySelector(".fldStreamLoop").classList.add("hide"),supportsTunerCount?(view.querySelector(".fldTunerCount").classList.remove("hide"),view.querySelector(".txtTunerCount").setAttribute("required","required")):(view.querySelector(".fldTunerCount").classList.add("hide"),view.querySelector(".txtTunerCount").removeAttribute("required")),mayIncludeUnsupportedDrmChannels?view.querySelector(".drmMessage").classList.remove("hide"):view.querySelector(".drmMessage").classList.add("hide"),suppportsSubmit?view.querySelector(".button-submit").classList.remove("hide"):view.querySelector(".button-submit").classList.add("hide")}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){params.id||view.querySelector(".btnDetect").classList.remove("hide");view.addEventListener("viewshow",(function(){var currentId=params.id;(function fillTypes(view,currentId){return ApiClient.getJSON(ApiClient.getUrl("LiveTv/TunerHosts/Types")).then((function(types){var selectType=view.querySelector(".selectType"),html="";html+=types.map((function(tuner){return'<option value="'+tuner.Id+'">'+tuner.Name+"</option>"})).join(""),html+='<option value="other">',html+=_globalize.default.translate("TabOther"),html+="</option>",selectType.innerHTML=html,selectType.disabled=null!=currentId,selectType.value="",onTypeChange.call(selectType)}))})(view,currentId).then((function(){!function reload(view,providerId){view.querySelector(".txtDevicePath").value="",view.querySelector(".chkFavorite").checked=!1,view.querySelector(".txtDevicePath").value="",providerId&&ApiClient.getNamedConfiguration("livetv").then((function(config){var info=config.TunerHosts.filter((function(i){return i.Id===providerId}))[0];fillTunerHostInfo(view,info)}))}(view,currentId)}))})),view.querySelector("form").addEventListener("submit",(function(e){return function submitForm(page){_loading.default.show();var info={Type:page.querySelector(".selectType").value,Url:page.querySelector(".txtDevicePath").value||null,UserAgent:page.querySelector(".txtUserAgent").value||null,FriendlyName:page.querySelector(".txtFriendlyName").value||null,DeviceId:page.querySelector(".fldDeviceId").value||null,TunerCount:page.querySelector(".txtTunerCount").value||0,ImportFavoritesOnly:page.querySelector(".chkFavorite").checked,AllowHWTranscoding:page.querySelector(".chkTranscode").checked,EnableStreamLooping:page.querySelector(".chkStreamLoop").checked};isM3uVariant(info.Type)&&(info.Source=info.Type,info.Type="m3u");getParameterByName("id")&&(info.Id=getParameterByName("id"));ApiClient.ajax({type:"POST",url:ApiClient.getUrl("LiveTv/TunerHosts"),data:JSON.stringify(info),contentType:"application/json"}).then((function(result){Dashboard.processServerConfigurationUpdateResult(),Dashboard.navigate("livetvstatus.html")}),(function(){_loading.default.hide(),Dashboard.alert({message:_globalize.default.translate("ErrorSavingTvProvider")})}))}(view),e.preventDefault(),e.stopPropagation(),!1})),view.querySelector(".selectType").addEventListener("change",onTypeChange),view.querySelector(".btnDetect").addEventListener("click",(function(){(function getDetectedDevice(){return new Promise((function(_resolve,_reject){return _require(["tunerPicker"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){return(new(0,_ref.default)).show({serverId:ApiClient.serverId()})}))})().then((function(info){fillTunerHostInfo(view,info)}))})),view.querySelector(".btnSelectPath").addEventListener("click",(function(){new Promise((function(_resolve,_reject){return _require(["directorybrowser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){var picker=new(0,_ref2.default);picker.show({includeFiles:!0,callback:function callback(path){path&&(view.querySelector(".txtDevicePath").value=path),picker.close()}})}))}))},_globalize=_interopRequireDefault(_globalize),_loading=_interopRequireDefault(_loading),_dom=_interopRequireDefault(_dom)}));
//# sourceMappingURL=livetvtuner.js.map
