{"version":3,"sources":["controllers/livetvtuner.js"],"names":["define","_require","_exports","_globalize","_loading","_dom","_embyInput","_embyButton","_embyCheckbox","_embySelect","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","isM3uVariant","type","indexOf","fillTunerHostInfo","view","info","selectType","querySelector","Type","Source","value","onTypeChange","Url","FriendlyName","UserAgent","DeviceId","checked","ImportFavoritesOnly","AllowHWTranscoding","EnableStreamLooping","TunerCount","this","dom","parentWithClass","mayIncludeUnsupportedDrmChannels","supportsTranscoding","supportsFavorites","supportsTunerIpAddress","supportsTunerFileOrUrl","supportsStreamLooping","supportsTunerCount","supportsUserAgent","suppportsSubmit","supportsSelectablePath","txtDevicePath","label","globalize","translate","classList","remove","add","setAttribute","removeAttribute","_default","params","id","addEventListener","currentId","fillTypes","ApiClient","getJSON","getUrl","then","types","html","map","tuner","Id","Name","join","innerHTML","disabled","reload","providerId","getNamedConfiguration","config","TunerHosts","filter","i","e","submitForm","page","loading","show","getParameterByName","ajax","url","data","JSON","stringify","contentType","result","Dashboard","processServerConfigurationUpdateResult","navigate","hide","alert","message","preventDefault","stopPropagation","getDetectedDevice","Promise","_resolve","_reject","imported","_ref","tunerPicker","serverId","_ref2","picker","directorybrowser","includeFiles","callback","path","close"],"mappings":"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","file":"livetvtuner.js","sourcesContent":["import globalize from 'globalize';\nimport loading from 'loading';\nimport dom from 'dom';\nimport 'emby-input';\nimport 'emby-button';\nimport 'emby-checkbox';\nimport 'emby-select';\n\nfunction isM3uVariant(type) {\n    return ['nextpvr'].indexOf(type || '') !== -1;\n}\n\nfunction fillTypes(view, currentId) {\n    return ApiClient.getJSON(ApiClient.getUrl('LiveTv/TunerHosts/Types')).then(function (types) {\n        const selectType = view.querySelector('.selectType');\n        let html = '';\n        html += types.map(function (tuner) {\n            return '<option value=\"' + tuner.Id + '\">' + tuner.Name + '</option>';\n        }).join('');\n        html += '<option value=\"other\">';\n        html += globalize.translate('TabOther');\n        html += '</option>';\n        selectType.innerHTML = html;\n        selectType.disabled = currentId != null;\n        selectType.value = '';\n        onTypeChange.call(selectType);\n    });\n}\n\nfunction reload(view, providerId) {\n    view.querySelector('.txtDevicePath').value = '';\n    view.querySelector('.chkFavorite').checked = false;\n    view.querySelector('.txtDevicePath').value = '';\n\n    if (providerId) {\n        ApiClient.getNamedConfiguration('livetv').then(function (config) {\n            const info = config.TunerHosts.filter(function (i) {\n                return i.Id === providerId;\n            })[0];\n            fillTunerHostInfo(view, info);\n        });\n    }\n}\n\nfunction fillTunerHostInfo(view, info) {\n    const selectType = view.querySelector('.selectType');\n    let type = info.Type || '';\n\n    if (info.Source && isM3uVariant(info.Source)) {\n        type = info.Source;\n    }\n\n    selectType.value = type;\n    onTypeChange.call(selectType);\n    view.querySelector('.txtDevicePath').value = info.Url || '';\n    view.querySelector('.txtFriendlyName').value = info.FriendlyName || '';\n    view.querySelector('.txtUserAgent').value = info.UserAgent || '';\n    view.querySelector('.fldDeviceId').value = info.DeviceId || '';\n    view.querySelector('.chkFavorite').checked = info.ImportFavoritesOnly;\n    view.querySelector('.chkTranscode').checked = info.AllowHWTranscoding;\n    view.querySelector('.chkStreamLoop').checked = info.EnableStreamLooping;\n    view.querySelector('.txtTunerCount').value = info.TunerCount || '0';\n}\n\nfunction submitForm(page) {\n    loading.show();\n    const info = {\n        Type: page.querySelector('.selectType').value,\n        Url: page.querySelector('.txtDevicePath').value || null,\n        UserAgent: page.querySelector('.txtUserAgent').value || null,\n        FriendlyName: page.querySelector('.txtFriendlyName').value || null,\n        DeviceId: page.querySelector('.fldDeviceId').value || null,\n        TunerCount: page.querySelector('.txtTunerCount').value || 0,\n        ImportFavoritesOnly: page.querySelector('.chkFavorite').checked,\n        AllowHWTranscoding: page.querySelector('.chkTranscode').checked,\n        EnableStreamLooping: page.querySelector('.chkStreamLoop').checked\n    };\n\n    if (isM3uVariant(info.Type)) {\n        info.Source = info.Type;\n        info.Type = 'm3u';\n    }\n\n    if (getParameterByName('id')) {\n        info.Id = getParameterByName('id');\n    }\n\n    ApiClient.ajax({\n        type: 'POST',\n        url: ApiClient.getUrl('LiveTv/TunerHosts'),\n        data: JSON.stringify(info),\n        contentType: 'application/json'\n    }).then(function (result) {\n        Dashboard.processServerConfigurationUpdateResult();\n        Dashboard.navigate('livetvstatus.html');\n    }, function () {\n        loading.hide();\n        Dashboard.alert({\n            message: globalize.translate('ErrorSavingTvProvider')\n        });\n    });\n}\n\nfunction getDetectedDevice() {\n    return import('tunerPicker').then(({default: tunerPicker}) => {\n        return new tunerPicker().show({\n            serverId: ApiClient.serverId()\n        });\n    });\n}\n\nfunction onTypeChange() {\n    const value = this.value;\n    const view = dom.parentWithClass(this, 'page');\n    const mayIncludeUnsupportedDrmChannels = value === 'hdhomerun';\n    const supportsTranscoding = value === 'hdhomerun';\n    const supportsFavorites = value === 'hdhomerun';\n    const supportsTunerIpAddress = value === 'hdhomerun';\n    const supportsTunerFileOrUrl = value === 'm3u';\n    const supportsStreamLooping = value === 'm3u';\n    const supportsTunerCount = value === 'm3u';\n    const supportsUserAgent = value === 'm3u';\n    const suppportsSubmit = value !== 'other';\n    const supportsSelectablePath = supportsTunerFileOrUrl;\n    const txtDevicePath = view.querySelector('.txtDevicePath');\n\n    if (supportsTunerIpAddress) {\n        txtDevicePath.label(globalize.translate('LabelTunerIpAddress'));\n        view.querySelector('.fldPath').classList.remove('hide');\n    } else if (supportsTunerFileOrUrl) {\n        txtDevicePath.label(globalize.translate('LabelFileOrUrl'));\n        view.querySelector('.fldPath').classList.remove('hide');\n    } else {\n        view.querySelector('.fldPath').classList.add('hide');\n    }\n\n    if (supportsSelectablePath) {\n        view.querySelector('.btnSelectPath').classList.remove('hide');\n        view.querySelector('.txtDevicePath').setAttribute('required', 'required');\n    } else {\n        view.querySelector('.btnSelectPath').classList.add('hide');\n        view.querySelector('.txtDevicePath').removeAttribute('required');\n    }\n\n    if (supportsUserAgent) {\n        view.querySelector('.fldUserAgent').classList.remove('hide');\n    } else {\n        view.querySelector('.fldUserAgent').classList.add('hide');\n    }\n\n    if (supportsFavorites) {\n        view.querySelector('.fldFavorites').classList.remove('hide');\n    } else {\n        view.querySelector('.fldFavorites').classList.add('hide');\n    }\n\n    if (supportsTranscoding) {\n        view.querySelector('.fldTranscode').classList.remove('hide');\n    } else {\n        view.querySelector('.fldTranscode').classList.add('hide');\n    }\n\n    if (supportsStreamLooping) {\n        view.querySelector('.fldStreamLoop').classList.remove('hide');\n    } else {\n        view.querySelector('.fldStreamLoop').classList.add('hide');\n    }\n\n    if (supportsTunerCount) {\n        view.querySelector('.fldTunerCount').classList.remove('hide');\n        view.querySelector('.txtTunerCount').setAttribute('required', 'required');\n    } else {\n        view.querySelector('.fldTunerCount').classList.add('hide');\n        view.querySelector('.txtTunerCount').removeAttribute('required');\n    }\n\n    if (mayIncludeUnsupportedDrmChannels) {\n        view.querySelector('.drmMessage').classList.remove('hide');\n    } else {\n        view.querySelector('.drmMessage').classList.add('hide');\n    }\n\n    if (suppportsSubmit) {\n        view.querySelector('.button-submit').classList.remove('hide');\n    } else {\n        view.querySelector('.button-submit').classList.add('hide');\n    }\n}\n\nexport default function (view, params) {\n    if (!params.id) {\n        view.querySelector('.btnDetect').classList.remove('hide');\n    }\n\n    view.addEventListener('viewshow', function () {\n        const currentId = params.id;\n        fillTypes(view, currentId).then(function () {\n            reload(view, currentId);\n        });\n    });\n    view.querySelector('form').addEventListener('submit', function (e) {\n        submitForm(view);\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n    });\n    view.querySelector('.selectType').addEventListener('change', onTypeChange);\n    view.querySelector('.btnDetect').addEventListener('click', function () {\n        getDetectedDevice().then(function (info) {\n            fillTunerHostInfo(view, info);\n        });\n    });\n    view.querySelector('.btnSelectPath').addEventListener('click', function () {\n        import('directorybrowser').then(({default: directorybrowser}) => {\n            const picker = new directorybrowser();\n            picker.show({\n                includeFiles: true,\n                callback: function (path) {\n                    if (path) {\n                        view.querySelector('.txtDevicePath').value = path;\n                    }\n\n                    picker.close();\n                }\n            });\n        });\n    });\n}\n"]}