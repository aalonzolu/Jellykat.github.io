define(["require","exports","events","inputManager","libraryMenu","layoutManager","loading","dom","userSettings","cardBuilder","playbackManager","mainTabsManager","globalize","scrollStyles","emby-itemscontainer","emby-button"],(function(_require,_exports,_events,_inputManager,_libraryMenu,_layoutManager,_loading,_dom,userSettings,_cardBuilder,_playbackManager,mainTabsManager,_globalize,_scrollStyles,_embyItemscontainer,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function getTabs(){return[{name:_globalize.default.translate("Shows")},{name:_globalize.default.translate("Suggestions")},{name:_globalize.default.translate("TabLatest")},{name:_globalize.default.translate("TabUpcoming")},{name:_globalize.default.translate("Genres")},{name:_globalize.default.translate("TabNetworks")},{name:_globalize.default.translate("Episodes")}]}function setScrollClasses(elem,scrollX){scrollX?(elem.classList.add("hiddenScrollX"),_layoutManager.default.tv&&elem.classList.add("smoothScrollX"),elem.classList.add("scrollX"),elem.classList.remove("vertical-wrap")):(elem.classList.remove("hiddenScrollX"),elem.classList.remove("smoothScrollX"),elem.classList.remove("scrollX"),elem.classList.add("vertical-wrap"))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){function reload(){_loading.default.show(),function loadResume(){var parentId=_libraryMenu.default.getTopParentId(),options={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Episode",Filters:"IsResumable",Limit:_dom.default.getWindowSize().innerWidth>=1600?5:6,Recursive:!0,Fields:"PrimaryImageAspectRatio,SeriesInfo,UserData,BasicSyncInfo",ExcludeLocationTypes:"Virtual",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(ApiClient.getCurrentUserId(),options).then((function(result){result.Items.length?view.querySelector("#resumableSection").classList.remove("hide"):view.querySelector("#resumableSection").classList.add("hide");var allowBottomPadding=!enableScrollX(),container=view.querySelector("#resumableItems");_cardBuilder.default.buildCards(result.Items,{itemsContainer:container,preferThumb:!0,shape:enableScrollX()?"overflowBackdrop":"backdrop",scalable:!0,showTitle:!0,showParentTitle:!0,overlayText:!1,centerText:!0,overlayPlayButton:!0,allowBottomPadding:allowBottomPadding,cardLayout:!1})}))}(),function loadNextUp(){var query={Limit:24,Fields:"PrimaryImageAspectRatio,SeriesInfo,DateCreated,BasicSyncInfo",UserId:ApiClient.getCurrentUserId(),ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb",EnableTotalRecordCount:!1};query.ParentId=_libraryMenu.default.getTopParentId(),ApiClient.getNextUpEpisodes(query).then((function(result){result.Items.length?view.querySelector(".noNextUpItems").classList.add("hide"):view.querySelector(".noNextUpItems").classList.remove("hide");var container=view.querySelector("#nextUpItems");_cardBuilder.default.buildCards(result.Items,{itemsContainer:container,preferThumb:!0,shape:"backdrop",scalable:!0,showTitle:!0,showParentTitle:!0,overlayText:!1,centerText:!0,overlayPlayButton:!0,cardLayout:!1}),_loading.default.hide(),new Promise((function(_resolve,_reject){return _require(["autoFocuser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){_ref.default.autoFocus(view)}))}))}()}function enableScrollX(){return!_layoutManager.default.desktop}function onBeforeTabChange(e){!function preLoadTab(page,index){getTabController(page,index,(function(controller){-1==renderedTabs.indexOf(index)&&controller.preRender&&controller.preRender()}))}(view,parseInt(e.detail.selectedTabIndex))}function onTabChange(e){var newIndex=parseInt(e.detail.selectedTabIndex);!function loadTab(page,index){currentTabIndex=index,getTabController(page,index,(function(controller){-1==renderedTabs.indexOf(index)&&(renderedTabs.push(index),controller.renderTab())}))}(view,newIndex)}function getTabContainers(){return view.querySelectorAll(".pageTabContent")}function getTabController(page,index,callback){var depends;switch(index){case 0:depends="controllers/shows/tvshows";break;case 1:depends="controllers/shows/tvrecommended";break;case 2:depends="controllers/shows/tvlatest";break;case 3:depends="controllers/shows/tvupcoming";break;case 4:depends="controllers/shows/tvgenres";break;case 5:depends="controllers/shows/tvstudios";break;case 6:depends="controllers/shows/episodes"}new Promise((function(_resolve,_reject){return _require(["".concat(depends)],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){var tabContent,controllerFactory=_ref2.default;1===index&&(tabContent=view.querySelector(".pageTabContent[data-index='"+index+"']"),self.tabContent=tabContent);var controller=tabControllers[index];controller||(tabContent=view.querySelector(".pageTabContent[data-index='"+index+"']"),controller=1===index?self:7===index?new controllerFactory(view,tabContent,{collectionType:"tvshows",parentId:params.topParentId}):new controllerFactory(view,params,tabContent),tabControllers[index]=controller,controller.initTab&&controller.initTab()),callback(controller)}))}function onPlaybackStop(e,state){state.NowPlayingItem&&"Video"==state.NowPlayingItem.MediaType&&(renderedTabs=[],mainTabsManager.getTabsElement().triggerTabChange())}function onWebSocketMessage(e,data){var msg=data;"UserDataChanged"===msg.MessageType&&msg.Data.UserId==ApiClient.getCurrentUserId()&&(renderedTabs=[])}function onInputCommand(e){switch(e.detail.command){case"search":e.preventDefault(),Dashboard.navigate("search.html?collectionType=tv&parentId="+params.topParentId)}}var self=this,currentTabIndex=parseInt(params.tab||function getDefaultTabIndex(folderId){switch(userSettings.get("landing-"+folderId)){case"suggestions":return 1;case"latest":return 2;case"favorites":return 1;case"genres":return 4;default:return 0}}(params.topParentId));self.initTab=function(){setScrollClasses(self.tabContent.querySelector("#resumableItems"),enableScrollX())},self.renderTab=function(){reload()};var tabControllers=[],renderedTabs=[];setScrollClasses(view.querySelector("#resumableItems"),enableScrollX()),view.addEventListener("viewshow",(function(e){if(function initTabs(){mainTabsManager.setTabs(view,currentTabIndex,getTabs,getTabContainers,onBeforeTabChange,onTabChange)}(),!view.getAttribute("data-title")){var parentId=params.topParentId;parentId?ApiClient.getItem(ApiClient.getCurrentUserId(),parentId).then((function(item){view.setAttribute("data-title",item.Name),_libraryMenu.default.setTitle(item.Name)})):(view.setAttribute("data-title",_globalize.default.translate("Shows")),_libraryMenu.default.setTitle(_globalize.default.translate("Shows")))}_events.default.on(_playbackManager.default,"playbackstop",onPlaybackStop),_events.default.on(ApiClient,"message",onWebSocketMessage),_inputManager.default.on(window,onInputCommand)})),view.addEventListener("viewbeforehide",(function(e){_inputManager.default.off(window,onInputCommand),_events.default.off(_playbackManager.default,"playbackstop",onPlaybackStop),_events.default.off(ApiClient,"message",onWebSocketMessage)})),view.addEventListener("viewdestroy",(function(e){tabControllers.forEach((function(t){t.destroy&&t.destroy()}))}))},_events=_interopRequireDefault(_events),_inputManager=_interopRequireDefault(_inputManager),_libraryMenu=_interopRequireDefault(_libraryMenu),_layoutManager=_interopRequireDefault(_layoutManager),_loading=_interopRequireDefault(_loading),_dom=_interopRequireDefault(_dom),userSettings=_interopRequireWildcard(userSettings),_cardBuilder=_interopRequireDefault(_cardBuilder),_playbackManager=_interopRequireDefault(_playbackManager),mainTabsManager=_interopRequireWildcard(mainTabsManager),_globalize=_interopRequireDefault(_globalize)}));
//# sourceMappingURL=tvrecommended.js.map
