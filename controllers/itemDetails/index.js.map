{"version":3,"sources":["controllers/itemDetails/index.js"],"names":["define","_require","_exports","_apphost","_loading","_appRouter","_itemShortcuts","_layoutManager","_connectionManager","userSettings","_cardBuilder","_datetime","_mediaInfo","_backdrop","_listView","_itemContextMenu","_itemHelper","_dom","_indicators","_imageLoader","_libraryMenu","_globalize","_browser","_events","_playbackManager","_scrollStyles","_embyItemscontainer","_embyCheckbox","_embyButton","_embyPlaystatebutton","_embyRatingbutton","_embyScroller","_embySelect","_interopRequireDefault","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_getRequireWildcardCache","WeakMap","cache","_interopRequireWildcard","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","_createForOfIteratorHelper","o","allowArrayLike","it","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e2","f","TypeError","err","normalCompletion","didErr","step","next","_e3","return","minLen","_arrayLikeToArray","toString","slice","name","from","test","arr","len","arr2","getPromise","apiClient","params","id","getItem","getCurrentUserId","seriesTimerId","getLiveTvSeriesTimer","genre","getGenre","musicgenre","getMusicGenre","musicartist","getArtist","Error","hideAll","page","className","show","_step","_iterator","querySelectorAll","elem","classList","remove","add","getContextMenuOptions","item","user","button","open","play","playAllFromHere","queueAllFromHere","positionTo","cancelTimer","record","deleteItem","CanDelete","shuffle","instantMix","share","renderTrackSelections","instance","forceReload","select","querySelector","MediaSources","itemHelper","supportsMediaSourceSelection","playbackManager","getSupportedCommands","indexOf","canPlay","innerHTML","mediaSources","_currentPlaybackMediaSources","setLabel","globalize","translate","currentValue","selectedId","Id","map","v","selected","Name","join","renderVideoSelections","renderAudioSelections","renderSubtitleSelections","mediaSourceId","tracks","filter","m","MediaStreams","Type","Index","titleParts","resolutionText","mediaInfo","getResolutionText","push","Codec","toUpperCase","DisplayTitle","setAttribute","mediaSource","DefaultAudioStreamIndex","removeAttribute","DefaultSubtitleStreamIndex","reloadPlayButtons","now","Date","datetime","parseISO8601Date","StartDate","EndDate","IsFolder","isResumable","UserData","PlaybackPositionTicks","_step2","_iterator2","replace","getArtistLinksHtml","artists","serverId","context","_step3","html","_iterator3","artist","href","appRouter","getRouteUrl","itemType","setTrailerButtonVisibility","LocalTrailerCount","RemoteTrailers","setInitialCollapsibleState","renderPlaylistItems","Promise","_resolve","_reject","imported","then","PlaylistViewer","render","renderItemsByName","window","ItemsByName","renderItems","renderChildren","renderSeriesSchedule","connectionManager","getApiClient","ServerId","getLiveTvPrograms","UserId","HasAired","SortBy","EnableTotalRecordCount","EnableImages","ImageTypeLimit","Limit","EnableUserData","LibrarySeriesId","result","Items","listView","getListViewHtml","items","enableUserDataButtons","showParentTitle","image","showProgramDateTime","showTitle","moreButton","action","loading","hide","renderNextUp","section","getNextUpEpisodes","SeriesId","cardBuilder","getCardsHtml","shape","displayAsSpecial","IndexNumber","overlayText","centerText","overlayPlayButton","itemsContainer","imageLoader","lazyChildren","renderScenes","chapters","Chapters","ImageTag","scenesContent","_ref5","buildChapterCards","backdropShape","squareShape","imageBlurhashes","ImageBlurHashes","SpecialFeatureCount","renderSpecials","getSpecialFeatures","specials","specialsContent","getVideosHtml","renderCast","PartCount","renderAdditionalParts","getAdditionalVideoParts","additionalPartsContent","renderMusicVideos","getItems","SortOrder","IncludeItemTypes","Recursive","Fields","AlbumIds","musicVideosContent","toggleLineClamp","clampTarget","expandButton","target","contains","renderDetails","isStatic","renderSimilarItems","similarCollapsible","options","userId","limit","fields","AlbumArtists","ExcludeArtistIds","getSimilarItems","lazy","showDetailsMenu","coverImage","showYear","similarContent","renderMoreFromSeason","view","SeasonId","getEpisodes","SeasonName","buildCards","parentContainer","sectionTitleTagName","scalable","includeParentInfoInTitle","allowBottomPadding","card","setTimeout","toStart","previousSibling","renderMoreFromArtist","isMinServerVersion","query","ExcludeItemIds","ContributingArtistIds","AlbumArtistIds","ArtistIds","renderDirector","directors","People","person","directorsGroup","renderWriter","writers","writersGroup","renderGenres","arguments","undefined","inferContext","genres","GenreItems","type","p","genresLabel","genresValue","genresGroup","renderChannelGuide","ChannelIds","renderProgramsForChannel","currentItems","currentStartDate","itemStartDate","toDateString","toLocaleDateString","weekday","month","day","showProgramTime","parentTitleWithTitle","renderTagline","taglineElement","Taglines","renderOverview","_step5","_iterator5","overviewElemnt","overview","Overview","parentElement","Math","abs","scrollHeight","offsetHeight","addEventListener","bind","_step6","_iterator6","renderMiscInfo","_step7","_iterator7","miscInfo","fillPrimaryMediaInfo","interactive","episodeTitle","subtitles","_step8","_iterator8","fillSecondaryMediaInfo","reloadUserDataButtons","btnPlaystates","btnPlaystate","canMarkPlayed","setItem","btnUserRatings","btnUserRating","canRate","renderLinks","externalLinksElem","links","layoutManager","tv","HomePageUrl","concat","ExternalUrls","_step4","_iterator4","url","Url","renderTags","itemTags","tagElements","tags","Tags","renderSeriesAirTime","seriesAirTime","AirDays","a","AirTime","Studios","Status","enableScrollX","browser","mobile","screen","availWidth","promise","ParentId","getSeasons","seasonId","scrollX","isList","childrenItemsContainer","smallIcon","showIndex","index","showIndexNumberLeft","playFromHere","containerAlbumArtists","showIndexNumber","enableOverview","enablePlayedButton","infoButton","imageSize","enableSideMediaInfo","highlight","desktop","imagePlayButton","collectionItemTypes","mediaType","renderCollectionItems","parentItem","types","_step9","_iterator9","typeItems","filterItemsByCollectionItemType","renderCollectionItemType","otherType","otherTypeItems","curr","t","_step10","containers","notifyRefreshNeeded","_iterator10","canPlaySomeItemInCollection","_ref4","autoFocus","typeInfo","MediaType","getSquareShape","getPortraitShape","overlayMoreButton","showAddToCollection","showRemoveFromCollection","collectionId","collectionItems","insertAdjacentHTML","showRuntime","people","castContent","_ref6","buildPeopleCards","bindAll","selector","eventName","fn","_step11","_iterator11","onTrackSelectionsSubmit","preventDefault","_default","reload","ApiClient","all","getCurrentUser","_ref7","_ref8","_slicedToArray","_arrayWithHoles","_iterableToArrayLimit","_arr","_n","_d","_e","_s","_i","_nonIterableRest","currentItem","reloadFromItem","Emby","Page","setTitle","renderImage","renderDetailImage","itemArray","cardHtml","transition","disableIndicators","width","dom","getWindowSize","innerWidth","renderLogo","detailLogo","logoImageUrl","ImageTags","Logo","tag","getScaledImageUrl","ParentLogoImageTag","ParentLogoItemId","enableBackdrops","setLazyImage","renderBackdrop","backdrop","setBackdrops","clearBackdrop","renderDetailPageBackdrop","imgUrl","hasbackdrop","itemBackdropElement","detailsBanner","BackdropImageTags","maxWidth","getScreenWidth","lazyImage","ParentBackdropItemId","ParentBackdropImageTags","Primary","style","backgroundImage","renderName","container","parentRoute","parentNameHtml","parentNameLast","ArtistItems","SeriesName","IsSeries","EpisodeTitle","ParentIndexNumber","Album","AlbumId","tvShowHtml","tvSeasonHtml","getDisplayName","includeParentInfo","OriginalTitle","renderSeriesTimerEditor","Policy","EnableLiveTvManagement","_ref","embed","renderSeriesTimerSchedule","getLiveTvTimers","EnableImageTypes","SeriesTimerId","getProgramScheduleHtml","imageSource","showChannel","recordButton","scheduleTab","renderTimerEditor","TimerId","showRecordingFields","currentRecordingFields","recordingFieldsElement","_ref3","recordingFields","parent","programId","groupedVersions","g","IsAdministrator","itemContextMenu","getCommands","itemBirthday","PremiereDate","birthday","itemDeathDate","deathday","itemBirthLocation","ProductionLocations","gmap","setPeopleHeader","CanDownload","appHost","supports","_ref2","catch","error","console","playItem","startPosition","playOptions","getPlayOptions","audioStreamIndex","startPositionTicks","subtitleStreamIndex","onPlayClick","playCurrentItem","mode","getLiveTvChannel","ChannelId","channel","this","getAttribute","onPlayerChange","self","onWebSocketMessage","data","msg","MessageType","Data","Key","userData","UserDataList","u","refreshImage","refreshDetailImageUserData","indicators","getProgressBarHtml","onInstantMixClick","onShuffleClick","onPlayTrailerClick","playTrailer","playTrailers","onCancelSeriesTimerClick","_ref10","cancelSeriesTimerWithConfirmation","Dashboard","navigate","onCancelTimerClick","_ref11","onDownloadClick","_ref12","fileDownloader","downloadHref","getItemDownloadUrl","download","itemId","onPosterClick","itemShortcuts","onClick","splitVersions","_ref9","confirm","ajax","getUrl","onMoreCommandsClick","selectedItem","deleted","goHome","updated","libraryMenu","setTransparentMenu","detail","isRestored","events","on","off","ItemDetailPage","itemDetailPage"],"mappings":"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","file":"index.js","sourcesContent":["import appHost from 'apphost';\nimport loading from 'loading';\nimport appRouter from 'appRouter';\nimport itemShortcuts from 'itemShortcuts';\nimport layoutManager from 'layoutManager';\nimport connectionManager from 'connectionManager';\nimport * as userSettings from 'userSettings';\nimport cardBuilder from 'cardBuilder';\nimport datetime from 'datetime';\nimport mediaInfo from 'mediaInfo';\nimport backdrop from 'backdrop';\nimport listView from 'listView';\nimport itemContextMenu from 'itemContextMenu';\nimport itemHelper from 'itemHelper';\nimport dom from 'dom';\nimport indicators from 'indicators';\nimport imageLoader from 'imageLoader';\nimport libraryMenu from 'libraryMenu';\nimport globalize from 'globalize';\nimport browser from 'browser';\nimport events from 'events';\nimport playbackManager from 'playbackManager';\nimport 'scrollStyles';\nimport 'emby-itemscontainer';\nimport 'emby-checkbox';\nimport 'emby-button';\nimport 'emby-playstatebutton';\nimport 'emby-ratingbutton';\nimport 'emby-scroller';\nimport 'emby-select';\n\nfunction getPromise(apiClient, params) {\n    const id = params.id;\n\n    if (id) {\n        return apiClient.getItem(apiClient.getCurrentUserId(), id);\n    }\n\n    if (params.seriesTimerId) {\n        return apiClient.getLiveTvSeriesTimer(params.seriesTimerId);\n    }\n\n    if (params.genre) {\n        return apiClient.getGenre(params.genre, apiClient.getCurrentUserId());\n    }\n\n    if (params.musicgenre) {\n        return apiClient.getMusicGenre(params.musicgenre, apiClient.getCurrentUserId());\n    }\n\n    if (params.musicartist) {\n        return apiClient.getArtist(params.musicartist, apiClient.getCurrentUserId());\n    }\n\n    throw new Error('Invalid request');\n}\n\nfunction hideAll(page, className, show) {\n    for (const elem of page.querySelectorAll('.' + className)) {\n        if (show) {\n            elem.classList.remove('hide');\n        } else {\n            elem.classList.add('hide');\n        }\n    }\n}\n\nfunction getContextMenuOptions(item, user, button) {\n    return {\n        item: item,\n        open: false,\n        play: false,\n        playAllFromHere: false,\n        queueAllFromHere: false,\n        positionTo: button,\n        cancelTimer: false,\n        record: false,\n        deleteItem: item.CanDelete === true,\n        shuffle: false,\n        instantMix: false,\n        user: user,\n        share: true\n    };\n}\n\nfunction getProgramScheduleHtml(items) {\n    let html = '';\n\n    html += '<div is=\"emby-itemscontainer\" class=\"itemsContainer vertical-list\" data-contextmenu=\"false\">';\n    html += listView.getListViewHtml({\n        items: items,\n        enableUserDataButtons: false,\n        image: true,\n        imageSource: 'channel',\n        showProgramDateTime: true,\n        showChannel: false,\n        mediaInfo: false,\n        action: 'none',\n        moreButton: false,\n        recordButton: false\n    });\n\n    html += '</div>';\n\n    return html;\n}\n\nfunction renderSeriesTimerSchedule(page, apiClient, seriesTimerId) {\n    apiClient.getLiveTvTimers({\n        UserId: apiClient.getCurrentUserId(),\n        ImageTypeLimit: 1,\n        EnableImageTypes: 'Primary,Backdrop,Thumb',\n        SortBy: 'StartDate',\n        EnableTotalRecordCount: false,\n        EnableUserData: false,\n        SeriesTimerId: seriesTimerId,\n        Fields: 'ChannelInfo,ChannelImage'\n    }).then(function (result) {\n        if (result.Items.length && result.Items[0].SeriesTimerId != seriesTimerId) {\n            result.Items = [];\n        }\n\n        const html = getProgramScheduleHtml(result.Items);\n        const scheduleTab = page.querySelector('.seriesTimerSchedule');\n        scheduleTab.innerHTML = html;\n        imageLoader.lazyChildren(scheduleTab);\n    });\n}\n\nfunction renderTimerEditor(page, item, apiClient, user) {\n    if (item.Type !== 'Recording' || !user.Policy.EnableLiveTvManagement || !item.TimerId || item.Status !== 'InProgress') {\n        return void hideAll(page, 'btnCancelTimer');\n    }\n\n    hideAll(page, 'btnCancelTimer', true);\n}\n\nfunction renderSeriesTimerEditor(page, item, apiClient, user) {\n    if (item.Type !== 'SeriesTimer') {\n        return void hideAll(page, 'btnCancelSeriesTimer');\n    }\n\n    if (user.Policy.EnableLiveTvManagement) {\n        import('seriesRecordingEditor').then(({ default: seriesRecordingEditor }) => {\n            seriesRecordingEditor.embed(item, apiClient.serverId(), {\n                context: page.querySelector('.seriesRecordingEditor')\n            });\n        });\n\n        page.querySelector('.seriesTimerScheduleSection').classList.remove('hide');\n        hideAll(page, 'btnCancelSeriesTimer', true);\n        return void renderSeriesTimerSchedule(page, apiClient, item.Id);\n    }\n\n    page.querySelector('.seriesTimerScheduleSection').classList.add('hide');\n    return void hideAll(page, 'btnCancelSeriesTimer');\n}\n\nfunction renderTrackSelections(page, instance, item, forceReload) {\n    const select = page.querySelector('.selectSource');\n\n    if (!item.MediaSources || !itemHelper.supportsMediaSourceSelection(item) || playbackManager.getSupportedCommands().indexOf('PlayMediaSource') === -1 || !playbackManager.canPlay(item)) {\n        page.querySelector('.trackSelections').classList.add('hide');\n        select.innerHTML = '';\n        page.querySelector('.selectVideo').innerHTML = '';\n        page.querySelector('.selectAudio').innerHTML = '';\n        page.querySelector('.selectSubtitles').innerHTML = '';\n        return;\n    }\n\n    const mediaSources = item.MediaSources;\n    instance._currentPlaybackMediaSources = mediaSources;\n\n    page.querySelector('.trackSelections').classList.remove('hide');\n    select.setLabel(globalize.translate('LabelVersion'));\n\n    const currentValue = select.value;\n\n    const selectedId = mediaSources[0].Id;\n    select.innerHTML = mediaSources.map(function (v) {\n        const selected = v.Id === selectedId ? ' selected' : '';\n        return '<option value=\"' + v.Id + '\"' + selected + '>' + v.Name + '</option>';\n    }).join('');\n\n    if (mediaSources.length > 1) {\n        page.querySelector('.selectSourceContainer').classList.remove('hide');\n    } else {\n        page.querySelector('.selectSourceContainer').classList.add('hide');\n    }\n\n    if (select.value !== currentValue || forceReload) {\n        renderVideoSelections(page, mediaSources);\n        renderAudioSelections(page, mediaSources);\n        renderSubtitleSelections(page, mediaSources);\n    }\n}\n\nfunction renderVideoSelections(page, mediaSources) {\n    const mediaSourceId = page.querySelector('.selectSource').value;\n    const mediaSource = mediaSources.filter(function (m) {\n        return m.Id === mediaSourceId;\n    })[0];\n\n    const tracks = mediaSource.MediaStreams.filter(function (m) {\n        return m.Type === 'Video';\n    });\n\n    const select = page.querySelector('.selectVideo');\n    select.setLabel(globalize.translate('LabelVideo'));\n    const selectedId = tracks.length ? tracks[0].Index : -1;\n    select.innerHTML = tracks.map(function (v) {\n        const selected = v.Index === selectedId ? ' selected' : '';\n        const titleParts = [];\n        const resolutionText = mediaInfo.getResolutionText(v);\n\n        if (resolutionText) {\n            titleParts.push(resolutionText);\n        }\n\n        if (v.Codec) {\n            titleParts.push(v.Codec.toUpperCase());\n        }\n\n        return '<option value=\"' + v.Index + '\" ' + selected + '>' + (v.DisplayTitle || titleParts.join(' ')) + '</option>';\n    }).join('');\n    select.setAttribute('disabled', 'disabled');\n\n    if (tracks.length) {\n        page.querySelector('.selectVideoContainer').classList.remove('hide');\n    } else {\n        page.querySelector('.selectVideoContainer').classList.add('hide');\n    }\n}\n\nfunction renderAudioSelections(page, mediaSources) {\n    const mediaSourceId = page.querySelector('.selectSource').value;\n    const mediaSource = mediaSources.filter(function (m) {\n        return m.Id === mediaSourceId;\n    })[0];\n    const tracks = mediaSource.MediaStreams.filter(function (m) {\n        return m.Type === 'Audio';\n    });\n    const select = page.querySelector('.selectAudio');\n    select.setLabel(globalize.translate('Audio'));\n    const selectedId = mediaSource.DefaultAudioStreamIndex;\n    select.innerHTML = tracks.map(function (v) {\n        const selected = v.Index === selectedId ? ' selected' : '';\n        return '<option value=\"' + v.Index + '\" ' + selected + '>' + v.DisplayTitle + '</option>';\n    }).join('');\n\n    if (tracks.length > 1) {\n        select.removeAttribute('disabled');\n    } else {\n        select.setAttribute('disabled', 'disabled');\n    }\n\n    if (tracks.length) {\n        page.querySelector('.selectAudioContainer').classList.remove('hide');\n    } else {\n        page.querySelector('.selectAudioContainer').classList.add('hide');\n    }\n}\n\nfunction renderSubtitleSelections(page, mediaSources) {\n    const mediaSourceId = page.querySelector('.selectSource').value;\n    const mediaSource = mediaSources.filter(function (m) {\n        return m.Id === mediaSourceId;\n    })[0];\n    const tracks = mediaSource.MediaStreams.filter(function (m) {\n        return m.Type === 'Subtitle';\n    });\n    const select = page.querySelector('.selectSubtitles');\n    select.setLabel(globalize.translate('Subtitles'));\n    const selectedId = mediaSource.DefaultSubtitleStreamIndex == null ? -1 : mediaSource.DefaultSubtitleStreamIndex;\n\n    const videoTracks = mediaSource.MediaStreams.filter(function (m) {\n        return m.Type === 'Video';\n    });\n\n    // This only makes sense on Video items\n    if (videoTracks.length) {\n        let selected = selectedId === -1 ? ' selected' : '';\n        select.innerHTML = '<option value=\"-1\">' + globalize.translate('Off') + '</option>' + tracks.map(function (v) {\n            selected = v.Index === selectedId ? ' selected' : '';\n            return '<option value=\"' + v.Index + '\" ' + selected + '>' + v.DisplayTitle + '</option>';\n        }).join('');\n\n        if (tracks.length > 0) {\n            select.removeAttribute('disabled');\n        } else {\n            select.setAttribute('disabled', 'disabled');\n        }\n\n        page.querySelector('.selectSubtitlesContainer').classList.remove('hide');\n    } else {\n        select.innerHTML = '';\n        page.querySelector('.selectSubtitlesContainer').classList.add('hide');\n    }\n}\n\nfunction reloadPlayButtons(page, item) {\n    let canPlay = false;\n\n    if (item.Type == 'Program') {\n        const now = new Date();\n\n        if (now >= datetime.parseISO8601Date(item.StartDate, true) && now < datetime.parseISO8601Date(item.EndDate, true)) {\n            hideAll(page, 'btnPlay', true);\n            canPlay = true;\n        } else {\n            hideAll(page, 'btnPlay');\n        }\n\n        hideAll(page, 'btnResume');\n        hideAll(page, 'btnInstantMix');\n        hideAll(page, 'btnShuffle');\n    } else if (playbackManager.canPlay(item)) {\n        hideAll(page, 'btnPlay', true);\n        const enableInstantMix = ['Audio', 'MusicAlbum', 'MusicGenre', 'MusicArtist'].indexOf(item.Type) !== -1;\n        hideAll(page, 'btnInstantMix', enableInstantMix);\n        const enableShuffle = item.IsFolder || ['MusicAlbum', 'MusicGenre', 'MusicArtist'].indexOf(item.Type) !== -1;\n        hideAll(page, 'btnShuffle', enableShuffle);\n        canPlay = true;\n\n        const isResumable = item.UserData && item.UserData.PlaybackPositionTicks > 0;\n        hideAll(page, 'btnResume', isResumable);\n\n        if (isResumable) {\n            for (const elem of page.querySelectorAll('.btnPlay')) {\n                elem.querySelector('.detailButton-icon').classList.replace('play_arrow', 'replay');\n            }\n        }\n    } else {\n        hideAll(page, 'btnPlay');\n        hideAll(page, 'btnResume');\n        hideAll(page, 'btnInstantMix');\n        hideAll(page, 'btnShuffle');\n    }\n\n    return canPlay;\n}\n\nfunction reloadUserDataButtons(page, item) {\n    let i;\n    let length;\n    const btnPlaystates = page.querySelectorAll('.btnPlaystate');\n\n    for (i = 0, length = btnPlaystates.length; i < length; i++) {\n        const btnPlaystate = btnPlaystates[i];\n\n        if (itemHelper.canMarkPlayed(item)) {\n            btnPlaystate.classList.remove('hide');\n            btnPlaystate.setItem(item);\n        } else {\n            btnPlaystate.classList.add('hide');\n            btnPlaystate.setItem(null);\n        }\n    }\n\n    const btnUserRatings = page.querySelectorAll('.btnUserRating');\n\n    for (i = 0, length = btnUserRatings.length; i < length; i++) {\n        const btnUserRating = btnUserRatings[i];\n\n        if (itemHelper.canRate(item)) {\n            btnUserRating.classList.remove('hide');\n            btnUserRating.setItem(item);\n        } else {\n            btnUserRating.classList.add('hide');\n            btnUserRating.setItem(null);\n        }\n    }\n}\n\nfunction getArtistLinksHtml(artists, serverId, context) {\n    const html = [];\n\n    for (const artist of artists) {\n        const href = appRouter.getRouteUrl(artist, {\n            context: context,\n            itemType: 'MusicArtist',\n            serverId: serverId\n        });\n        html.push('<a style=\"color:inherit;\" class=\"button-link\" is=\"emby-linkbutton\" href=\"' + href + '\">' + artist.Name + '</a>');\n    }\n\n    return html.join(' / ');\n}\n\n/**\n * Renders the item's name block\n * @param {Object} item - Item used to render the name.\n * @param {HTMLDivElement} container - Container to render the information into.\n * @param {Object} context - Application context.\n */\nfunction renderName(item, container, context) {\n    let parentRoute;\n    const parentNameHtml = [];\n    let parentNameLast = false;\n\n    if (item.AlbumArtists) {\n        parentNameHtml.push(getArtistLinksHtml(item.AlbumArtists, item.ServerId, context));\n        parentNameLast = true;\n    } else if (item.ArtistItems && item.ArtistItems.length && item.Type === 'MusicVideo') {\n        parentNameHtml.push(getArtistLinksHtml(item.ArtistItems, item.ServerId, context));\n        parentNameLast = true;\n    } else if (item.SeriesName && item.Type === 'Episode') {\n        parentRoute = appRouter.getRouteUrl({\n            Id: item.SeriesId,\n            Name: item.SeriesName,\n            Type: 'Series',\n            IsFolder: true,\n            ServerId: item.ServerId\n        }, {\n            context: context\n        });\n        parentNameHtml.push('<a style=\"color:inherit;\" class=\"button-link\" is=\"emby-linkbutton\" href=\"' + parentRoute + '\">' + item.SeriesName + '</a>');\n    } else if (item.IsSeries || item.EpisodeTitle) {\n        parentNameHtml.push(item.Name);\n    }\n\n    if (item.SeriesName && item.Type === 'Season') {\n        parentRoute = appRouter.getRouteUrl({\n            Id: item.SeriesId,\n            Name: item.SeriesName,\n            Type: 'Series',\n            IsFolder: true,\n            ServerId: item.ServerId\n        }, {\n            context: context\n        });\n        parentNameHtml.push('<a style=\"color:inherit;\" class=\"button-link\" is=\"emby-linkbutton\" href=\"' + parentRoute + '\">' + item.SeriesName + '</a>');\n    } else if (item.ParentIndexNumber != null && item.Type === 'Episode') {\n        parentRoute = appRouter.getRouteUrl({\n            Id: item.SeasonId,\n            Name: item.SeasonName,\n            Type: 'Season',\n            IsFolder: true,\n            ServerId: item.ServerId\n        }, {\n            context: context\n        });\n        parentNameHtml.push('<a style=\"color:inherit;\" class=\"button-link\" is=\"emby-linkbutton\" href=\"' + parentRoute + '\">' + item.SeasonName + '</a>');\n    } else if (item.ParentIndexNumber != null && item.IsSeries) {\n        parentNameHtml.push(item.SeasonName || 'S' + item.ParentIndexNumber);\n    } else if (item.Album && item.AlbumId && (item.Type === 'MusicVideo' || item.Type === 'Audio')) {\n        parentRoute = appRouter.getRouteUrl({\n            Id: item.AlbumId,\n            Name: item.Album,\n            Type: 'MusicAlbum',\n            IsFolder: true,\n            ServerId: item.ServerId\n        }, {\n            context: context\n        });\n        parentNameHtml.push('<a style=\"color:inherit;\" class=\"button-link\" is=\"emby-linkbutton\" href=\"' + parentRoute + '\">' + item.Album + '</a>');\n    } else if (item.Album) {\n        parentNameHtml.push(item.Album);\n    }\n\n    // FIXME: This whole section needs some refactoring, so it becames easier to scale across all form factors. See GH #1022\n    let html = '';\n    const tvShowHtml = parentNameHtml[0];\n    const tvSeasonHtml = parentNameHtml[1];\n\n    if (parentNameHtml.length) {\n        if (parentNameLast) {\n            // Music\n            if (layoutManager.mobile) {\n                html = '<h3 class=\"parentName musicParentName\">' + parentNameHtml.join('</br>') + '</h3>';\n            } else {\n                html = '<h3 class=\"parentName musicParentName\">' + parentNameHtml.join(' - ') + '</h3>';\n            }\n        } else {\n            html = '<h1 class=\"parentName\">' + tvShowHtml + '</h1>';\n        }\n    }\n\n    const name = itemHelper.getDisplayName(item, {\n        includeParentInfo: false\n    });\n\n    if (html && !parentNameLast) {\n        if (tvSeasonHtml) {\n            html += '<h3 class=\"itemName infoText subtitle\">' + tvSeasonHtml + ' - ' + name + '</h3>';\n        } else {\n            html += '<h3 class=\"itemName infoText subtitle\">' + name + '</h3>';\n        }\n    } else if (item.OriginalTitle && item.OriginalTitle != item.Name) {\n        html = '<h1 class=\"itemName infoText parentNameLast withOriginalTitle\">' + name + '</h1>' + html;\n    } else {\n        html = '<h1 class=\"itemName infoText parentNameLast\">' + name + '</h1>' + html;\n    }\n\n    if (item.OriginalTitle && item.OriginalTitle != item.Name) {\n        html += '<h4 class=\"itemName infoText originalTitle\">' + item.OriginalTitle + '</h4>';\n    }\n\n    container.innerHTML = html;\n\n    if (html.length) {\n        container.classList.remove('hide');\n    } else {\n        container.classList.add('hide');\n    }\n}\n\nfunction setTrailerButtonVisibility(page, item) {\n    if ((item.LocalTrailerCount || item.RemoteTrailers && item.RemoteTrailers.length) && playbackManager.getSupportedCommands().indexOf('PlayTrailers') !== -1) {\n        hideAll(page, 'btnPlayTrailer', true);\n    } else {\n        hideAll(page, 'btnPlayTrailer');\n    }\n}\n\nfunction renderBackdrop(item) {\n    if (dom.getWindowSize().innerWidth >= 1000) {\n        backdrop.setBackdrops([item]);\n    } else {\n        backdrop.clearBackdrop();\n    }\n}\n\nfunction renderDetailPageBackdrop(page, item, apiClient) {\n    let imgUrl;\n    let hasbackdrop = false;\n    const itemBackdropElement = page.querySelector('#itemBackdrop');\n\n    if (!layoutManager.mobile && !userSettings.detailsBanner()) {\n        return false;\n    }\n\n    if (item.BackdropImageTags && item.BackdropImageTags.length) {\n        imgUrl = apiClient.getScaledImageUrl(item.Id, {\n            type: 'Backdrop',\n            maxWidth: dom.getScreenWidth(),\n            index: 0,\n            tag: item.BackdropImageTags[0]\n        });\n        imageLoader.lazyImage(itemBackdropElement, imgUrl);\n        hasbackdrop = true;\n    } else if (item.ParentBackdropItemId && item.ParentBackdropImageTags && item.ParentBackdropImageTags.length) {\n        imgUrl = apiClient.getScaledImageUrl(item.ParentBackdropItemId, {\n            type: 'Backdrop',\n            maxWidth: dom.getScreenWidth(),\n            index: 0,\n            tag: item.ParentBackdropImageTags[0]\n        });\n        imageLoader.lazyImage(itemBackdropElement, imgUrl);\n        hasbackdrop = true;\n    } else if (item.ImageTags && item.ImageTags.Primary) {\n        imgUrl = apiClient.getScaledImageUrl(item.Id, {\n            type: 'Primary',\n            maxWidth: dom.getScreenWidth(),\n            tag: item.ImageTags.Primary\n        });\n        imageLoader.lazyImage(itemBackdropElement, imgUrl);\n        hasbackdrop = true;\n    } else {\n        itemBackdropElement.style.backgroundImage = '';\n    }\n\n    return hasbackdrop;\n}\n\nfunction reloadFromItem(instance, page, params, item, user) {\n    const apiClient = connectionManager.getApiClient(item.ServerId);\n\n    Emby.Page.setTitle('');\n\n    // Start rendering the artwork first\n    renderImage(page, item);\n    renderLogo(page, item, apiClient);\n    renderBackdrop(item);\n    renderDetailPageBackdrop(page, item, apiClient);\n\n    // Render the main information for the item\n    page.querySelector('.detailPagePrimaryContainer').classList.add('detailRibbon');\n    renderName(item, page.querySelector('.nameContainer'), params.context);\n    renderDetails(page, item, apiClient, params.context);\n    renderTrackSelections(page, instance, item);\n\n    renderSeriesTimerEditor(page, item, apiClient, user);\n    renderTimerEditor(page, item, apiClient, user);\n    setInitialCollapsibleState(page, item, apiClient, params.context, user);\n    const canPlay = reloadPlayButtons(page, item);\n\n    if ((item.LocalTrailerCount || item.RemoteTrailers && item.RemoteTrailers.length) && playbackManager.getSupportedCommands().indexOf('PlayTrailers') !== -1) {\n        hideAll(page, 'btnPlayTrailer', true);\n    } else {\n        hideAll(page, 'btnPlayTrailer');\n    }\n\n    setTrailerButtonVisibility(page, item);\n\n    if (item.Type !== 'Program' || canPlay) {\n        hideAll(page, 'mainDetailButtons', true);\n    } else {\n        hideAll(page, 'mainDetailButtons');\n    }\n\n    showRecordingFields(instance, page, item, user);\n    const groupedVersions = (item.MediaSources || []).filter(function (g) {\n        return g.Type == 'Grouping';\n    });\n\n    if (user.Policy.IsAdministrator && groupedVersions.length) {\n        page.querySelector('.btnSplitVersions').classList.remove('hide');\n    } else {\n        page.querySelector('.btnSplitVersions').classList.add('hide');\n    }\n\n    if (itemContextMenu.getCommands(getContextMenuOptions(item, user)).length) {\n        hideAll(page, 'btnMoreCommands', true);\n    } else {\n        hideAll(page, 'btnMoreCommands');\n    }\n\n    const itemBirthday = page.querySelector('#itemBirthday');\n\n    if (item.Type == 'Person' && item.PremiereDate) {\n        try {\n            const birthday = datetime.parseISO8601Date(item.PremiereDate, true).toDateString();\n            itemBirthday.classList.remove('hide');\n            itemBirthday.innerHTML = globalize.translate('BirthDateValue', birthday);\n        } catch (err) {\n            itemBirthday.classList.add('hide');\n        }\n    } else {\n        itemBirthday.classList.add('hide');\n    }\n\n    const itemDeathDate = page.querySelector('#itemDeathDate');\n\n    if (item.Type == 'Person' && item.EndDate) {\n        try {\n            const deathday = datetime.parseISO8601Date(item.EndDate, true).toDateString();\n            itemDeathDate.classList.remove('hide');\n            itemDeathDate.innerHTML = globalize.translate('DeathDateValue', deathday);\n        } catch (err) {\n            itemDeathDate.classList.add('hide');\n        }\n    } else {\n        itemDeathDate.classList.add('hide');\n    }\n\n    const itemBirthLocation = page.querySelector('#itemBirthLocation');\n\n    if (item.Type == 'Person' && item.ProductionLocations && item.ProductionLocations.length) {\n        const gmap = '<a is=\"emby-linkbutton\" class=\"button-link textlink\" target=\"_blank\" href=\"https://maps.google.com/maps?q=' + item.ProductionLocations[0] + '\">' + item.ProductionLocations[0] + '</a>';\n        itemBirthLocation.classList.remove('hide');\n        itemBirthLocation.innerHTML = globalize.translate('BirthPlaceValue', gmap);\n    } else {\n        itemBirthLocation.classList.add('hide');\n    }\n\n    setPeopleHeader(page, item);\n    loading.hide();\n\n    if (item.Type === 'Book' && item.CanDownload && appHost.supports('filedownload')) {\n        hideAll(page, 'btnDownload', true);\n    }\n\n    import('autoFocuser').then(({ default: autoFocuser }) => {\n        autoFocuser.autoFocus(page);\n    });\n}\n\nfunction logoImageUrl(item, apiClient, options) {\n    options = options || {};\n    options.type = 'Logo';\n\n    if (item.ImageTags && item.ImageTags.Logo) {\n        options.tag = item.ImageTags.Logo;\n        return apiClient.getScaledImageUrl(item.Id, options);\n    }\n\n    if (item.ParentLogoImageTag) {\n        options.tag = item.ParentLogoImageTag;\n        return apiClient.getScaledImageUrl(item.ParentLogoItemId, options);\n    }\n\n    return null;\n}\n\nfunction renderLogo(page, item, apiClient) {\n    const detailLogo = page.querySelector('.detailLogo');\n\n    const url = logoImageUrl(item, apiClient, {});\n\n    if (!layoutManager.mobile && !userSettings.enableBackdrops()) {\n        detailLogo.classList.add('hide');\n    } else if (url) {\n        detailLogo.classList.remove('hide');\n        imageLoader.setLazyImage(detailLogo, url);\n    } else {\n        detailLogo.classList.add('hide');\n    }\n}\n\nfunction showRecordingFields(instance, page, item, user) {\n    if (!instance.currentRecordingFields) {\n        const recordingFieldsElement = page.querySelector('.recordingFields');\n\n        if (item.Type == 'Program' && user.Policy.EnableLiveTvManagement) {\n            import('recordingFields').then(({ default: recordingFields }) => {\n                instance.currentRecordingFields = new recordingFields({\n                    parent: recordingFieldsElement,\n                    programId: item.Id,\n                    serverId: item.ServerId\n                });\n                recordingFieldsElement.classList.remove('hide');\n            });\n        } else {\n            recordingFieldsElement.classList.add('hide');\n            recordingFieldsElement.innerHTML = '';\n        }\n    }\n}\n\nfunction renderLinks(page, item) {\n    const externalLinksElem = page.querySelector('.itemExternalLinks');\n\n    const links = [];\n\n    if (!layoutManager.tv && item.HomePageUrl) {\n        links.push(`<a is=\"emby-linkbutton\" class=\"button-link\" href=\"${item.HomePageUrl}\" target=\"_blank\">${globalize.translate('ButtonWebsite')}</a>`);\n    }\n\n    if (item.ExternalUrls) {\n        for (const url of item.ExternalUrls) {\n            links.push(`<a is=\"emby-linkbutton\" class=\"button-link\" href=\"${url.Url}\" target=\"_blank\">${url.Name}</a>`);\n        }\n    }\n\n    const html = [];\n    if (links.length) {\n        html.push(links.join(', '));\n    }\n\n    externalLinksElem.innerHTML = html.join(', ');\n\n    if (html.length) {\n        externalLinksElem.classList.remove('hide');\n    } else {\n        externalLinksElem.classList.add('hide');\n    }\n}\n\nfunction renderDetailImage(elem, item, imageLoader) {\n    const itemArray = [];\n    itemArray.push(item);\n    const cardHtml = cardBuilder.getCardsHtml(itemArray, {\n        shape: 'auto',\n        showTitle: false,\n        centerText: true,\n        overlayText: false,\n        transition: false,\n        disableIndicators: true,\n        overlayPlayButton: true,\n        action: 'play',\n        width: dom.getWindowSize().innerWidth * 0.25\n    });\n\n    elem.innerHTML = cardHtml;\n    imageLoader.lazyChildren(elem);\n}\n\nfunction renderImage(page, item) {\n    renderDetailImage(\n        page.querySelector('.detailImageContainer'),\n        item,\n        imageLoader\n    );\n}\n\nfunction refreshDetailImageUserData(elem, item) {\n    elem.querySelector('.detailImageProgressContainer').innerHTML = indicators.getProgressBarHtml(item);\n}\n\nfunction refreshImage(page, item) {\n    refreshDetailImageUserData(page.querySelector('.detailImageContainer'), item);\n}\n\nfunction setPeopleHeader(page, item) {\n    if (item.MediaType == 'Audio' || item.Type == 'MusicAlbum' || item.MediaType == 'Book' || item.MediaType == 'Photo') {\n        page.querySelector('#peopleHeader').innerHTML = globalize.translate('People');\n    } else {\n        page.querySelector('#peopleHeader').innerHTML = globalize.translate('HeaderCastAndCrew');\n    }\n}\n\nfunction renderNextUp(page, item, user) {\n    const section = page.querySelector('.nextUpSection');\n\n    if (item.Type != 'Series') {\n        return void section.classList.add('hide');\n    }\n\n    connectionManager.getApiClient(item.ServerId).getNextUpEpisodes({\n        SeriesId: item.Id,\n        UserId: user.Id\n    }).then(function (result) {\n        if (result.Items.length) {\n            section.classList.remove('hide');\n        } else {\n            section.classList.add('hide');\n        }\n\n        const html = cardBuilder.getCardsHtml({\n            items: result.Items,\n            shape: 'overflowBackdrop',\n            showTitle: true,\n            displayAsSpecial: item.Type == 'Season' && item.IndexNumber,\n            overlayText: false,\n            centerText: true,\n            overlayPlayButton: true\n        });\n        const itemsContainer = section.querySelector('.nextUpItems');\n        itemsContainer.innerHTML = html;\n        imageLoader.lazyChildren(itemsContainer);\n    });\n}\n\nfunction setInitialCollapsibleState(page, item, apiClient, context, user) {\n    page.querySelector('.collectionItems').innerHTML = '';\n\n    if (item.Type == 'Playlist') {\n        page.querySelector('#childrenCollapsible').classList.remove('hide');\n        renderPlaylistItems(page, item);\n    } else if (item.Type == 'Studio' || item.Type == 'Person' || item.Type == 'Genre' || item.Type == 'MusicGenre' || item.Type == 'MusicArtist') {\n        page.querySelector('#childrenCollapsible').classList.remove('hide');\n        renderItemsByName(page, item);\n    } else if (item.IsFolder) {\n        if (item.Type == 'BoxSet') {\n            page.querySelector('#childrenCollapsible').classList.add('hide');\n        }\n\n        renderChildren(page, item);\n    } else {\n        page.querySelector('#childrenCollapsible').classList.add('hide');\n    }\n\n    if (item.Type == 'Series') {\n        renderSeriesSchedule(page, item);\n        renderNextUp(page, item, user);\n    } else {\n        page.querySelector('.nextUpSection').classList.add('hide');\n    }\n\n    renderScenes(page, item);\n\n    if (item.SpecialFeatureCount && item.SpecialFeatureCount != 0 && item.Type != 'Series') {\n        page.querySelector('#specialsCollapsible').classList.remove('hide');\n        renderSpecials(page, item, user);\n    } else {\n        page.querySelector('#specialsCollapsible').classList.add('hide');\n    }\n\n    renderCast(page, item);\n\n    if (item.PartCount && item.PartCount > 1) {\n        page.querySelector('#additionalPartsCollapsible').classList.remove('hide');\n        renderAdditionalParts(page, item, user);\n    } else {\n        page.querySelector('#additionalPartsCollapsible').classList.add('hide');\n    }\n\n    if (item.Type == 'MusicAlbum') {\n        renderMusicVideos(page, item, user);\n    } else {\n        page.querySelector('#musicVideosCollapsible').classList.add('hide');\n    }\n}\n\nfunction toggleLineClamp(clampTarget, e) {\n    const expandButton = e.target;\n    const clampClassName = 'detail-clamp-text';\n\n    if (clampTarget.classList.contains(clampClassName)) {\n        clampTarget.classList.remove(clampClassName);\n        expandButton.innerHTML = globalize.translate('ShowLess');\n    } else {\n        clampTarget.classList.add(clampClassName);\n        expandButton.innerHTML = globalize.translate('ShowMore');\n    }\n}\n\nfunction renderOverview(page, item) {\n    for (const overviewElemnt of page.querySelectorAll('.overview')) {\n        const overview = item.Overview || '';\n\n        if (overview) {\n            overviewElemnt.innerHTML = overview;\n            overviewElemnt.classList.remove('hide');\n            overviewElemnt.classList.add('detail-clamp-text');\n\n            // Grab the sibling element to control the expand state\n            const expandButton = overviewElemnt.parentElement.querySelector('.overview-expand');\n\n            // Detect if we have overflow of text. Based on this StackOverflow answer\n            // https://stackoverflow.com/a/35157976\n            if (Math.abs(overviewElemnt.scrollHeight - overviewElemnt.offsetHeight) > 2) {\n                expandButton.classList.remove('hide');\n            } else {\n                expandButton.classList.add('hide');\n            }\n\n            expandButton.addEventListener('click', toggleLineClamp.bind(null, overviewElemnt));\n\n            for (const anchor of overviewElemnt.querySelectorAll('a')) {\n                anchor.setAttribute('target', '_blank');\n            }\n        } else {\n            overviewElemnt.innerHTML = '';\n            overviewElemnt.classList.add('hide');\n        }\n    }\n}\n\nfunction renderGenres(page, item, context = inferContext(item)) {\n    const genres = item.GenreItems || [];\n    const type = context === 'music' ? 'MusicGenre' : 'Genre';\n\n    const html = genres.map(function (p) {\n        return '<a style=\"color:inherit;\" class=\"button-link\" is=\"emby-linkbutton\" href=\"' + appRouter.getRouteUrl({\n            Name: p.Name,\n            Type: type,\n            ServerId: item.ServerId,\n            Id: p.Id\n        }, {\n            context: context\n        }) + '\">' + p.Name + '</a>';\n    }).join(', ');\n\n    const genresLabel = page.querySelector('.genresLabel');\n    genresLabel.innerHTML = globalize.translate(genres.length > 1 ? 'Genres' : 'Genre');\n    const genresValue = page.querySelector('.genres');\n    genresValue.innerHTML = html;\n\n    const genresGroup = page.querySelector('.genresGroup');\n    if (genres.length) {\n        genresGroup.classList.remove('hide');\n    } else {\n        genresGroup.classList.add('hide');\n    }\n}\n\nfunction renderWriter(page, item, context) {\n    const writers = (item.People || []).filter(function (person) {\n        return person.Type === 'Writer';\n    });\n\n    const html = writers.map(function (person) {\n        return '<a style=\"color:inherit;\" class=\"button-link\" is=\"emby-linkbutton\" href=\"' + appRouter.getRouteUrl({\n            Name: person.Name,\n            Type: 'Person',\n            ServerId: item.ServerId,\n            Id: person.Id\n        }, {\n            context: context\n        }) + '\">' + person.Name + '</a>';\n    }).join(', ');\n\n    const writersLabel = page.querySelector('.writersLabel');\n    writersLabel.innerHTML = globalize.translate(writers.length > 1 ? 'Writers' : 'Writer');\n    const writersValue = page.querySelector('.writers');\n    writersValue.innerHTML = html;\n\n    const writersGroup = page.querySelector('.writersGroup');\n    if (writers.length) {\n        writersGroup.classList.remove('hide');\n    } else {\n        writersGroup.classList.add('hide');\n    }\n}\n\nfunction renderDirector(page, item, context) {\n    const directors = (item.People || []).filter(function (person) {\n        return person.Type === 'Director';\n    });\n\n    const html = directors.map(function (person) {\n        return '<a style=\"color:inherit;\" class=\"button-link\" is=\"emby-linkbutton\" href=\"' + appRouter.getRouteUrl({\n            Name: person.Name,\n            Type: 'Person',\n            ServerId: item.ServerId,\n            Id: person.Id\n        }, {\n            context: context\n        }) + '\">' + person.Name + '</a>';\n    }).join(', ');\n\n    const directorsLabel = page.querySelector('.directorsLabel');\n    directorsLabel.innerHTML = globalize.translate(directors.length > 1 ? 'Directors' : 'Director');\n    const directorsValue = page.querySelector('.directors');\n    directorsValue.innerHTML = html;\n\n    const directorsGroup = page.querySelector('.directorsGroup');\n    if (directors.length) {\n        directorsGroup.classList.remove('hide');\n    } else {\n        directorsGroup.classList.add('hide');\n    }\n}\n\nfunction renderMiscInfo(page, item) {\n    const primaryItemMiscInfo = page.querySelectorAll('.itemMiscInfo-primary');\n\n    for (const miscInfo of primaryItemMiscInfo) {\n        mediaInfo.fillPrimaryMediaInfo(miscInfo, item, {\n            interactive: true,\n            episodeTitle: false,\n            subtitles: false\n        });\n\n        if (miscInfo.innerHTML && item.Type !== 'SeriesTimer') {\n            miscInfo.classList.remove('hide');\n        } else {\n            miscInfo.classList.add('hide');\n        }\n    }\n\n    const secondaryItemMiscInfo = page.querySelectorAll('.itemMiscInfo-secondary');\n\n    for (const miscInfo of secondaryItemMiscInfo) {\n        mediaInfo.fillSecondaryMediaInfo(miscInfo, item, {\n            interactive: true\n        });\n\n        if (miscInfo.innerHTML && item.Type !== 'SeriesTimer') {\n            miscInfo.classList.remove('hide');\n        } else {\n            miscInfo.classList.add('hide');\n        }\n    }\n}\n\nfunction renderTagline(page, item) {\n    const taglineElement = page.querySelector('.tagline');\n\n    if (item.Taglines && item.Taglines.length) {\n        taglineElement.classList.remove('hide');\n        taglineElement.innerHTML = item.Taglines[0];\n    } else {\n        taglineElement.classList.add('hide');\n    }\n}\n\nfunction renderDetails(page, item, apiClient, context, isStatic) {\n    renderSimilarItems(page, item, context);\n    renderMoreFromSeason(page, item, apiClient);\n    renderMoreFromArtist(page, item, apiClient);\n    renderDirector(page, item, context);\n    renderWriter(page, item, context);\n    renderGenres(page, item, context);\n    renderChannelGuide(page, apiClient, item);\n    renderTagline(page, item);\n    renderOverview(page, item);\n    renderMiscInfo(page, item);\n    reloadUserDataButtons(page, item);\n    renderLinks(page, item);\n    renderTags(page, item);\n    renderSeriesAirTime(page, item, isStatic);\n}\n\nfunction enableScrollX() {\n    return browser.mobile && window.screen.availWidth <= 1000;\n}\n\nfunction getPortraitShape(scrollX) {\n    if (scrollX == null) {\n        scrollX = enableScrollX();\n    }\n\n    return scrollX ? 'overflowPortrait' : 'portrait';\n}\n\nfunction getSquareShape(scrollX) {\n    if (scrollX == null) {\n        scrollX = enableScrollX();\n    }\n\n    return scrollX ? 'overflowSquare' : 'square';\n}\n\nfunction renderMoreFromSeason(view, item, apiClient) {\n    const section = view.querySelector('.moreFromSeasonSection');\n\n    if (section) {\n        if (item.Type !== 'Episode' || !item.SeasonId || !item.SeriesId) {\n            return void section.classList.add('hide');\n        }\n\n        const userId = apiClient.getCurrentUserId();\n        apiClient.getEpisodes(item.SeriesId, {\n            SeasonId: item.SeasonId,\n            UserId: userId,\n            Fields: 'ItemCounts,PrimaryImageAspectRatio,BasicSyncInfo,CanDelete,MediaSourceCount'\n        }).then(function (result) {\n            if (result.Items.length < 2) {\n                return void section.classList.add('hide');\n            }\n\n            section.classList.remove('hide');\n            section.querySelector('h2').innerHTML = globalize.translate('MoreFromValue', item.SeasonName);\n            const itemsContainer = section.querySelector('.itemsContainer');\n            cardBuilder.buildCards(result.Items, {\n                parentContainer: section,\n                itemsContainer: itemsContainer,\n                shape: 'autooverflow',\n                sectionTitleTagName: 'h2',\n                scalable: true,\n                showTitle: true,\n                overlayText: false,\n                centerText: true,\n                includeParentInfoInTitle: false,\n                allowBottomPadding: false\n            });\n            const card = itemsContainer.querySelector('.card[data-id=\"' + item.Id + '\"]');\n\n            if (card) {\n                setTimeout(function () {\n                    section.querySelector('.emby-scroller').toStart(card.previousSibling || card, true);\n                }, 100);\n            }\n        });\n    }\n}\n\nfunction renderMoreFromArtist(view, item, apiClient) {\n    const section = view.querySelector('.moreFromArtistSection');\n\n    if (section) {\n        if (item.Type === 'MusicArtist') {\n            if (!apiClient.isMinServerVersion('3.4.1.19')) {\n                return void section.classList.add('hide');\n            }\n        } else if (item.Type !== 'MusicAlbum' || !item.AlbumArtists || !item.AlbumArtists.length) {\n            return void section.classList.add('hide');\n        }\n\n        const query = {\n            IncludeItemTypes: 'MusicAlbum',\n            Recursive: true,\n            ExcludeItemIds: item.Id,\n            SortBy: 'ProductionYear,SortName',\n            SortOrder: 'Descending'\n        };\n\n        if (item.Type === 'MusicArtist') {\n            query.ContributingArtistIds = item.Id;\n        } else if (apiClient.isMinServerVersion('3.4.1.18')) {\n            query.AlbumArtistIds = item.AlbumArtists[0].Id;\n        } else {\n            query.ArtistIds = item.AlbumArtists[0].Id;\n        }\n\n        apiClient.getItems(apiClient.getCurrentUserId(), query).then(function (result) {\n            if (!result.Items.length) {\n                return void section.classList.add('hide');\n            }\n\n            section.classList.remove('hide');\n\n            if (item.Type === 'MusicArtist') {\n                section.querySelector('h2').innerHTML = globalize.translate('HeaderAppearsOn');\n            } else {\n                section.querySelector('h2').innerHTML = globalize.translate('MoreFromValue', item.AlbumArtists[0].Name);\n            }\n\n            cardBuilder.buildCards(result.Items, {\n                parentContainer: section,\n                itemsContainer: section.querySelector('.itemsContainer'),\n                shape: 'autooverflow',\n                sectionTitleTagName: 'h2',\n                scalable: true,\n                coverImage: item.Type === 'MusicArtist' || item.Type === 'MusicAlbum',\n                showTitle: true,\n                showParentTitle: false,\n                centerText: true,\n                overlayText: false,\n                overlayPlayButton: true,\n                showYear: true\n            });\n        });\n    }\n}\n\nfunction renderSimilarItems(page, item, context) {\n    const similarCollapsible = page.querySelector('#similarCollapsible');\n\n    if (similarCollapsible) {\n        if (item.Type != 'Movie' && item.Type != 'Trailer' && item.Type != 'Series' && item.Type != 'Program' && item.Type != 'Recording' && item.Type != 'MusicAlbum' && item.Type != 'MusicArtist' && item.Type != 'Playlist') {\n            return void similarCollapsible.classList.add('hide');\n        }\n\n        similarCollapsible.classList.remove('hide');\n        const apiClient = connectionManager.getApiClient(item.ServerId);\n        const options = {\n            userId: apiClient.getCurrentUserId(),\n            limit: 12,\n            fields: 'PrimaryImageAspectRatio,UserData,CanDelete'\n        };\n\n        if (item.Type == 'MusicAlbum' && item.AlbumArtists && item.AlbumArtists.length) {\n            options.ExcludeArtistIds = item.AlbumArtists[0].Id;\n        }\n\n        apiClient.getSimilarItems(item.Id, options).then(function (result) {\n            if (!result.Items.length) {\n                return void similarCollapsible.classList.add('hide');\n            }\n\n            similarCollapsible.classList.remove('hide');\n            let html = '';\n            html += cardBuilder.getCardsHtml({\n                items: result.Items,\n                shape: 'autooverflow',\n                showParentTitle: item.Type == 'MusicAlbum',\n                centerText: true,\n                showTitle: true,\n                context: context,\n                lazy: true,\n                showDetailsMenu: true,\n                coverImage: item.Type == 'MusicAlbum' || item.Type == 'MusicArtist',\n                overlayPlayButton: true,\n                overlayText: false,\n                showYear: item.Type === 'Movie' || item.Type === 'Trailer' || item.Type === 'Series'\n            });\n            const similarContent = similarCollapsible.querySelector('.similarContent');\n            similarContent.innerHTML = html;\n            imageLoader.lazyChildren(similarContent);\n        });\n    }\n}\n\nfunction renderSeriesAirTime(page, item, isStatic) {\n    const seriesAirTime = page.querySelector('#seriesAirTime');\n    if (item.Type != 'Series') {\n        seriesAirTime.classList.add('hide');\n        return;\n    }\n    let html = '';\n    if (item.AirDays && item.AirDays.length) {\n        if (item.AirDays.length == 7) {\n            html += 'daily';\n        } else {\n            html += item.AirDays.map(function (a) {\n                return a + 's';\n            }).join(',');\n        }\n    }\n    if (item.AirTime) {\n        html += ' at ' + item.AirTime;\n    }\n    if (item.Studios.length) {\n        if (isStatic) {\n            html += ' on ' + item.Studios[0].Name;\n        } else {\n            const context = inferContext(item);\n            const href = appRouter.getRouteUrl(item.Studios[0], {\n                context: context,\n                itemType: 'Studio',\n                serverId: item.ServerId\n            });\n            html += ' on <a class=\"textlink button-link\" is=\"emby-linkbutton\" href=\"' + href + '\">' + item.Studios[0].Name + '</a>';\n        }\n    }\n    if (html) {\n        html = (item.Status == 'Ended' ? 'Aired ' : 'Airs ') + html;\n        seriesAirTime.innerHTML = html;\n        seriesAirTime.classList.remove('hide');\n    } else {\n        seriesAirTime.classList.add('hide');\n    }\n}\n\nfunction renderTags(page, item) {\n    const itemTags = page.querySelector('.itemTags');\n    const tagElements = [];\n    let tags = item.Tags || [];\n\n    if (item.Type === 'Program') {\n        tags = [];\n    }\n\n    for (let i = 0, length = tags.length; i < length; i++) {\n        tagElements.push(tags[i]);\n    }\n\n    if (tagElements.length) {\n        itemTags.innerHTML = globalize.translate('TagsValue', tagElements.join(', '));\n        itemTags.classList.remove('hide');\n    } else {\n        itemTags.innerHTML = '';\n        itemTags.classList.add('hide');\n    }\n}\n\nfunction renderChildren(page, item) {\n    let fields = 'ItemCounts,PrimaryImageAspectRatio,BasicSyncInfo,CanDelete,MediaSourceCount';\n    const query = {\n        ParentId: item.Id,\n        Fields: fields\n    };\n\n    if (item.Type !== 'BoxSet') {\n        query.SortBy = 'SortName';\n    }\n\n    let promise;\n    const apiClient = connectionManager.getApiClient(item.ServerId);\n    const userId = apiClient.getCurrentUserId();\n\n    if (item.Type == 'Series') {\n        promise = apiClient.getSeasons(item.Id, {\n            userId: userId,\n            Fields: fields\n        });\n    } else if (item.Type == 'Season') {\n        fields += ',Overview';\n        promise = apiClient.getEpisodes(item.SeriesId, {\n            seasonId: item.Id,\n            userId: userId,\n            Fields: fields\n        });\n    } else if (item.Type == 'MusicArtist') {\n        query.SortBy = 'ProductionYear,SortName';\n    }\n\n    promise = promise || apiClient.getItems(apiClient.getCurrentUserId(), query);\n    promise.then(function (result) {\n        let html = '';\n        let scrollX = false;\n        let isList = false;\n        const childrenItemsContainer = page.querySelector('.childrenItemsContainer');\n\n        if (item.Type == 'MusicAlbum') {\n            html = listView.getListViewHtml({\n                items: result.Items,\n                smallIcon: true,\n                showIndex: true,\n                index: 'disc',\n                showIndexNumberLeft: true,\n                playFromHere: true,\n                action: 'playallfromhere',\n                image: false,\n                artist: 'auto',\n                containerAlbumArtists: item.AlbumArtists\n            });\n            isList = true;\n        } else if (item.Type == 'Series') {\n            scrollX = enableScrollX();\n            html = cardBuilder.getCardsHtml({\n                items: result.Items,\n                shape: 'overflowPortrait',\n                showTitle: true,\n                centerText: true,\n                lazy: true,\n                overlayPlayButton: true,\n                allowBottomPadding: !scrollX\n            });\n        } else if (item.Type == 'Season' || item.Type == 'Episode') {\n            if (item.Type !== 'Episode') {\n                isList = true;\n            }\n            scrollX = item.Type == 'Episode';\n            if (result.Items.length < 2 && item.Type === 'Episode') {\n                return;\n            }\n\n            if (item.Type === 'Episode') {\n                html = cardBuilder.getCardsHtml({\n                    items: result.Items,\n                    shape: 'overflowBackdrop',\n                    showTitle: true,\n                    displayAsSpecial: item.Type == 'Season' && item.IndexNumber,\n                    playFromHere: true,\n                    overlayText: true,\n                    lazy: true,\n                    showDetailsMenu: true,\n                    overlayPlayButton: true,\n                    allowBottomPadding: !scrollX,\n                    includeParentInfoInTitle: false\n                });\n            } else if (item.Type === 'Season') {\n                html = listView.getListViewHtml({\n                    items: result.Items,\n                    showIndexNumber: false,\n                    enableOverview: true,\n                    enablePlayedButton: layoutManager.mobile ? false : true,\n                    infoButton: layoutManager.mobile ? false : true,\n                    imageSize: 'large',\n                    enableSideMediaInfo: false,\n                    highlight: false,\n                    action: !layoutManager.desktop ? 'link' : 'none',\n                    imagePlayButton: true,\n                    includeParentInfoInTitle: false\n                });\n            }\n        }\n\n        if (item.Type !== 'BoxSet') {\n            page.querySelector('#childrenCollapsible').classList.remove('hide');\n        }\n        if (scrollX) {\n            childrenItemsContainer.classList.add('scrollX');\n            childrenItemsContainer.classList.add('hiddenScrollX');\n            childrenItemsContainer.classList.remove('vertical-wrap');\n            childrenItemsContainer.classList.remove('vertical-list');\n        } else {\n            childrenItemsContainer.classList.remove('scrollX');\n            childrenItemsContainer.classList.remove('hiddenScrollX');\n            childrenItemsContainer.classList.remove('smoothScrollX');\n            if (isList) {\n                childrenItemsContainer.classList.add('vertical-list');\n                childrenItemsContainer.classList.remove('vertical-wrap');\n            } else {\n                childrenItemsContainer.classList.add('vertical-wrap');\n                childrenItemsContainer.classList.remove('vertical-list');\n            }\n        }\n        if (layoutManager.mobile) {\n            childrenItemsContainer.classList.remove('padded-right');\n        }\n        childrenItemsContainer.innerHTML = html;\n        imageLoader.lazyChildren(childrenItemsContainer);\n        if (item.Type == 'BoxSet') {\n            const collectionItemTypes = [{\n                name: globalize.translate('HeaderVideos'),\n                mediaType: 'Video'\n            }, {\n                name: globalize.translate('Series'),\n                type: 'Series'\n            }, {\n                name: globalize.translate('Albums'),\n                type: 'MusicAlbum'\n            }, {\n                name: globalize.translate('Books'),\n                type: 'Book'\n            }];\n            renderCollectionItems(page, item, collectionItemTypes, result.Items);\n        }\n    });\n\n    if (item.Type == 'Season') {\n        page.querySelector('#childrenTitle').innerHTML = globalize.translate('Episodes');\n    } else if (item.Type == 'Series') {\n        page.querySelector('#childrenTitle').innerHTML = globalize.translate('HeaderSeasons');\n    } else if (item.Type == 'MusicAlbum') {\n        page.querySelector('#childrenTitle').innerHTML = globalize.translate('HeaderTracks');\n    } else {\n        page.querySelector('#childrenTitle').innerHTML = globalize.translate('Items');\n    }\n\n    if (item.Type == 'MusicAlbum' || item.Type == 'Season') {\n        page.querySelector('.childrenSectionHeader').classList.add('hide');\n        page.querySelector('#childrenCollapsible').classList.add('verticalSection-extrabottompadding');\n    } else {\n        page.querySelector('.childrenSectionHeader').classList.remove('hide');\n    }\n}\n\nfunction renderItemsByName(page, item) {\n    import('scripts/itembynamedetailpage').then(() => {\n        window.ItemsByName.renderItems(page, item);\n    });\n}\n\nfunction renderPlaylistItems(page, item) {\n    import('scripts/playlistedit').then(() => {\n        PlaylistViewer.render(page, item);\n    });\n}\n\nfunction renderProgramsForChannel(page, result) {\n    let html = '';\n    let currentItems = [];\n    let currentStartDate = null;\n\n    for (let i = 0, length = result.Items.length; i < length; i++) {\n        const item = result.Items[i];\n        const itemStartDate = datetime.parseISO8601Date(item.StartDate);\n\n        if (!(currentStartDate && currentStartDate.toDateString() === itemStartDate.toDateString())) {\n            if (currentItems.length) {\n                html += '<div class=\"verticalSection verticalDetailSection\">';\n                html += '<h2 class=\"sectionTitle padded-left\">' + datetime.toLocaleDateString(currentStartDate, {\n                    weekday: 'long',\n                    month: 'long',\n                    day: 'numeric'\n                }) + '</h2>';\n                html += '<div is=\"emby-itemscontainer\" class=\"vertical-list padded-left padded-right\">' + listView.getListViewHtml({\n                    items: currentItems,\n                    enableUserDataButtons: false,\n                    showParentTitle: true,\n                    image: false,\n                    showProgramTime: true,\n                    mediaInfo: false,\n                    parentTitleWithTitle: true\n                }) + '</div></div>';\n            }\n\n            currentStartDate = itemStartDate;\n            currentItems = [];\n        }\n\n        currentItems.push(item);\n    }\n\n    if (currentItems.length) {\n        html += '<div class=\"verticalSection verticalDetailSection\">';\n        html += '<h2 class=\"sectionTitle padded-left\">' + datetime.toLocaleDateString(currentStartDate, {\n            weekday: 'long',\n            month: 'long',\n            day: 'numeric'\n        }) + '</h2>';\n        html += '<div is=\"emby-itemscontainer\" class=\"vertical-list padded-left padded-right\">' + listView.getListViewHtml({\n            items: currentItems,\n            enableUserDataButtons: false,\n            showParentTitle: true,\n            image: false,\n            showProgramTime: true,\n            mediaInfo: false,\n            parentTitleWithTitle: true\n        }) + '</div></div>';\n    }\n\n    page.querySelector('.programGuide').innerHTML = html;\n}\n\nfunction renderChannelGuide(page, apiClient, item) {\n    if (item.Type === 'TvChannel') {\n        page.querySelector('.programGuideSection').classList.remove('hide');\n        apiClient.getLiveTvPrograms({\n            ChannelIds: item.Id,\n            UserId: apiClient.getCurrentUserId(),\n            HasAired: false,\n            SortBy: 'StartDate',\n            EnableTotalRecordCount: false,\n            EnableImages: false,\n            ImageTypeLimit: 0,\n            EnableUserData: false\n        }).then(function (result) {\n            renderProgramsForChannel(page, result);\n        });\n    }\n}\n\nfunction renderSeriesSchedule(page, item) {\n    const apiClient = connectionManager.getApiClient(item.ServerId);\n    apiClient.getLiveTvPrograms({\n        UserId: apiClient.getCurrentUserId(),\n        HasAired: false,\n        SortBy: 'StartDate',\n        EnableTotalRecordCount: false,\n        EnableImages: false,\n        ImageTypeLimit: 0,\n        Limit: 50,\n        EnableUserData: false,\n        LibrarySeriesId: item.Id\n    }).then(function (result) {\n        if (result.Items.length) {\n            page.querySelector('#seriesScheduleSection').classList.remove('hide');\n        } else {\n            page.querySelector('#seriesScheduleSection').classList.add('hide');\n        }\n\n        page.querySelector('#seriesScheduleList').innerHTML = listView.getListViewHtml({\n            items: result.Items,\n            enableUserDataButtons: false,\n            showParentTitle: false,\n            image: false,\n            showProgramDateTime: true,\n            mediaInfo: false,\n            showTitle: true,\n            moreButton: false,\n            action: 'programdialog'\n        });\n        loading.hide();\n    });\n}\n\nfunction inferContext(item) {\n    if (item.Type === 'Movie' || item.Type === 'BoxSet') {\n        return 'movies';\n    }\n\n    if (item.Type === 'Series' || item.Type === 'Season' || item.Type === 'Episode') {\n        return 'tvshows';\n    }\n\n    if (item.Type === 'MusicArtist' || item.Type === 'MusicAlbum' || item.Type === 'Audio' || item.Type === 'AudioBook') {\n        return 'music';\n    }\n\n    if (item.Type === 'Program') {\n        return 'livetv';\n    }\n\n    return null;\n}\n\nfunction filterItemsByCollectionItemType(items, typeInfo) {\n    return items.filter(function (item) {\n        if (typeInfo.mediaType) {\n            return item.MediaType == typeInfo.mediaType;\n        }\n\n        return item.Type == typeInfo.type;\n    });\n}\n\nfunction canPlaySomeItemInCollection(items) {\n    let i = 0;\n\n    for (let length = items.length; i < length; i++) {\n        if (playbackManager.canPlay(items[i])) {\n            return true;\n        }\n    }\n\n    return false;\n}\n\nfunction renderCollectionItems(page, parentItem, types, items) {\n    page.querySelector('.collectionItems').classList.remove('hide');\n    page.querySelector('.collectionItems').innerHTML = '';\n\n    for (const type of types) {\n        const typeItems = filterItemsByCollectionItemType(items, type);\n\n        if (typeItems.length) {\n            renderCollectionItemType(page, parentItem, type, typeItems);\n        }\n    }\n\n    const otherType = {\n        name: globalize.translate('HeaderOtherItems')\n    };\n    const otherTypeItems = items.filter(function (curr) {\n        return !types.filter(function (t) {\n            return filterItemsByCollectionItemType([curr], t).length > 0;\n        }).length;\n    });\n\n    if (otherTypeItems.length) {\n        renderCollectionItemType(page, parentItem, otherType, otherTypeItems);\n    }\n\n    if (!items.length) {\n        renderCollectionItemType(page, parentItem, {\n            name: globalize.translate('Items')\n        }, items);\n    }\n\n    const containers = page.querySelectorAll('.collectionItemsContainer');\n\n    const notifyRefreshNeeded = function () {\n        renderChildren(page, parentItem);\n    };\n\n    for (const container of containers) {\n        container.notifyRefreshNeeded = notifyRefreshNeeded;\n    }\n\n    // if nothing in the collection can be played hide play and shuffle buttons\n    if (!canPlaySomeItemInCollection(items)) {\n        hideAll(page, 'btnPlay', false);\n        hideAll(page, 'btnShuffle', false);\n    }\n\n    // HACK: Call autoFocuser again because btnPlay may be hidden, but focused by reloadFromItem\n    // FIXME: Sometimes focus does not move until all (?) sections are loaded\n    import('autoFocuser').then(({ default: autoFocuser }) => {\n        autoFocuser.autoFocus(page);\n    });\n}\n\nfunction renderCollectionItemType(page, parentItem, type, items) {\n    let html = '';\n    html += '<div class=\"verticalSection\">';\n    html += '<div class=\"sectionTitleContainer sectionTitleContainer-cards padded-left\">';\n    html += '<h2 class=\"sectionTitle sectionTitle-cards\">';\n    html += '<span>' + type.name + '</span>';\n    html += '</h2>';\n    html += '</div>';\n    html += '<div is=\"emby-itemscontainer\" class=\"itemsContainer collectionItemsContainer vertical-wrap padded-left padded-right\">';\n    const shape = type.type == 'MusicAlbum' ? getSquareShape(false) : getPortraitShape(false);\n    html += cardBuilder.getCardsHtml({\n        items: items,\n        shape: shape,\n        showTitle: true,\n        showYear: type.mediaType === 'Video' || type.type === 'Series',\n        centerText: true,\n        lazy: true,\n        showDetailsMenu: true,\n        overlayMoreButton: true,\n        showAddToCollection: false,\n        showRemoveFromCollection: true,\n        collectionId: parentItem.Id\n    });\n    html += '</div>';\n    html += '</div>';\n    const collectionItems = page.querySelector('.collectionItems');\n    collectionItems.insertAdjacentHTML('beforeend', html);\n    imageLoader.lazyChildren(collectionItems);\n}\n\nfunction renderMusicVideos(page, item, user) {\n    connectionManager.getApiClient(item.ServerId).getItems(user.Id, {\n        SortBy: 'SortName',\n        SortOrder: 'Ascending',\n        IncludeItemTypes: 'MusicVideo',\n        Recursive: true,\n        Fields: 'PrimaryImageAspectRatio,BasicSyncInfo,CanDelete,MediaSourceCount',\n        AlbumIds: item.Id\n    }).then(function (result) {\n        if (result.Items.length) {\n            page.querySelector('#musicVideosCollapsible').classList.remove('hide');\n            const musicVideosContent = page.querySelector('.musicVideosContent');\n            musicVideosContent.innerHTML = getVideosHtml(result.Items);\n            imageLoader.lazyChildren(musicVideosContent);\n        } else {\n            page.querySelector('#musicVideosCollapsible').classList.add('hide');\n        }\n    });\n}\n\nfunction renderAdditionalParts(page, item, user) {\n    connectionManager.getApiClient(item.ServerId).getAdditionalVideoParts(user.Id, item.Id).then(function (result) {\n        if (result.Items.length) {\n            page.querySelector('#additionalPartsCollapsible').classList.remove('hide');\n            const additionalPartsContent = page.querySelector('#additionalPartsContent');\n            additionalPartsContent.innerHTML = getVideosHtml(result.Items);\n            imageLoader.lazyChildren(additionalPartsContent);\n        } else {\n            page.querySelector('#additionalPartsCollapsible').classList.add('hide');\n        }\n    });\n}\n\nfunction renderScenes(page, item) {\n    let chapters = item.Chapters || [];\n\n    if (chapters.length && !chapters[0].ImageTag && (chapters = []), chapters.length) {\n        page.querySelector('#scenesCollapsible').classList.remove('hide');\n        const scenesContent = page.querySelector('#scenesContent');\n\n        import('chaptercardbuilder').then(({ default: chaptercardbuilder }) => {\n            chaptercardbuilder.buildChapterCards(item, chapters, {\n                itemsContainer: scenesContent,\n                backdropShape: 'overflowBackdrop',\n                squareShape: 'overflowSquare',\n                imageBlurhashes: item.ImageBlurHashes\n            });\n        });\n    } else {\n        page.querySelector('#scenesCollapsible').classList.add('hide');\n    }\n}\n\nfunction getVideosHtml(items) {\n    return cardBuilder.getCardsHtml({\n        items: items,\n        shape: 'autooverflow',\n        showTitle: true,\n        action: 'play',\n        overlayText: false,\n        centerText: true,\n        showRuntime: true\n    });\n}\n\nfunction renderSpecials(page, item, user) {\n    connectionManager.getApiClient(item.ServerId).getSpecialFeatures(user.Id, item.Id).then(function (specials) {\n        const specialsContent = page.querySelector('#specialsContent');\n        specialsContent.innerHTML = getVideosHtml(specials);\n        imageLoader.lazyChildren(specialsContent);\n    });\n}\n\nfunction renderCast(page, item) {\n    const people = (item.People || []).filter(function (p) {\n        return p.Type === 'Actor';\n    });\n\n    if (!people.length) {\n        return void page.querySelector('#castCollapsible').classList.add('hide');\n    }\n\n    page.querySelector('#castCollapsible').classList.remove('hide');\n    const castContent = page.querySelector('#castContent');\n\n    import('peoplecardbuilder').then(({ default: peoplecardbuilder }) => {\n        peoplecardbuilder.buildPeopleCards(people, {\n            itemsContainer: castContent,\n            coverImage: true,\n            serverId: item.ServerId,\n            shape: 'overflowPortrait',\n            imageBlurhashes: item.ImageBlurHashes\n        });\n    });\n}\n\nfunction itemDetailPage() {\n    const self = this;\n    self.setInitialCollapsibleState = setInitialCollapsibleState;\n    self.renderDetails = renderDetails;\n    self.renderCast = renderCast;\n}\n\nfunction bindAll(view, selector, eventName, fn) {\n    const elems = view.querySelectorAll(selector);\n\n    for (const elem of elems) {\n        elem.addEventListener(eventName, fn);\n    }\n}\n\nfunction onTrackSelectionsSubmit(e) {\n    e.preventDefault();\n    return false;\n}\n\nwindow.ItemDetailPage = new itemDetailPage();\n\nexport default function (view, params) {\n    function reload(instance, page, params) {\n        loading.show();\n\n        const apiClient = params.serverId ? connectionManager.getApiClient(params.serverId) : ApiClient;\n\n        Promise.all([getPromise(apiClient, params), apiClient.getCurrentUser()]).then(([item, user]) => {\n            currentItem = item;\n            reloadFromItem(instance, page, params, item, user);\n        }).catch((error) => {\n            console.error('failed to get item or current user: ', error);\n        });\n    }\n\n    function splitVersions(instance, page, apiClient, params) {\n        import('confirm').then(({ default: confirm }) => {\n            confirm('Are you sure you wish to split the media sources into separate items?', 'Split Media Apart').then(function () {\n                loading.show();\n                apiClient.ajax({\n                    type: 'DELETE',\n                    url: apiClient.getUrl('Videos/' + params.id + '/AlternateSources')\n                }).then(function () {\n                    loading.hide();\n                    reload(instance, page, params);\n                });\n            });\n        });\n    }\n\n    function getPlayOptions(startPosition) {\n        const audioStreamIndex = view.querySelector('.selectAudio').value || null;\n        return {\n            startPositionTicks: startPosition,\n            mediaSourceId: view.querySelector('.selectSource').value,\n            audioStreamIndex: audioStreamIndex,\n            subtitleStreamIndex: view.querySelector('.selectSubtitles').value\n        };\n    }\n\n    function playItem(item, startPosition) {\n        const playOptions = getPlayOptions(startPosition);\n        playOptions.items = [item];\n        playbackManager.play(playOptions);\n    }\n\n    function playTrailer() {\n        playbackManager.playTrailers(currentItem);\n    }\n\n    function playCurrentItem(button, mode) {\n        const item = currentItem;\n\n        if (item.Type === 'Program') {\n            const apiClient = connectionManager.getApiClient(item.ServerId);\n            return void apiClient.getLiveTvChannel(item.ChannelId, apiClient.getCurrentUserId()).then(function (channel) {\n                playbackManager.play({\n                    items: [channel]\n                });\n            });\n        }\n\n        playItem(item, item.UserData && mode === 'resume' ? item.UserData.PlaybackPositionTicks : 0);\n    }\n\n    function onPlayClick() {\n        playCurrentItem(this, this.getAttribute('data-mode'));\n    }\n\n    function onPosterClick(e) {\n        itemShortcuts.onClick.call(view.querySelector('.detailImageContainer'), e);\n    }\n\n    function onInstantMixClick() {\n        playbackManager.instantMix(currentItem);\n    }\n\n    function onShuffleClick() {\n        playbackManager.shuffle(currentItem);\n    }\n\n    function onCancelSeriesTimerClick() {\n        import('recordingHelper').then(({ default: recordingHelper }) => {\n            recordingHelper.cancelSeriesTimerWithConfirmation(currentItem.Id, currentItem.ServerId).then(function () {\n                Dashboard.navigate('livetv.html');\n            });\n        });\n    }\n\n    function onCancelTimerClick() {\n        import('recordingHelper').then(({ default: recordingHelper }) => {\n            recordingHelper.cancelTimer(connectionManager.getApiClient(currentItem.ServerId), currentItem.TimerId).then(function () {\n                reload(self, view, params);\n            });\n        });\n    }\n\n    function onPlayTrailerClick() {\n        playTrailer();\n    }\n\n    function onDownloadClick() {\n        import('fileDownloader').then(({ default: fileDownloader }) => {\n            const downloadHref = apiClient.getItemDownloadUrl(currentItem.Id);\n            fileDownloader.download([{\n                url: downloadHref,\n                itemId: currentItem.Id,\n                serverId: currentItem.serverId\n            }]);\n        });\n    }\n\n    function onMoreCommandsClick() {\n        const button = this;\n        let selectedItem = view.querySelector('.selectSource').value || currentItem.Id;\n\n        apiClient.getItem(apiClient.getCurrentUserId(), selectedItem).then(function (item) {\n            selectedItem = item;\n\n            apiClient.getCurrentUser().then(function (user) {\n                itemContextMenu.show(getContextMenuOptions(selectedItem, user, button)).then(function (result) {\n                    if (result.deleted) {\n                        appRouter.goHome();\n                    } else if (result.updated) {\n                        reload(self, view, params);\n                    }\n                });\n            });\n        });\n    }\n\n    function onPlayerChange() {\n        renderTrackSelections(view, self, currentItem);\n        setTrailerButtonVisibility(view, currentItem);\n    }\n\n    function onWebSocketMessage(e, data) {\n        const msg = data;\n\n        if (msg.MessageType === 'UserDataChanged' && currentItem && msg.Data.UserId == apiClient.getCurrentUserId()) {\n            const key = currentItem.UserData.Key;\n            const userData = msg.Data.UserDataList.filter(function (u) {\n                return u.Key == key;\n            })[0];\n\n            if (userData) {\n                currentItem.UserData = userData;\n                reloadPlayButtons(view, currentItem);\n                refreshImage(view, currentItem);\n            }\n        }\n    }\n\n    let currentItem;\n    const self = this;\n    const apiClient = params.serverId ? connectionManager.getApiClient(params.serverId) : ApiClient;\n    view.querySelectorAll('.btnPlay');\n    bindAll(view, '.btnPlay', 'click', onPlayClick);\n    bindAll(view, '.btnResume', 'click', onPlayClick);\n    bindAll(view, '.btnInstantMix', 'click', onInstantMixClick);\n    bindAll(view, '.btnShuffle', 'click', onShuffleClick);\n    bindAll(view, '.btnPlayTrailer', 'click', onPlayTrailerClick);\n    bindAll(view, '.btnCancelSeriesTimer', 'click', onCancelSeriesTimerClick);\n    bindAll(view, '.btnCancelTimer', 'click', onCancelTimerClick);\n    bindAll(view, '.btnDownload', 'click', onDownloadClick);\n    view.querySelector('.detailImageContainer').addEventListener('click', onPosterClick);\n    view.querySelector('.trackSelections').addEventListener('submit', onTrackSelectionsSubmit);\n    view.querySelector('.btnSplitVersions').addEventListener('click', function () {\n        splitVersions(self, view, apiClient, params);\n    });\n    bindAll(view, '.btnMoreCommands', 'click', onMoreCommandsClick);\n    view.querySelector('.selectSource').addEventListener('change', function () {\n        renderVideoSelections(view, self._currentPlaybackMediaSources);\n        renderAudioSelections(view, self._currentPlaybackMediaSources);\n        renderSubtitleSelections(view, self._currentPlaybackMediaSources);\n    });\n    view.addEventListener('viewshow', function (e) {\n        const page = this;\n\n        libraryMenu.setTransparentMenu(true);\n\n        if (e.detail.isRestored) {\n            if (currentItem) {\n                Emby.Page.setTitle('');\n                renderTrackSelections(page, self, currentItem, true);\n            }\n        } else {\n            reload(self, page, params);\n        }\n\n        events.on(apiClient, 'message', onWebSocketMessage);\n        events.on(playbackManager, 'playerchange', onPlayerChange);\n    });\n    view.addEventListener('viewbeforehide', function () {\n        events.off(apiClient, 'message', onWebSocketMessage);\n        events.off(playbackManager, 'playerchange', onPlayerChange);\n        libraryMenu.setTransparentMenu(false);\n    });\n    view.addEventListener('viewdestroy', function () {\n        currentItem = null;\n        self._currentPlaybackMediaSources = null;\n        self.currentRecordingFields = null;\n    });\n}\n"]}