define(["require","exports","events","layoutManager","inputManager","userSettings","libraryMenu","mainTabsManager","cardBuilder","dom","imageLoader","playbackManager","globalize","emby-scroller","emby-itemscontainer","emby-tabs","emby-button"],(function(_require,_exports,_events,_layoutManager,_inputManager,userSettings,_libraryMenu,mainTabsManager,_cardBuilder,_dom,_imageLoader,_playbackManager,_globalize,_embyScroller,_embyItemscontainer,_embyTabs,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function enableScrollX(){return!_layoutManager.default.desktop}function getPortraitShape(){return enableScrollX()?"overflowPortrait":"portrait"}function getRecommendationHtml(recommendation){var html="",title="";switch(recommendation.RecommendationType){case"SimilarToRecentlyPlayed":title=_globalize.default.translate("RecommendationBecauseYouWatched",recommendation.BaselineItemName);break;case"SimilarToLikedItem":title=_globalize.default.translate("RecommendationBecauseYouLike",recommendation.BaselineItemName);break;case"HasDirectorFromRecentlyPlayed":case"HasLikedDirector":title=_globalize.default.translate("RecommendationDirectedBy",recommendation.BaselineItemName);break;case"HasActorFromRecentlyPlayed":case"HasLikedActor":title=_globalize.default.translate("RecommendationStarring",recommendation.BaselineItemName)}html+='<div class="verticalSection">',html+='<h2 class="sectionTitle sectionTitle-cards padded-left">'+title+"</h2>";return enableScrollX()?(html+='<div is="emby-scroller" class="padded-top-focusscale padded-bottom-focusscale" data-mousewheel="false" data-centerfocus="true">',html+='<div is="emby-itemscontainer" class="itemsContainer scrollSlider focuscontainer-x">'):html+='<div is="emby-itemscontainer" class="itemsContainer focuscontainer-x padded-left padded-right vertical-wrap">',html+=_cardBuilder.default.getCardsHtml(recommendation.Items,{shape:getPortraitShape(),scalable:!0,overlayPlayButton:!0,allowBottomPadding:!0,showTitle:!0,showYear:!0,centerText:!0}),enableScrollX()&&(html+="</div>"),html+="</div>",html+="</div>"}function autoFocus(page){new Promise((function(_resolve,_reject){return _require(["autoFocuser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){_ref.default.autoFocus(page)}))}function setScrollClasses(elem,scrollX){scrollX?(elem.classList.add("hiddenScrollX"),_layoutManager.default.tv&&(elem.classList.add("smoothScrollX"),elem.classList.add("padded-top-focusscale"),elem.classList.add("padded-bottom-focusscale")),elem.classList.add("scrollX"),elem.classList.remove("vertical-wrap")):(elem.classList.remove("hiddenScrollX"),elem.classList.remove("smoothScrollX"),elem.classList.remove("scrollX"),elem.classList.add("vertical-wrap"))}function getTabs(){return[{name:_globalize.default.translate("Movies")},{name:_globalize.default.translate("Suggestions")},{name:_globalize.default.translate("Trailers")},{name:_globalize.default.translate("Favorites")},{name:_globalize.default.translate("Collections")},{name:_globalize.default.translate("Genres")}]}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){var _this=this;function onBeforeTabChange(e){!function preLoadTab(page,index){getTabController(page,index,(function(controller){-1==renderedTabs.indexOf(index)&&controller.preRender&&controller.preRender()}))}(view,parseInt(e.detail.selectedTabIndex))}function onTabChange(e){var newIndex=parseInt(e.detail.selectedTabIndex);!function loadTab(page,index){currentTabIndex=index,getTabController(page,index,(function(controller){-1==renderedTabs.indexOf(index)&&(renderedTabs.push(index),controller.renderTab())}))}(view,newIndex)}function getTabContainers(){return view.querySelectorAll(".pageTabContent")}var getTabController=function getTabController(page,index,callback){var depends="";switch(index){case 0:depends="controllers/movies/movies";break;case 1:depends="controllers/movies/moviesrecommended.js";break;case 2:depends="controllers/movies/movietrailers";break;case 3:depends="controllers/movies/movies";break;case 4:depends="controllers/movies/moviecollections";break;case 5:depends="controllers/movies/moviegenres"}new Promise((function(_resolve,_reject){return _require(["".concat(depends)],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){var tabContent,controllerFactory=_ref2.default;index===suggestionsTabIndex&&(tabContent=view.querySelector(".pageTabContent[data-index='"+index+"']"),_this.tabContent=tabContent);var controller=tabControllers[index];controller||(tabContent=view.querySelector(".pageTabContent[data-index='"+index+"']"),controller=index===suggestionsTabIndex?_this:6===index?new controllerFactory(view,tabContent,{collectionType:"movies",parentId:params.topParentId}):0==index||3==index?new controllerFactory(view,params,tabContent,{mode:index?"favorites":"movies"}):new controllerFactory(view,params,tabContent),tabControllers[index]=controller,controller.initTab&&controller.initTab()),callback(controller)}))};function onPlaybackStop(e,state){state.NowPlayingItem&&"Video"==state.NowPlayingItem.MediaType&&(renderedTabs=[],mainTabsManager.getTabsElement().triggerTabChange())}function onInputCommand(e){switch(e.detail.command){case"search":e.preventDefault(),Dashboard.navigate("search.html?collectionType=movies&parentId="+params.topParentId)}}var currentTabIndex=parseInt(params.tab||function getDefaultTabIndex(folderId){switch(userSettings.get("landing-"+folderId)){case"suggestions":return 1;case"favorites":return 3;case"collections":return 4;case"genres":return 5;default:return 0}}(params.topParentId)),suggestionsTabIndex=1;this.initTab=function(){!function initSuggestedTab(page,tabContent){var _step,_iterator=function _createForOfIteratorHelper(o,allowArrayLike){var it;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e2){didErr=!0,err=_e2},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}(tabContent.querySelectorAll(".itemsContainer"));try{for(_iterator.s();!(_step=_iterator.n()).done;){setScrollClasses(_step.value,enableScrollX())}}catch(err){_iterator.e(err)}finally{_iterator.f()}}(0,view.querySelector(".pageTabContent[data-index='"+suggestionsTabIndex+"']"))},this.renderTab=function(){var tabContent=view.querySelector(".pageTabContent[data-index='"+suggestionsTabIndex+"']");!function loadSuggestionsTab(view,params,tabContent){var parentId=params.topParentId,userId=ApiClient.getCurrentUserId();(function loadResume(page,userId,parentId){var screenWidth=_dom.default.getWindowSize().innerWidth,options={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Movie",Filters:"IsResumable",Limit:screenWidth>=1920||screenWidth>=1600?5:3,Recursive:!0,Fields:"PrimaryImageAspectRatio,MediaSourceCount,BasicSyncInfo",CollapseBoxSetItems:!1,ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(userId,options).then((function(result){result.Items.length?page.querySelector("#resumableSection").classList.remove("hide"):page.querySelector("#resumableSection").classList.add("hide");var allowBottomPadding=!enableScrollX(),container=page.querySelector("#resumableItems");_cardBuilder.default.buildCards(result.Items,{itemsContainer:container,preferThumb:!0,shape:enableScrollX()?"overflowBackdrop":"backdrop",scalable:!0,overlayPlayButton:!0,allowBottomPadding:allowBottomPadding,cardLayout:!1,showTitle:!0,showYear:!0,centerText:!0}),autoFocus(page)}))})(tabContent,userId,parentId),function loadLatest(page,userId,parentId){var options={IncludeItemTypes:"Movie",Limit:18,Fields:"PrimaryImageAspectRatio,MediaSourceCount,BasicSyncInfo",ParentId:parentId,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getJSON(ApiClient.getUrl("Users/"+userId+"/Items/Latest",options)).then((function(items){var allowBottomPadding=!enableScrollX(),container=page.querySelector("#recentlyAddedItems");_cardBuilder.default.buildCards(items,{itemsContainer:container,shape:getPortraitShape(),scalable:!0,overlayPlayButton:!0,allowBottomPadding:allowBottomPadding,showTitle:!0,showYear:!0,centerText:!0}),autoFocus(page)}))}(tabContent,userId,parentId),function loadSuggestions(page,userId,parentId){var screenWidth=_dom.default.getWindowSize().innerWidth,url=ApiClient.getUrl("Movies/Recommendations",{userId:userId,categoryLimit:6,ItemLimit:screenWidth>=1920||screenWidth>=1600?8:screenWidth>=1200?6:5,Fields:"PrimaryImageAspectRatio,MediaSourceCount,BasicSyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"});ApiClient.getJSON(url).then((function(recommendations){if(!recommendations.length)return page.querySelector(".noItemsMessage").classList.remove("hide"),void(page.querySelector(".recommendations").innerHTML="");var html=recommendations.map(getRecommendationHtml).join("");page.querySelector(".noItemsMessage").classList.add("hide");var recs=page.querySelector(".recommendations");recs.innerHTML=html,_imageLoader.default.lazyChildren(recs),autoFocus(page)}))}(tabContent,userId)}(0,params,tabContent)};var tabControllers=[],renderedTabs=[];view.addEventListener("viewshow",(function(e){if(function initTabs(){mainTabsManager.setTabs(view,currentTabIndex,getTabs,getTabContainers,onBeforeTabChange,onTabChange)}(),!view.getAttribute("data-title")){var parentId=params.topParentId;parentId?ApiClient.getItem(ApiClient.getCurrentUserId(),parentId).then((function(item){view.setAttribute("data-title",item.Name),_libraryMenu.default.setTitle(item.Name)})):(view.setAttribute("data-title",_globalize.default.translate("Movies")),_libraryMenu.default.setTitle(_globalize.default.translate("Movies")))}_events.default.on(_playbackManager.default,"playbackstop",onPlaybackStop),_inputManager.default.on(window,onInputCommand)})),view.addEventListener("viewbeforehide",(function(){_inputManager.default.off(window,onInputCommand)}));for(var _i=0,_tabControllers=tabControllers;_i<_tabControllers.length;_i++){var tabController=_tabControllers[_i];tabController.destroy&&tabController.destroy()}},_events=_interopRequireDefault(_events),_layoutManager=_interopRequireDefault(_layoutManager),_inputManager=_interopRequireDefault(_inputManager),userSettings=_interopRequireWildcard(userSettings),_libraryMenu=_interopRequireDefault(_libraryMenu),mainTabsManager=_interopRequireWildcard(mainTabsManager),_cardBuilder=_interopRequireDefault(_cardBuilder),_dom=_interopRequireDefault(_dom),_imageLoader=_interopRequireDefault(_imageLoader),_playbackManager=_interopRequireDefault(_playbackManager),_globalize=_interopRequireDefault(_globalize)}));
//# sourceMappingURL=moviesrecommended.js.map
