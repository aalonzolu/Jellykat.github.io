define(["require","exports","layoutManager","userSettings","inputManager","loading","globalize","mainTabsManager","cardBuilder","imageLoader","scrollStyles","emby-itemscontainer","emby-tabs","emby-button"],(function(_require,_exports,_layoutManager,userSettings,_inputManager,_loading,_globalize,mainTabsManager,_cardBuilder,_imageLoader,_scrollStyles,_embyItemscontainer,_embyTabs,_embyButton){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var cache=new WeakMap;return _getRequireWildcardCache=function _getRequireWildcardCache(){return cache},cache}function _interopRequireWildcard(obj){if(obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache();if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function enableScrollX(){return!_layoutManager.default.desktop}function getLimit(){return enableScrollX()?12:9}function reload(page,enableFullRender){enableFullRender&&(!function loadRecommendedPrograms(page){_loading.default.show();var limit=getLimit();enableScrollX()&&(limit*=2),ApiClient.getLiveTvRecommendedPrograms({userId:Dashboard.getCurrentUserId(),IsAiring:!0,limit:limit,ImageTypeLimit:1,EnableImageTypes:"Primary,Thumb,Backdrop",EnableTotalRecordCount:!1,Fields:"ChannelInfo,PrimaryImageAspectRatio"}).then((function(result){renderItems(page,result.Items,"activeProgramItems","play",{showAirDateTime:!1,showAirEndTime:!0}),_loading.default.hide(),new Promise((function(_resolve,_reject){return _require(["autoFocuser"],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref){_ref.default.autoFocus(page)}))}))}(page),ApiClient.getLiveTvPrograms({userId:Dashboard.getCurrentUserId(),HasAired:!1,limit:getLimit(),IsMovie:!1,IsSports:!1,IsKids:!1,IsNews:!1,IsSeries:!0,EnableTotalRecordCount:!1,Fields:"ChannelInfo,PrimaryImageAspectRatio",EnableImageTypes:"Primary,Thumb"}).then((function(result){renderItems(page,result.Items,"upcomingEpisodeItems")})),ApiClient.getLiveTvPrograms({userId:Dashboard.getCurrentUserId(),HasAired:!1,limit:getLimit(),IsMovie:!0,EnableTotalRecordCount:!1,Fields:"ChannelInfo",EnableImageTypes:"Primary,Thumb"}).then((function(result){renderItems(page,result.Items,"upcomingTvMovieItems",null,{shape:enableScrollX()?"overflowPortrait":"portrait",preferThumb:null,showParentTitle:!1})})),ApiClient.getLiveTvPrograms({userId:Dashboard.getCurrentUserId(),HasAired:!1,limit:getLimit(),IsSports:!0,EnableTotalRecordCount:!1,Fields:"ChannelInfo,PrimaryImageAspectRatio",EnableImageTypes:"Primary,Thumb"}).then((function(result){renderItems(page,result.Items,"upcomingSportsItems")})),ApiClient.getLiveTvPrograms({userId:Dashboard.getCurrentUserId(),HasAired:!1,limit:getLimit(),IsKids:!0,EnableTotalRecordCount:!1,Fields:"ChannelInfo,PrimaryImageAspectRatio",EnableImageTypes:"Primary,Thumb"}).then((function(result){renderItems(page,result.Items,"upcomingKidsItems")})),ApiClient.getLiveTvPrograms({userId:Dashboard.getCurrentUserId(),HasAired:!1,limit:getLimit(),IsNews:!0,EnableTotalRecordCount:!1,Fields:"ChannelInfo,PrimaryImageAspectRatio",EnableImageTypes:"Primary,Thumb"}).then((function(result){renderItems(page,result.Items,"upcomingNewsItems",null,{showParentTitleOrTitle:!0,showTitle:!1,showParentTitle:!1})})))}function renderItems(page,items,sectionClass,overlayButton,cardOptions){var html=_cardBuilder.default.getCardsHtml(Object.assign({items:items,preferThumb:"auto",inheritThumb:!1,shape:enableScrollX()?"autooverflow":"auto",defaultShape:enableScrollX()?"overflowBackdrop":"backdrop",showParentTitle:!0,showTitle:!0,centerText:!0,coverImage:!0,overlayText:!1,lazy:!0,overlayPlayButton:"play"===overlayButton,overlayMoreButton:"more"===overlayButton,overlayInfoButton:"info"===overlayButton,allowBottomPadding:!enableScrollX(),showAirTime:!0,showAirDateTime:!0},cardOptions||{})),elem=page.querySelector("."+sectionClass);elem.innerHTML=html,_imageLoader.default.lazyChildren(elem)}function getTabs(){return[{name:_globalize.default.translate("Programs")},{name:_globalize.default.translate("Guide")},{name:_globalize.default.translate("Channels")},{name:_globalize.default.translate("Recordings")},{name:_globalize.default.translate("Schedule")},{name:_globalize.default.translate("Series")}]}function setScrollClasses(elem,scrollX){scrollX?(elem.classList.add("hiddenScrollX"),_layoutManager.default.tv&&elem.classList.add("smoothScrollX"),elem.classList.add("scrollX"),elem.classList.remove("vertical-wrap")):(elem.classList.remove("hiddenScrollX"),elem.classList.remove("smoothScrollX"),elem.classList.remove("scrollX"),elem.classList.add("vertical-wrap"))}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=function _default(view,params){function onBeforeTabChange(evt){!function preLoadTab(page,index){getTabController(page,index,(function(controller){-1===renderedTabs.indexOf(index)&&controller.preRender&&controller.preRender()}))}(view,parseInt(evt.detail.selectedTabIndex))}function onTabChange(evt){var previousTabController=tabControllers[parseInt(evt.detail.previousIndex)];previousTabController&&previousTabController.onHide&&previousTabController.onHide(),function loadTab(page,index){currentTabIndex=index,getTabController(page,index,(function(controller){initialTabIndex=null,-1===renderedTabs.indexOf(index)?(1===index&&renderedTabs.push(index),controller.renderTab()):controller.onShow&&controller.onShow(),currentTabController=controller}))}(view,parseInt(evt.detail.selectedTabIndex))}function getTabContainers(){return view.querySelectorAll(".pageTabContent")}function getTabController(page,index,callback){var depends;switch(index){case 0:depends="controllers/livetv/livetvsuggested";break;case 1:depends="controllers/livetv/livetvguide";break;case 2:depends="controllers/livetv/livetvchannels";break;case 3:depends="controllers/livetv/livetvrecordings";break;case 4:depends="controllers/livetv/livetvschedule";break;case 5:depends="controllers/livetv/livetvseriestimers"}new Promise((function(_resolve,_reject){return _require(["".concat(depends)],(function(imported){return _resolve(_interopRequireWildcard(imported))}),_reject)})).then((function(_ref2){var tabContent,controllerFactory=_ref2.default;0===index&&(tabContent=view.querySelector('.pageTabContent[data-index="'.concat(index,'"]')),self.tabContent=tabContent);var controller=tabControllers[index];controller||(tabContent=view.querySelector('.pageTabContent[data-index="'.concat(index,'"]')),controller=0===index?self:6===index?new controllerFactory(view,tabContent,{collectionType:"livetv"}):new controllerFactory(view,params,tabContent),tabControllers[index]=controller,controller.initTab&&controller.initTab()),callback(controller)}))}function onInputCommand(evt){"search"===evt.detail.command&&(evt.preventDefault(),Dashboard.navigate("search.html?collectionType=livetv"))}var currentTabController,self=this,currentTabIndex=parseInt(params.tab||function getDefaultTabIndex(folderId){if("guide"===userSettings.get("landing-"+folderId))return 1;return 0}("livetv")),initialTabIndex=currentTabIndex,lastFullRender=0;[].forEach.call(view.querySelectorAll(".sectionTitleTextButton-programs"),(function(link){var href=link.href;href&&(link.href=href+"&serverId="+ApiClient.serverId())})),self.initTab=function(){for(var containers=view.querySelector('.pageTabContent[data-index="0"]').querySelectorAll(".itemsContainer"),i=0,length=containers.length;i<length;i++)setScrollClasses(containers[i],enableScrollX())},self.renderTab=function(){var tabContent=view.querySelector('.pageTabContent[data-index="0"]');!function enableFullRender(){return(new Date).getTime()-lastFullRender>3e5}()?reload(tabContent):(reload(tabContent,!0),lastFullRender=(new Date).getTime())};var tabControllers=[],renderedTabs=[];view.addEventListener("viewbeforeshow",(function(evt){evt.detail.isRestored,function initTabs(){mainTabsManager.setTabs(view,currentTabIndex,getTabs,getTabContainers,onBeforeTabChange,onTabChange)}()})),view.addEventListener("viewshow",(function(evt){evt.detail.isRestored||mainTabsManager.selectedTabIndex(initialTabIndex),_inputManager.default.on(window,onInputCommand)})),view.addEventListener("viewbeforehide",(function(){currentTabController&&currentTabController.onHide&&currentTabController.onHide(),_inputManager.default.off(window,onInputCommand)})),view.addEventListener("viewdestroy",(function(){tabControllers.forEach((function(tabController){tabController.destroy&&tabController.destroy()}))}))},_layoutManager=_interopRequireDefault(_layoutManager),userSettings=_interopRequireWildcard(userSettings),_inputManager=_interopRequireDefault(_inputManager),_loading=_interopRequireDefault(_loading),_globalize=_interopRequireDefault(_globalize),mainTabsManager=_interopRequireWildcard(mainTabsManager),_cardBuilder=_interopRequireDefault(_cardBuilder),_imageLoader=_interopRequireDefault(_imageLoader)}));
//# sourceMappingURL=livetvsuggested.js.map
